'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

/*import * as lfo  from 'waves-lfo/client';
import * as Myo from 'dist/client/js/myo';
import * as SG from 'ml-savitzky-golay';
import * as config from '../../config/default';*/

var lfo = require('waves-lfo/client');
var Myo = require('./myo');
var SG = require('ml-savitzky-golay');
var config = require('../../../config/configServer');

//Gravity constant
var g = 9.81;

//Constant for window Length used
var EMGWindowLength = 500;
var acceleroWindowLength = 30;
//Modification en direct
var speedRateWindowLength = 10;
var amplitudeWindowLength = 10;
var SGWindowLength = 22;

//Time for the bpfDisplay
var time = 0;
var dt = 0.01;
var timeEMG = 0;
var dtEMG = 0.01;

//Socked to send data to node
var socketSendJerkiness = new lfo.sink.SocketSend({ port: config.socketClientToServer.port });

//Starting myo
Myo.connect('com.stolksdorf.myAwesomeApp');
var myMyo = void 0;

//Creation of graph
var eventInAccelero = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 3,
  frameRate: 0.01,
  description: ['acceleroX', 'acceleroY', 'acceleroZ']
});
var eventInSmoothness = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 1,
  frameRate: 0.01,
  description: ['smoothX', 'smoothY', 'smoothZ']
});
var eventInGyro = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 3,
  frameRate: 0.01,
  description: ['gyroX', 'gyroY', 'gyroZ']
});
var eventInEMG = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 8,
  frameRate: 0.01,
  description: ['emg', 'emg', 'emg', 'emg', 'emg', 'emg', 'emg', 'emg']
});
var eventInEMGSliding = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 1,
  frameRate: 0.01,
  description: ['emgSliding']
});
var eventInSmoothnessRecorded = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 1,
  frameRate: 0.01,
  description: ['smoothX']
});

// initialize and start the different graph used
function initGraph() {
  //eventInAccelero.start();
  //eventInGyro.start();
  //eventInEMGSliding.start();
  //eventInEMG.start();
  eventInSmoothnessRecorded.start();
  eventInSmoothness.start();

  console.log("event in started");
  /*ACCELERO*/
  //eventInAccelero.connect(bpfDisplayAccelero);
  /*JERKINESS RATE*/
  //eventInSmoothness.connect(bpfDisplayJerkiness);
  eventInSmoothness.connect(socketSendJerkiness);
  /*EMG*/
  //eventInEMG.connect(bpfDisplayEMG);
  /*EMGS SLIDING WINDOW*/
  //eventInEMGSliding.connect(bpfDisplayEMGSlinding);
}

/*MYO starting event handler*/
Myo.onError = function () {
  console.log("Couldn't connect to Myo Connect");
};

Myo.on('connected', function () {
  myMyo = this;
  //myMyo.setLockingPolicy("Manual");
  addEvents(myMyo);
});

var addEvents = function addEvents(myo) {

  myMyo.streamEMG(true);
  Myo.on('emg', function (data) {
    //displayEMGWindow(EMGWindowLength,data);
  });

  var bpfDisplayAccelero = new lfo.sink.BpfDisplay({
    canvas: '#canvasBPFAccelero',
    width: 400,
    height: 250,
    duration: 5,
    max: 9,
    min: -9
  });
  var bpfDisplayJerkiness = new lfo.sink.BpfDisplay({
    canvas: '#bpfDisplayJerkiness',
    width: 400,
    height: 250,
    duration: 5,
    max: 1,
    min: -1
  });
  var bpfDisplayEMG = new lfo.sink.BpfDisplay({
    canvas: '#canvasEMG1',
    width: 400,
    height: 250,
    duration: 5,
    max: 128,
    min: -128
  });
  var bpfDisplayEMGSlinding = new lfo.sink.BpfDisplay({
    canvas: '#canvasEMG2',
    width: 400,
    height: 250,
    duration: 5,
    max: 1,
    min: -1
  });

  //Le low pass ne marche pas et je ne sais toujours pas pourquoi. Probleme de config?
  var biquad = new lfo.operator.Biquad({
    type: 'lowpass',
    f0: 50,
    gain: 3,
    q: 12
  });

  var biquad2 = new lfo.operator.Biquad({
    type: 'lowpass',
    f0: 500,
    gain: 3,
    q: 12
  });

  var movingAverage = new lfo.operator.MovingAverage({
    order: 5,
    fill: 0
  });

  //Init the different graph used and choose wich one to display
  initGraph();
  Myo.on('imu', function (data) {
    myMyo.lock();
    displayWindow(data);
  });
};

function displayWindow(data) {
  //displayAcceleroWindowSpeed(acceleroWindowLength,data);
  displaySmoothness(SGWindowLength, data);
  //displayEMGWindow(SGWindowLength,data);
}

/*Method sliding window computation, require less computation than the naive one*/
var ansX = [];
var ansY = [];
var ansZ = [];
var computedSpeedRate = 0;
var sumLastElem = 0;
var sumFirstElem = 0;
function computeSpeedRateAdaptativeWindow(windowLength, newX, newY, newZ) {
  if (ansX.length >= windowLength) {
    var firstElementX = ansX.shift();
    var firstElementY = ansY.shift();
    var firstElementZ = ansZ.shift();
    sumFirstElem = firstElementX + firstElementY + firstElementZ;
  }
  var x = Math.abs(newX / g);
  // let x = (newX/g);
  ansX.push(x);
  var y = Math.abs(newY / g);
  // let y = (newY/g);
  ansY.push(y);
  var z = Math.abs(newZ / g);
  //let z = (newZ/g);
  ansZ.push(z);

  sumLastElem = x + y + z;
  computedSpeedRate = computedSpeedRate - sumFirstElem + sumLastElem;

  return computedSpeedRate;
}

//Algorithm de calcul naif de la vitesse selon une fenetre: retourne le meme resultat que l'algorithme evolué
var ansXNaif = [];
var ansYNaif = [];
var ansZNaif = [];
function computeSpeedRateAdaptativeWindowNaif(windowLength, x, y, z) {
  console.log("The function computeSpeedRateAdaptativeWindowNaif is deprecated, use computeSpeedRateAdaptativeWindow instead.");
  if (ansXNaif.length >= windowLength) {
    ansXNaif.shift();
    ansYNaif.shift();
    ansZNaif.shift();
  }
  ansXNaif.push(x / g);
  ansYNaif.push(y / g);
  ansZNaif.push(z / g);

  var speedRate = 0;
  for (var _i = 0; _i < windowLength; _i++) {
    speedRate += ansXNaif[_i] + ansYNaif[_i] + ansZNaif[_i];
    //speedRate += Math.abs(ansX[i]/g)+ Math.abs(ansY[i]/g) +  Math.abs(ansZ[i]/g);
    // speedRate +=Math.sqrt(Math.pow( Math.abs(ansX[i]/g) ,2)+ Math.pow(  Math.abs(ansY[i]/g),2) + Math.pow( Math.abs(ansZ[i]/g),2));
  }
  return speedRate;
}

function displayAcceleroWindowSpeed(windowLength, data) {
  time += dt;
  var speedRate = computeSpeedRateAdaptativeWindow(windowLength, data.accelerometer.x, data.accelerometer.y, data.accelerometer.z);
  var frameAccelero = {
    time: time,
    data: [data.accelerometer.x * speedRate, data.accelerometer.y * speedRate, data.accelerometer.z * speedRate],
    metadata: true
  };
  eventInAccelero.processFrame(frameAccelero);
}

//For the sliding window of kinestetic awareness replication
var slidingWindow = [];
function displayEMGWindow(windowLength, data) {
  timeEMG += dtEMG;
  //Slinding window of EMG
  if (slidingWindow.length > windowLength) {
    slidingWindow.shift();
  }
  slidingWindow.push(Math.max.apply(Math, _toConsumableArray(data)));
  var maxSliding = Math.max.apply(Math, slidingWindow);
  var frameEMGSliding = {
    time: timeEMG,
    data: slidingWindow[slidingWindow.length - 1] / maxSliding
  };

  var frameEMG = {
    time: timeEMG,
    data: data
  };
  eventInEMGSliding.processFrame(frameEMGSliding);
  eventInEMG.processFrame(frameEMG);
}

//variables for the savitzky-golay filter
var arrayFilteringX = [];
var arrayFilteringY = [];
var arrayFilteringZ = [];
var ansx = [];
var ansy = [];
var ansz = [];
var options = { derivative: 1, windowSize: SGWindowLength - 1 };
var optionsGolayLowPass = { derivative: 0 };
function displaySmoothness(windowLengthSG, data) {
  //Calculing smoothness
  arrayFilteringX.push(data.accelerometer.x);
  arrayFilteringY.push(data.accelerometer.y);
  arrayFilteringZ.push(data.accelerometer.z);

  //taille de la fenetre de calcule de l'algorithme
  if (arrayFilteringZ.length >= windowLengthSG) {
    arrayFilteringX.shift();
    arrayFilteringY.shift();
    arrayFilteringZ.shift();

    //apllication de savitzky-golay filter
    ansx = SG(arrayFilteringX, 1, options);
    ansy = SG(arrayFilteringY, 1, options);
    ansz = SG(arrayFilteringZ, 1, options);

    //normalising data
    var normaliseData = Math.sqrt(Math.pow(ansx[ansx.length - 1], 2) + Math.pow(ansy[ansy.length - 1], 2) + Math.pow(ansz[ansz.length - 1], 2));
    var amplitudeData = computeAmplitudeWindow(amplitudeWindowLength, normaliseData);
    var speedRate = computeSpeedRateAdaptativeWindow(speedRateWindowLength, data.accelerometer.x, data.accelerometer.y, data.accelerometer.z);
    // console.log("speedRate : " + speedRate);

    if (recording) {
      arrayRecorded.push(normaliseData);
      console.log("arrayRecorded : " + arrayRecorded.length);
    }

    var frameSmoothness = {
      time: time,
      data: amplitudeData,
      //data: normaliseData,
      metadata: null
    };
    eventInSmoothness.processFrame(frameSmoothness);
  }
}

//version naive de l'algorithme, le for peut etre remplacé comme dans la fonction: computeSpeedRateAdaptativeWindow
//Moyenne des données du jerk normalisé
var arrayAmplitude = [];
function computeAmplitudeWindow(windowLength, data) {
  var amplitudeRate = 0;
  if (arrayAmplitude.length > windowLength) {
    arrayAmplitude.shift();
  }
  arrayAmplitude.push(data);
  for (var _i2 = 0; _i2 < windowLength; _i2++) {
    amplitudeRate += arrayAmplitude[_i2];
  }
  amplitudeRate /= windowLength;
  // console.log("amplitudeRate : " + amplitudeRate );
  return amplitudeRate;
}

window.setSGWindowLength = function (newValue) {
  //console.log("new value SG : " + newValue);
  SGWindowLength = newValue;
  options = { derivative: 1, windowSize: SGWindowLength - 1 };

  arrayFilteringX = [];
  arrayFilteringY = [];
  arrayFilteringZ = [];
  ansX = [];
  ansY = [];
  ansZ = [];
};

window.setAmplitudeWindowLength = function (newValue) {
  amplitudeWindowLength = newValue;
};

var arrayRecorded = [];
var recording = false;

/*Button function*/
window.startRecord = function () {
  console.log("recording");
  eventInSmoothness.stop();
  StreamOnOff("off");
  arrayRecorded = [];
  recording = true;
};

window.stopRecord = function () {
  eventInSmoothness.start();
  recording = false;
};

var i = 0;
var timer;

window.playRecorded = function () {
  timer = setInterval(playingRecord, 20);
  eventInSmoothnessRecorded.connect(socketSendJerkiness);
  eventInSmoothnessRecorded.start();
  eventInSmoothness.stop();

  function playingRecord() {
    if (i < arrayRecorded.length) {
      var frameSmoothness = {
        time: i,
        data: arrayRecorded[i],
        //data: normaliseData,
        metadata: null
      };
      eventInSmoothnessRecorded.processFrame(frameSmoothness);
    } else {
      clearTimeout(timer);
      eventInSmoothnessRecorded.stop();
      eventInSmoothness.start();
      i = 0;
    }
    i++;
  }
};
window.stopingRecorded = function () {
  clearTimeout(timer);
  eventInSmoothnessRecorded.stop();
  eventInSmoothness.start();
  StreamOnOff("on");

  i = 0;
};

//2000 = on, 1000 = off
var onOff = 1000;
window.StreamOnOff = function (value) {
  if (value === "on") {
    onOff = 1000;
    eventInSmoothness.start();
  } else if (value === "off") {
    onOff = 2000;
    //eventInSmoothness.stop();
  } else {
    if (onOff === 1000) {
      console.log("on : " + onOff);
      eventInSmoothness.start();
      onOff = 2000;
    } else {
      console.log("off  : " + onOff);
      onOff = 1000;
      //eventInSmoothness.stop();
    }
  }

  var frameSmoothnessOnOFF = {
    time: i,
    data: onOff,
    //data: normaliseData,
    metadata: null
  };

  eventInSmoothness.processFrame(frameSmoothnessOnOFF);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbnNvclNjcmlwdC5qcyJdLCJuYW1lcyI6WyJsZm8iLCJyZXF1aXJlIiwiTXlvIiwiU0ciLCJjb25maWciLCJnIiwiRU1HV2luZG93TGVuZ3RoIiwiYWNjZWxlcm9XaW5kb3dMZW5ndGgiLCJzcGVlZFJhdGVXaW5kb3dMZW5ndGgiLCJhbXBsaXR1ZGVXaW5kb3dMZW5ndGgiLCJTR1dpbmRvd0xlbmd0aCIsInRpbWUiLCJkdCIsInRpbWVFTUciLCJkdEVNRyIsInNvY2tldFNlbmRKZXJraW5lc3MiLCJzaW5rIiwiU29ja2V0U2VuZCIsInBvcnQiLCJzb2NrZXRDbGllbnRUb1NlcnZlciIsImNvbm5lY3QiLCJteU15byIsImV2ZW50SW5BY2NlbGVybyIsInNvdXJjZSIsIkV2ZW50SW4iLCJmcmFtZVR5cGUiLCJmcmFtZVNpemUiLCJmcmFtZVJhdGUiLCJkZXNjcmlwdGlvbiIsImV2ZW50SW5TbW9vdGhuZXNzIiwiZXZlbnRJbkd5cm8iLCJldmVudEluRU1HIiwiZXZlbnRJbkVNR1NsaWRpbmciLCJldmVudEluU21vb3RobmVzc1JlY29yZGVkIiwiaW5pdEdyYXBoIiwic3RhcnQiLCJjb25zb2xlIiwibG9nIiwib25FcnJvciIsIm9uIiwiYWRkRXZlbnRzIiwibXlvIiwic3RyZWFtRU1HIiwiZGF0YSIsImJwZkRpc3BsYXlBY2NlbGVybyIsIkJwZkRpc3BsYXkiLCJjYW52YXMiLCJ3aWR0aCIsImhlaWdodCIsImR1cmF0aW9uIiwibWF4IiwibWluIiwiYnBmRGlzcGxheUplcmtpbmVzcyIsImJwZkRpc3BsYXlFTUciLCJicGZEaXNwbGF5RU1HU2xpbmRpbmciLCJiaXF1YWQiLCJvcGVyYXRvciIsIkJpcXVhZCIsInR5cGUiLCJmMCIsImdhaW4iLCJxIiwiYmlxdWFkMiIsIm1vdmluZ0F2ZXJhZ2UiLCJNb3ZpbmdBdmVyYWdlIiwib3JkZXIiLCJmaWxsIiwibG9jayIsImRpc3BsYXlXaW5kb3ciLCJkaXNwbGF5U21vb3RobmVzcyIsImFuc1giLCJhbnNZIiwiYW5zWiIsImNvbXB1dGVkU3BlZWRSYXRlIiwic3VtTGFzdEVsZW0iLCJzdW1GaXJzdEVsZW0iLCJjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvdyIsIndpbmRvd0xlbmd0aCIsIm5ld1giLCJuZXdZIiwibmV3WiIsImxlbmd0aCIsImZpcnN0RWxlbWVudFgiLCJzaGlmdCIsImZpcnN0RWxlbWVudFkiLCJmaXJzdEVsZW1lbnRaIiwieCIsIk1hdGgiLCJhYnMiLCJwdXNoIiwieSIsInoiLCJhbnNYTmFpZiIsImFuc1lOYWlmIiwiYW5zWk5haWYiLCJjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvd05haWYiLCJzcGVlZFJhdGUiLCJpIiwiZGlzcGxheUFjY2VsZXJvV2luZG93U3BlZWQiLCJhY2NlbGVyb21ldGVyIiwiZnJhbWVBY2NlbGVybyIsIm1ldGFkYXRhIiwicHJvY2Vzc0ZyYW1lIiwic2xpZGluZ1dpbmRvdyIsImRpc3BsYXlFTUdXaW5kb3ciLCJtYXhTbGlkaW5nIiwiZnJhbWVFTUdTbGlkaW5nIiwiZnJhbWVFTUciLCJhcnJheUZpbHRlcmluZ1giLCJhcnJheUZpbHRlcmluZ1kiLCJhcnJheUZpbHRlcmluZ1oiLCJhbnN4IiwiYW5zeSIsImFuc3oiLCJvcHRpb25zIiwiZGVyaXZhdGl2ZSIsIndpbmRvd1NpemUiLCJvcHRpb25zR29sYXlMb3dQYXNzIiwid2luZG93TGVuZ3RoU0ciLCJub3JtYWxpc2VEYXRhIiwic3FydCIsInBvdyIsImFtcGxpdHVkZURhdGEiLCJjb21wdXRlQW1wbGl0dWRlV2luZG93IiwicmVjb3JkaW5nIiwiYXJyYXlSZWNvcmRlZCIsImZyYW1lU21vb3RobmVzcyIsImFycmF5QW1wbGl0dWRlIiwiYW1wbGl0dWRlUmF0ZSIsIndpbmRvdyIsInNldFNHV2luZG93TGVuZ3RoIiwibmV3VmFsdWUiLCJzZXRBbXBsaXR1ZGVXaW5kb3dMZW5ndGgiLCJzdGFydFJlY29yZCIsInN0b3AiLCJTdHJlYW1Pbk9mZiIsInN0b3BSZWNvcmQiLCJ0aW1lciIsInBsYXlSZWNvcmRlZCIsInNldEludGVydmFsIiwicGxheWluZ1JlY29yZCIsImNsZWFyVGltZW91dCIsInN0b3BpbmdSZWNvcmRlZCIsIm9uT2ZmIiwidmFsdWUiLCJmcmFtZVNtb290aG5lc3NPbk9GRiJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7OztBQUtBLElBQUlBLE1BQU1DLFFBQVMsa0JBQVQsQ0FBVjtBQUNBLElBQUlDLE1BQU1ELFFBQVMsT0FBVCxDQUFWO0FBQ0EsSUFBSUUsS0FBS0YsUUFBUSxtQkFBUixDQUFUO0FBQ0EsSUFBSUcsU0FBU0gsUUFBUyw4QkFBVCxDQUFiOztBQUVBO0FBQ0EsSUFBTUksSUFBSSxJQUFWOztBQUVBO0FBQ0EsSUFBSUMsa0JBQWtCLEdBQXRCO0FBQ0EsSUFBSUMsdUJBQXVCLEVBQTNCO0FBQ0E7QUFDQSxJQUFJQyx3QkFBd0IsRUFBNUI7QUFDQSxJQUFJQyx3QkFBd0IsRUFBNUI7QUFDQSxJQUFJQyxpQkFBaUIsRUFBckI7O0FBSUE7QUFDQSxJQUFJQyxPQUFPLENBQVg7QUFDQSxJQUFNQyxLQUFLLElBQVg7QUFDQSxJQUFJQyxVQUFVLENBQWQ7QUFDQSxJQUFNQyxRQUFRLElBQWQ7O0FBRUE7QUFDQSxJQUFNQyxzQkFBc0IsSUFBSWYsSUFBSWdCLElBQUosQ0FBU0MsVUFBYixDQUF3QixFQUFFQyxNQUFNZCxPQUFPZSxvQkFBUCxDQUE0QkQsSUFBcEMsRUFBeEIsQ0FBNUI7O0FBRUE7QUFDQWhCLElBQUlrQixPQUFKLENBQVksNkJBQVo7QUFDQSxJQUFJQyxjQUFKOztBQUdBO0FBQ0EsSUFBTUMsa0JBQWtCLElBQUl0QixJQUFJdUIsTUFBSixDQUFXQyxPQUFmLENBQXVCO0FBQzdDQyxhQUFXLFFBRGtDO0FBRTdDQyxhQUFXLENBRmtDO0FBRzdDQyxhQUFXLElBSGtDO0FBSTdDQyxlQUFhLENBQUMsV0FBRCxFQUFjLFdBQWQsRUFBMkIsV0FBM0I7QUFKZ0MsQ0FBdkIsQ0FBeEI7QUFNQSxJQUFNQyxvQkFBb0IsSUFBSTdCLElBQUl1QixNQUFKLENBQVdDLE9B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QUFQLEdBQXFCLFVBQVVTLEtBQVYsRUFBaUI7QUFDcEMsTUFBR0EsVUFBVSxJQUFiLEVBQWtCO0FBQ2hCRCxZQUFRLElBQVI7QUFDQWxILHNCQUFrQk0sS0FBbEI7QUFDRCxHQUhELE1BR08sSUFBSTZHLFVBQVUsS0FBZCxFQUFvQjtBQUN6QkQsWUFBUSxJQUFSO0FBQ0E7QUFDRCxHQUhNLE1BR0E7QUFDTCxRQUFJQSxVQUFVLElBQWQsRUFBbUI7QUFDakIzRyxjQUFRQyxHQUFSLENBQVksVUFBVTBHLEtBQXRCO0FBQ0FsSCx3QkFBa0JNLEtBQWxCO0FBQ0E0RyxjQUFRLElBQVI7QUFDRCxLQUpELE1BSU87QUFDTDNHLGNBQVFDLEdBQVIsQ0FBWSxZQUFZMEcsS0FBeEI7QUFDQUEsY0FBUSxJQUFSO0FBQ0E7QUFDRDtBQUNGOztBQUVELE1BQUlFLHVCQUF1QjtBQUN6QnRJLFVBQU1zRixDQURtQjtBQUV6QnRELFVBQU1vRyxLQUZtQjtBQUd6QjtBQUNBMUMsY0FBVTtBQUplLEdBQTNCOztBQU9BeEUsb0JBQWtCeUUsWUFBbEIsQ0FBK0IyQyxvQkFBL0I7QUFFRCxDQTVCRCIsImZpbGUiOiJzZW5zb3JTY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmltcG9ydCAqIGFzIGxmbyAgZnJvbSAnd2F2ZXMtbGZvL2NsaWVudCc7XG5pbXBvcnQgKiBhcyBNeW8gZnJvbSAnZGlzdC9jbGllbnQvanMvbXlvJztcbmltcG9ydCAqIGFzIFNHIGZyb20gJ21sLXNhdml0emt5LWdvbGF5JztcbmltcG9ydCAqIGFzIGNvbmZpZyBmcm9tICcuLi8uLi9jb25maWcvZGVmYXVsdCc7Ki9cblxudmFyIGxmbyA9IHJlcXVpcmUoICd3YXZlcy1sZm8vY2xpZW50Jyk7XG52YXIgTXlvID0gcmVxdWlyZSggJy4vbXlvJyk7XG52YXIgU0cgPSByZXF1aXJlKCdtbC1zYXZpdHpreS1nb2xheScpO1xudmFyIGNvbmZpZyA9IHJlcXVpcmUoICcuLi8uLi8uLi9jb25maWcvY29uZmlnU2VydmVyJyk7XG5cbi8vR3Jhdml0eSBjb25zdGFudFxuY29uc3QgZyA9IDkuODE7XG5cbi8vQ29uc3RhbnQgZm9yIHdpbmRvdyBMZW5ndGggdXNlZFxudmFyIEVNR1dpbmRvd0xlbmd0aCA9IDUwMDtcbnZhciBhY2NlbGVyb1dpbmRvd0xlbmd0aCA9IDMwO1xuLy9Nb2RpZmljYXRpb24gZW4gZGlyZWN0XG52YXIgc3BlZWRSYXRlV2luZG93TGVuZ3RoID0gMTA7XG52YXIgYW1wbGl0dWRlV2luZG93TGVuZ3RoID0gMTA7XG52YXIgU0dXaW5kb3dMZW5ndGggPSAyMjtcblxuXG5cbi8vVGltZSBmb3IgdGhlIGJwZkRpc3BsYXlcbmxldCB0aW1lID0gMDtcbmNvbnN0IGR0ID0gMC4wMTtcbmxldCB0aW1lRU1HID0gMDtcbmNvbnN0IGR0RU1HID0gMC4wMTtcblxuLy9Tb2NrZWQgdG8gc2VuZCBkYXRhIHRvIG5vZGVcbmNvbnN0IHNvY2tldFNlbmRKZXJraW5lc3MgPSBuZXcgbGZvLnNpbmsuU29ja2V0U2VuZCh7IHBvcnQ6IGNvbmZpZy5zb2NrZXRDbGllbnRUb1NlcnZlci5wb3J0IH0pO1xuXG4vL1N0YXJ0aW5nIG15b1xuTXlvLmNvbm5lY3QoJ2NvbS5zdG9sa3Nkb3JmLm15QXdlc29tZUFwcCcpO1xubGV0IG15TXlvO1xuXG5cbi8vQ3JlYXRpb24gb2YgZ3JhcGhcbmNvbnN0IGV2ZW50SW5BY2NlbGVybyA9IG5ldyBsZm8uc291cmNlLkV2ZW50SW4oe1xuICBmcmFtZVR5cGU6ICd2ZWN0b3InLFxuICBmcmFtZVNpemU6IDMsXG4gIGZyYW1lUmF0ZTogMC4wMSxcbiAgZGVzY3JpcHRpb246IFsnYWNjZWxlcm9YJywgJ2FjY2VsZXJvWScsICdhY2NlbGVyb1onXSxcbn0pO1xuY29uc3QgZXZlbnRJblNtb290aG5lc3MgPSBuZXcgbGZvLnNvdXJjZS5FdmVudEluKHtcbiAgZnJhbWVUeXBlOiAndmVjdG9yJyxcbiAgZnJhbWVTaXplOiAxLFxuICBmcmFtZVJhdGU6IDAuMDEsXG4gIGRlc2NyaXB0aW9uOiBbJ3Ntb290aFgnLCAnc21vb3RoWScsICdzbW9vdGhaJ10sXG59KTtcbmNvbnN0IGV2ZW50SW5HeXJvID0gbmV3IGxmby5zb3VyY2UuRXZlbnRJbih7XG4gIGZyYW1lVHlwZTogJ3ZlY3RvcicsXG4gIGZyYW1lU2l6ZTogMyxcbiAgZnJhbWVSYXRlOiAwLjAxLFxuICBkZXNjcmlwdGlvbjogWydneXJvWCcsICdneXJvWScsICdneXJvWiddLFxufSk7XG5jb25zdCBldmVudEluRU1HID0gbmV3IGxmby5zb3VyY2UuRXZlbnRJbih7XG4gIGZyYW1lVHlwZTogJ3ZlY3RvcicsXG4gIGZyYW1lU2l6ZTogOCxcbiAgZnJhbWVSYXRlOiAwLjAxLFxuICBkZXNjcmlwdGlvbjogWydlbWcnLCAnZW1nJywgJ2VtZycsJ2VtZycsICdlbWcnLCAnZW1nJywnZW1nJywgJ2VtZyddLFxufSk7XG5jb25zdCBldmVudEluRU1HU2xpZGluZyA9IG5ldyBsZm8uc291cmNlLkV2ZW50SW4oe1xuICBmcmFtZVR5cGU6ICd2ZWN0b3InLFxuICBmcmFtZVNpemU6IDEsXG4gIGZyYW1lUmF0ZTogMC4wMSxcbiAgZGVzY3JpcHRpb246IFsnZW1nU2xpZGluZyddLFxufSk7XG5jb25zdCBldmVudEluU21vb3RobmVzc1JlY29yZGVkID0gbmV3IGxmby5zb3VyY2UuRXZlbnRJbih7XG4gIGZyYW1lVHlwZTogJ3ZlY3RvcicsXG4gIGZyYW1lU2l6ZTogMSxcbiAgZnJhbWVSYXRlOiAwLjAxLFxuICBkZXNjcmlwdGlvbjogWydzbW9vdGhYJ10sXG59KTtcblxuLy8gaW5pdGlhbGl6ZSBhbmQgc3RhcnQgdGhlIGRpZmZlcmVudCBncmFwaCB1c2VkXG5mdW5jdGlvbiBpbml0R3JhcGgoKXtcbi8vZXZlbnRJbkFjY2VsZXJvLnN0YXJ0KCk7XG4vL2V2ZW50SW5HeXJvLnN0YXJ0KCk7XG4vL2V2ZW50SW5FTUdTbGlkaW5nLnN0YXJ0KCk7XG4vL2V2ZW50SW5FTUcuc3RhcnQoKTtcbiAgZXZlbnRJblNtb290aG5lc3NSZWNvcmRlZC5zdGFydCgpO1xuICBldmVudEluU21vb3RobmVzcy5zdGFydCgpO1xuICBcbiAgY29uc29sZS5sb2coXCJldmVudCBpbiBzdGFydGVkXCIpO1xuICAvKkFDQ0VMRVJPKi9cbiAgLy9ldmVudEluQWNjZWxlcm8uY29ubmVjdChicGZEaXNwbGF5QWNjZWxlcm8pO1xuICAvKkpFUktJTkVTUyBSQVRFKi9cbiAgLy9ldmVudEluU21vb3RobmVzcy5jb25uZWN0KGJwZkRpc3BsYXlKZXJraW5lc3MpO1xuICBldmVudEluU21vb3RobmVzcy5jb25uZWN0KHNvY2tldFNlbmRKZXJraW5lc3MpO1xuICAvKkVNRyovXG4gIC8vZXZlbnRJbkVNRy5jb25uZWN0KGJwZkRpc3BsYXlFTUcpO1xuICAvKkVNR1MgU0xJRElORyBXSU5ET1cqL1xuICAvL2V2ZW50SW5FTUdTbGlkaW5nLmNvbm5lY3QoYnBmRGlzcGxheUVNR1NsaW5kaW5nKTtcbn1cblxuXG4vKk1ZTyBzdGFydGluZyBldmVudCBoYW5kbGVyKi9cbk15by5vbkVycm9yID0gZnVuY3Rpb24gKCkge1xuICBjb25zb2xlLmxvZyhcIkNvdWxkbid0IGNvbm5lY3QgdG8gTXlvIENvbm5lY3RcIik7XG59O1xuXG5NeW8ub24oJ2Nvbm5lY3RlZCcsIGZ1bmN0aW9uKCl7XG4gIG15TXlvID0gdGhpcztcbiAgLy9teU15by5zZXRMb2NraW5nUG9saWN5KFwiTWFudWFsXCIpO1xuICBhZGRFdmVudHMobXlNeW8pO1xuICBcbn0pO1xuXG5sZXQgYWRkRXZlbnRzID0gZnVuY3Rpb24obXlvKXtcbiAgXG4gIG15TXlvLnN0cmVhbUVNRyh0cnVlKTtcbiAgTXlvLm9uKCdlbWcnLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgIC8vZGlzcGxheUVNR1dpbmRvdyhFTUdXaW5kb3dMZW5ndGgsZGF0YSk7XG4gIH0pO1xuICBcbiAgY29uc3QgYnBmRGlzcGxheUFjY2VsZXJvID0gbmV3IGxmby5zaW5rLkJwZkRpc3BsYXkoe1xuICAgIGNhbnZhczogJyNjYW52YXNCUEZBY2NlbGVybycsXG4gICAgd2lkdGg6IDQwMCxcbiAgICBoZWlnaHQ6IDI1MCxcbiAgICBkdXJhdGlvbjogNSxcbiAgICBtYXg6IDksXG4gICAgbWluOiAtOVxuICB9KTtcbiAgY29uc3QgYnBmRGlzcGxheUplcmtpbmVzcyA9IG5ldyBsZm8uc2luay5CcGZEaXNwbGF5KHtcbiAgICBjYW52YXM6ICcjYnBmRGlzcGxheUplcmtpbmVzcycsXG4gICAgd2lkdGg6IDQwMCxcbiAgICBoZWlnaHQ6IDI1MCxcbiAgICBkdXJhdGlvbjogNSxcbiAgICBtYXg6IDEsXG4gICAgbWluOiAtMVxuICB9KTtcbiAgY29uc3QgYnBmRGlzcGxheUVNRyA9IG5ldyBsZm8uc2luay5CcGZEaXNwbGF5KHtcbiAgICBjYW52YXM6ICcjY2FudmFzRU1HMScsXG4gICAgd2lkdGg6IDQwMCxcbiAgICBoZWlnaHQ6IDI1MCxcbiAgICBkdXJhdGlvbjogNSxcbiAgICBtYXg6IDEyOCxcbiAgICBtaW46IC0xMjhcbiAgfSk7XG4gIGNvbnN0IGJwZkRpc3BsYXlFTUdTbGluZGluZyA9IG5ldyBsZm8uc2luay5CcGZEaXNwbGF5KHtcbiAgICBjYW52YXM6ICcjY2FudmFzRU1HMicsXG4gICAgd2lkdGg6IDQwMCxcbiAgICBoZWlnaHQ6IDI1MCxcbiAgICBkdXJhdGlvbjogNSxcbiAgICBtYXg6IDEsXG4gICAgbWluOiAtMVxuICB9KTtcbiAgXG4gIC8vTGUgbG93IHBhc3MgbmUgbWFyY2hlIHBhcyBldCBqZSBuZSBzYWlzIHRvdWpvdXJzIHBhcyBwb3VycXVvaS4gUHJvYmxlbWUgZGUgY29uZmlnP1xuICBjb25zdCBiaXF1YWQgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gICAgdHlwZTogJ2xvd3Bhc3MnLFxuICAgIGYwOiA1MCxcbiAgICBnYWluOiAzLFxuICAgIHE6IDEyLFxuICB9KTtcbiAgXG4gIGNvbnN0IGJpcXVhZDIgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gICAgdHlwZTogJ2xvd3Bhc3MnLFxuICAgIGYwOiA1MDAsXG4gICAgZ2FpbjogMyxcbiAgICBxOiAxMixcbiAgfSk7XG4gIFxuICBjb25zdCBtb3ZpbmdBdmVyYWdlID0gbmV3IGxmby5vcGVyYXRvci5Nb3ZpbmdBdmVyYWdlKHtcbiAgICBvcmRlcjogNSxcbiAgICBmaWxsOiAwXG4gIH0pO1xuICBcbiAgLy9Jbml0IHRoZSBkaWZmZXJlbnQgZ3JhcGggdXNlZCBhbmQgY2hvb3NlIHdpY2ggb25lIHRvIGRpc3BsYXlcbiAgaW5pdEdyYXBoKCk7XG4gIE15by5vbignaW11JywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBteU15by5sb2NrKCk7XG4gICAgZGlzcGxheVdpbmRvdyhkYXRhKTtcbiAgfSk7XG59O1xuXG5mdW5jdGlvbiBkaXNwbGF5V2luZG93KGRhdGEpe1xuICAvL2Rpc3BsYXlBY2NlbGVyb1dpbmRvd1NwZWVkKGFjY2VsZXJvV2luZG93TGVuZ3RoLGRhdGEpO1xuICBkaXNwbGF5U21vb3RobmVzcyhTR1dpbmRvd0xlbmd0aCxkYXRhKTtcbiAgLy9kaXNwbGF5RU1HV2luZG93KFNHV2luZG93TGVuZ3RoLGRhdGEpO1xufVxuXG5cblxuXG5cbi8qTWV0aG9kIHNsaWRpbmcgd2luZG93IGNvbXB1dGF0aW9uLCByZXF1aXJlIGxlc3MgY29tcHV0YXRpb24gdGhhbiB0aGUgbmFpdmUgb25lKi9cbnZhciBhbnNYID0gW107XG52YXIgYW5zWSA9IFtdO1xudmFyIGFuc1ogPSBbXTtcbnZhciBjb21wdXRlZFNwZWVkUmF0ZSA9IDA7XG52YXIgc3VtTGFzdEVsZW0gPSAwO1xudmFyIHN1bUZpcnN0RWxlbSA9IDA7XG5mdW5jdGlvbiBjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvdyh3aW5kb3dMZW5ndGgsIG5ld1gsbmV3WSxuZXdaKSB7XG4gIGlmIChhbnNYLmxlbmd0aCA+PSB3aW5kb3dMZW5ndGgpIHtcbiAgICB2YXIgZmlyc3RFbGVtZW50WCA9IGFuc1guc2hpZnQoKTtcbiAgICB2YXIgZmlyc3RFbGVtZW50WSA9IGFuc1kuc2hpZnQoKTtcbiAgICB2YXIgZmlyc3RFbGVtZW50WiA9IGFuc1ouc2hpZnQoKTtcbiAgICBzdW1GaXJzdEVsZW0gPSAoZmlyc3RFbGVtZW50WCApICsgKGZpcnN0RWxlbWVudFkgKSArIChmaXJzdEVsZW1lbnRaICk7XG4gIH1cbiAgICBsZXQgeCA9IE1hdGguYWJzKG5ld1gvZyk7XG4gICAvLyBsZXQgeCA9IChuZXdYL2cpO1xuICAgIGFuc1gucHVzaCh4KTtcbiAgICBsZXQgeSA9IE1hdGguYWJzKG5ld1kvZyk7XG4gICAvLyBsZXQgeSA9IChuZXdZL2cpO1xuICAgIGFuc1kucHVzaCh5KTtcbiAgICBsZXQgeiA9IE1hdGguYWJzKG5ld1ovZyk7XG4gICAgLy9sZXQgeiA9IChuZXdaL2cpO1xuICAgIGFuc1oucHVzaCh6KTtcbiAgXG4gICAgc3VtTGFzdEVsZW0gPSAoeCkrKHkpKyh6KTtcbiAgICBjb21wdXRlZFNwZWVkUmF0ZSA9IGNvbXB1dGVkU3BlZWRSYXRlIC0gc3VtRmlyc3RFbGVtICsgc3VtTGFzdEVsZW07XG4gIFxuICByZXR1cm4gY29tcHV0ZWRTcGVlZFJhdGU7XG59XG5cblxuLy9BbGdvcml0aG0gZGUgY2FsY3VsIG5haWYgZGUgbGEgdml0ZXNzZSBzZWxvbiB1bmUgZmVuZXRyZTogcmV0b3VybmUgbGUgbWVtZSByZXN1bHRhdCBxdWUgbCdhbGdvcml0aG1lIGV2b2x1w6lcbnZhciBhbnNYTmFpZiA9IFtdO1xudmFyIGFuc1lOYWlmID0gW107XG52YXIgYW5zWk5haWYgPSBbXTtcbmZ1bmN0aW9uIGNvbXB1dGVTcGVlZFJhdGVBZGFwdGF0aXZlV2luZG93TmFpZih3aW5kb3dMZW5ndGgseCx5LHope1xuICBjb25zb2xlLmxvZyhcIlRoZSBmdW5jdGlvbiBjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvd05haWYgaXMgZGVwcmVjYXRlZCwgdXNlIGNvbXB1dGVTcGVlZFJhdGVBZGFwdGF0aXZlV2luZG93IGluc3RlYWQuXCIpO1xuICBpZiAoYW5zWE5haWYubGVuZ3RoID49IHdpbmRvd0xlbmd0aCkge1xuICAgIGFuc1hOYWlmLnNoaWZ0KCk7XG4gICAgYW5zWU5haWYuc2hpZnQoKTtcbiAgICBhbnNaTmFpZi5zaGlmdCgpO1xuICB9XG4gIGFuc1hOYWlmLnB1c2goeC9nKTtcbiAgYW5zWU5haWYucHVzaCh5L2cpO1xuICBhbnNaTmFpZi5wdXNoKHovZyk7XG4gIFxuICBsZXQgIHNwZWVkUmF0ZSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgd2luZG93TGVuZ3RoIDsgaSsrKSB7XG4gICAgICBzcGVlZFJhdGUgKz0gKGFuc1hOYWlmW2ldKSArIChhbnNZTmFpZltpXSkgKyAoYW5zWk5haWZbaV0pO1xuICAgICAgLy9zcGVlZFJhdGUgKz0gTWF0aC5hYnMoYW5zWFtpXS9nKSsgTWF0aC5hYnMoYW5zWVtpXS9nKSArICBNYXRoLmFicyhhbnNaW2ldL2cpO1xuICAgICAvLyBzcGVlZFJhdGUgKz1NYXRoLnNxcnQoTWF0aC5wb3coIE1hdGguYWJzKGFuc1hbaV0vZykgLDIpKyBNYXRoLnBvdyggIE1hdGguYWJzKGFuc1lbaV0vZyksMikgKyBNYXRoLnBvdyggTWF0aC5hYnMoYW5zWltpXS9nKSwyKSk7XG4gIH1cbiAgcmV0dXJuIHNwZWVkUmF0ZTtcbn1cblxuZnVuY3Rpb24gZGlzcGxheUFjY2VsZXJvV2luZG93U3BlZWQod2luZG93TGVuZ3RoLCBkYXRhKXtcbiAgdGltZSArPSBkdDtcbiAgbGV0IHNwZWVkUmF0ZSA9IGNvbXB1dGVTcGVlZFJhdGVBZGFwdGF0aXZlV2luZG93KHdpbmRvd0xlbmd0aCxkYXRhLmFjY2VsZXJvbWV0ZXIueCwgZGF0YS5hY2NlbGVyb21ldGVyLnksIGRhdGEuYWNjZWxlcm9tZXRlci56KTtcbiAgY29uc3QgZnJhbWVBY2NlbGVybyA9IHtcbiAgICB0aW1lOiB0aW1lLFxuICAgIGRhdGE6IFtkYXRhLmFjY2VsZXJvbWV0ZXIueCooc3BlZWRSYXRlKSwgZGF0YS5hY2NlbGVyb21ldGVyLnkqKHNwZWVkUmF0ZSksIGRhdGEuYWNjZWxlcm9tZXRlci56KihzcGVlZFJhdGUpXSxcbiAgICBtZXRhZGF0YTp0cnVlLFxuICB9O1xuICBldmVudEluQWNjZWxlcm8ucHJvY2Vzc0ZyYW1lKGZyYW1lQWNjZWxlcm8pO1xufVxuXG5cbi8vRm9yIHRoZSBzbGlkaW5nIHdpbmRvdyBvZiBraW5lc3RldGljIGF3YXJlbmVzcyByZXBsaWNhdGlvblxubGV0IHNsaWRpbmdXaW5kb3cgPSBbXTtcbmZ1bmN0aW9uIGRpc3BsYXlFTUdXaW5kb3cod2luZG93TGVuZ3RoLCBkYXRhKXtcbiAgdGltZUVNRyArPSBkdEVNRztcbiAgLy9TbGluZGluZyB3aW5kb3cgb2YgRU1HXG4gIGlmKHNsaWRpbmdXaW5kb3cubGVuZ3RoID4gd2luZG93TGVuZ3RoKXtcbiAgICBzbGlkaW5nV2luZG93LnNoaWZ0KCk7XG4gIH1cbiAgc2xpZGluZ1dpbmRvdy5wdXNoKE1hdGgubWF4KC4uLmRhdGEpKTtcbiAgbGV0IG1heFNsaWRpbmcgPSBNYXRoLm1heCguLi5zbGlkaW5nV2luZG93KTtcbiAgY29uc3QgZnJhbWVFTUdTbGlkaW5nID0ge1xuICAgIHRpbWU6IHRpbWVFTUcsXG4gICAgZGF0YTogc2xpZGluZ1dpbmRvd1tzbGlkaW5nV2luZG93Lmxlbmd0aC0xXS9tYXhTbGlkaW5nLFxuICB9O1xuICBcbiAgY29uc3QgZnJhbWVFTUcgPSB7XG4gICAgdGltZTogdGltZUVNRyxcbiAgICBkYXRhOiBkYXRhLFxuICB9O1xuICBldmVudEluRU1HU2xpZGluZy5wcm9jZXNzRnJhbWUoZnJhbWVFTUdTbGlkaW5nKTtcbiAgZXZlbnRJbkVNRy5wcm9jZXNzRnJhbWUoZnJhbWVFTUcpO1xufVxuXG5cbi8vdmFyaWFibGVzIGZvciB0aGUgc2F2aXR6a3ktZ29sYXkgZmlsdGVyXG5sZXQgYXJyYXlGaWx0ZXJpbmdYID0gW107XG5sZXQgYXJyYXlGaWx0ZXJpbmdZID0gW107XG5sZXQgYXJyYXlGaWx0ZXJpbmdaID0gW107XG5sZXQgYW5zeCA9IFtdO1xubGV0IGFuc3kgPSBbXTtcbmxldCBhbnN6ID0gW107XG52YXIgb3B0aW9ucyA9IHtkZXJpdmF0aXZlOiAxLHdpbmRvd1NpemU6IFNHV2luZG93TGVuZ3RoLTF9O1xubGV0IG9wdGlvbnNHb2xheUxvd1Bhc3MgPSB7ZGVyaXZhdGl2ZTogMH07XG5mdW5jdGlvbiBkaXNwbGF5U21vb3RobmVzcyh3aW5kb3dMZW5ndGhTRywgZGF0YSApe1xuICAvL0NhbGN1bGluZyBzbW9vdGhuZXNzXG4gIGFycmF5RmlsdGVyaW5nWC5wdXNoKGRhdGEuYWNjZWxlcm9tZXRlci54KTtcbiAgYXJyYXlGaWx0ZXJpbmdZLnB1c2goZGF0YS5hY2NlbGVyb21ldGVyLnkpO1xuICBhcnJheUZpbHRlcmluZ1oucHVzaChkYXRhLmFjY2VsZXJvbWV0ZXIueik7XG4gIFxuICAvL3RhaWxsZSBkZSBsYSBmZW5ldHJlIGRlIGNhbGN1bGUgZGUgbCdhbGdvcml0aG1lXG4gIGlmKGFycmF5RmlsdGVyaW5nWi5sZW5ndGggPj0gd2luZG93TGVuZ3RoU0cgKXtcbiAgICBhcnJheUZpbHRlcmluZ1guc2hpZnQoKTtcbiAgICBhcnJheUZpbHRlcmluZ1kuc2hpZnQoKTtcbiAgICBhcnJheUZpbHRlcmluZ1ouc2hpZnQoKTtcbiAgICBcbiAgICAvL2FwbGxpY2F0aW9uIGRlIHNhdml0emt5LWdvbGF5IGZpbHRlclxuICAgIGFuc3ggPSAgU0coYXJyYXlGaWx0ZXJpbmdYLCAxLCBvcHRpb25zKTtcbiAgICBhbnN5ID0gIFNHKGFycmF5RmlsdGVyaW5nWSwgMSwgb3B0aW9ucyk7XG4gICAgYW5zeiA9ICBTRyhhcnJheUZpbHRlcmluZ1osIDEsIG9wdGlvbnMpO1xuICAgIFxuICAgIC8vbm9ybWFsaXNpbmcgZGF0YVxuICAgIGxldCBub3JtYWxpc2VEYXRhID0gTWF0aC5zcXJ0KE1hdGgucG93KGFuc3hbYW5zeC5sZW5ndGggLSAxXSwyKStNYXRoLnBvdyhhbnN5W2Fuc3kubGVuZ3RoIC0gMV0sMikrTWF0aC5wb3coYW5zelthbnN6Lmxlbmd0aCAtIDFdLDIpKTtcbiAgICBsZXQgYW1wbGl0dWRlRGF0YSA9IGNvbXB1dGVBbXBsaXR1ZGVXaW5kb3coYW1wbGl0dWRlV2luZG93TGVuZ3RoLG5vcm1hbGlzZURhdGEpO1xuICAgIGxldCBzcGVlZFJhdGUgPSBjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvdyhzcGVlZFJhdGVXaW5kb3dMZW5ndGgsZGF0YS5hY2NlbGVyb21ldGVyLngsZGF0YS5hY2NlbGVyb21ldGVyLnksZGF0YS5hY2NlbGVyb21ldGVyLnopO1xuICAgLy8gY29uc29sZS5sb2coXCJzcGVlZFJhdGUgOiBcIiArIHNwZWVkUmF0ZSk7XG4gIFxuICAgIGlmKHJlY29yZGluZyl7XG4gICAgICBhcnJheVJlY29yZGVkLnB1c2gobm9ybWFsaXNlRGF0YSk7XG4gICAgICBjb25zb2xlLmxvZyhcImFycmF5UmVjb3JkZWQgOiBcIiArIGFycmF5UmVjb3JkZWQubGVuZ3RoKTtcbiAgICB9XG4gIFxuICAgIGxldCBmcmFtZVNtb290aG5lc3MgPSB7XG4gICAgICB0aW1lOiB0aW1lLFxuICAgICAgZGF0YTogYW1wbGl0dWRlRGF0YSxcbiAgICAgIC8vZGF0YTogbm9ybWFsaXNlRGF0YSxcbiAgICAgIG1ldGFkYXRhOm51bGwsXG4gICAgfTtcbiAgICBldmVudEluU21vb3RobmVzcy5wcm9jZXNzRnJhbWUoZnJhbWVTbW9vdGhuZXNzKTtcbiAgfVxufVxuXG4vL3ZlcnNpb24gbmFpdmUgZGUgbCdhbGdvcml0aG1lLCBsZSBmb3IgcGV1dCBldHJlIHJlbXBsYWPDqSBjb21tZSBkYW5zIGxhIGZvbmN0aW9uOiBjb21wdXRlU3BlZWRSYXRlQWRhcHRhdGl2ZVdpbmRvd1xuLy9Nb3llbm5lIGRlcyBkb25uw6llcyBkdSBqZXJrIG5vcm1hbGlzw6lcbnZhciBhcnJheUFtcGxpdHVkZSA9W107XG5mdW5jdGlvbiBjb21wdXRlQW1wbGl0dWRlV2luZG93KHdpbmRvd0xlbmd0aCwgZGF0YSl7XG4gIGxldCBhbXBsaXR1ZGVSYXRlID0gMDtcbiAgaWYoYXJyYXlBbXBsaXR1ZGUubGVuZ3RoID4gd2luZG93TGVuZ3RoKXtcbiAgICBhcnJheUFtcGxpdHVkZS5zaGlmdCgpO1xuICB9XG4gIGFycmF5QW1wbGl0dWRlLnB1c2goZGF0YSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgd2luZG93TGVuZ3RoIDsgaSsrKSB7XG4gICAgYW1wbGl0dWRlUmF0ZSArPSBhcnJheUFtcGxpdHVkZVtpXTtcbiAgfVxuICBhbXBsaXR1ZGVSYXRlIC89IHdpbmRvd0xlbmd0aDtcbiAvLyBjb25zb2xlLmxvZyhcImFtcGxpdHVkZVJhdGUgOiBcIiArIGFtcGxpdHVkZVJhdGUgKTtcbiAgcmV0dXJuIGFtcGxpdHVkZVJhdGU7XG59XG5cbndpbmRvdy5zZXRTR1dpbmRvd0xlbmd0aCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSl7XG4gIC8vY29uc29sZS5sb2coXCJuZXcgdmFsdWUgU0cgOiBcIiArIG5ld1ZhbHVlKTtcbiAgU0dXaW5kb3dMZW5ndGg9IG5ld1ZhbHVlO1xuICBvcHRpb25zID0ge2Rlcml2YXRpdmU6IDEsd2luZG93U2l6ZTogU0dXaW5kb3dMZW5ndGgtMX07XG4gIFxuICAgYXJyYXlGaWx0ZXJpbmdYID0gW107XG4gICBhcnJheUZpbHRlcmluZ1kgPSBbXTtcbiAgIGFycmF5RmlsdGVyaW5nWiA9IFtdO1xuICAgYW5zWCA9IFtdO1xuICAgYW5zWSA9IFtdO1xuICAgYW5zWiA9IFtdO1xufTtcblxud2luZG93LnNldEFtcGxpdHVkZVdpbmRvd0xlbmd0aCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICBhbXBsaXR1ZGVXaW5kb3dMZW5ndGggPSBuZXdWYWx1ZTtcbn07XG5cblxudmFyIGFycmF5UmVjb3JkZWQgPSBbXTtcbnZhciByZWNvcmRpbmcgPSBmYWxzZTtcblxuLypCdXR0b24gZnVuY3Rpb24qL1xud2luZG93LnN0YXJ0UmVjb3JkID0gZnVuY3Rpb24gKCkge1xuICBjb25zb2xlLmxvZyhcInJlY29yZGluZ1wiKTtcbiAgZXZlbnRJblNtb290aG5lc3Muc3RvcCgpO1xuICBTdHJlYW1Pbk9mZihcIm9mZlwiKTtcbiAgYXJyYXlSZWNvcmRlZCA9IFtdO1xuICByZWNvcmRpbmcgPSB0cnVlO1xufTtcblxud2luZG93LnN0b3BSZWNvcmQgPSBmdW5jdGlvbiAoKSB7XG4gIGV2ZW50SW5TbW9vdGhuZXNzLnN0YXJ0KCk7XG4gIHJlY29yZGluZyA9IGZhbHNlO1xufTtcblxudmFyIGkgPSAwO1xudmFyIHRpbWVyO1xuXG53aW5kb3cucGxheVJlY29yZGVkID0gZnVuY3Rpb24gKCkge1xuICB0aW1lciA9IHNldEludGVydmFsKHBsYXlpbmdSZWNvcmQsIDIwKTtcbiAgZXZlbnRJblNtb290aG5lc3NSZWNvcmRlZC5jb25uZWN0KHNvY2tldFNlbmRKZXJraW5lc3MpO1xuICBldmVudEluU21vb3RobmVzc1JlY29yZGVkLnN0YXJ0KCk7XG4gIGV2ZW50SW5TbW9vdGhuZXNzLnN0b3AoKTtcbiAgXG4gIGZ1bmN0aW9uIHBsYXlpbmdSZWNvcmQoKSB7XG4gICAgaWYoaSA8IGFycmF5UmVjb3JkZWQubGVuZ3RoICAgKXtcbiAgICAgIGxldCBmcmFtZVNtb290aG5lc3MgPSB7XG4gICAgICAgIHRpbWU6IGksXG4gICAgICAgIGRhdGE6IGFycmF5UmVjb3JkZWRbaV0sXG4gICAgICAgIC8vZGF0YTogbm9ybWFsaXNlRGF0YSxcbiAgICAgICAgbWV0YWRhdGE6bnVsbCxcbiAgICAgIH07XG4gICAgICBldmVudEluU21vb3RobmVzc1JlY29yZGVkLnByb2Nlc3NGcmFtZShmcmFtZVNtb290aG5lc3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgZXZlbnRJblNtb290aG5lc3NSZWNvcmRlZC5zdG9wKCk7XG4gICAgICBldmVudEluU21vb3RobmVzcy5zdGFydCgpO1xuICAgICAgaSA9IDA7XG4gICAgfVxuICAgIGkrKztcbiAgfVxuICBcbn07XG53aW5kb3cuc3RvcGluZ1JlY29yZGVkID0gZnVuY3Rpb24gKCkge1xuICBjbGVhclRpbWVvdXQodGltZXIpO1xuICBldmVudEluU21vb3RobmVzc1JlY29yZGVkLnN0b3AoKTtcbiAgZXZlbnRJblNtb290aG5lc3Muc3RhcnQoKTtcbiAgU3RyZWFtT25PZmYoXCJvblwiKTtcbiAgXG4gIGkgPSAwO1xufTtcblxuXG4vLzIwMDAgPSBvbiwgMTAwMCA9IG9mZlxudmFyIG9uT2ZmID0gMTAwMDtcbndpbmRvdy5TdHJlYW1Pbk9mZiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICBpZih2YWx1ZSA9PT0gXCJvblwiKXtcbiAgICBvbk9mZiA9IDEwMDA7XG4gICAgZXZlbnRJblNtb290aG5lc3Muc3RhcnQoKTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gXCJvZmZcIil7XG4gICAgb25PZmYgPSAyMDAwO1xuICAgIC8vZXZlbnRJblNtb290aG5lc3Muc3RvcCgpO1xuICB9IGVsc2Uge1xuICAgIGlmKCBvbk9mZiA9PT0gMTAwMCl7XG4gICAgICBjb25zb2xlLmxvZyhcIm9uIDogXCIgKyBvbk9mZik7XG4gICAgICBldmVudEluU21vb3RobmVzcy5zdGFydCgpO1xuICAgICAgb25PZmYgPSAyMDAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIm9mZiAgOiBcIiArIG9uT2ZmKTtcbiAgICAgIG9uT2ZmID0gMTAwMDtcbiAgICAgIC8vZXZlbnRJblNtb290aG5lc3Muc3RvcCgpO1xuICAgIH1cbiAgfVxuICBcbiAgbGV0IGZyYW1lU21vb3RobmVzc09uT0ZGID0ge1xuICAgIHRpbWU6IGksXG4gICAgZGF0YTogb25PZmYsXG4gICAgLy9kYXRhOiBub3JtYWxpc2VEYXRhLFxuICAgIG1ldGFkYXRhOiBudWxsLFxuICB9O1xuICBcbiAgZXZlbnRJblNtb290aG5lc3MucHJvY2Vzc0ZyYW1lKGZyYW1lU21vb3RobmVzc09uT0ZGKTtcbiAgXG59O1xuXG5cbiJdfQ==