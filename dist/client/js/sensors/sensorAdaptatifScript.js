'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var lfo = require('waves-lfo/client');
var Myo = require('src/client/js/sensors/myo');
var SG = require('ml-savitzky-golay');

//Time for the bpfDisplay
var time = 0;
var dt = 0.01;
var timeEMG = 0;
var dtEMG = 0.01;

//Starting myo
Myo.connect('com.stolksdorf.myAwesomeApp');
var myMyo;

//For the sliding window of kinestetic awareness replication
var slidingWindow = [];

//variables for the savitzky-golay filter
var arrayFilteringX = [];
var arrayFilteringY = [];
var arrayFilteringZ = [];
var ansx = [];
var ansy = [];
var ansz = [];
var options = { derivative: 1 };
var optionsGolayLowpass = { derivative: 0 };

//Creation of graph
var eventInAccelero = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 3,
  frameRate: 0.01,
  description: ['acceleroX', 'acceleroY', 'acceleroZ']
});

var eventInSmoothness = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 3,
  frameRate: 0.01,
  description: ['smoothX', 'smoothY', 'smoothZ']
});

var eventInGyro = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 3,
  frameRate: 0.01,
  description: ['gyroX', 'gyroY', 'gyroZ']
});

var eventInEMG = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 8,
  frameRate: 0.01,
  description: ['emg', 'emg', 'emg', 'emg', 'emg', 'emg', 'emg', 'emg']
});

var eventInEMGSliding = new lfo.source.EventIn({
  frameType: 'vector',
  frameSize: 1,
  frameRate: 0.01,
  description: ['emgSliding']
});

// initialize and start the different graph used
eventInAccelero.start();
//eventInGyro.start();
eventInSmoothness.start();
eventInEMGSliding.start();
eventInEMG.start();
console.log("event in started");

/*MYO starting event handler*/
Myo.onError = function () {
  console.log("Couldn't connect to Myo Connect");
};

Myo.on('connected', function () {
  myMyo = this;
  addEvents(myMyo);
});

var addEvents = function addEvents(myo) {

  myMyo.streamEMG(true);
  myMyo.lock();

  Myo.on('emg', function (data) {
    timeEMG += dtEMG;

    //Slinding window of EMG
    if (slidingWindow.length > 1000) {
      slidingWindow.shift();
    }
    slidingWindow.push(Math.max.apply(Math, _toConsumableArray(data)));
    maxSliding = Math.max.apply(Math, slidingWindow);
    var frameEMGSliding = {
      time: timeEMG,
      data: slidingWindow[slidingWindow.length - 1] / maxSliding
      // console.log(frameEMGSliding);

    };var frameEMG = {
      time: timeEMG,
      data: data
    };
    eventInEMGSliding.processFrame(frameEMGSliding);
    eventInEMG.processFrame(frameEMG);
  });

  var bpfDisplayAccelero = new lfo.sink.BpfDisplay({
    canvas: '#canvasBPFAccelero',
    width: 400,
    height: 250,
    duration: 5,
    max: 2,
    min: -2
  });
  var bpfDisplayJerkiness = new lfo.sink.BpfDisplay({
    canvas: '#bpfDisplayJerkiness',
    width: 400,
    height: 250,
    duration: 5,
    max: 1,
    min: -1
  });
  var bpfDisplayEMG = new lfo.sink.BpfDisplay({
    canvas: '#canvasEMG1',
    width: 400,
    height: 250,
    duration: 5,
    max: 100,
    min: -100
  });

  var bpfDisplayEMGSlinding = new lfo.sink.BpfDisplay({
    canvas: '#canvasEMG2',
    width: 400,
    height: 250,
    duration: 5,
    max: 1,
    min: -1
  });

  //Le low pass ne marche pas et je ne sais toujours pas pourquoi. Probleme de config?
  var biquad = new lfo.operator.Biquad({
    type: 'lowpass',
    f0: 10000,
    gain: 3,
    q: 12
  });

  var biquad2 = new lfo.operator.Biquad({
    type: 'lowpass',
    f0: 10,
    gain: 3,
    q: 12
  });

  var movingAverage = new lfo.operator.MovingAverage({
    order: 5,
    fill: 0
  });

  Myo.on('imu', function (data) {
    time += dt;
    var frameAccelero = {
      time: time,
      data: [data.accelerometer.x, data.accelerometer.y, data.accelerometer.z]
    };
    var frameGyro = {
      time: time,
      data: [data.gyroscope.x, data.gyroscope.y, data.gyroscope.z]
    };

    eventInAccelero.processFrame(frameAccelero);

    //Calculing smoothness
    arrayFilteringX.push(data.accelerometer.x);
    arrayFilteringY.push(data.accelerometer.y);
    arrayFilteringZ.push(data.accelerometer.z);

    //taille de la fenetre de calcule de l'algorithme
    if (arrayFilteringZ.length > 20) {
      arrayFilteringX.shift();
      arrayFilteringY.shift();
      arrayFilteringZ.shift();

      //apllication de savitzky-golay filter
      ansx = SG(arrayFilteringX, 1, options);
      ansy = SG(arrayFilteringY, 1, options);
      ansz = SG(arrayFilteringZ, 1, options);
      var frameSmoothness = {
        time: time,
        data: [ansx[ansx.length - 1], ansy[ansy.length - 1], ansz[ansz.length - 1]]
      };
      eventInSmoothness.processFrame(frameSmoothness);
    }
  });

  /*MYO stop event handler*/
  /*Connection of the graph to display */

  //ACCELERO
  /*eventInAccelero.connect(biquad);
  biquad.connect(bpfDisplayAccelero);*/
  eventInAccelero.connect(bpfDisplayAccelero);

  //Smoothness
  eventInSmoothness.connect(bpfDisplayJerkiness);

  //EMG
  /* eventInEMG.connect(biquad2);
   biquad2.connect(bpfDisplayEMG);
  */eventInEMG.connect(bpfDisplayEMG);

  //EMG SLIDING WINDOW
  eventInEMGSliding.connect(bpfDisplayEMGSlinding);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbnNvckFkYXB0YXRpZlNjcmlwdC5qcyJdLCJuYW1lcyI6WyJsZm8iLCJyZXF1aXJlIiwiTXlvIiwiU0ciLCJ0aW1lIiwiZHQiLCJ0aW1lRU1HIiwiZHRFTUciLCJjb25uZWN0IiwibXlNeW8iLCJzbGlkaW5nV2luZG93IiwiYXJyYXlGaWx0ZXJpbmdYIiwiYXJyYXlGaWx0ZXJpbmdZIiwiYXJyYXlGaWx0ZXJpbmdaIiwiYW5zeCIsImFuc3kiLCJhbnN6Iiwib3B0aW9ucyIsImRlcml2YXRpdmUiLCJvcHRpb25zR29sYXlMb3dwYXNzIiwiZXZlbnRJbkFjY2VsZXJvIiwic291cmNlIiwiRXZlbnRJbiIsImZyYW1lVHlwZSIsImZyYW1lU2l6ZSIsImZyYW1lUmF0ZSIsImRlc2NyaXB0aW9uIiwiZXZlbnRJblNtb290aG5lc3MiLCJldmVudEluR3lybyIsImV2ZW50SW5FTUciLCJldmVudEluRU1HU2xpZGluZyIsInN0YXJ0IiwiY29uc29sZSIsImxvZyIsIm9uRXJyb3IiLCJvbiIsImFkZEV2ZW50cyIsIm15byIsInN0cmVhbUVNRyIsImxvY2siLCJkYXRhIiwibGVuZ3RoIiwic2hpZnQiLCJwdXNoIiwiTWF0aCIsIm1heCIsIm1heFNsaWRpbmciLCJmcmFtZUVNR1NsaWRpbmciLCJmcmFtZUVNRyIsInByb2Nlc3NGcmFtZSIsImJwZkRpc3BsYXlBY2NlbGVybyIsInNpbmsiLCJCcGZEaXNwbGF5IiwiY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJkdXJhdGlvbiIsIm1pbiIsImJwZkRpc3BsYXlKZXJraW5lc3MiLCJicGZEaXNwbGF5RU1HIiwiYnBmRGlzcGxheUVNR1NsaW5kaW5nIiwiYmlxdWFkIiwib3BlcmF0b3IiLCJCaXF1YWQiLCJ0eXBlIiwiZjAiLCJnYWluIiwicSIsImJpcXVhZDIiLCJtb3ZpbmdBdmVyYWdlIiwiTW92aW5nQXZlcmFnZSIsIm9yZGVyIiwiZmlsbCIsImZyYW1lQWNjZWxlcm8iLCJhY2NlbGVyb21ldGVyIiwieCIsInkiLCJ6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O0FBQ0Q7QUFDRixHQWxDRDs7QUFvQ0E7QUFDQTs7QUFHQTtBQUNBOztBQUVBNUQsa0JBQWdCWixPQUFoQixDQUF3QjBDLGtCQUF4Qjs7QUFHQTtBQUNBdkIsb0JBQWtCbkIsT0FBbEIsQ0FBMEJrRCxtQkFBMUI7O0FBRUE7QUFDQTs7SUFFRTdCLFdBQVdyQixPQUFYLENBQW1CbUQsYUFBbkI7O0FBRUY7QUFDQTdCLG9CQUFrQnRCLE9BQWxCLENBQTBCb0QscUJBQTFCO0FBRUQsQ0E3SUQiLCJmaWxlIjoic2Vuc29yQWRhcHRhdGlmU2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGxmbyA9IHJlcXVpcmUoJ3dhdmVzLWxmby9jbGllbnQnKTtcbnZhciBNeW8gPSByZXF1aXJlKCdzcmMvY2xpZW50L2pzL3NlbnNvcnMvbXlvJyk7XG52YXIgU0cgPSByZXF1aXJlKCdtbC1zYXZpdHpreS1nb2xheScpO1xuXG5cbi8vVGltZSBmb3IgdGhlIGJwZkRpc3BsYXlcbmxldCB0aW1lID0gMDtcbmNvbnN0IGR0ID0gMC4wMTtcbmxldCB0aW1lRU1HID0gMDtcbmNvbnN0IGR0RU1HID0gMC4wMTtcblxuLy9TdGFydGluZyBteW9cbk15by5jb25uZWN0KCdjb20uc3RvbGtzZG9yZi5teUF3ZXNvbWVBcHAnKTtcbnZhciBteU15bztcblxuLy9Gb3IgdGhlIHNsaWRpbmcgd2luZG93IG9mIGtpbmVzdGV0aWMgYXdhcmVuZXNzIHJlcGxpY2F0aW9uXG52YXIgc2xpZGluZ1dpbmRvdyA9IFtdO1xuXG4vL3ZhcmlhYmxlcyBmb3IgdGhlIHNhdml0emt5LWdvbGF5IGZpbHRlclxudmFyIGFycmF5RmlsdGVyaW5nWCA9IFtdO1xudmFyIGFycmF5RmlsdGVyaW5nWSA9IFtdO1xudmFyIGFycmF5RmlsdGVyaW5nWiA9IFtdO1xudmFyIGFuc3ggPSBbXTtcbnZhciBhbnN5ID0gW107XG52YXIgYW5zeiA9IFtdO1xudmFyIG9wdGlvbnMgPSB7ZGVyaXZhdGl2ZTogMX07XG52YXIgb3B0aW9uc0dvbGF5TG93cGFzcyA9IHtkZXJpdmF0aXZlOiAwfTtcblxuXG4vL0NyZWF0aW9uIG9mIGdyYXBoXG5jb25zdCBldmVudEluQWNjZWxlcm8gPSBuZXcgbGZvLnNvdXJjZS5FdmVudEluKHtcbiAgZnJhbWVUeXBlOiAndmVjdG9yJyxcbiAgZnJhbWVTaXplOiAzLFxuICBmcmFtZVJhdGU6IDAuMDEsXG4gIGRlc2NyaXB0aW9uOiBbJ2FjY2VsZXJvWCcsICdhY2NlbGVyb1knLCAnYWNjZWxlcm9aJ10sXG59KTtcblxuY29uc3QgZXZlbnRJblNtb290aG5lc3MgPSBuZXcgbGZvLnNvdXJjZS5FdmVudEluKHtcbiAgZnJhbWVUeXBlOiAndmVjdG9yJyxcbiAgZnJhbWVTaXplOiAzLFxuICBmcmFtZVJhdGU6IDAuMDEsXG4gIGRlc2NyaXB0aW9uOiBbJ3Ntb290aFgnLCAnc21vb3RoWScsICdzbW9vdGhaJ10sXG59KTtcblxuY29uc3QgZXZlbnRJbkd5cm8gPSBuZXcgbGZvLnNvdXJjZS5FdmVudEluKHtcbiAgZnJhbWVUeXBlOiAndmVjdG9yJyxcbiAgZnJhbWVTaXplOiAzLFxuICBmcmFtZVJhdGU6IDAuMDEsXG4gIGRlc2NyaXB0aW9uOiBbJ2d5cm9YJywgJ2d5cm9ZJywgJ2d5cm9aJ10sXG59KTtcblxuY29uc3QgZXZlbnRJbkVNRyA9IG5ldyBsZm8uc291cmNlLkV2ZW50SW4oe1xuICBmcmFtZVR5cGU6ICd2ZWN0b3InLFxuICBmcmFtZVNpemU6IDgsXG4gIGZyYW1lUmF0ZTogMC4wMSxcbiAgZGVzY3JpcHRpb246IFsnZW1nJywgJ2VtZycsICdlbWcnLCdlbWcnLCAnZW1nJywgJ2VtZycsJ2VtZycsICdlbWcnXSxcbn0pO1xuXG5jb25zdCBldmVudEluRU1HU2xpZGluZyA9IG5ldyBsZm8uc291cmNlLkV2ZW50SW4oe1xuICBmcmFtZVR5cGU6ICd2ZWN0b3InLFxuICBmcmFtZVNpemU6IDEsXG4gIGZyYW1lUmF0ZTogMC4wMSxcbiAgZGVzY3JpcHRpb246IFsnZW1nU2xpZGluZyddLFxufSk7XG5cblxuLy8gaW5pdGlhbGl6ZSBhbmQgc3RhcnQgdGhlIGRpZmZlcmVudCBncmFwaCB1c2VkXG5ldmVudEluQWNjZWxlcm8uc3RhcnQoKTtcbi8vZXZlbnRJbkd5cm8uc3RhcnQoKTtcbmV2ZW50SW5TbW9vdGhuZXNzLnN0YXJ0KCk7XG5ldmVudEluRU1HU2xpZGluZy5zdGFydCgpO1xuZXZlbnRJbkVNRy5zdGFydCgpO1xuY29uc29sZS5sb2coXCJldmVudCBpbiBzdGFydGVkXCIpO1xuXG4vKk1ZTyBzdGFydGluZyBldmVudCBoYW5kbGVyKi9cbk15by5vbkVycm9yID0gZnVuY3Rpb24gKCkge1xuICBjb25zb2xlLmxvZyhcIkNvdWxkbid0IGNvbm5lY3QgdG8gTXlvIENvbm5lY3RcIik7XG59O1xuXG5NeW8ub24oJ2Nvbm5lY3RlZCcsIGZ1bmN0aW9uKCl7XG4gIG15TXlvID0gdGhpcztcbiAgYWRkRXZlbnRzKG15TXlvKTtcbn0pO1xuXG52YXIgYWRkRXZlbnRzID0gZnVuY3Rpb24obXlvKXtcbiAgXG4gIG15TXlvLnN0cmVhbUVNRyh0cnVlKTtcbiAgbXlNeW8ubG9jaygpO1xuICBcbiAgTXlvLm9uKCdlbWcnLCBmdW5jdGlvbihkYXRhKXtcbiAgICB0aW1lRU1HICs9IGR0RU1HO1xuICBcbiAgICAvL1NsaW5kaW5nIHdpbmRvdyBvZiBFTUdcbiAgICBpZihzbGlkaW5nV2luZG93Lmxlbmd0aCA+IDEwMDApe1xuICAgICAgc2xpZGluZ1dpbmRvdy5zaGlmdCgpO1xuICAgIH1cbiAgICBzbGlkaW5nV2luZG93LnB1c2goTWF0aC5tYXgoLi4uZGF0YSkpO1xuICAgIG1heFNsaWRpbmcgPSBNYXRoLm1heCguLi5zbGlkaW5nV2luZG93KTtcbiAgICBjb25zdCBmcmFtZUVNR1NsaWRpbmcgPSB7XG4gICAgICB0aW1lOiB0aW1lRU1HLFxuICAgICAgZGF0YTogc2xpZGluZ1dpbmRvd1tzbGlkaW5nV2luZG93Lmxlbmd0aC0xXS9tYXhTbGlkaW5nLFxuICAgIH1cbiAgIC8vIGNvbnNvbGUubG9nKGZyYW1lRU1HU2xpZGluZyk7XG4gICAgXG4gICAgY29uc3QgZnJhbWVFTUcgPSB7XG4gICAgICB0aW1lOiB0aW1lRU1HLFxuICAgICAgZGF0YTogZGF0YSxcbiAgICB9O1xuICAgIGV2ZW50SW5FTUdTbGlkaW5nLnByb2Nlc3NGcmFtZShmcmFtZUVNR1NsaWRpbmcpO1xuICAgIGV2ZW50SW5FTUcucHJvY2Vzc0ZyYW1lKGZyYW1lRU1HKTtcbiAgICBcbiAgfSk7XG4gIFxuICBjb25zdCBicGZEaXNwbGF5QWNjZWxlcm8gPSBuZXcgbGZvLnNpbmsuQnBmRGlzcGxheSh7XG4gICAgY2FudmFzOiAnI2NhbnZhc0JQRkFjY2VsZXJvJyxcbiAgICB3aWR0aDogNDAwLFxuICAgIGhlaWdodDogMjUwLFxuICAgIGR1cmF0aW9uOiA1LFxuICAgIG1heDogMixcbiAgICBtaW46IC0yXG4gIH0pO1xuICBjb25zdCBicGZEaXNwbGF5SmVya2luZXNzID0gbmV3IGxmby5zaW5rLkJwZkRpc3BsYXkoe1xuICAgIGNhbnZhczogJyNicGZEaXNwbGF5SmVya2luZXNzJyxcbiAgICB3aWR0aDogNDAwLFxuICAgIGhlaWdodDogMjUwLFxuICAgIGR1cmF0aW9uOiA1LFxuICAgIG1heDogMSxcbiAgICBtaW46IC0xXG4gIH0pO1xuICBjb25zdCBicGZEaXNwbGF5RU1HID0gbmV3IGxmby5zaW5rLkJwZkRpc3BsYXkoe1xuICAgIGNhbnZhczogJyNjYW52YXNFTUcxJyxcbiAgICB3aWR0aDogNDAwLFxuICAgIGhlaWdodDogMjUwLFxuICAgIGR1cmF0aW9uOiA1LFxuICAgIG1heDogMTAwLFxuICAgIG1pbjogLTEwMFxuICB9KTtcbiAgXG4gIGNvbnN0IGJwZkRpc3BsYXlFTUdTbGluZGluZyA9IG5ldyBsZm8uc2luay5CcGZEaXNwbGF5KHtcbiAgICBjYW52YXM6ICcjY2FudmFzRU1HMicsXG4gICAgd2lkdGg6IDQwMCxcbiAgICBoZWlnaHQ6IDI1MCxcbiAgICBkdXJhdGlvbjogNSxcbiAgICBtYXg6IDEsXG4gICAgbWluOiAtMVxuICB9KTtcbiAgXG4gIC8vTGUgbG93IHBhc3MgbmUgbWFyY2hlIHBhcyBldCBqZSBuZSBzYWlzIHRvdWpvdXJzIHBhcyBwb3VycXVvaS4gUHJvYmxlbWUgZGUgY29uZmlnP1xuICBjb25zdCBiaXF1YWQgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gICAgdHlwZTogJ2xvd3Bhc3MnLFxuICAgIGYwOiAxMDAwMCxcbiAgICBnYWluOiAzLFxuICAgIHE6IDEyLFxuICB9KTtcbiAgXG4gIGNvbnN0IGJpcXVhZDIgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gICAgdHlwZTogJ2xvd3Bhc3MnLFxuICAgIGYwOiAxMCxcbiAgICBnYWluOiAzLFxuICAgIHE6IDEyLFxuICB9KTtcbiAgXG4gIGNvbnN0IG1vdmluZ0F2ZXJhZ2UgPSBuZXcgbGZvLm9wZXJhdG9yLk1vdmluZ0F2ZXJhZ2Uoe1xuICAgIG9yZGVyOiA1LFxuICAgIGZpbGw6IDBcbiAgfSk7XG4gIFxuICBcbiAgTXlvLm9uKCdpbXUnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRpbWUgKz0gZHQ7XG4gICAgY29uc3QgZnJhbWVBY2NlbGVybyA9IHtcbiAgICAgIHRpbWU6IHRpbWUsXG4gICAgICBkYXRhOiBbZGF0YS5hY2NlbGVyb21ldGVyLngsIGRhdGEuYWNjZWxlcm9tZXRlci55LCBkYXRhLmFjY2VsZXJvbWV0ZXIuel1cbiAgICB9O1xuICAgIGNvbnN0IGZyYW1lR3lybyA9IHtcbiAgICAgIHRpbWU6IHRpbWUsXG4gICAgICBkYXRhOiBbZGF0YS5neXJvc2NvcGUueCwgZGF0YS5neXJvc2NvcGUueSwgZGF0YS5neXJvc2NvcGUuel1cbiAgICB9O1xuICBcbiAgICBldmVudEluQWNjZWxlcm8ucHJvY2Vzc0ZyYW1lKGZyYW1lQWNjZWxlcm8pO1xuICBcbiAgICAvL0NhbGN1bGluZyBzbW9vdGhuZXNzXG4gICAgYXJyYXlGaWx0ZXJpbmdYLnB1c2goZGF0YS5hY2NlbGVyb21ldGVyLngpO1xuICAgIGFycmF5RmlsdGVyaW5nWS5wdXNoKGRhdGEuYWNjZWxlcm9tZXRlci55KTtcbiAgICBhcnJheUZpbHRlcmluZ1oucHVzaChkYXRhLmFjY2VsZXJvbWV0ZXIueik7XG4gICAgXG4gICAgLy90YWlsbGUgZGUgbGEgZmVuZXRyZSBkZSBjYWxjdWxlIGRlIGwnYWxnb3JpdGhtZVxuICAgIGlmKGFycmF5RmlsdGVyaW5nWi5sZW5ndGggPiAyMCApe1xuICAgICAgYXJyYXlGaWx0ZXJpbmdYLnNoaWZ0KCk7XG4gICAgICBhcnJheUZpbHRlcmluZ1kuc2hpZnQoKTtcbiAgICAgIGFycmF5RmlsdGVyaW5nWi5zaGlmdCgpO1xuICAgICBcbiAgICAgIC8vYXBsbGljYXRpb24gZGUgc2F2aXR6a3ktZ29sYXkgZmlsdGVyXG4gICAgICBhbnN4ID0gIFNHKGFycmF5RmlsdGVyaW5nWCwgMSwgb3B0aW9ucyk7XG4gICAgICBhbnN5ID0gIFNHKGFycmF5RmlsdGVyaW5nWSwgMSwgb3B0aW9ucyk7XG4gICAgICBhbnN6ID0gIFNHKGFycmF5RmlsdGVyaW5nWiwgMSwgb3B0aW9ucyk7XG4gICAgICB2YXIgZnJhbWVTbW9vdGhuZXNzID0ge1xuICAgICAgICB0aW1lOiB0aW1lLFxuICAgICAgICBkYXRhOiBbYW5zeFthbnN4Lmxlbmd0aCAtIDFdLGFuc3lbYW5zeS5sZW5ndGggLSAxXSxhbnN6W2Fuc3oubGVuZ3RoIC0gMV1dLFxuICAgICAgfTtcbiAgICAgIGV2ZW50SW5TbW9vdGhuZXNzLnByb2Nlc3NGcmFtZShmcmFtZVNtb290aG5lc3MpO1xuICAgIH1cbiAgfSk7XG4gIFxuICAvKk1ZTyBzdG9wIGV2ZW50IGhhbmRsZXIqL1xuICAvKkNvbm5lY3Rpb24gb2YgdGhlIGdyYXBoIHRvIGRpc3BsYXkgKi9cbiAgXG4gIFxuICAvL0FDQ0VMRVJPXG4gIC8qZXZlbnRJbkFjY2VsZXJvLmNvbm5lY3QoYmlxdWFkKTtcbiAgYmlxdWFkLmNvbm5lY3QoYnBmRGlzcGxheUFjY2VsZXJvKTsqL1xuICBldmVudEluQWNjZWxlcm8uY29ubmVjdChicGZEaXNwbGF5QWNjZWxlcm8pO1xuICBcbiAgXG4gIC8vU21vb3RobmVzc1xuICBldmVudEluU21vb3RobmVzcy5jb25uZWN0KGJwZkRpc3BsYXlKZXJraW5lc3MpO1xuICBcbiAgLy9FTUdcbiAgLyogZXZlbnRJbkVNRy5jb25uZWN0KGJpcXVhZDIpO1xuICAgYmlxdWFkMi5jb25uZWN0KGJwZkRpc3BsYXlFTUcpO1xuICAqL2V2ZW50SW5FTUcuY29ubmVjdChicGZEaXNwbGF5RU1HKVxuICBcbiAgLy9FTUcgU0xJRElORyBXSU5ET1dcbiAgZXZlbnRJbkVNR1NsaWRpbmcuY29ubmVjdChicGZEaXNwbGF5RU1HU2xpbmRpbmcpO1xuICBcbn07Il19