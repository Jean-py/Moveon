"use strict";

// log helper

var socket = null;
var port = 8000;
var socket_name_session = "dev";

var Logger = function Logger() {
  return {
    //Connect to the server
    connect: function connect() {
      connectToServer();
    },
    //Change the user's name (of the socket)
    changeUsernameSocket: function changeUsernameSocket(username) {
      send_username(username);
    },
    //Send a command to the server and the server logs it
    sendAndLogCommand: function sendAndLogCommand(command) {
      log_command(command);
    },
    saveSH: function saveSH(SH) {
      _saveSH(SH);
    },
    getSocket_name_session: function getSocket_name_session() {
      return _getSocket_name_session();
    }

  };
};

function _getSocket_name_session() {
  return socket_name_session;
}

function connectToServer() {
  console.log("testing connect to server...");
  var addr = document.URL;
  //Split the https://xxxx:port#oNote  to xxxx:port
  addr = addr.split('/')[2];
  console.log("connect to : " + addr);
  socket = io.connect(addr);
  console.log("changing username socket to dev");
  logger.changeUsernameSocket("dev");
};

function send_username(username) {
  if (socket != null) {
    //console.log("username val : " + username);
    socket_name_session = username;
    socket.emit("socket_username", { username: username });
  }
};

//TODO faire une deep recopies des objets pass√© en parametre!
function log_command(commandParam) {
  console.log("executing : ");
  console.log(commandParam);
  if (socket != null) {
    var objCopy = null;

    //We have to log an event, if so, it's a circular reference and need to be treated as well
    if (commandParam.e !== undefined) {
      //console.log("OK --- " ) ;
      //console.log(commandParam.e.pageX) ;

      var mouse_event = { mouseEvent: { pageX: commandParam.e.pageX, pageY: commandParam.e.pageY } };

      //const o2 = { y: commandParam.e.pageY};
      objCopy = Object.assign({}, commandParam);
      objCopy = Object.assign(commandParam, mouse_event);
      objCopy.e = undefined;
    } else {
      objCopy = Object.assign({}, commandParam);
    }

    //console.log("*** LOGGER : log_command ***" );
    if (socket_name_session !== null) {
      send_username(socket_name_session);
    }
    objCopy.execute = objCopy.execute.name;
    if (objCopy.undo != null) {
      objCopy.undo = objCopy.undo.name;
    }

    socket.emit("log_command", objCopy);
    return true;
  }
  return false;
};

function _saveSH(SH) {
  if (socket != null) {
    var objCopy = null;

    objCopy = SH;

    if (socket_name_session !== null) {
      send_username(socket_name_session);
    }
    socket.emit("saveSH", SH);
    return true;
  }
  return false;
};

//Stringify an object, if the object contain a function,
// /!\ it convert the body of the function into text
var stringify = function stringify(obj, prop) {
  var placeholder = '____PLACEHOLDER____';
  var fns = [];
  var json = JSON.stringify(obj, function (key, value) {
    if (typeof value === 'function') {
      fns.push(value);
      return placeholder;
    }
    return value;
  }, 2);
  json = json.replace(new RegExp('"' + placeholder + '"', 'g'), function (_) {
    return fns.shift();
  });
  return json + ';';
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2dlci5qcyJdLCJuYW1lcyI6WyJzb2NrZXQiLCJwb3J0Iiwic29ja2V0X25hbWVfc2Vzc2lvbiIsIkxvZ2dlciIsImNvbm5lY3QiLCJjb25uZWN0VG9TZXJ2ZXIiLCJjaGFuZ2VVc2VybmFtZVNvY2tldCIsInVzZXJuYW1lIiwic2VuZF91c2VybmFtZSIsInNlbmRBbmRMb2dDb21tYW5kIiwiY29tbWFuZCIsImxvZ19jb21tYW5kIiwic2F2ZVNIIiwiU0giLCJnZXRTb2NrZXRfbmFtZV9zZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImFkZHIiLCJkb2N1bWVudCIsIlVSTCIsInNwbGl0IiwiaW8iLCJsb2dnZXIiLCJlbWl0IiwiY29tbWFuZFBhcmFtIiwib2JqQ29weSIsImUiLCJ1bmRlZmluZWQiLCJtb3VzZV9ldmVudCIsIm1vdXNlRXZlbnQiLCJwYWdlWCIsInBhZ2VZIiwiT2JqZWN0IiwiYXNzaWduIiwiZXhlY3V0ZSIsIm5hbWUiLCJ1bmRvIiwic3RyaW5naWZ5Iiwib2JqIiwicHJvcCIsInBsYWNlaG9sZGVyIiwiZm5zIiwianNvbiIsIkpTT04iLCJrZXkiLCJ2YWx1ZSIsInB1c2giLCJyZXBsYWNlIiwiUmVnRXhwIiwiXyIsInNoaWZ0Il0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUVBLElBQUlBLFNBQVMsSUFBYjtBQUNBLElBQUlDLE9BQU8sSUFBWDtBQUNBLElBQUlDLHNCQUFzQixLQUExQjs7QUFFQSxJQUFJQyxTQUFTLFNBQVRBLE1BQVMsR0FBVztBQUN0QixTQUFPO0FBQ0w7QUFDQUMsYUFBUyxtQkFBVTtBQUNqQkM7QUFDRCxLQUpJO0FBS0w7QUFDQUMsMEJBQXNCLDhCQUFTQyxRQUFULEVBQW1CO0FBQ3ZDQyxvQkFBY0QsUUFBZDtBQUNELEtBUkk7QUFTTDtBQUNBRSx1QkFBbUIsMkJBQVNDLE9BQVQsRUFBa0I7QUFDbkNDLGtCQUFZRCxPQUFaO0FBQ0QsS0FaSTtBQWFMRSxZQUFRLGdCQUFTQyxFQUFULEVBQWE7QUFDbkJELGNBQU9D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ZCxFQUFxQjtBQUNsRCxRQUFJLE9BQU9BLEtBQVAsS0FBaUIsVUFBckIsRUFBaUM7QUFDL0JKLFVBQUlLLElBQUosQ0FBU0QsS0FBVDtBQUNBLGFBQU9MLFdBQVA7QUFDRDtBQUNELFdBQU9LLEtBQVA7QUFDRCxHQU5VLEVBTVIsQ0FOUSxDQUFYO0FBT0FILFNBQU9BLEtBQUtLLE9BQUwsQ0FBYSxJQUFJQyxNQUFKLENBQVcsTUFBTVIsV0FBTixHQUFvQixHQUEvQixFQUFvQyxHQUFwQyxDQUFiLEVBQXVELFVBQVNTLENBQVQsRUFBWTtBQUN4RSxXQUFPUixJQUFJUyxLQUFKLEVBQVA7QUFDRCxHQUZNLENBQVA7QUFHQSxTQUFRUixPQUFPLEdBQWY7QUFDRCxDQWREIiwiZmlsZSI6ImxvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGxvZyBoZWxwZXJcblxudmFyIHNvY2tldCA9IG51bGw7XG52YXIgcG9ydCA9IDgwMDA7XG52YXIgc29ja2V0X25hbWVfc2Vzc2lvbiA9IFwiZGV2XCI7XG5cbnZhciBMb2dnZXIgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHtcbiAgICAvL0Nvbm5lY3QgdG8gdGhlIHNlcnZlclxuICAgIGNvbm5lY3Q6IGZ1bmN0aW9uKCl7XG4gICAgICBjb25uZWN0VG9TZXJ2ZXIoKTtcbiAgICB9LFxuICAgIC8vQ2hhbmdlIHRoZSB1c2VyJ3MgbmFtZSAob2YgdGhlIHNvY2tldClcbiAgICBjaGFuZ2VVc2VybmFtZVNvY2tldDogZnVuY3Rpb24odXNlcm5hbWUpIHtcbiAgICAgIHNlbmRfdXNlcm5hbWUodXNlcm5hbWUpO1xuICAgIH0sXG4gICAgLy9TZW5kIGEgY29tbWFuZCB0byB0aGUgc2VydmVyIGFuZCB0aGUgc2VydmVyIGxvZ3MgaXRcbiAgICBzZW5kQW5kTG9nQ29tbWFuZDogZnVuY3Rpb24oY29tbWFuZCkge1xuICAgICAgbG9nX2NvbW1hbmQoY29tbWFuZCk7XG4gICAgfSxcbiAgICBzYXZlU0g6IGZ1bmN0aW9uKFNIKSB7XG4gICAgICBzYXZlU0goU0gpO1xuICAgIH0sXG4gICAgZ2V0U29ja2V0X25hbWVfc2Vzc2lvbjogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGdldFNvY2tldF9uYW1lX3Nlc3Npb24oKTtcbiAgICB9XG4gICAgXG4gICAgXG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdldFNvY2tldF9uYW1lX3Nlc3Npb24oKXtcbiAgcmV0dXJuIHNvY2tldF9uYW1lX3Nlc3Npb247XG59XG5cblxuXG5cblxuXG5cbmZ1bmN0aW9uIGNvbm5lY3RUb1NlcnZlcigpIHtcbiAgY29uc29sZS5sb2coXCJ0ZXN0aW5nIGNvbm5lY3QgdG8gc2VydmVyLi4uXCIpO1xuICB2YXIgYWRkciA9IGRvY3VtZW50LlVSTDtcbiAgLy9TcGxpdCB0aGUgaHR0cHM6Ly94eHh4OnBvcnQjb05vdGUgIHRvIHh4eHg6cG9ydFxuICBhZGRyID0gYWRkci5zcGxpdCgnLycpWzJdO1xuICBjb25zb2xlLmxvZyhcImNvbm5lY3QgdG8gOiBcIiArIGFkZHIpO1xuICBzb2NrZXQgPSBpby5jb25uZWN0KGFkZHIpO1xuICBjb25zb2xlLmxvZyhcImNoYW5naW5nIHVzZXJuYW1lIHNvY2tldCB0byBkZXZcIik7XG4gIGxvZ2dlci5jaGFuZ2VVc2VybmFtZVNvY2tldChcImRldlwiKTtcbn07XG5cblxuXG5mdW5jdGlvbiBzZW5kX3VzZXJuYW1lKHVzZXJuYW1lKSB7XG4gIGlmKHNvY2tldCAhPSBudWxsKXtcbiAgICAvL2NvbnNvbGUubG9nKFwidXNlcm5hbWUgdmFsIDogXCIgKyB1c2VybmFtZSk7XG4gICAgc29ja2V0X25hbWVfc2Vzc2lvbiA9IHVzZXJuYW1lO1xuICAgIHNvY2tldC5lbWl0KFwic29ja2V0X3VzZXJuYW1lXCIsIHt1c2VybmFtZSA6IHVzZXJuYW1lfSlcbiAgfVxufTtcblxuLy9UT0RPIGZhaXJlIHVuZSBkZWVwIHJlY29waWVzIGRlcyBvYmpldHMgcGFzc8OpIGVuIHBhcmFtZXRyZSFcbmZ1bmN0aW9uIGxvZ19jb21tYW5kKGNvbW1hbmRQYXJhbSl7XG4gIGNvbnNvbGUubG9nKFwiZXhlY3V0aW5nIDogXCIpO1xuICBjb25zb2xlLmxvZyhjb21tYW5kUGFyYW0pO1xuICBpZihzb2NrZXQgIT0gbnVsbCl7XG4gICAgdmFyIG9iakNvcHkgPSBudWxsO1xuICAgIFxuICAgIC8vV2UgaGF2ZSB0byBsb2cgYW4gZXZlbnQsIGlmIHNvLCBpdCdzIGEgY2lyY3VsYXIgcmVmZXJlbmNlIGFuZCBuZWVkIHRvIGJlIHRyZWF0ZWQgYXMgd2VsbFxuICAgIGlmIChjb21tYW5kUGFyYW0uZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvL2NvbnNvbGUubG9nKFwiT0sgLS0tIFwiICkgO1xuICAgICAgLy9jb25zb2xlLmxvZyhjb21tYW5kUGFyYW0uZS5wYWdlWCkgO1xuICAgICAgXG4gICAgICBjb25zdCBtb3VzZV9ldmVudCA9IHttb3VzZUV2ZW50IDoge3BhZ2VYOiBjb21tYW5kUGFyYW0uZS5wYWdlWCwgcGFnZVk6IGNvbW1hbmRQYXJhbS5lLnBhZ2VZfX07XG4gICAgICBcbiAgICAgIC8vY29uc3QgbzIgPSB7IHk6IGNvbW1hbmRQYXJhbS5lLnBhZ2VZfTtcbiAgICAgICBvYmpDb3B5ID0gT2JqZWN0LmFzc2lnbih7fSwgY29tbWFuZFBhcmFtKTtcbiAgICAgICBvYmpDb3B5ID0gT2JqZWN0LmFzc2lnbihjb21tYW5kUGFyYW0sIG1vdXNlX2V2ZW50KTtcbiAgICAgICBvYmpDb3B5LmUgPSB1bmRlZmluZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICBvYmpDb3B5ID0gT2JqZWN0LmFzc2lnbih7fSwgY29tbWFuZFBhcmFtKTtcbiAgICB9XG4gIFxuICAgIFxuICAgIFxuICAgIC8vY29uc29sZS5sb2coXCIqKiogTE9HR0VSIDogbG9nX2NvbW1hbmQgKioqXCIgKTtcbiAgICBpZihzb2NrZXRfbmFtZV9zZXNzaW9uICE9PSBudWxsICl7XG4gICAgICBzZW5kX3VzZXJuYW1lKHNvY2tldF9uYW1lX3Nlc3Npb24pO1xuICAgIH1cbiAgICBvYmpDb3B5LmV4ZWN1dGUgPSBvYmpDb3B5LmV4ZWN1dGUubmFtZTtcbiAgICBpZihvYmpDb3B5LnVuZG8gIT0gbnVsbCl7XG4gICAgICBvYmpDb3B5LnVuZG8gPSBvYmpDb3B5LnVuZG8ubmFtZTtcbiAgICB9XG5cbiAgICBzb2NrZXQuZW1pdChcImxvZ19jb21tYW5kXCIsIG9iakNvcHkpO1xuICAgIHJldHVybiB0cnVlO1xuICAgIFxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblxuXG5mdW5jdGlvbiBzYXZlU0goU0gpe1xuICBpZihzb2NrZXQgIT0gbnVsbCl7XG4gICAgdmFyIG9iakNvcHkgPSBudWxsO1xuICAgIFxuICAgIG9iakNvcHkgPSAgU0g7XG5cbiAgICBpZihzb2NrZXRfbmFtZV9zZXNzaW9uICE9PSBudWxsICl7XG4gICAgICBzZW5kX3VzZXJuYW1lKHNvY2tldF9uYW1lX3Nlc3Npb24pO1xuICAgIH1cbiAgICBzb2NrZXQuZW1pdChcInNhdmVTSFwiLCBTSCk7XG4gICAgcmV0dXJuIHRydWU7XG4gICAgXG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG5cblxuLy9TdHJpbmdpZnkgYW4gb2JqZWN0LCBpZiB0aGUgb2JqZWN0IGNvbnRhaW4gYSBmdW5jdGlvbixcbi8vIC8hXFwgaXQgY29udmVydCB0aGUgYm9keSBvZiB0aGUgZnVuY3Rpb24gaW50byB0ZXh0XG52YXIgc3RyaW5naWZ5ID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7XG4gIHZhciBwbGFjZWhvbGRlciA9ICdfX19fUExBQ0VIT0xERVJfX19fJztcbiAgdmFyIGZucyA9IFtdO1xuICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KG9iaiwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGZucy5wdXNoKHZhbHVlKTtcbiAgICAgIHJldHVybiBwbGFjZWhvbGRlcjtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9LCAyKTtcbiAganNvbiA9IGpzb24ucmVwbGFjZShuZXcgUmVnRXhwKCdcIicgKyBwbGFjZWhvbGRlciArICdcIicsICdnJyksIGZ1bmN0aW9uKF8pIHtcbiAgICByZXR1cm4gZm5zLnNoaWZ0KCk7XG4gIH0pO1xuICByZXR1cm4gIGpzb24gKyAnOyc7XG59O1xuXG5cbiJdfQ==