"use strict";

// log helper

var socket = null;
var port = 8000;
var socket_name_session = "dev";

var Logger = function Logger() {
  return {
    //Connect to the server
    connect: function connect() {
      connectToServer();
    },
    //Change the user's name (of the socket)
    changeUsernameSocket: function changeUsernameSocket(username) {
      send_username(username);
    },
    //Send a command to the server and the server logs it
    sendAndLogCommand: function sendAndLogCommand(command) {
      log_command(command);
    },
    saveSH: function saveSH(SH) {
      _saveSH(SH);
    },
    getSocket_name_session: function getSocket_name_session() {
      return _getSocket_name_session();
    }

  };
};

function _getSocket_name_session() {
  return socket_name_session;
}

function connectToServer() {
  var addr = document.URL;
  //Split the https://xxxx:port#oNote  to xxxx:port
  addr = addr.split('/')[2];
  socket = io.connect(addr);
  console.log("connected to : " + addr, "changing username socket to dev");
  logger.changeUsernameSocket("dev");
};

function send_username(username) {
  if (socket != null) {
    //console.log("username val : " + username);
    socket_name_session = username;
    socket.emit("socket_username", { username: username });
  }
};

//TODO faire une deep recopies des objets pass√© en parametre!
function log_command(commandParam) {
  /*console.log("executing : ");
  console.log(commandParam);*/
  if (socket != null) {
    var objCopy = null;

    //We have to log an event, if so, it's a circular reference and need to be treated as well
    if (commandParam.e !== undefined) {
      console.log(" dans le if");
      //console.log(commandParam.e.pageX) ;

      var mouse_event = { mouseEvent: { pageX: commandParam.e.pageX, pageY: commandParam.e.pageY } };

      //const o2 = { y: commandParam.e.pageY};
      objCopy = Object.assign(commandParam, mouse_event);
      objCopy.e = undefined;
    } else {
      objCopy = Object.assign({}, commandParam);
    }

    //console.log("*** LOGGER : log_command ***" );
    if (socket_name_session !== null) {
      send_username(socket_name_session);
    }
    objCopy.execute = objCopy.execute.name;
    if (objCopy.undo != null) {
      objCopy.undo = objCopy.undo.name;
    }
    socket.emit("log_command", objCopy);
    return true;
  }
  return false;
};

function _saveSH(SH) {
  if (socket != null) {
    if (socket_name_session !== null) {
      send_username(socket_name_session);
    }
    socket.emit("saveSH", SH);
    return true;
  }
  return false;
};

//Stringify an object, if the object contain a function,
// /!\ it convert the body of the function into text
var stringify = function stringify(obj, prop) {
  var placeholder = '____PLACEHOLDER____';
  var fns = [];
  var json = JSON.stringify(obj, function (key, value) {
    if (typeof value === 'function') {
      fns.push(value);
      return placeholder;
    }
    return value;
  }, 2);
  json = json.replace(new RegExp('"' + placeholder + '"', 'g'), function (_) {
    return fns.shift();
  });
  return json + ';';
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2dlci5qcyJdLCJuYW1lcyI6WyJzb2NrZXQiLCJwb3J0Iiwic29ja2V0X25hbWVfc2Vzc2lvbiIsIkxvZ2dlciIsImNvbm5lY3QiLCJjb25uZWN0VG9TZXJ2ZXIiLCJjaGFuZ2VVc2VybmFtZVNvY2tldCIsInVzZXJuYW1lIiwic2VuZF91c2VybmFtZSIsInNlbmRBbmRMb2dDb21tYW5kIiwiY29tbWFuZCIsImxvZ19jb21tYW5kIiwic2F2ZVNIIiwiU0giLCJnZXRTb2NrZXRfbmFtZV9zZXNzaW9uIiwiYWRkciIsImRvY3VtZW50IiwiVVJMIiwic3BsaXQiLCJpbyIsImNvbnNvbGUiLCJsb2ciLCJsb2dnZXIiLCJlbWl0IiwiY29tbWFuZFBhcmFtIiwib2JqQ29weSIsImUiLCJ1bmRlZmluZWQiLCJtb3VzZV9ldmVudCIsIm1vdXNlRXZlbnQiLCJwYWdlWCIsInBhZ2VZIiwiT2JqZWN0IiwiYXNzaWduIiwiZXhlY3V0ZSIsIm5hbWUiLCJ1bmRvIiwic3RyaW5naWZ5Iiwib2JqIiwicHJvcCIsInBsYWNlaG9sZGVyIiwiZm5zIiwianNvbiIsIkpTT04iLCJrZXkiLCJ2YWx1ZSIsInB1c2giLCJyZXBsYWNlIiwiUmVnRXhwIiwiXyIsInNoaWZ0Il0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUVBLElBQUlBLFNBQVMsSUFBYjtBQUNBLElBQUlDLE9BQU8sSUFBWDtBQUNBLElBQUlDLHNCQUFzQixLQUExQjs7QUFFQSxJQUFJQyxTQUFTLFNBQVRBLE1BQVMsR0FBVztBQUN0QixTQUFPO0FBQ0w7QUFDQUMsYUFBUyxtQkFBVTtBQUNqQkM7QUFDRCxLQUpJO0FBS0w7QUFDQUMsMEJBQXNCLDhCQUFTQyxRQUFULEVBQW1CO0FBQ3ZDQyxvQkFBY0QsUUFBZDtBQUNELEtBUkk7QUFTTDtBQUNBRSx1QkFBbUIsMkJBQVNDLE9BQVQsRUFBa0I7QUFDbkNDLGtCQUFZRCxPQUFaO0FBQ0QsS0FaSTtBQWFMRSxZQUFRLGdCQUFTQyxFQUFULEVBQWE7QUFDbkJELGNBQU9D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YSxJQUFJQyxNQUFKLENBQVcsTUFBTVIsV0FBTixHQUFvQixHQUEvQixFQUFvQyxHQUFwQyxDQUFiLEVBQXVELFVBQVNTLENBQVQsRUFBWTtBQUN4RSxXQUFPUixJQUFJUyxLQUFKLEVBQVA7QUFDRCxHQUZNLENBQVA7QUFHQSxTQUFRUixPQUFPLEdBQWY7QUFDRCxDQWREIiwiZmlsZSI6ImxvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGxvZyBoZWxwZXJcblxudmFyIHNvY2tldCA9IG51bGw7XG52YXIgcG9ydCA9IDgwMDA7XG52YXIgc29ja2V0X25hbWVfc2Vzc2lvbiA9IFwiZGV2XCI7XG5cbnZhciBMb2dnZXIgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHtcbiAgICAvL0Nvbm5lY3QgdG8gdGhlIHNlcnZlclxuICAgIGNvbm5lY3Q6IGZ1bmN0aW9uKCl7XG4gICAgICBjb25uZWN0VG9TZXJ2ZXIoKTtcbiAgICB9LFxuICAgIC8vQ2hhbmdlIHRoZSB1c2VyJ3MgbmFtZSAob2YgdGhlIHNvY2tldClcbiAgICBjaGFuZ2VVc2VybmFtZVNvY2tldDogZnVuY3Rpb24odXNlcm5hbWUpIHtcbiAgICAgIHNlbmRfdXNlcm5hbWUodXNlcm5hbWUpO1xuICAgIH0sXG4gICAgLy9TZW5kIGEgY29tbWFuZCB0byB0aGUgc2VydmVyIGFuZCB0aGUgc2VydmVyIGxvZ3MgaXRcbiAgICBzZW5kQW5kTG9nQ29tbWFuZDogZnVuY3Rpb24oY29tbWFuZCkge1xuICAgICAgbG9nX2NvbW1hbmQoY29tbWFuZCk7XG4gICAgfSxcbiAgICBzYXZlU0g6IGZ1bmN0aW9uKFNIKSB7XG4gICAgICBzYXZlU0goU0gpO1xuICAgIH0sXG4gICAgZ2V0U29ja2V0X25hbWVfc2Vzc2lvbjogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGdldFNvY2tldF9uYW1lX3Nlc3Npb24oKTtcbiAgICB9XG4gICAgXG4gICAgXG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdldFNvY2tldF9uYW1lX3Nlc3Npb24oKXtcbiAgcmV0dXJuIHNvY2tldF9uYW1lX3Nlc3Npb247XG59XG5cblxuXG5cblxuXG5cbmZ1bmN0aW9uIGNvbm5lY3RUb1NlcnZlcigpIHtcbiAgdmFyIGFkZHIgPSBkb2N1bWVudC5VUkw7XG4gIC8vU3BsaXQgdGhlIGh0dHBzOi8veHh4eDpwb3J0I29Ob3RlICB0byB4eHh4OnBvcnRcbiAgYWRkciA9IGFkZHIuc3BsaXQoJy8nKVsyXTtcbiAgc29ja2V0ID0gaW8uY29ubmVjdChhZGRyKTtcbiAgY29uc29sZS5sb2coXCJjb25uZWN0ZWQgdG8gOiBcIiArIGFkZHIsIFwiY2hhbmdpbmcgdXNlcm5hbWUgc29ja2V0IHRvIGRldlwiKTtcbiAgbG9nZ2VyLmNoYW5nZVVzZXJuYW1lU29ja2V0KFwiZGV2XCIpO1xufTtcblxuXG5cbmZ1bmN0aW9uIHNlbmRfdXNlcm5hbWUodXNlcm5hbWUpIHtcbiAgaWYoc29ja2V0ICE9IG51bGwpe1xuICAgIC8vY29uc29sZS5sb2coXCJ1c2VybmFtZSB2YWwgOiBcIiArIHVzZXJuYW1lKTtcbiAgICBzb2NrZXRfbmFtZV9zZXNzaW9uID0gdXNlcm5hbWU7XG4gICAgc29ja2V0LmVtaXQoXCJzb2NrZXRfdXNlcm5hbWVcIiwge3VzZXJuYW1lIDogdXNlcm5hbWV9KVxuICB9XG59O1xuXG4vL1RPRE8gZmFpcmUgdW5lIGRlZXAgcmVjb3BpZXMgZGVzIG9iamV0cyBwYXNzw6kgZW4gcGFyYW1ldHJlIVxuZnVuY3Rpb24gbG9nX2NvbW1hbmQoY29tbWFuZFBhcmFtKXtcbiAgLypjb25zb2xlLmxvZyhcImV4ZWN1dGluZyA6IFwiKTtcbiAgY29uc29sZS5sb2coY29tbWFuZFBhcmFtKTsqL1xuICBpZihzb2NrZXQgIT0gbnVsbCl7XG4gICAgdmFyIG9iakNvcHkgPSBudWxsO1xuICAgIFxuICAgIC8vV2UgaGF2ZSB0byBsb2cgYW4gZXZlbnQsIGlmIHNvLCBpdCdzIGEgY2lyY3VsYXIgcmVmZXJlbmNlIGFuZCBuZWVkIHRvIGJlIHRyZWF0ZWQgYXMgd2VsbFxuICAgIGlmIChjb21tYW5kUGFyYW0uZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIiBkYW5zIGxlIGlmXCIgKSA7XG4gICAgICAvL2NvbnNvbGUubG9nKGNvbW1hbmRQYXJhbS5lLnBhZ2VYKSA7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vdXNlX2V2ZW50ID0ge21vdXNlRXZlbnQgOiB7cGFnZVg6IGNvbW1hbmRQYXJhbS5lLnBhZ2VYLCBwYWdlWTogY29tbWFuZFBhcmFtLmUucGFnZVl9fTtcbiAgICAgIFxuICAgICAgLy9jb25zdCBvMiA9IHsgeTogY29tbWFuZFBhcmFtLmUucGFnZVl9O1xuICAgICAgIG9iakNvcHkgPSBPYmplY3QuYXNzaWduKGNvbW1hbmRQYXJhbSwgbW91c2VfZXZlbnQpO1xuICAgICAgIG9iakNvcHkuZSA9IHVuZGVmaW5lZDtcbiAgICB9IGVsc2Uge1xuICAgICAgIG9iakNvcHkgPSBPYmplY3QuYXNzaWduKHt9LCBjb21tYW5kUGFyYW0pO1xuICAgIH1cbiAgICBcbiAgICAvL2NvbnNvbGUubG9nKFwiKioqIExPR0dFUiA6IGxvZ19jb21tYW5kICoqKlwiICk7XG4gICAgaWYoc29ja2V0X25hbWVfc2Vzc2lvbiAhPT0gbnVsbCApe1xuICAgICAgc2VuZF91c2VybmFtZShzb2NrZXRfbmFtZV9zZXNzaW9uKTtcbiAgICB9XG4gICAgb2JqQ29weS5leGVjdXRlID0gb2JqQ29weS5leGVjdXRlLm5hbWU7XG4gICAgaWYob2JqQ29weS51bmRvICE9IG51bGwpe1xuICAgICAgb2JqQ29weS51bmRvID0gb2JqQ29weS51bmRvLm5hbWU7XG4gICAgfVxuICAgIHNvY2tldC5lbWl0KFwibG9nX2NvbW1hbmRcIiwgb2JqQ29weSk7XG4gICAgcmV0dXJuIHRydWU7XG4gICAgXG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG5cbmZ1bmN0aW9uIHNhdmVTSChTSCl7XG4gIGlmKHNvY2tldCAhPSBudWxsKXtcbiAgICBpZihzb2NrZXRfbmFtZV9zZXNzaW9uICE9PSBudWxsICl7XG4gICAgICBzZW5kX3VzZXJuYW1lKHNvY2tldF9uYW1lX3Nlc3Npb24pO1xuICAgIH1cbiAgICBzb2NrZXQuZW1pdChcInNhdmVTSFwiLCBTSCk7XG4gICAgcmV0dXJuIHRydWU7XG4gICAgXG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG5cblxuLy9TdHJpbmdpZnkgYW4gb2JqZWN0LCBpZiB0aGUgb2JqZWN0IGNvbnRhaW4gYSBmdW5jdGlvbixcbi8vIC8hXFwgaXQgY29udmVydCB0aGUgYm9keSBvZiB0aGUgZnVuY3Rpb24gaW50byB0ZXh0XG52YXIgc3RyaW5naWZ5ID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7XG4gIHZhciBwbGFjZWhvbGRlciA9ICdfX19fUExBQ0VIT0xERVJfX19fJztcbiAgdmFyIGZucyA9IFtdO1xuICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KG9iaiwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGZucy5wdXNoKHZhbHVlKTtcbiAgICAgIHJldHVybiBwbGFjZWhvbGRlcjtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9LCAyKTtcbiAganNvbiA9IGpzb24ucmVwbGFjZShuZXcgUmVnRXhwKCdcIicgKyBwbGFjZWhvbGRlciArICdcIicsICdnJyksIGZ1bmN0aW9uKF8pIHtcbiAgICByZXR1cm4gZm5zLnNoaWZ0KCk7XG4gIH0pO1xuICByZXR1cm4gIGpzb24gKyAnOyc7XG59O1xuXG5cbiJdfQ==