'use strict';

var cardFunctionalCore = new CardFunctionalCore();

function Card(startDurationParam, endDurationParam, startPositionParam, endPositionParam, cardInfo) {
  var description = '';

  //Propriété de style
  var width = '6%';
  var height = '6%';
  var deleted = false;
  var iDiv = null;
  var startP = startPositionParam;
  var endP = endPositionParam;
  //Valeur pour jouer la carte
  var speed = 1;
  var repetitionNumber = 1;
  //div used
  var divInfoCard = null;
  //let selectSpeed=null;
  var selectNbRepet = null;
  var selectSpeed = null;

  var imgSlow = null;

  var textSegment = null;
  var textStartSegment = null;
  var textEndSegment = null;
  var imgRepet = null;
  var divSegment = null;
  var startDuration = startDurationParam;
  var endDuration = endDurationParam;
  var left = void 0;

  var buttonDelete = null;
  var cardObject;

  //cette div est la principale, celle qui contient fragment + bardFragment
  iDiv = document.createElement('div');
  iDiv.id = 'idCard' + createUniqueId();
  iDiv.className = 'segmentWrapper';
  iDiv.style.left = startPositionParam;

  //Color picker
  //var arrowDown = document.createElement('input');
  /* arrowDown.type = 'jscolor';
   arrowDown.className = 'jscolor';
   arrowDown.value = '#8DFFFF';
   //jscolor.installByClassName("jscolor");*/

  /* arrowDown.border = 'none';
   arrowDown.outline = 'none';
   arrowDown.style.backgroundColor = 'black';
   arrowDown.style.webkitAppearance = 'listitem';
   arrowDown.value = "#41568d";*/

  //arrowDown.value = "FF9900";
  //arrowDown.mode = 'HS';
  //arrowDown.position = 'right' ;
  /* arrowDown.value ="#102b9f";
   arrowDown.style.outline="none";*/

  //Div du segment bleu
  divSegment = document.createElement('div');
  divSegment.className = 'segment';

  //taille de la carte initiale
  //width = iDiv.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "%";
  divSegment.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "%";
  width = divSegment.style.width;
  console.log(divSegment.style.width);

  initGUI();
  initStyle();
  initListener();
  playCard(iDiv, startDurationParam);

  function watchColorPicker(event) {
    divSegment.style.backgroundColor = event.target.value;
  }
  //console.log(cardInfo.deleted);
  function updateInfo() {
    cardObject.width = width;
    cardObject.startP = startP;
    cardObject.endP = endP;
    cardObject.description = description;
    cardObject.speed = speed;
    cardObject.deleted = deleted;
    cardObject.repetitionNumber = repetitionNumber;
    cardObject.iDiv = iDiv;
    cardObject.id = iDiv.id;
    return cardObject;
  }

  function initListener() {
    textSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });
    divSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });
    selectSpeed.addEventListener("blur", function (e) {
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      speed = speedRate;
      cardFunctionalCore.execute(new CardSpeedCommand(cardObject, speedRate));
    });
    selectNbRepet.addEventListener("blur", function (e) {
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      console.log("nbrepet in card :" + repetitionNumber);
      cardFunctionalCore.execute(new CardNbRepetCommand(cardObject, repetitionNumber));
      //cardFunctionalCore.execute(new CardNbRepetCommand(cardObject, 100));
    });
    divSegment.addEventListener("mousedown", function (e) {
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      speed = speedRate;
      segmentFeedback.startPostion = iDiv.style.left;
      segmentFeedback.width = width;
      description = textSegment.value;

      //feedbackOnSliderVideo(true,startDurationParam,endDurationParam);

      //videoFunctionalCoreManager.execute(new RepetPartOfVideoCommand(startDuration, endDuration, repetitionNumber, speedRate));
      videoFunctionalCoreManager.execute(new RepetPartOfVideoCommand(startDuration, endDuration, 100, speedRate));
    }, false);
    //TODO widget color picker
    //arrowDown.addEventListener("change", watchColorPicker, false);
  }
  function initGUI() {
    textSegment = document.createElement('input');
    textSegment.className = 'textSegment';
    //UI button speed and slow
    imgRepet = document.createElement("img");
    imgRepet.className = 'imgRepet';
    imgSlow = document.createElement("img");

    imgSlow.className = 'imgSlow';
    selectSpeed = document.createElement("select");
    selectSpeed.className = 'selectSpeed';
    selectNbRepet = document.createElement("select");

    selectNbRepet.className = 'selectNbRepet';
    divInfoCard = document.createElement('div');

    divInfoCard.className = "infoCard";

    /*textSegment.addEventListener("focus", function () {
      cardFunctionalCore.execute(new ModifyCardDescriptionCommand(cardObject,textSegment.value));
    });*/
    textSegment.addEventListener("blur", function () {
      description = textSegment.value;
      cardFunctionalCore.execute(new ModifyCardDescriptionCommand(cardObject, textSegment.value));
    });

    for (var i = 0; i < 20; i += 1) {
      selectSpeed.add(new Option(i / 10 + ""));
    }
    selectSpeed.selectedIndex = 10;
    for (var _i = 0; _i < 20; _i++) {
      selectNbRepet.options.add(new Option(_i + ""));
    }

    selectNbRepet.selectedIndex = 1;
    /*
    Creation des étapes pour facilement changer la taille des segments
    
      textStartSegment = document.createElement('input');
      textStartSegment.className = '';
      textEndSegment = document.createElement('input');
      textEndSegment.className = '';
      divInfoCard.appendChild(textStartSegment);
      divInfoCard.appendChild(textEndSegment);
    */

    //Div contenant les info du dessus (taille de div invariable)
    divInfoCard.appendChild(imgSlow);
    divInfoCard.appendChild(selectSpeed);
    //divInfoCard.appendChild(imgRepet);
    //divInfoCard.appendChild(selectNbRepet);
    divInfoCard.appendChild(textSegment);
    //divInfoCard.appendChild(arrowDown);
    iDiv.appendChild(divSegment);
    iDiv.appendChild(divInfoCard);

    //If the card have been deleted, the color is red, otherwise blue.
    if (cardInfo) {
      if (cardInfo.deleted) {
        divSegment.style.backgroundColor = "red";
      } else {
        divSegment.style.backgroundColor = "#213F8D";
      }
      textSegment.value = cardInfo.description;
      selectNbRepet.selectedIndex = cardInfo.repetitionNumber;
      selectSpeed.selectedIndex = cardInfo.speed * 10;
    }
  }

  function initStyle() {
    textSegment.style.left = divSegment.style.width;
    /*imgSlow.src = "/media/workshop2/card/slow.png";
    imgRepet.src = "/media/workshop2/card/repet.png";*/
  }

  function createBtnDelete(e) {
    e.preventDefault();
    //delete apparait
    var buttonDelete = document.createElement('button');
    buttonDelete.id = 'idBtnDelete';
    buttonDelete.style.position = "absolute";
    buttonDelete.type = "button";
    buttonDelete.innerHTML = "Delete";
    buttonDelete.style.width = "100px";
    divInfoCard.appendChild(buttonDelete);
    buttonDelete.addEventListener('mouseup', function (e) {
      //TODO
      cardManager.execute(new DeleteCardCommand(cardObject));
      //deleteCard(cardObject);
    });

    buttonDelete.addEventListener('touchend', function (e) {
      cardManager.execute(new DeleteCardCommand(cardObject));
      //deleteCard();
    });
  }

  cardObject = {
    width: width,
    startP: startP,
    endP: endP,
    description: this.description,
    speed: this.speed,
    repetitionNumber: this.repetitionNumber,
    iDiv: iDiv,
    id: iDiv.id,
    updateInfo: updateInfo
  };

  return cardObject;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmQuanMiXSwibmFtZXMiOlsiY2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZCIsInN0YXJ0RHVyYXRpb25QYXJhbSIsImVuZER1cmF0aW9uUGFyYW0iLCJzdGFydFBvc2l0aW9uUGFyYW0iLCJlbmRQb3NpdGlvblBhcmFtIiwiY2FyZEluZm8iLCJkZXNjcmlwdGlvbiIsIndpZHRoIiwiaGVpZ2h0IiwiZGVsZXRlZCIsImlEaXYiLCJzdGFydFAiLCJlbmRQIiwic3BlZWQiLCJyZXBldGl0aW9uTnVtYmVyIiwiZGl2SW5mb0NhcmQiLCJzZWxlY3ROYlJlcGV0Iiwic2VsZWN0U3BlZWQiLCJpbWdTbG93IiwidGV4dFNlZ21lbnQiLCJ0ZXh0U3RhcnRTZWdtZW50IiwidGV4dEVuZFNlZ21lbnQiLCJpbWdSZXBldCIsImRpdlNlZ21lbnQiLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJsZWZ0IiwiYnV0dG9uRGVsZXRlIiwiY2FyZE9iamVjdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlkIiwiY3JlYXRlVW5pcXVlSWQiLCJjbGFzc05hbWUiLCJzdHlsZSIsInBhcnNlSW50IiwiY29uc29sZSIsImxvZyIsImluaXRHVUkiLCJpbml0U3R5bGUiLCJpbml0TGlzdGVuZXIiLCJwbGF5Q2FyZCIsIndhdGNoQ29sb3JQaWNrZXIiLCJldmVudCIsImJhY2tncm91bmRDb2xvciIsInRhcmdldCIsInZhbHVlIiwidXBkYXRlSW5mbyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY3JlYXRlQnRuRGVsZXRlIiwic3BlZWRSYXRlIiwib3B0aW9ucyIsInNlbGVjdGVkSW5kZXgiLCJleGVjdXRlIiwiQ2FyZFNwZWVkQ29tbWFuZCIsIkNhcmROYlJlcGV0Q29tbWFuZCIsInNlZ21lbnRGZWVkYmFjayIsInN0YXJ0UG9zdGlvbiIsInZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyIiwiUmVwZXRQYXJ0T2ZWaWRlb0NvbW1hbmQiLCJNb2RpZnlDYXJkRGVzY3JpcHRpb25Db21tYW5kIiwiaSIsImFkZCIsIk9wdGlvbiIsImFwcGVuZENoaWxkIiwicHJldmVudERlZmF1bHQiLCJwb3NpdGlvbiIsInR5cGUiLCJpbm5lckhUTUwiLCJjYXJkTWFuYWdlciIsIkRlbGV0ZUNhcmRDb21tYW5kIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLHFCQUFxQixJQUFJQyxrQkFBSixFQUF6Qjs7QUFFQSxTQUFTQyxJQUFULENBQWVDLGtCQUFmLEVBQWtDQyxnQkFBbEMsRUFBbURDLGtCQUFuRCxFQUFzRUMsZ0JBQXRFLEVBQXdGQyxRQUF4RixFQUFrRztBQUNoRyxNQUFJQyxjQUFjLEVBQWxCOztBQUVBO0FBQ0EsTUFBSUMsUUFBUSxJQUFaO0FBQ0EsTUFBSUMsU0FBUyxJQUFiO0FBQ0EsTUFBSUMsVUFBVSxLQUFkO0FBQ0EsTUFBSUMsT0FBTyxJQUFYO0FBQ0EsTUFBSUMsU0FBU1Isa0JBQWI7QUFDQSxNQUFJUyxPQUFPUixnQkFBWDtBQUNGO0FBQ0UsTUFBSVMsUUFBUSxDQUFaO0FBQ0EsTUFBSUMsbUJBQW1CLENBQXZCO0FBQ0Y7QUFDRSxNQUFJQyxjQUFjLElBQWxCO0FBQ0E7QUFDQSxNQUFJQyxnQkFBZ0IsSUFBcEI7QUFDQSxNQUFJQyxjQUFjLElBQWxCOztBQUVBLE1BQUlDLFVBQVUsSUFBZDs7QUFJQSxNQUFJQyxjQUFjLElBQWxCO0FBQ0EsTUFBSUMsbUJBQW1CLElBQXZCO0FBQ0EsTUFBSUMsaUJBQWlCLElBQXJCO0FBQ0EsTUFBSUMsV0FBVyxJQUFmO0FBQ0EsTUFBSUMsYUFBYSxJQUFqQjtBQUNBLE1BQUlDLGdCQUFnQnZCLGtCQUFwQjtBQUNBLE1BQUl3QixjQUFjdkIsZ0JBQWxCO0FBQ0EsTUFBSXdCLGFBQUo7O0FBRUEsTUFBSUMsZUFBZSxJQUFuQjtBQUNBLE1BQUlDLFVBQUo7O0FBRUE7QUFDQWxCLFNBQU9tQixTQUFTQyxhQUFULENBQXVCLEtBQXZCLENBQVA7QUFDQXBCLE9BQUtxQixFQUFMLEdBQVUsV0FBV0Ms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PSBuZXcgQ2FyZEZ1bmN0aW9uYWxDb3JlKCk7XG5cbmZ1bmN0aW9uIENhcmQgKHN0YXJ0RHVyYXRpb25QYXJhbSxlbmREdXJhdGlvblBhcmFtLHN0YXJ0UG9zaXRpb25QYXJhbSxlbmRQb3NpdGlvblBhcmFtLCBjYXJkSW5mbykge1xuICB2YXIgZGVzY3JpcHRpb24gPSAnJztcbiAgXG4gIC8vUHJvcHJpw6l0w6kgZGUgc3R5bGVcbiAgbGV0IHdpZHRoID0gJzYlJztcbiAgbGV0IGhlaWdodCA9ICc2JSc7XG4gIHZhciBkZWxldGVkID0gZmFsc2U7XG4gIHZhciBpRGl2ID0gbnVsbDtcbiAgdmFyIHN0YXJ0UCA9IHN0YXJ0UG9zaXRpb25QYXJhbTtcbiAgdmFyIGVuZFAgPSBlbmRQb3NpdGlvblBhcmFtO1xuLy9WYWxldXIgcG91ciBqb3VlciBsYSBjYXJ0ZVxuICB2YXIgc3BlZWQgPSAxO1xuICB2YXIgcmVwZXRpdGlvbk51bWJlciA9IDE7XG4vL2RpdiB1c2VkXG4gIGxldCBkaXZJbmZvQ2FyZCA9IG51bGw7XG4gIC8vbGV0IHNlbGVjdFNwZWVkPW51bGw7XG4gIGxldCBzZWxlY3ROYlJlcGV0ID0gbnVsbDtcbiAgbGV0IHNlbGVjdFNwZWVkID0gbnVsbDtcbiAgXG4gIGxldCBpbWdTbG93ID0gbnVsbDtcbiAgXG4gIFxuICBcbiAgdmFyIHRleHRTZWdtZW50ID0gbnVsbDtcbiAgdmFyIHRleHRTdGFydFNlZ21lbnQgPSBudWxsO1xuICB2YXIgdGV4dEVuZFNlZ21lbnQgPSBudWxsO1xuICBsZXQgaW1nUmVwZXQgPSBudWxsO1xuICBsZXQgZGl2U2VnbWVudCA9IG51bGw7XG4gIGxldCBzdGFydER1cmF0aW9uID0gc3RhcnREdXJhdGlvblBhcmFtO1xuICBsZXQgZW5kRHVyYXRpb24gPSBlbmREdXJhdGlvblBhcmFtO1xuICBsZXQgbGVmdCA7XG4gIFxuICB2YXIgYnV0dG9uRGVsZXRlID0gbnVsbDtcbiAgdmFyIGNhcmRPYmplY3Q7XG4gIFxuICAvL2NldHRlIGRpdiBlc3QgbGEgcHJpbmNpcGFsZSwgY2VsbGUgcXVpIGNvbnRpZW50IGZyYWdtZW50ICsgYmFyZEZyYWdtZW50XG4gIGlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgaURpdi5pZCA9ICdpZENhcmQnICsgY3JlYXRlVW5pcXVlSWQoKTtcbiAgaURpdi5jbGFzc05hbWUgPSAnc2VnbWVudFdyYXBwZXInO1xuICBpRGl2LnN0eWxlLmxlZnQgPSBzdGFydFBvc2l0aW9uUGFyYW0gO1xuICBcbiAgXG4gIC8vQ29sb3IgcGlja2VyXG4gIC8vdmFyIGFycm93RG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gLyogYXJyb3dEb3duLnR5cGUgPSAnanNjb2xvcic7XG4gIGFycm93RG93bi5jbGFzc05hbWUgPSAnanNjb2xvcic7XG4gIGFycm93RG93bi52YWx1ZSA9ICcjOERGRkZGJztcbiAgLy9qc2NvbG9yLmluc3RhbGxCeUNsYXNzTmFtZShcImpzY29sb3JcIik7Ki9cbiAgXG4gIFxuICBcbiAgLyogYXJyb3dEb3duLmJvcmRlciA9ICdub25lJztcbiAgIGFycm93RG93bi5vdXRsaW5lID0gJ25vbmUnO1xuICAgYXJyb3dEb3duLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdibGFjayc7XG4gICBhcnJvd0Rvd24uc3R5bGUud2Via2l0QXBwZWFyYW5jZSA9ICdsaXN0aXRlbSc7XG4gICBhcnJvd0Rvd24udmFsdWUgPSBcIiM0MTU2OGRcIjsqL1xuICBcbiAgICAgLy9hcnJvd0Rvd24udmFsdWUgPSBcIkZGOTkwMFwiO1xuICAvL2Fycm93RG93bi5tb2RlID0gJ0hTJztcbiAgLy9hcnJvd0Rvd24ucG9zaXRpb24gPSAncmlnaHQnIDtcbiAvKiBhcnJvd0Rvd24udmFsdWUgPVwiIzEwMmI5ZlwiO1xuICBhcnJvd0Rvd24uc3R5bGUub3V0bGluZT1cIm5vbmVcIjsqL1xuICBcbiAgLy9EaXYgZHUgc2VnbWVudCBibGV1XG4gIGRpdlNlZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2U2VnbWVudC5jbGFzc05hbWUgPSAnc2VnbWVudCc7XG4gIFxuICAvL3RhaWxsZSBkZSBsYSBjYXJ0ZSBpbml0aWFsZVxuICAvL3dpZHRoID0gaURpdi5zdHlsZS53aWR0aCA9IHBhcnNlSW50KGVuZFBvc2l0aW9uUGFyYW0sIDEwKSAtIHBhcnNlSW50KHN0YXJ0UG9zaXRpb25QYXJhbSwgMTApICsgXCIlXCI7XG4gIGRpdlNlZ21lbnQuc3R5bGUud2lkdGggPSBwYXJzZUludChlbmRQb3NpdGlvblBhcmFtLCAxMCkgLSBwYXJzZUludChzdGFydFBvc2l0aW9uUGFyYW0sIDEwKSArIFwiJVwiO1xuICB3aWR0aCA9ICAgZGl2U2VnbWVudC5zdHlsZS53aWR0aDtcbiAgY29uc29sZS5sb2coIGRpdlNlZ21lbnQuc3R5bGUud2lkdGgpO1xuICBcbiAgaW5pdEdVSSgpO1xuICBpbml0U3R5bGUoKTtcbiAgaW5pdExpc3RlbmVyKCk7XG4gIHBsYXlDYXJkKGlEaXYsIHN0YXJ0RHVyYXRpb25QYXJhbSk7XG4gIFxuICBcbiAgZnVuY3Rpb24gd2F0Y2hDb2xvclBpY2tlcihldmVudCkge1xuICAgIGRpdlNlZ21lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICBcbiAgfVxuICAvL2NvbnNvbGUubG9nKGNhcmRJbmZvLmRlbGV0ZWQpO1xuICBmdW5jdGlvbiB1cGRhdGVJbmZvKCl7XG4gICAgY2FyZE9iamVjdC53aWR0aCA9IHdpZHRoO1xuICAgIGNhcmRPYmplY3Quc3RhcnRQID0gc3RhcnRQO1xuICAgIGNhcmRPYmplY3QuZW5kUCA9IGVuZFA7XG4gICAgY2FyZE9iamVjdC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgIGNhcmRPYmplY3Quc3BlZWQgPSBzcGVlZDtcbiAgICBjYXJkT2JqZWN0LmRlbGV0ZWQgPSBkZWxldGVkO1xuICAgIGNhcmRPYmplY3QucmVwZXRpdGlvbk51bWJlciA9IHJlcGV0aXRpb25OdW1iZXI7XG4gICAgY2FyZE9iamVjdC5pRGl2ID0gaURpdjtcbiAgICBjYXJkT2JqZWN0LmlkID0gaURpdi5pZDtcbiAgICByZXR1cm4gY2FyZE9iamVjdDtcbiAgfVxuICBcbiAgXG4gIGZ1bmN0aW9uIGluaXRMaXN0ZW5lcigpIHtcbiAgICB0ZXh0U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKCdsb25nLXByZXNzJywgZnVuY3Rpb24oZSl7XG4gICAgICBjcmVhdGVCdG5EZWxldGUoZSk7XG4gICAgfSk7XG4gICAgZGl2U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKCdsb25nLXByZXNzJywgZnVuY3Rpb24oZSl7XG4gICAgICBjcmVhdGVCdG5EZWxldGUoZSk7XG4gICAgfSk7XG4gICAgc2VsZWN0U3BlZWQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oZSl7XG4gICAgICBsZXQgc3BlZWRSYXRlID0gc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIHNwZWVkID0gc3BlZWRSYXRlO1xuICAgICAgY2FyZEZ1bmN0aW9uYWxDb3JlLmV4ZWN1dGUobmV3IENhcmRTcGVlZENvbW1hbmQoY2FyZE9iamVjdCxzcGVlZFJhdGUpKTtcbiAgICB9KTtcbiAgICBzZWxlY3ROYlJlcGV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgcmVwZXRpdGlvbk51bWJlciA9IHNlbGVjdE5iUmVwZXQub3B0aW9uc1tzZWxlY3ROYlJlcGV0LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICAgICAgY29uc29sZS5sb2coXCJuYnJlcGV0IGluIGNhcmQgOlwiICsgIHJlcGV0aXRpb25OdW1iZXIpO1xuICAgICAgY2FyZEZ1bmN0aW9uYWxDb3JlLmV4ZWN1dGUobmV3IENhcmROYlJlcGV0Q29tbWFuZChjYXJkT2JqZWN0LCByZXBldGl0aW9uTnVtYmVyKSk7XG4gICAgICAvL2NhcmRGdW5jdGlvbmFsQ29yZS5leGVjdXRlKG5ldyBDYXJkTmJSZXBldENvbW1hbmQoY2FyZE9iamVjdCwgMTAwKSk7XG4gICAgfSk7XG4gICAgZGl2U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXBldGl0aW9uTnVtYmVyID0gc2VsZWN0TmJSZXBldC5vcHRpb25zW3NlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBsZXQgc3BlZWRSYXRlID0gc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIHNwZWVkID0gc3BlZWRSYXRlO1xuICAgICAgc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbiA9IGlEaXYuc3R5bGUubGVmdCAgO1xuICAgICAgc2VnbWVudEZlZWRiYWNrLndpZHRoID0gd2lkdGg7XG4gICAgICBkZXNjcmlwdGlvbiA9IHRleHRTZWdtZW50LnZhbHVlO1xuICBcbiAgICAgIC8vZmVlZGJhY2tPblNsaWRlclZpZGVvKHRydWUsc3RhcnREdXJhdGlvblBhcmFtLGVuZER1cmF0aW9uUGFyYW0pO1xuICAgICAgXG4gICAgICAvL3ZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IFJlcGV0UGFydE9mVmlkZW9Db21tYW5kKHN0YXJ0RHVyYXRpb24sIGVuZER1cmF0aW9uLCByZXBldGl0aW9uTnVtYmVyLCBzcGVlZFJhdGUpKTtcbiAgICAgIHZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IFJlcGV0UGFydE9mVmlkZW9Db21tYW5kKHN0YXJ0RHVyYXRpb24sIGVuZER1cmF0aW9uLCAxMDAsIHNwZWVkUmF0ZSkpO1xuICAgIH0sIGZhbHNlKTtcbiAgICAvL1RPRE8gd2lkZ2V0IGNvbG9yIHBpY2tlclxuICAgIC8vYXJyb3dEb3duLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgd2F0Y2hDb2xvclBpY2tlciwgZmFsc2UpO1xuICB9XG4gIGZ1bmN0aW9uIGluaXRHVUkoKSB7XG4gICAgdGV4dFNlZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIHRleHRTZWdtZW50LmNsYXNzTmFtZSA9ICd0ZXh0U2VnbWVudCc7XG4gICAgLy9VSSBidXR0b24gc3BlZWQgYW5kIHNsb3dcbiAgICBpbWdSZXBldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgaW1nUmVwZXQuY2xhc3NOYW1lPSdpbWdSZXBldCc7XG4gICAgaW1nU2xvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gIFxuICAgIGltZ1Nsb3cuY2xhc3NOYW1lPSdpbWdTbG93JztcbiAgICBzZWxlY3RTcGVlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgc2VsZWN0U3BlZWQuY2xhc3NOYW1lID0nc2VsZWN0U3BlZWQnIDtcbiAgICBzZWxlY3ROYlJlcGV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtcbiAgXG4gICAgc2VsZWN0TmJSZXBldC5jbGFzc05hbWUgPSdzZWxlY3ROYlJlcGV0JyA7XG4gICAgZGl2SW5mb0NhcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgXG4gICAgZGl2SW5mb0NhcmQuY2xhc3NOYW1lID0gXCJpbmZvQ2FyZFwiO1xuICAgIFxuICAgIC8qdGV4dFNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNhcmRGdW5jdGlvbmFsQ29yZS5leGVjdXRlKG5ldyBNb2RpZnlDYXJkRGVzY3JpcHRpb25Db21tYW5kKGNhcmRPYmplY3QsdGV4dFNlZ21lbnQudmFsdWUpKTtcbiAgICB9KTsqL1xuICAgIHRleHRTZWdtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRlc2NyaXB0aW9uID0gdGV4dFNlZ21lbnQudmFsdWU7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgTW9kaWZ5Q2FyZERlc2NyaXB0aW9uQ29tbWFuZChjYXJkT2JqZWN0LHRleHRTZWdtZW50LnZhbHVlKSk7XG4gICAgfSk7XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDsgaSArPSAxKSB7XG4gICAgICBzZWxlY3RTcGVlZC5hZGQobmV3IE9wdGlvbihpIC8gMTAgKyBcIlwiKSk7XG4gICAgfVxuICAgIHNlbGVjdFNwZWVkLnNlbGVjdGVkSW5kZXggPSAxMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAgIHNlbGVjdE5iUmVwZXQub3B0aW9ucy5hZGQobmV3IE9wdGlvbihpICsgXCJcIikpO1xuICAgIH1cbiAgXG4gICAgc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4ID0gMTtcbiAgLypcbiAgQ3JlYXRpb24gZGVzIMOpdGFwZXMgcG91ciBmYWNpbGVtZW50IGNoYW5nZXIgbGEgdGFpbGxlIGRlcyBzZWdtZW50c1xuICBcbiAgICB0ZXh0U3RhcnRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0U3RhcnRTZWdtZW50LmNsYXNzTmFtZSA9ICcnO1xuICAgIHRleHRFbmRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0RW5kU2VnbWVudC5jbGFzc05hbWUgPSAnJztcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0U3RhcnRTZWdtZW50KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0RW5kU2VnbWVudCk7XG4gICovXG4gIFxuICAgIC8vRGl2IGNvbnRlbmFudCBsZXMgaW5mbyBkdSBkZXNzdXMgKHRhaWxsZSBkZSBkaXYgaW52YXJpYWJsZSlcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChpbWdTbG93KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChzZWxlY3RTcGVlZCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChpbWdSZXBldCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChzZWxlY3ROYlJlcGV0KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0U2VnbWVudCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChhcnJvd0Rvd24pO1xuICAgIGlEaXYuYXBwZW5kQ2hpbGQoZGl2U2VnbWVudCk7XG4gICAgaURpdi5hcHBlbmRDaGlsZChkaXZJbmZvQ2FyZCk7XG4gIFxuICAgIFxuICBcbiAgXG4gICAgLy9JZiB0aGUgY2FyZCBoYXZlIGJlZW4gZGVsZXRlZCwgdGhlIGNvbG9yIGlzIHJlZCwgb3RoZXJ3aXNlIGJsdWUuXG4gICAgaWYgKGNhcmRJbmZvKSB7XG4gICAgICBpZihjYXJkSW5mby5kZWxldGVkKXtcbiAgICAgICAgZGl2U2VnbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGl2U2VnbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMyMTNGOERcIjtcbiAgICAgIH1cbiAgICAgIHRleHRTZWdtZW50LnZhbHVlID0gY2FyZEluZm8uZGVzY3JpcHRpb247XG4gICAgICBzZWxlY3ROYlJlcGV0LnNlbGVjdGVkSW5kZXggPSBjYXJkSW5mby5yZXBldGl0aW9uTnVtYmVyO1xuICAgICAgc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleCA9IGNhcmRJbmZvLnNwZWVkKjEwO1xuICAgIH1cbiAgfVxuICBcbiAgXG4gIFxuICBmdW5jdGlvbiBpbml0U3R5bGUoKSB7XG4gICAgdGV4dFNlZ21lbnQuc3R5bGUubGVmdCA9IGRpdlNlZ21lbnQuc3R5bGUud2lkdGg7XG4gICAgLyppbWdTbG93LnNyYyA9IFwiL21lZGlhL3dvcmtzaG9wMi9jYXJkL3Nsb3cucG5nXCI7XG4gICAgaW1nUmVwZXQuc3JjID0gXCIvbWVkaWEvd29ya3Nob3AyL2NhcmQvcmVwZXQucG5nXCI7Ki9cbiAgfVxuICBcbiAgXG4gIFxuICBmdW5jdGlvbiBjcmVhdGVCdG5EZWxldGUoZSl7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vZGVsZXRlIGFwcGFyYWl0XG4gICAgdmFyIGJ1dHRvbkRlbGV0ZSA9ICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICBidXR0b25EZWxldGUuaWQgPSAnaWRCdG5EZWxldGUnO1xuICAgIGJ1dHRvbkRlbGV0ZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBidXR0b25EZWxldGUudHlwZSA9IFwiYnV0dG9uXCI7XG4gICAgYnV0dG9uRGVsZXRlLmlubmVySFRNTCA9IFwiRGVsZXRlXCI7XG4gICAgYnV0dG9uRGVsZXRlLnN0eWxlLndpZHRoID0gXCIxMDBweFwiO1xuICAgIGRpdkluZm9DYXJkLmFwcGVuZENoaWxkKGJ1dHRvbkRlbGV0ZSk7XG4gICAgYnV0dG9uRGVsZXRlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLGZ1bmN0aW9uKGUpe1xuICAgICAgLy9UT0RPXG4gICAgICBjYXJkTWFuYWdlci5leGVjdXRlKG5ldyBEZWxldGVDYXJkQ29tbWFuZChjYXJkT2JqZWN0KSk7XG4gICAgICAvL2RlbGV0ZUNhcmQoY2FyZE9iamVjdCk7XG4gICAgfSk7XG4gICAgXG4gICAgYnV0dG9uRGVsZXRlLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJyxmdW5jdGlvbihlKXtcbiAgICAgIGNhcmRNYW5hZ2VyLmV4ZWN1dGUobmV3IERlbGV0ZUNhcmRDb21tYW5kKGNhcmRPYmplY3QpKTtcbiAgICAgIC8vZGVsZXRlQ2FyZCgpO1xuICAgIH0pO1xuICB9XG4gIFxuICBjYXJkT2JqZWN0ID0ge1xuICAgIHdpZHRoOiAgd2lkdGgsXG4gICAgc3RhcnRQIDogc3RhcnRQLFxuICAgIGVuZFAgOiBlbmRQLFxuICAgIGRlc2NyaXB0aW9uIDogdGhpcy5kZXNjcmlwdGlvbixcbiAgICBzcGVlZCA6ICB0aGlzLnNwZWVkLFxuICAgIHJlcGV0aXRpb25OdW1iZXIgOiAgdGhpcy5yZXBldGl0aW9uTnVtYmVyLFxuICAgIGlEaXY6aURpdixcbiAgICBpZDppRGl2LmlkLFxuICAgIHVwZGF0ZUluZm8gOiB1cGRhdGVJbmZvXG4gIH07XG4gIFxuICBcbiAgcmV0dXJuIGNhcmRPYmplY3Q7XG59XG5cblxuXG4iXX0=