'use strict';

var cardFunctionalCore = new CardFunctionalCore();

function Card(startDurationParam, endDurationParam, startPositionParam, endPositionParam, cardInfo) {
  var description = '';

  //Propriété de style
  var width = '6%';
  var height = '6%';
  var deleted = false;
  var iDiv = null;
  var startP = startPositionParam;
  var endP = endPositionParam;
  //Valeur pour jouer la carte
  var speed = 1;
  var repetitionNumber = 1;
  //div used
  var divInfoCard = null;
  //let selectSpeed=null;
  var selectNbRepet = null;
  var selectSpeed = null;

  var imgSlow = null;

  var textSegment = null;
  var imgRepet = null;
  var divSegment = null;
  var startDuration = startDurationParam;
  var endDuration = endDurationParam;
  var left = void 0;


  var buttonDelete = null;

  //cette div est la principale, celle qui contient fragment + bardFragment
  iDiv = document.createElement('div');
  iDiv.id = 'idCard' + createUniqueId();
  iDiv.className = 'segmentWrapper';
  iDiv.style.left = startPositionParam + "px";

  //Div du segment bleu
  divSegment = document.createElement('div');
  divSegment.className = 'segment';

  //taille de la carte initiale
  width = iDiv.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "px";
  divSegment.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "px";

  initGUI();
  initStyle();
  initListener();
  playCard(iDiv, startDurationParam);

  //console.log(cardInfo.deleted);
  function updateInfo() {
    var cardObject = {
      width: width,
      startP: startP,
      endP: endP,
      description: description,
      speed: speed,
      deleted: deleted,
      repetitionNumber: repetitionNumber
    };
    return cardObject;
  }

  function initListener() {
    textSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });
    divSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });

    /*selectSpeed.addEventListener("focus", function(){
      cardFunctionalCore.execute(new LogCardSpeedCommand(cardObject));
    });*/
    selectSpeed.addEventListener("blur", function () {
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      cardFunctionalCore.execute(new CardSpeedCommand(cardObject, speedRate));
    });

    /*selectNbRepet.addEventListener("focus", function(){
      cardFunctionalCore.execute(new LogCardNbRepetCommand(cardObject));
    });*/
    selectNbRepet.addEventListener("blur", function () {
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      console.log("nbrepet in card :" + repetitionNumber);
      cardFunctionalCore.execute(new CardNbRepetCommand(cardObject, repetitionNumber));
    });

    divSegment.addEventListener("mousedown", function () {
      console.log('Click on a card !! ');
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;

      //modifyCardSpeed(cardObject);
      //modifyCardNbRepet(cardObject);
      segmentFeedback.startPostion = iDiv.style.left;
      segmentFeedback.width = width;
      feedbackOnSliderVideo(true);

      //console.log("play back rate : " , startDuration, endDuration, nbRepet, speedRate);
      videoFunctionalCoreManager.execute(new RepetPartOfVideoCommand(startDuration, endDuration, nbRepet, speedRate));
      //repetPartOfVideo(startDuration, endDuration, nbRepet, speedRate);
    }, false);
  }

  function initGUI() {
    textSegment = document.createElement('input');
    textSegment.className = 'textSegment';
    //UI button speed and slow
    imgRepet = document.createElement("img");
    imgRepet.className = 'imgRepet';
    imgSlow = document.createElement("img");
    imgSlow.className = 'imgSlow';

    selectSpeed = document.createElement("select");
    selectSpeed.className = 'selectSpeed';
    selectNbRepet = document.createElement("select");
    selectNbRepet.className = 'selectNbRepet';

    divInfoCard = document.createElement('div');
    divInfoCard.className = "infoCard";

    /*textSegment.addEventListener("focus", function () {
      cardFunctionalCore.execute(new ModifyCardDescriptionCommand(cardObject,textSegment.value));
    });*/
    textSegment.addEventListener("blur", function () {
      cardFunctionalCore.execute(new ModifyCardDescriptionCommand(cardObject, textSegment.value));
    });

    //Peupler les listes déroulantes
    for (var i = 0; i < 20; i += 1) {
      selectSpeed.add(new Option(i / 10 + ""));
    }
    selectSpeed.selectedIndex = 10;
    for (var _i = 0; _i < 20; _i++) {
      selectNbRepet.options.add(new Option(_i + ""));
    }
    selectNbRepet.selectedIndex = 1;

    /*
    selectNbRepet.addEventListener("onchange", function () {
      
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      console.log("selected : " + repetitionNumber);
    });*/

    //Div contenant les info du dessus (taille de div invariable)
    divInfoCard.appendChild(imgSlow);
    divInfoCard.appendChild(selectSpeed);
    divInfoCard.appendChild(imgRepet);
    divInfoCard.appendChild(selectNbRepet);
    divInfoCard.appendChild(textSegment);
    iDiv.appendChild(divSegment);
    iDiv.appendChild(divInfoCard);

    //If the card have been deleted, the color is red, otherwise blue.
    if (cardInfo) {
      if (cardInfo.deleted) {
        divSegment.style.backgroundColor = "red";
      } else {
        divSegment.style.backgroundColor = "#213F8D";
      }
      textSegment.value = cardInfo.description;
      selectNbRepet.selectedIndex = cardInfo.repetitionNumber;
      selectSpeed.selectedIndex = cardInfo.speed * 10;
    }
  }

  function initStyle() {
    textSegment.style.left = divSegment.style.width;
    imgSlow.src = "/media/workshop2/card/slow.png";
    imgRepet.src = "/media/workshop2/card/repet.png";
  }

  var cardObject = {
    width: width,
    startP: startP,
    endP: endP,
    description: description,
    speed: speed,
    repetitionNumber: repetitionNumber,
    iDiv: iDiv,
    id: iDiv.id,
    updateInfo: updateInfo
  };

  function createBtnDelete(e) {
    e.preventDefault();
    //delete apparait
    var buttonDelete = document.createElement('button');
    buttonDelete.id = 'idBtnDelete';
    buttonDelete.style.position = "absolute";
    buttonDelete.type = "button";
    buttonDelete.innerHTML = "Delete";
    buttonDelete.style.width = "100px";
    divInfoCard.appendChild(buttonDelete);
    buttonDelete.addEventListener('mouseup', function (e) {
      //TODO
      cardManager.execute(new DeleteCardCommand(cardObject));
      //deleteCard(cardObject);
    });

    buttonDelete.addEventListener('touchend', function (e) {
      cardManager.execute(new DeleteCardCommand(cardObject));
      //deleteCard();
    });
  }

  return cardObject;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmQuanMiXSwibmFtZXMiOlsiY2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZCIsInN0YXJ0RHVyYXRpb25QYXJhbSIsImVuZER1cmF0aW9uUGFyYW0iLCJzdGFydFBvc2l0aW9uUGFyYW0iLCJlbmRQb3NpdGlvblBhcmFtIiwiY2FyZEluZm8iLCJkZXNjcmlwdGlvbiIsIndpZHRoIiwiaGVpZ2h0IiwiZGVsZXRlZCIsImlEaXYiLCJzdGFydFAiLCJlbmRQIiwic3BlZWQiLCJyZXBldGl0aW9uTnVtYmVyIiwiZGl2SW5mb0NhcmQiLCJzZWxlY3ROYlJlcGV0Iiwic2VsZWN0U3BlZWQiLCJpbWdTbG93IiwidGV4dFNlZ21lbnQiLCJpbWdSZXBldCIsImRpdlNlZ21lbnQiLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJsZWZ0IiwiYnV0dG9uRGVsZXRlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJjcmVhdGVVbmlxdWVJZCIsImNsYXNzTmFtZSIsInN0eWxlIiwicGFyc2VJbnQiLCJpbml0R1VJIiwiaW5pdFN0eWxlIiwiaW5pdExpc3RlbmVyIiwicGxheUNhcmQiLCJ1cGRhdGVJbmZvIiwiY2FyZE9iamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY3JlYXRlQnRuRGVsZXRlIiwic3BlZWRSYXRlIiwib3B0aW9ucyIsInNlbGVjdGVkSW5kZXgiLCJ2YWx1ZSIsImV4ZWN1dGUiLCJDYXJkU3BlZWRDb21tYW5kIiwibmJSZXBldCIsImNvbnNvbGUiLCJsb2ciLCJDYXJkTmJSZXBldENvbW1hbmQiLCJzZWdtZW50RmVlZGJhY2siLCJzdGFydFBvc3Rpb24iLCJmZWVkYmFja09uU2xpZGVyVmlkZW8iLCJ2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlciIsIlJlcGV0UGFydE9mVmlkZW9Db21tYW5kIiwiTW9kaWZ5Q2FyZERlc2NyaXB0aW9uQ29tbWFuZCIsImkiLCJhZGQiLCJPcHRpb24iLCJhcHBlbmRDaGlsZCIsImJhY2tncm91bmRDb2xvciIsInNyYyIsInByZXZlbnREZWZhdWx0IiwicG9zaXRpb24iLCJ0eXBlIiwiaW5uZXJIVE1MIiwiY2FyZE1hbmFnZXIiLCJEZWxldGVDYXJkQ29tbWFuZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxxQkFBcUIsSUFBSUMsa0JBQUosRUFBekI7O0FBRUEsU0FBU0MsSUFBVCxDQUFlQyxrQkFBZixFQUFrQ0MsZ0JBQWxDLEVBQW1EQyxrQkFBbkQsRUFBc0VDLGdCQUF0RSxFQUF3RkMsUUFBeEYsRUFBa0c7QUFDaEcsTUFBSUMsY0FBYyxFQUFsQjs7QUFFQTtBQUNBLE1BQUlDLFFBQVEsSUFBWjtBQUNBLE1BQUlDLFNBQVMsSUFBYjtBQUNBLE1BQUlDLFVBQVUsS0FBZDtBQUNBLE1BQUlDLE9BQU8sSUFBWDtBQUNBLE1BQUlDLFNBQVNSLGtCQUFiO0FBQ0EsTUFBSVMsT0FBT1IsZ0JBQVg7QUFDRjtBQUNFLE1BQUlTLFFBQVEsQ0FBWjtBQUNBLE1BQUlDLG1CQUFtQixDQUF2QjtBQUNGO0FBQ0UsTUFBSUMsY0FBYyxJQUFsQjtBQUNBO0FBQ0EsTUFBSUMsZ0JBQWdCLElBQXBCO0FBQ0EsTUFBSUMsY0FBYyxJQUFsQjs7QUFFQSxNQUFJQyxVQUFVLElBQWQ7O0FBRUEsTUFBSUMsY0FBYyxJQUFsQjtBQUNBLE1BQUlDLFdBQVcsSUFBZjtBQUNBLE1BQUlDLGFBQWEsSUFBakI7QUFDQSxNQUFJQyxnQkFBZ0JyQixrQkFBcEI7QUFDQSxNQUFJc0IsY0FBY3JCLGdCQUFsQjtBQUNBLE1BQUlzQixhQUFKOztBQUVBLE1BQUlDLGVBQWUsSUFBbkI7O0FBRUE7QUFDQWYsU0FBT2dCLFNBQVNDLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBUDtBQUNBakIsT0FBS2tCLEVBQUwsR0FBVSxXQUFXQyxnQkFBckI7QUFDQW5CLE9BQUtvQixTQUFMLEdBQWlCLGdCQUFqQjtBQUNBcEIsT0FBS3FCLEtBQUwsQ0FBV1AsSUFBWCxHQUFrQnJCLHFCQUFxQixJQUF2Qzs7QUFFQTtB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Q0FGLGlCQUFhRyxFQUFiLEdBQWtCLGFBQWxCO0FBQ0FILGlCQUFhTSxLQUFiLENBQW1Ca0MsUUFBbkIsR0FBOEIsVUFBOUI7QUFDQXhDLGlCQUFheUMsSUFBYixHQUFvQixRQUFwQjtBQUNBekMsaUJBQWEwQyxTQUFiLEdBQXlCLFFBQXpCO0FBQ0ExQyxpQkFBYU0sS0FBYixDQUFtQnhCLEtBQW5CLEdBQTJCLE9BQTNCO0FBQ0FRLGdCQUFZOEMsV0FBWixDQUF3QnBDLFlBQXhCO0FBQ0FBLGlCQUFhYyxnQkFBYixDQUE4QixTQUE5QixFQUF3QyxVQUFTQyxDQUFULEVBQVc7QUFDakQ7QUFDQTRCLGtCQUFZdEIsT0FBWixDQUFvQixJQUFJdUIsaUJBQUosQ0FBc0IvQixVQUF0QixDQUFwQjtBQUNBO0FBQ0QsS0FKRDs7QUFNQWIsaUJBQWFjLGdCQUFiLENBQThCLFVBQTlCLEVBQXlDLFVBQVNDLENBQVQsRUFBVztBQUNsRDRCLGtCQUFZdEIsT0FBWixDQUFvQixJQUFJdUIsaUJBQUosQ0FBc0IvQixVQUF0QixDQUFwQjtBQUNBO0FBQ0QsS0FIRDtBQUlEOztBQUtELFNBQU9BLFVBQVA7QUFDRCIsImZpbGUiOiJjYXJkLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNhcmRGdW5jdGlvbmFsQ29yZSA9IG5ldyBDYXJkRnVuY3Rpb25hbENvcmUoKTtcblxuZnVuY3Rpb24gQ2FyZCAoc3RhcnREdXJhdGlvblBhcmFtLGVuZER1cmF0aW9uUGFyYW0sc3RhcnRQb3NpdGlvblBhcmFtLGVuZFBvc2l0aW9uUGFyYW0sIGNhcmRJbmZvKSB7XG4gIHZhciBkZXNjcmlwdGlvbiA9ICcnO1xuICBcbiAgLy9Qcm9wcmnDqXTDqSBkZSBzdHlsZVxuICBsZXQgd2lkdGggPSAnNiUnO1xuICBsZXQgaGVpZ2h0ID0gJzYlJztcbiAgdmFyIGRlbGV0ZWQgPSBmYWxzZTtcbiAgdmFyIGlEaXYgPSBudWxsO1xuICB2YXIgc3RhcnRQID0gc3RhcnRQb3NpdGlvblBhcmFtO1xuICB2YXIgZW5kUCA9IGVuZFBvc2l0aW9uUGFyYW07XG4vL1ZhbGV1ciBwb3VyIGpvdWVyIGxhIGNhcnRlXG4gIGxldCBzcGVlZCA9IDE7XG4gIGxldCByZXBldGl0aW9uTnVtYmVyID0gMTtcbi8vZGl2IHVzZWRcbiAgbGV0IGRpdkluZm9DYXJkID0gbnVsbDtcbiAgLy9sZXQgc2VsZWN0U3BlZWQ9bnVsbDtcbiAgbGV0IHNlbGVjdE5iUmVwZXQgPSBudWxsO1xuICBsZXQgc2VsZWN0U3BlZWQgPSBudWxsO1xuICBcbiAgbGV0IGltZ1Nsb3cgPSBudWxsO1xuICBcbiAgbGV0IHRleHRTZWdtZW50ID0gbnVsbDtcbiAgbGV0IGltZ1JlcGV0ID0gbnVsbDtcbiAgbGV0IGRpdlNlZ21lbnQgPSBudWxsO1xuICBsZXQgc3RhcnREdXJhdGlvbiA9IHN0YXJ0RHVyYXRpb25QYXJhbTtcbiAgbGV0IGVuZER1cmF0aW9uID0gZW5kRHVyYXRpb25QYXJhbTtcbiAgbGV0IGxlZnQgO1xuICBcbiAgdmFyIGJ1dHRvbkRlbGV0ZSA9IG51bGw7XG4gIFxuICAvL2NldHRlIGRpdiBlc3QgbGEgcHJpbmNpcGFsZSwgY2VsbGUgcXVpIGNvbnRpZW50IGZyYWdtZW50ICsgYmFyZEZyYWdtZW50XG4gIGlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgaURpdi5pZCA9ICdpZENhcmQnICsgY3JlYXRlVW5pcXVlSWQoKTtcbiAgaURpdi5jbGFzc05hbWUgPSAnc2VnbWVudFdyYXBwZXInO1xuICBpRGl2LnN0eWxlLmxlZnQgPSBzdGFydFBvc2l0aW9uUGFyYW0gKyBcInB4XCI7XG4gIFxuICAvL0RpdiBkdSBzZWdtZW50IGJsZXVcbiAgZGl2U2VnbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXZTZWdtZW50LmNsYXNzTmFtZSA9ICdzZWdtZW50JztcbiAgXG4gIC8vdGFpbGxlIGRlIGxhIGNhcnRlIGluaXRpYWxlXG4gIHdpZHRoID0gaURpdi5zdHlsZS53aWR0aCA9IHBhcnNlSW50KGVuZFBvc2l0aW9uUGFyYW0sIDEwKSAtIHBhcnNlSW50KHN0YXJ0UG9zaXRpb25QYXJhbSwgMTApICsgXCJweFwiO1xuICBkaXZTZWdtZW50LnN0eWxlLndpZHRoID0gcGFyc2VJbnQoZW5kUG9zaXRpb25QYXJhbSwgMTApIC0gcGFyc2VJbnQoc3RhcnRQb3NpdGlvblBhcmFtLCAxMCkgKyBcInB4XCI7XG4gIFxuICBpbml0R1VJKCk7XG4gIGluaXRTdHlsZSgpO1xuICBpbml0TGlzdGVuZXIoKTtcbiAgcGxheUNhcmQoaURpdiwgc3RhcnREdXJhdGlvblBhcmFtKTtcbiAgXG4gIC8vY29uc29sZS5sb2coY2FyZEluZm8uZGVsZXRlZCk7XG4gIGZ1bmN0aW9uIHVwZGF0ZUluZm8oKXtcbiAgICB2YXIgY2FyZE9iamVjdCA9IHtcbiAgICAgIHdpZHRoOiAgd2lkdGgsXG4gICAgICBzdGFydFAgOiBzdGFydFAsXG4gICAgICBlbmRQIDogZW5kUCxcbiAgICAgIGRlc2NyaXB0aW9uIDogZGVzY3JpcHRpb24sXG4gICAgICBzcGVlZCA6IHNwZWVkLFxuICAgICAgZGVsZXRlZDpkZWxldGVkLFxuICAgICAgcmVwZXRpdGlvbk51bWJlciA6IHJlcGV0aXRpb25OdW1iZXJcbiAgICB9O1xuICAgIHJldHVybiBjYXJkT2JqZWN0O1xuICB9XG4gIFxuICBcbiAgZnVuY3Rpb24gaW5pdExpc3RlbmVyKCkge1xuICAgIHRleHRTZWdtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2xvbmctcHJlc3MnLCBmdW5jdGlvbihlKXtcbiAgICAgIGNyZWF0ZUJ0bkRlbGV0ZShlKTtcbiAgICB9KTtcbiAgICBkaXZTZWdtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2xvbmctcHJlc3MnLCBmdW5jdGlvbihlKXtcbiAgICAgIGNyZWF0ZUJ0bkRlbGV0ZShlKTtcbiAgICB9KTtcbiAgIFxuICAgIFxuICAgIC8qc2VsZWN0U3BlZWQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIGZ1bmN0aW9uKCl7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgTG9nQ2FyZFNwZWVkQ29tbWFuZChjYXJkT2JqZWN0KSk7XG4gICAgfSk7Ki9cbiAgICBzZWxlY3RTcGVlZC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbigpe1xuICAgICAgbGV0IHNwZWVkUmF0ZSA9IHNlbGVjdFNwZWVkLm9wdGlvbnNbc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgQ2FyZFNwZWVkQ29tbWFuZChjYXJkT2JqZWN0LHNwZWVkUmF0ZSkpO1xuICAgIH0pO1xuICAgIFxuICAgIC8qc2VsZWN0TmJSZXBldC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGNhcmRGdW5jdGlvbmFsQ29yZS5leGVjdXRlKG5ldyBMb2dDYXJkTmJSZXBldENvbW1hbmQoY2FyZE9iamVjdCkpO1xuICAgIH0pOyovXG4gICAgc2VsZWN0TmJSZXBldC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbigpe1xuICAgICAgbGV0IG5iUmVwZXQgPSBzZWxlY3ROYlJlcGV0Lm9wdGlvbnNbc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIGNvbnNvbGUubG9nKFwibmJyZXBldCBpbiBjYXJkIDpcIiArICBuYlJlcGV0KTtcbiAgICAgIGNhcmRGdW5jdGlvbmFsQ29yZS5leGVjdXRlKG5ldyBDYXJkTmJSZXBldENvbW1hbmQoY2FyZE9iamVjdCwgbmJSZXBldCkpO1xuICAgIH0pO1xuICAgIFxuICAgIFxuICAgIFxuICAgIGRpdlNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZygnQ2xpY2sgb24gYSBjYXJkICEhICcpO1xuICAgICAgbGV0IG5iUmVwZXQgPSBzZWxlY3ROYlJlcGV0Lm9wdGlvbnNbc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIGxldCBzcGVlZFJhdGUgPSBzZWxlY3RTcGVlZC5vcHRpb25zW3NlbGVjdFNwZWVkLnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICBcbiAgICAgIC8vbW9kaWZ5Q2FyZFNwZWVkKGNhcmRPYmplY3QpO1xuICAgICAgLy9tb2RpZnlDYXJkTmJSZXBldChjYXJkT2JqZWN0KTtcbiAgICAgIHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb24gPSBpRGl2LnN0eWxlLmxlZnQgIDtcbiAgICAgIHNlZ21lbnRGZWVkYmFjay53aWR0aCA9IHdpZHRoO1xuICAgICAgZmVlZGJhY2tPblNsaWRlclZpZGVvKHRydWUpO1xuICBcbiAgICAgIC8vY29uc29sZS5sb2coXCJwbGF5IGJhY2sgcmF0ZSA6IFwiICwgc3RhcnREdXJhdGlvbiwgZW5kRHVyYXRpb24sIG5iUmVwZXQsIHNwZWVkUmF0ZSk7XG4gICAgICB2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBSZXBldFBhcnRPZlZpZGVvQ29tbWFuZChzdGFydER1cmF0aW9uLCBlbmREdXJhdGlvbiwgbmJSZXBldCwgc3BlZWRSYXRlKSk7XG4gICAgICAvL3JlcGV0UGFydE9mVmlkZW8oc3RhcnREdXJhdGlvbiwgZW5kRHVyYXRpb24sIG5iUmVwZXQsIHNwZWVkUmF0ZSk7XG4gICAgfSwgZmFsc2UpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBpbml0R1VJKCkge1xuICAgIHRleHRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0U2VnbWVudC5jbGFzc05hbWUgPSAndGV4dFNlZ21lbnQnO1xuICAgIC8vVUkgYnV0dG9uIHNwZWVkIGFuZCBzbG93XG4gICAgaW1nUmVwZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgIGltZ1JlcGV0LmNsYXNzTmFtZT0naW1nUmVwZXQnO1xuICAgIGltZ1Nsb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgIGltZ1Nsb3cuY2xhc3NOYW1lPSdpbWdTbG93JztcbiAgICBcbiAgICBzZWxlY3RTcGVlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgc2VsZWN0U3BlZWQuY2xhc3NOYW1lID0nc2VsZWN0U3BlZWQnIDtcbiAgICBzZWxlY3ROYlJlcGV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtcbiAgICBzZWxlY3ROYlJlcGV0LmNsYXNzTmFtZSA9J3NlbGVjdE5iUmVwZXQnIDtcbiAgICBcbiAgICBkaXZJbmZvQ2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkluZm9DYXJkLmNsYXNzTmFtZSA9IFwiaW5mb0NhcmRcIjtcbiAgICBcbiAgICAvKnRleHRTZWdtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgTW9kaWZ5Q2FyZERlc2NyaXB0aW9uQ29tbWFuZChjYXJkT2JqZWN0LHRleHRTZWdtZW50LnZhbHVlKSk7XG4gICAgfSk7Ki9cbiAgICB0ZXh0U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgTW9kaWZ5Q2FyZERlc2NyaXB0aW9uQ29tbWFuZChjYXJkT2JqZWN0LHRleHRTZWdtZW50LnZhbHVlKSk7XG4gICAgfSk7XG4gICAgXG4gICAgICAvL1BldXBsZXIgbGVzIGxpc3RlcyBkw6lyb3VsYW50ZXNcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpICs9IDEpIHtcbiAgICAgIHNlbGVjdFNwZWVkLmFkZChuZXcgT3B0aW9uKGkgLyAxMCArIFwiXCIpKTtcbiAgICB9XG4gICAgc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleCA9IDEwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgc2VsZWN0TmJSZXBldC5vcHRpb25zLmFkZChuZXcgT3B0aW9uKGkgKyBcIlwiKSk7XG4gICAgfVxuICAgIHNlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleCA9IDE7XG4gICAgXG4gICAgLypcbiAgICBzZWxlY3ROYlJlcGV0LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBcbiAgICAgIHJlcGV0aXRpb25OdW1iZXIgPSBzZWxlY3ROYlJlcGV0Lm9wdGlvbnNbc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIGNvbnNvbGUubG9nKFwic2VsZWN0ZWQgOiBcIiArIHJlcGV0aXRpb25OdW1iZXIpO1xuICAgIH0pOyovXG4gICAgXG4gICAgLy9EaXYgY29udGVuYW50IGxlcyBpbmZvIGR1IGRlc3N1cyAodGFpbGxlIGRlIGRpdiBpbnZhcmlhYmxlKVxuICAgIGRpdkluZm9DYXJkLmFwcGVuZENoaWxkKGltZ1Nsb3cpO1xuICAgIGRpdkluZm9DYXJkLmFwcGVuZENoaWxkKHNlbGVjdFNwZWVkKTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChpbWdSZXBldCk7XG4gICAgZGl2SW5mb0NhcmQuYXBwZW5kQ2hpbGQoc2VsZWN0TmJSZXBldCk7XG4gICAgZGl2SW5mb0NhcmQuYXBwZW5kQ2hpbGQodGV4dFNlZ21lbnQpO1xuICAgIGlEaXYuYXBwZW5kQ2hpbGQoZGl2U2VnbWVudCk7XG4gICAgaURpdi5hcHBlbmRDaGlsZChkaXZJbmZvQ2FyZCk7XG4gICAgXG4gICAgLy9JZiB0aGUgY2FyZCBoYXZlIGJlZW4gZGVsZXRlZCwgdGhlIGNvbG9yIGlzIHJlZCwgb3RoZXJ3aXNlIGJsdWUuXG4gICAgaWYgKGNhcmRJbmZvKSB7XG4gICAgICBpZihjYXJkSW5mby5kZWxldGVkKXtcbiAgICAgICAgZGl2U2VnbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGl2U2VnbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMyMTNGOERcIjtcbiAgICAgIH1cbiAgICAgIHRleHRTZWdtZW50LnZhbHVlID0gY2FyZEluZm8uZGVzY3JpcHRpb247XG4gICAgICBzZWxlY3ROYlJlcGV0LnNlbGVjdGVkSW5kZXggPSBjYXJkSW5mby5yZXBldGl0aW9uTnVtYmVyO1xuICAgICAgc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleCA9IGNhcmRJbmZvLnNwZWVkKjEwO1xuICAgIH1cbiAgfVxuICBcbiAgZnVuY3Rpb24gaW5pdFN0eWxlKCkge1xuICAgIHRleHRTZWdtZW50LnN0eWxlLmxlZnQgPSBkaXZTZWdtZW50LnN0eWxlLndpZHRoO1xuICAgIGltZ1Nsb3cuc3JjID0gXCIvbWVkaWEvd29ya3Nob3AyL2NhcmQvc2xvdy5wbmdcIjtcbiAgICBpbWdSZXBldC5zcmMgPSBcIi9tZWRpYS93b3Jrc2hvcDIvY2FyZC9yZXBldC5wbmdcIjtcbiAgfVxuICBcbiAgdmFyIGNhcmRPYmplY3QgPSB7XG4gICAgd2lkdGg6ICB3aWR0aCxcbiAgICBzdGFydFAgOiBzdGFydFAsXG4gICAgZW5kUCA6IGVuZFAsXG4gICAgZGVzY3JpcHRpb24gOiBkZXNjcmlwdGlvbixcbiAgICBzcGVlZCA6IHNwZWVkLFxuICAgIHJlcGV0aXRpb25OdW1iZXIgOiByZXBldGl0aW9uTnVtYmVyLFxuICAgIGlEaXY6aURpdixcbiAgICBpZDppRGl2LmlkLFxuICAgIHVwZGF0ZUluZm8gOiB1cGRhdGVJbmZvXG4gIH07XG4gIFxuICBcbiAgZnVuY3Rpb24gY3JlYXRlQnRuRGVsZXRlKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvL2RlbGV0ZSBhcHBhcmFpdFxuICAgIHZhciBidXR0b25EZWxldGUgPSAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgYnV0dG9uRGVsZXRlLmlkID0gJ2lkQnRuRGVsZXRlJztcbiAgICBidXR0b25EZWxldGUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgYnV0dG9uRGVsZXRlLnR5cGUgPSBcImJ1dHRvblwiO1xuICAgIGJ1dHRvbkRlbGV0ZS5pbm5lckhUTUwgPSBcIkRlbGV0ZVwiO1xuICAgIGJ1dHRvbkRlbGV0ZS5zdHlsZS53aWR0aCA9IFwiMTAwcHhcIjtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChidXR0b25EZWxldGUpO1xuICAgIGJ1dHRvbkRlbGV0ZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJyxmdW5jdGlvbihlKXtcbiAgICAgIC8vVE9ET1xuICAgICAgY2FyZE1hbmFnZXIuZXhlY3V0ZShuZXcgRGVsZXRlQ2FyZENvbW1hbmQoY2FyZE9iamVjdCkpO1xuICAgICAgLy9kZWxldGVDYXJkKGNhcmRPYmplY3QpO1xuICAgIH0pO1xuICAgIFxuICAgIGJ1dHRvbkRlbGV0ZS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsZnVuY3Rpb24oZSl7XG4gICAgICBjYXJkTWFuYWdlci5leGVjdXRlKG5ldyBEZWxldGVDYXJkQ29tbWFuZChjYXJkT2JqZWN0KSk7XG4gICAgICAvL2RlbGV0ZUNhcmQoKTtcbiAgICB9KTtcbiAgfVxuICBcbiAgXG4gIFxuICBcbiAgcmV0dXJuIGNhcmRPYmplY3Q7XG59XG5cblxuXG4iXX0=