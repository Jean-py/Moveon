'use strict';

var cardFunctionalCore = new CardFunctionalCore();

function Card(startDurationParam, endDurationParam, startPositionParam, endPositionParam, cardInfo) {
  var description = '';

  var listCardConnected = [];

  console.log("startDurationParam,endDurationParam", startDurationParam, endDurationParam);

  //Propriété de style
  var width = '6%';
  var height = '6%';
  var deleted = false;
  var iDiv = null;
  var startP = startPositionParam;
  var endP = endPositionParam;
  //Valeur pour jouer la carte
  var speed = 1;
  var repetitionNumber = 1;
  //div used
  var divInfoCard = null;
  //let selectSpeed=null;
  var selectNbRepet = null;
  var selectSpeed = null;

  var imgSlow = null;

  var textSegment = null;
  var textStartSegment = null;
  var textEndSegment = null;
  var btnDelete = null;
  var btnMinus = null;
  var divWrapperBtn = null;

  var imgRepet = null;
  var divSegment = null;
  var startDuration = startDurationParam;
  var endDuration = endDurationParam;
  var left = void 0;

  var buttonDelete = null;
  var cardObject;

  //cette div est la principale, celle qui contient fragment + bardFragment
  iDiv = document.createElement('div');
  iDiv.id = 'idCard' + createUniqueId();
  iDiv.className = 'segmentWrapper';
  iDiv.style.left = startPositionParam;

  //Color picker
  /* var arrowDown = document.createElement('input');
   arrowDown.type = 'jscolor';
   arrowDown.className = 'jscolor';
   arrowDown.value = '#8DFFFF';
   //jscolor.installByClassName("jscolor");
   
   
    arrowDown.border = 'none';
    arrowDown.outline = 'none';
    arrowDown.style.backgroundColor = 'black';
    arrowDown.style.webkitAppearance = 'listitem';
    arrowDown.value = "#41568d";*/

  //arrowDown.value = "FF9900";
  //arrowDown.mode = 'HS';
  //arrowDown.position = 'right' ;
  /* arrowDown.value ="#102b9f";
   arrowDown.style.outline="none";*/

  //Div du segment bleu
  divSegment = document.createElement('div');
  divSegment.className = 'segment';

  //taille de la carte initiale
  //width = iDiv.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "%";
  divSegment.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "%";
  width = divSegment.style.width;
  console.log(divSegment.style.width);

  initGUI();
  initListener();
  playCard(iDiv, startDurationParam);

  function watchColorPicker(event) {
    divSegment.style.backgroundColor = event.target.value;
  }
  //console.log(cardInfo.deleted);
  function updateInfo() {
    cardObject.width = width;
    cardObject.startP = startP;
    cardObject.endP = endP;
    cardObject.startDuration = startDuration;
    cardObject.endDuration = endDuration;

    cardObject.description = description;
    cardObject.speed = speed;
    cardObject.deleted = deleted;
    cardObject.repetitionNumber = repetitionNumber;
    cardObject.iDiv = iDiv;
    cardObject.id = iDiv.id;
    return cardObject;
  }

  function displayDivInfoCard() {
    if ($(divInfoCard).hasClass('hidden')) {
      btnMinus.innerHTML = '-';
      $(divInfoCard).removeClass('hidden');
      setTimeout(function () {
        $(divInfoCard).removeClass('visuallyhidden');
        divInfoCard.style.display = 'block';
        iDiv.style.height = "auto";
      }, 20);
    } else {
      btnMinus.innerHTML = '+';
      $(divInfoCard).addClass('visuallyhidden');
      $(divInfoCard).one('transitionend', function (e) {
        $(divInfoCard).addClass('hidden');
        divInfoCard.style.display = 'none';
        iDiv.style.height = " 20px";
      });
    }

    /*  console.log("click btn minus");
      if(btnMinus.innerText === '-'){
        divInfoCard.style.display = "none";
        btnMinus.innerHTML = '+'
      } else {
        divInfoCard.style.display = "block";
        btnMinus.innerHTML = '-';
       
      }*/
  }
  function removeTheCard() {
    if (confirm(" /!\\ Voulez-vous vraiment supprimer ce segment?")) {
      // Code à éxécuter si le l'utilisateur clique sur "OK"
      //I have a circular error here, that break the log system... I can't find it
      //So I do not log this command for now
      cardManager.execute(new DeleteCardCommand(cardObject));
      //cardManager.execute(new DeleteCardCommand(cardObject));
    }
  }

  function initListener() {

    textSegment.addEventListener("blur", function () {
      description = textSegment.value;
      cardFunctionalCore.execute(new ModifyCardDescriptionCommand(cardObject, textSegment.value));
    });

    for (var i = 0; i < 20; i += 1) {
      selectSpeed.add(new Option(i / 10 + ""));
    }
    selectSpeed.selectedIndex = 10;
    for (var _i = 0; _i < 20; _i++) {
      selectNbRepet.options.add(new Option(_i + ""));
    }

    //delete apparait
    btnDelete.addEventListener('mouseup', function () {
      removeTheCard();
    });

    btnDelete.addEventListener('touchend', function () {
      removeTheCard();
    });

    btnMinus.addEventListener('mouseup', function () {
      displayDivInfoCard();
    });
    btnMinus.addEventListener('touchend', function () {
      displayDivInfoCard();
    });

    selectSpeed.addEventListener("blur", function () {
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      speed = speedRate;
      cardFunctionalCore.execute(new CardSpeedCommand(cardObject, speedRate));
    });
    selectNbRepet.addEventListener("blur", function () {
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      console.log("nbrepet in card :" + repetitionNumber);
      cardFunctionalCore.execute(new CardNbRepetCommand(cardObject, repetitionNumber));
      //cardFunctionalCore.execute(new CardNbRepetCommand(cardObject, 100));
    });
    divSegment.addEventListener("mousedown", function () {
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      speed = speedRate;
      //segmentFeedback.startPostion = iDiv.style.left  ;
      //segmentFeedback.width = width;
      description = textSegment.value;

      //var audio = new Audio();
      //var buffered = audio.buffered;
      // returns time in seconds of the last buffered TimeRange
      //audio.setAttribute("src","public/sounds/preparation/preparation.mp3");
      //audio.play();
      videoFunctionalCoreManager.execute(new RepetPartOfVideoCommand(startDuration, endDuration, 100, speedRate));
      //updateSegmentFeedback(true,startP,endP);


      $(function () {
        $(".segmentWrapper").draggable({
          axis: "y",
          snapTolerance: 20,
          snapMode: "inner",
          activeClass: "ui-state-highlight",
          containment: '#wrapperCommandAndRangeCardBoard',
          snap: true

        });
      });

      $(".segmentWrapper").droppable({
        classes: {
          "ui-droppable": "highlight"
        },
        snap: true,

        drop: function drop(event, ui) {
          console.log("dropped");
          console.log(this);
          //TODO faire la fonction de drag avec une liste de carte connecté ou une liste chainé de cartes?
          $(this).css("background-color", "var(--main-color)");
        }
      });
    }, false);
    //TODO widget color picker
    //arrowDown.addEventListener("change", watchColorPicker, false);
  }
  function initGUI() {

    textSegment = document.createElement('input');
    textSegment.className = 'textSegment';
    //UI button speed and slow
    imgRepet = document.createElement("img");
    imgRepet.className = 'imgRepet';
    imgSlow = document.createElement("img");

    imgSlow.className = 'imgSlow';
    selectSpeed = document.createElement("select");
    selectSpeed.className = 'selectSpeed';
    selectNbRepet = document.createElement("select");
    selectNbRepet.selectedIndex = 1;

    selectNbRepet.className = 'selectNbRepet';
    divInfoCard = document.createElement('div');
    divInfoCard.className = "infoCard";

    /*
    Wrapper that contain the btutton (minus) - and x (delete)
     */
    divWrapperBtn = document.createElement('div');
    divWrapperBtn.className = 'divWrapperBtn';

    btnDelete = document.createElement('p');
    btnDelete.className = 'span';
    btnDelete.classList.add('btnDeleteCard');
    btnDelete.innerHTML = "x";

    btnMinus = document.createElement('p');
    btnMinus.className = 'span';
    btnMinus.classList.add('btnMinusCard');
    btnMinus.innerHTML = "-";
    divWrapperBtn.appendChild(btnMinus);
    divWrapperBtn.appendChild(btnDelete);

    /*
    Creation des étapes pour facilement changer la taille des segments
    
      textStartSegment = document.createElement('input');
      textStartSegment.className = '';
      textEndSegment = document.createElement('input');
      textEndSegment.className = '';
      divInfoCard.appendChild(textStartSegment);
      divInfoCard.appendChild(textEndSegment);
    */

    //Div contenant les info du dessus (taille de div invariable)
    divInfoCard.appendChild(imgSlow);
    divInfoCard.appendChild(selectSpeed);
    //divInfoCard.appendChild(imgRepet);
    //divInfoCard.appendChild(selectNbRepet);
    divInfoCard.appendChild(textSegment);
    //divInfoCard.appendChild(arrowDown);
    iDiv.appendChild(divSegment);
    iDiv.appendChild(divWrapperBtn);
    iDiv.appendChild(divInfoCard);

    //If the card have been deleted, the color is red, otherwise fourth-color (define in style.css).
    if (cardInfo) {
      if (cardInfo.deleted) {
        divSegment.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--unsucess-color');
      } else {
        divSegment.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--fourth-color');
      }
      textSegment.value = cardInfo.description;
      selectNbRepet.selectedIndex = cardInfo.repetitionNumber;
      selectSpeed.selectedIndex = cardInfo.speed * 10;
    }
  }

  cardObject = {
    width: width,
    startP: startP,
    endP: endP,
    startDuration: startDuration,
    endDuration: endDuration,
    deleted: deleted,
    description: this.description,
    speed: this.speed,
    repetitionNumber: this.repetitionNumber,
    iDiv: iDiv,
    id: iDiv.id,
    updateInfo: updateInfo
  };

  return cardObject;
}

/* Permet de drag la video et le SH en entier
$( function() {
  $( ".wrapperCommandAndRange" ).draggable({
    axis: "y",
    drop: function( event, ui ) {
      console.log("drag");
    }
  });
} );*/

/*
$( ".wrapperCommandAndRange" ).droppable({
  drop: function( event, ui ) {
    $( this )
      .addClass( "ui-state-highlight" )
      .find( "p" )
      .html( "Dropped!" );
    console.log("dropped");
  
  
  }
});*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmQuanMiXSwibmFtZXMiOlsiY2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZEZ1bmN0aW9uYWxDb3JlIiwiQ2FyZCIsInN0YXJ0RHVyYXRpb25QYXJhbSIsImVuZER1cmF0aW9uUGFyYW0iLCJzdGFydFBvc2l0aW9uUGFyYW0iLCJlbmRQb3NpdGlvblBhcmFtIiwiY2FyZEluZm8iLCJkZXNjcmlwdGlvbiIsImxpc3RDYXJkQ29ubmVjdGVkIiwiY29uc29sZSIsImxvZyIsIndpZHRoIiwiaGVpZ2h0IiwiZGVsZXRlZCIsImlEaXYiLCJzdGFydFAiLCJlbmRQIiwic3BlZWQiLCJyZXBldGl0aW9uTnVtYmVyIiwiZGl2SW5mb0NhcmQiLCJzZWxlY3ROYlJlcGV0Iiwic2VsZWN0U3BlZWQiLCJpbWdTbG93IiwidGV4dFNlZ21lbnQiLCJ0ZXh0U3RhcnRTZWdtZW50IiwidGV4dEVuZFNlZ21lbnQiLCJidG5EZWxldGUiLCJidG5NaW51cyIsImRpdldyYXBwZXJCdG4iLCJpbWdSZXBldCIsImRpdlNlZ21lbnQiLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJsZWZ0IiwiYnV0dG9uRGVsZXRlIiwiY2FyZE9iamVjdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlkIiwiY3JlYXRlVW5pcXVlSWQiLCJjbGFzc05hbWUiLCJzdHlsZSIsInBhcnNlSW50IiwiaW5pdEdVSSIsImluaXRMaXN0ZW5lciIsInBsYXlDYXJkIiwid2F0Y2hDb2xvclBpY2tlciIsImV2ZW50IiwiYmFja2dyb3VuZENvbG9yIiwidGFyZ2V0IiwidmFsdWUiLCJ1cGRhdGVJbmZvIiwiZGlzcGxheURpdkluZm9DYXJkIiwiJCIsImhhc0NsYXNzIiwiaW5uZXJIVE1MIiwicmVtb3ZlQ2xhc3MiLCJzZXRUaW1lb3V0IiwiZGlzcGxheSIsImFkZENsYXNzIiwib25lIiwiZSIsInJlbW92ZVRoZUNhcmQiLCJjb25maXJtIiwiY2FyZE1hbmFnZXIiLCJleGVjdXRlIiwiRGVsZXRlQ2FyZENvbW1hbmQiLCJhZGRFdmVudExpc3RlbmVyIiwiTW9kaWZ5Q2FyZERlc2NyaXB0aW9uQ29tbWFuZCIsImkiLCJhZGQiLCJPcHRpb24iLCJzZWxlY3RlZEluZGV4Iiwib3B0aW9ucyIsInNwZWVkUmF0ZSIsIkNhcmRTcGVlZENvbW1hbmQiLCJDYXJkTmJSZXBldENvbW1hbmQiLCJ2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlciIsIlJlcGV0UGFydE9mVmlkZW9Db21tYW5kIiwiZHJhZ2dhYmxlIiwiYXhpcyIsInNuYXBUb2xlcmFuY2UiLCJzbmFwTW9kZSIsImFjdGl2ZUNsYXNzIiwiY29udGFpbm1lbnQiLCJzbmFwIiwiZHJvcHBhYmxlIiwiY2xhc3NlcyIsImRyb3AiLCJ1aSIsImNzcyIsImNsYXNzTGlzdCIsImFwcGVuZENoaWxkIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImRvY3VtZW50RWxlbWVudCIsImdldFByb3BlcnR5VmFsdWUiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEscUJBQXFCLElBQUlDLGtCQUFKLEVBQXpCOztBQUVBLFNBQVNDLElBQVQsQ0FBZUMsa0JBQWYsRUFBa0NDLGdCQUFsQyxFQUFtREMsa0JBQW5ELEVBQXNFQyxnQkFBdEUsRUFBd0ZDLFFBQXhGLEVBQWtHO0FBQ2hHLE1BQUlDLGNBQWMsRUFBbEI7O0FBRUEsTUFBSUMsb0JBQW9CLEVBQXhCOztBQUVBQyxVQUFRQyxHQUFSLENBQVkscUNBQVosRUFBbURSLGtCQUFuRCxFQUFzRUMsZ0JBQXRFOztBQUVBO0FBQ0EsTUFBSVEsUUFBUSxJQUFaO0FBQ0EsTUFBSUMsU0FBUyxJQUFiO0FBQ0EsTUFBSUMsVUFBVSxLQUFkO0FBQ0EsTUFBSUMsT0FBTyxJQUFYO0FBQ0EsTUFBSUMsU0FBU1gsa0JBQWI7QUFDQSxNQUFJWSxPQUFPWCxnQkFBWDtBQUNGO0FBQ0UsTUFBSVksUUFBUSxDQUFaO0FBQ0EsTUFBSUMsbUJBQW1CLENBQXZCO0FBQ0Y7QUFDRSxNQUFJQyxjQUFjLElBQWxCO0FBQ0E7QUFDQSxNQUFJQyxnQkFBZ0IsSUFB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Q0FBaUJ6RSxXQUFqQjs7QUFFQTtBQUNBLFFBQUliLFFBQUosRUFBYztBQUNaLFVBQUdBLFNBQVNPLE9BQVosRUFBb0I7QUFDbEJpQixtQkFBV1csS0FBWCxDQUFpQk8sZUFBakIsR0FBbUM2QyxpQkFBaUJ6RCxTQUFTMEQsZUFBMUIsRUFBMkNDLGdCQUEzQyxDQUE0RCxrQkFBNUQsQ0FBbkM7QUFDRCxPQUZELE1BRU87QUFDTGpFLG1CQUFXVyxLQUFYLENBQWlCTyxlQUFqQixHQUFtQzZDLGlCQUFpQnpELFNBQVMwRCxlQUExQixFQUEyQ0MsZ0JBQTNDLENBQTRELGdCQUE1RCxDQUFuQztBQUNEO0FBQ0R4RSxrQkFBWTJCLEtBQVosR0FBb0I1QyxTQUFTQyxXQUE3QjtBQUNBYSxvQkFBY29ELGFBQWQsR0FBOEJsRSxTQUFTWSxnQkFBdkM7QUFDQUcsa0JBQVltRCxhQUFaLEdBQTRCbEUsU0FBU1csS0FBVCxHQUFlLEVBQTNDO0FBQ0Q7QUFDRjs7QUFLRGtCLGVBQWE7QUFDWHhCLFdBQVFBLEtBREc7QUFFWEksWUFBU0EsTUFGRTtBQUdYQyxVQUFPQSxJQUhJO0FBSVhlLG1CQUFnQkEsYUFKTDtBQUtYQyxpQkFBY0EsV0FMSDtBQU1YbkIsYUFBUUEsT0FORztBQU9YTixpQkFBYyxLQUFLQSxXQVBSO0FBUVhVLFdBQVMsS0FBS0EsS0FSSDtBQVNYQyxzQkFBb0IsS0FBS0EsZ0JBVGQ7QUFVWEosVUFBS0EsSUFWTTtBQVdYd0IsUUFBR3hCLEtBQUt3QixFQVhHO0FBWVhhLGdCQUFhQTtBQVpGLEdBQWI7O0FBa0JBLFNBQU9oQixVQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7Ozs7QUFVQSIsImZpbGUiOiJjYXJkLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNhcmRGdW5jdGlvbmFsQ29yZSA9IG5ldyBDYXJkRnVuY3Rpb25hbENvcmUoKTtcblxuZnVuY3Rpb24gQ2FyZCAoc3RhcnREdXJhdGlvblBhcmFtLGVuZER1cmF0aW9uUGFyYW0sc3RhcnRQb3NpdGlvblBhcmFtLGVuZFBvc2l0aW9uUGFyYW0sIGNhcmRJbmZvKSB7XG4gIHZhciBkZXNjcmlwdGlvbiA9ICcnO1xuICBcbiAgdmFyIGxpc3RDYXJkQ29ubmVjdGVkID0gW107XG4gIFxuICBjb25zb2xlLmxvZyhcInN0YXJ0RHVyYXRpb25QYXJhbSxlbmREdXJhdGlvblBhcmFtXCIsIHN0YXJ0RHVyYXRpb25QYXJhbSxlbmREdXJhdGlvblBhcmFtKTtcbiAgXG4gIC8vUHJvcHJpw6l0w6kgZGUgc3R5bGVcbiAgbGV0IHdpZHRoID0gJzYlJztcbiAgbGV0IGhlaWdodCA9ICc2JSc7XG4gIHZhciBkZWxldGVkID0gZmFsc2U7XG4gIHZhciBpRGl2ID0gbnVsbDtcbiAgdmFyIHN0YXJ0UCA9IHN0YXJ0UG9zaXRpb25QYXJhbTtcbiAgdmFyIGVuZFAgPSBlbmRQb3NpdGlvblBhcmFtO1xuLy9WYWxldXIgcG91ciBqb3VlciBsYSBjYXJ0ZVxuICB2YXIgc3BlZWQgPSAxO1xuICB2YXIgcmVwZXRpdGlvbk51bWJlciA9IDE7XG4vL2RpdiB1c2VkXG4gIGxldCBkaXZJbmZvQ2FyZCA9IG51bGw7XG4gIC8vbGV0IHNlbGVjdFNwZWVkPW51bGw7XG4gIGxldCBzZWxlY3ROYlJlcGV0ID0gbnVsbDtcbiAgbGV0IHNlbGVjdFNwZWVkID0gbnVsbDtcbiAgXG4gIGxldCBpbWdTbG93ID0gbnVsbDtcbiAgXG4gIFxuICBcbiAgdmFyIHRleHRTZWdtZW50ID0gbnVsbDtcbiAgdmFyIHRleHRTdGFydFNlZ21lbnQgPSBudWxsO1xuICB2YXIgdGV4dEVuZFNlZ21lbnQgPSBudWxsO1xuICB2YXIgYnRuRGVsZXRlID0gbnVsbDtcbiAgdmFyIGJ0bk1pbnVzID0gbnVsbDtcbiAgdmFyIGRpdldyYXBwZXJCdG4gPSBudWxsO1xuICBcbiAgbGV0IGltZ1JlcGV0ID0gbnVsbDtcbiAgbGV0IGRpdlNlZ21lbnQgPSBudWxsO1xuICBsZXQgc3RhcnREdXJhdGlvbiA9IHN0YXJ0RHVyYXRpb25QYXJhbTtcbiAgbGV0IGVuZER1cmF0aW9uID0gZW5kRHVyYXRpb25QYXJhbTtcbiAgbGV0IGxlZnQgO1xuICBcbiAgdmFyIGJ1dHRvbkRlbGV0ZSA9IG51bGw7XG4gIHZhciBjYXJkT2JqZWN0O1xuICBcbiAgLy9jZXR0ZSBkaXYgZXN0IGxhIHByaW5jaXBhbGUsIGNlbGxlIHF1aSBjb250aWVudCBmcmFnbWVudCArIGJhcmRGcmFnbWVudFxuICBpRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGlEaXYuaWQgPSAnaWRDYXJkJyArIGNyZWF0ZVVuaXF1ZUlkKCk7XG4gIGlEaXYuY2xhc3NOYW1lID0gJ3NlZ21lbnRXcmFwcGVyJztcbiAgaURpdi5zdHlsZS5sZWZ0ID0gc3RhcnRQb3NpdGlvblBhcmFtIDtcbiAgXG4gIC8vQ29sb3IgcGlja2VyXG4gLyogdmFyIGFycm93RG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGFycm93RG93bi50eXBlID0gJ2pzY29sb3InO1xuICBhcnJvd0Rvd24uY2xhc3NOYW1lID0gJ2pzY29sb3InO1xuICBhcnJvd0Rvd24udmFsdWUgPSAnIzhERkZGRic7XG4gIC8vanNjb2xvci5pbnN0YWxsQnlDbGFzc05hbWUoXCJqc2NvbG9yXCIpO1xuICBcbiAgXG4gICBhcnJvd0Rvd24uYm9yZGVyID0gJ25vbmUnO1xuICAgYXJyb3dEb3duLm91dGxpbmUgPSAnbm9uZSc7XG4gICBhcnJvd0Rvd24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2JsYWNrJztcbiAgIGFycm93RG93bi5zdHlsZS53ZWJraXRBcHBlYXJhbmNlID0gJ2xpc3RpdGVtJztcbiAgIGFycm93RG93bi52YWx1ZSA9IFwiIzQxNTY4ZFwiOyovXG4gIFxuICAgICAvL2Fycm93RG93bi52YWx1ZSA9IFwiRkY5OTAwXCI7XG4gIC8vYXJyb3dEb3duLm1vZGUgPSAnSFMnO1xuICAvL2Fycm93RG93bi5wb3NpdGlvbiA9ICdyaWdodCcgO1xuIC8qIGFycm93RG93bi52YWx1ZSA9XCIjMTAyYjlmXCI7XG4gIGFycm93RG93bi5zdHlsZS5vdXRsaW5lPVwibm9uZVwiOyovXG4gIFxuICAvL0RpdiBkdSBzZWdtZW50IGJsZXVcbiAgZGl2U2VnbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXZTZWdtZW50LmNsYXNzTmFtZSA9ICdzZWdtZW50JztcbiAgXG4gIC8vdGFpbGxlIGRlIGxhIGNhcnRlIGluaXRpYWxlXG4gIC8vd2lkdGggPSBpRGl2LnN0eWxlLndpZHRoID0gcGFyc2VJbnQoZW5kUG9zaXRpb25QYXJhbSwgMTApIC0gcGFyc2VJbnQoc3RhcnRQb3NpdGlvblBhcmFtLCAxMCkgKyBcIiVcIjtcbiAgZGl2U2VnbWVudC5zdHlsZS53aWR0aCA9IHBhcnNlSW50KGVuZFBvc2l0aW9uUGFyYW0sIDEwKSAtIHBhcnNlSW50KHN0YXJ0UG9zaXRpb25QYXJhbSwgMTApICsgXCIlXCI7XG4gIHdpZHRoID0gICBkaXZTZWdtZW50LnN0eWxlLndpZHRoO1xuICBjb25zb2xlLmxvZyggZGl2U2VnbWVudC5zdHlsZS53aWR0aCk7XG4gIFxuICBpbml0R1VJKCk7XG4gIGluaXRMaXN0ZW5lcigpO1xuICBwbGF5Q2FyZChpRGl2LCBzdGFydER1cmF0aW9uUGFyYW0pO1xuICBcbiAgXG4gIGZ1bmN0aW9uIHdhdGNoQ29sb3JQaWNrZXIoZXZlbnQpIHtcbiAgICBkaXZTZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgXG4gIH1cbiAgLy9jb25zb2xlLmxvZyhjYXJkSW5mby5kZWxldGVkKTtcbiAgZnVuY3Rpb24gdXBkYXRlSW5mbygpe1xuICAgIGNhcmRPYmplY3Qud2lkdGggPSB3aWR0aDtcbiAgICBjYXJkT2JqZWN0LnN0YXJ0UCA9IHN0YXJ0UDtcbiAgICBjYXJkT2JqZWN0LmVuZFAgPSBlbmRQO1xuICAgIGNhcmRPYmplY3Quc3RhcnREdXJhdGlvbiA9IHN0YXJ0RHVyYXRpb247XG4gICAgY2FyZE9iamVjdC5lbmREdXJhdGlvbiA9IGVuZER1cmF0aW9uO1xuICAgIFxuICAgIGNhcmRPYmplY3QuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICBjYXJkT2JqZWN0LnNwZWVkID0gc3BlZWQ7XG4gICAgY2FyZE9iamVjdC5kZWxldGVkID0gZGVsZXRlZDtcbiAgICBjYXJkT2JqZWN0LnJlcGV0aXRpb25OdW1iZXIgPSByZXBldGl0aW9uTnVtYmVyO1xuICAgIGNhcmRPYmplY3QuaURpdiA9IGlEaXY7XG4gICAgY2FyZE9iamVjdC5pZCA9IGlEaXYuaWQ7XG4gICAgcmV0dXJuIGNhcmRPYmplY3Q7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGRpc3BsYXlEaXZJbmZvQ2FyZCgpIHtcbiAgICBpZiAoJChkaXZJbmZvQ2FyZCkuaGFzQ2xhc3MoJ2hpZGRlbicpKSB7XG4gICAgICBidG5NaW51cy5pbm5lckhUTUwgPSAnLSc7XG4gICAgICAkKGRpdkluZm9DYXJkKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChkaXZJbmZvQ2FyZCkucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7XG4gICAgICAgIGRpdkluZm9DYXJkLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICBpRGl2LnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xuICAgICAgfSwgMjApO1xuICAgIH0gZWxzZSB7XG4gICAgICBidG5NaW51cy5pbm5lckhUTUwgPSAnKyc7XG4gICAgICAkKGRpdkluZm9DYXJkKS5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTtcbiAgICAgICQoZGl2SW5mb0NhcmQpLm9uZSgndHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgJChkaXZJbmZvQ2FyZCkuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICBkaXZJbmZvQ2FyZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBpRGl2LnN0eWxlLmhlaWdodCA9XCIgMjBweFwiO1xuICAgICAgICBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKiAgY29uc29sZS5sb2coXCJjbGljayBidG4gbWludXNcIik7XG4gICAgICBpZihidG5NaW51cy5pbm5lclRleHQgPT09ICctJyl7XG4gICAgICAgIGRpdkluZm9DYXJkLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgYnRuTWludXMuaW5uZXJIVE1MID0gJysnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXZJbmZvQ2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICBidG5NaW51cy5pbm5lckhUTUwgPSAnLSc7XG4gICAgICAgXG4gICAgICB9Ki9cbiAgfVxuICBmdW5jdGlvbiByZW1vdmVUaGVDYXJkKCkge1xuICAgIGlmICggY29uZmlybSggXCIgLyFcXFxcIFZvdWxlei12b3VzIHZyYWltZW50IHN1cHByaW1lciBjZSBzZWdtZW50P1wiICkgKSB7XG4gICAgICAvLyBDb2RlIMOgIMOpeMOpY3V0ZXIgc2kgbGUgbCd1dGlsaXNhdGV1ciBjbGlxdWUgc3VyIFwiT0tcIlxuICAgICAgLy9JIGhhdmUgYSBjaXJjdWxhciBlcnJvciBoZXJlLCB0aGF0IGJyZWFrIHRoZSBsb2cgc3lzdGVtLi4uIEkgY2FuJ3QgZmluZCBpdFxuICAgICAgLy9TbyBJIGRvIG5vdCBsb2cgdGhpcyBjb21tYW5kIGZvciBub3dcbiAgICAgIGNhcmRNYW5hZ2VyLmV4ZWN1dGUobmV3IERlbGV0ZUNhcmRDb21tYW5kKGNhcmRPYmplY3QpKTtcbiAgICAgIC8vY2FyZE1hbmFnZXIuZXhlY3V0ZShuZXcgRGVsZXRlQ2FyZENvbW1hbmQoY2FyZE9iamVjdCkpO1xuICAgIH1cbiAgfVxuICBcbiAgXG4gIGZ1bmN0aW9uIGluaXRMaXN0ZW5lcigpIHtcbiAgICBcbiAgICB0ZXh0U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkZXNjcmlwdGlvbiA9IHRleHRTZWdtZW50LnZhbHVlO1xuICAgICAgY2FyZEZ1bmN0aW9uYWxDb3JlLmV4ZWN1dGUobmV3IE1vZGlmeUNhcmREZXNjcmlwdGlvbkNvbW1hbmQoY2FyZE9iamVjdCx0ZXh0U2VnbWVudC52YWx1ZSkpO1xuICAgIH0pO1xuICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpICs9IDEpIHtcbiAgICAgIHNlbGVjdFNwZWVkLmFkZChuZXcgT3B0aW9uKGkgLyAxMCArIFwiXCIpKTtcbiAgICB9XG4gICAgc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleCA9IDEwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgc2VsZWN0TmJSZXBldC5vcHRpb25zLmFkZChuZXcgT3B0aW9uKGkgKyBcIlwiKSk7XG4gICAgfVxuICAgIFxuICAgIC8vZGVsZXRlIGFwcGFyYWl0XG4gICAgYnRuRGVsZXRlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLGZ1bmN0aW9uKCl7XG4gICAgICByZW1vdmVUaGVDYXJkKCk7XG4gICAgfSk7XG4gIFxuICAgIGJ0bkRlbGV0ZS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsZnVuY3Rpb24oKXtcbiAgICAgIHJlbW92ZVRoZUNhcmQoKVxuICAgIH0pO1xuICAgIFxuICAgIGJ0bk1pbnVzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLGZ1bmN0aW9uKCl7XG4gICAgICBkaXNwbGF5RGl2SW5mb0NhcmQoKTtcbiAgICB9KTtcbiAgICBidG5NaW51cy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsZnVuY3Rpb24oKXtcbiAgICAgIGRpc3BsYXlEaXZJbmZvQ2FyZCgpO1xuICAgIH0pO1xuICAgXG4gICAgc2VsZWN0U3BlZWQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGxldCBzcGVlZFJhdGUgPSBzZWxlY3RTcGVlZC5vcHRpb25zW3NlbGVjdFNwZWVkLnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICAgICAgc3BlZWQgPSBzcGVlZFJhdGU7XG4gICAgICBjYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgQ2FyZFNwZWVkQ29tbWFuZChjYXJkT2JqZWN0LHNwZWVkUmF0ZSkpO1xuICAgIH0pO1xuICAgIHNlbGVjdE5iUmVwZXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oKXtcbiAgICAgIHJlcGV0aXRpb25OdW1iZXIgPSBzZWxlY3ROYlJlcGV0Lm9wdGlvbnNbc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIGNvbnNvbGUubG9nKFwibmJyZXBldCBpbiBjYXJkIDpcIiArICByZXBldGl0aW9uTnVtYmVyKTtcbiAgICAgIGNhcmRGdW5jdGlvbmFsQ29yZS5leGVjdXRlKG5ldyBDYXJkTmJSZXBldENvbW1hbmQoY2FyZE9iamVjdCwgcmVwZXRpdGlvbk51bWJlcikpO1xuICAgICAgLy9jYXJkRnVuY3Rpb25hbENvcmUuZXhlY3V0ZShuZXcgQ2FyZE5iUmVwZXRDb21tYW5kKGNhcmRPYmplY3QsIDEwMCkpO1xuICAgIH0pO1xuICAgIGRpdlNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICByZXBldGl0aW9uTnVtYmVyID0gc2VsZWN0TmJSZXBldC5vcHRpb25zW3NlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBsZXQgc3BlZWRSYXRlID0gc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIHNwZWVkID0gc3BlZWRSYXRlO1xuICAgICAgLy9zZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uID0gaURpdi5zdHlsZS5sZWZ0ICA7XG4gICAgICAvL3NlZ21lbnRGZWVkYmFjay53aWR0aCA9IHdpZHRoO1xuICAgICAgZGVzY3JpcHRpb24gPSB0ZXh0U2VnbWVudC52YWx1ZTtcbiAgXG4gICAgICAvL3ZhciBhdWRpbyA9IG5ldyBBdWRpbygpO1xuICAgICAgLy92YXIgYnVmZmVyZWQgPSBhdWRpby5idWZmZXJlZDtcbiAgICAgIC8vIHJldHVybnMgdGltZSBpbiBzZWNvbmRzIG9mIHRoZSBsYXN0IGJ1ZmZlcmVkIFRpbWVSYW5nZVxuICAgICAgLy9hdWRpby5zZXRBdHRyaWJ1dGUoXCJzcmNcIixcInB1YmxpYy9zb3VuZHMvcHJlcGFyYXRpb24vcHJlcGFyYXRpb24ubXAzXCIpO1xuICAgICAgLy9hdWRpby5wbGF5KCk7XG4gICAgICB2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBSZXBldFBhcnRPZlZpZGVvQ29tbWFuZChzdGFydER1cmF0aW9uLGVuZER1cmF0aW9uICwgIDEwMCwgc3BlZWRSYXRlKSk7XG4gICAgICAvL3VwZGF0ZVNlZ21lbnRGZWVkYmFjayh0cnVlLHN0YXJ0UCxlbmRQKTtcbiAgXG4gIFxuICAgICAgJCggZnVuY3Rpb24oKSB7XG4gICAgICAgICQoIFwiLnNlZ21lbnRXcmFwcGVyXCIgKS5kcmFnZ2FibGUoe1xuICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgIHNuYXBUb2xlcmFuY2U6IDIwLFxuICAgICAgICAgIHNuYXBNb2RlOlwiaW5uZXJcIixcbiAgICAgICAgICBhY3RpdmVDbGFzczogXCJ1aS1zdGF0ZS1oaWdobGlnaHRcIixcbiAgICAgICAgICBjb250YWlubWVudCA6ICcjd3JhcHBlckNvbW1hbmRBbmRSYW5nZUNhcmRCb2FyZCcsXG4gICAgICAgICAgc25hcCA6IHRydWVcbiAgXG4gIFxuICAgICAgICB9KTtcbiAgICAgIH0gKTtcbiAgXG4gIFxuICAgICAgXG4gICAgICAkKCBcIi5zZWdtZW50V3JhcHBlclwiICkuZHJvcHBhYmxlKHtcbiAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgIFwidWktZHJvcHBhYmxlXCI6IFwiaGlnaGxpZ2h0XCJcbiAgICAgICAgfSxcbiAgICAgICAgc25hcCA6IHRydWUsXG4gICAgICAgIFxuICAgICAgICBkcm9wOiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZHJvcHBlZFwiKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzKTtcbiAgICAgICAgICAvL1RPRE8gZmFpcmUgbGEgZm9uY3Rpb24gZGUgZHJhZyBhdmVjIHVuZSBsaXN0ZSBkZSBjYXJ0ZSBjb25uZWN0w6kgb3UgdW5lIGxpc3RlIGNoYWluw6kgZGUgY2FydGVzP1xuICAgICAgICAgICQodGhpcykuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLFwidmFyKC0tbWFpbi1jb2xvcilcIilcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgIFxuICBcbiAgICB9LCBmYWxzZSk7XG4gICAgLy9UT0RPIHdpZGdldCBjb2xvciBwaWNrZXJcbiAgICAvL2Fycm93RG93bi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIHdhdGNoQ29sb3JQaWNrZXIsIGZhbHNlKTtcbiAgfVxuICBmdW5jdGlvbiBpbml0R1VJKCkge1xuICAgIFxuICAgIHRleHRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0U2VnbWVudC5jbGFzc05hbWUgPSAndGV4dFNlZ21lbnQnO1xuICAgIC8vVUkgYnV0dG9uIHNwZWVkIGFuZCBzbG93XG4gICAgaW1nUmVwZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgIGltZ1JlcGV0LmNsYXNzTmFtZT0naW1nUmVwZXQnO1xuICAgIGltZ1Nsb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICBcbiAgICBpbWdTbG93LmNsYXNzTmFtZT0naW1nU2xvdyc7XG4gICAgc2VsZWN0U3BlZWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuICAgIHNlbGVjdFNwZWVkLmNsYXNzTmFtZSA9J3NlbGVjdFNwZWVkJyA7XG4gICAgc2VsZWN0TmJSZXBldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4ID0gMTtcbiAgICBcbiAgICBzZWxlY3ROYlJlcGV0LmNsYXNzTmFtZSA9J3NlbGVjdE5iUmVwZXQnIDtcbiAgICBkaXZJbmZvQ2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkluZm9DYXJkLmNsYXNzTmFtZSA9IFwiaW5mb0NhcmRcIjtcbiAgXG4gICBcbiAgICAvKlxuICAgIFdyYXBwZXIgdGhhdCBjb250YWluIHRoZSBidHV0dG9uIChtaW51cykgLSBhbmQgeCAoZGVsZXRlKVxuICAgICAqL1xuICAgIGRpdldyYXBwZXJCdG4gID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2V3JhcHBlckJ0bi5jbGFzc05hbWUgPSAnZGl2V3JhcHBlckJ0bic7XG4gICAgXG4gICAgXG4gICAgYnRuRGVsZXRlICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBidG5EZWxldGUuY2xhc3NOYW1lID0gJ3NwYW4nO1xuICAgIGJ0bkRlbGV0ZS5jbGFzc0xpc3QuYWRkKCdidG5EZWxldGVDYXJkJyk7XG4gICAgYnRuRGVsZXRlLmlubmVySFRNTCA9IFwieFwiO1xuICBcbiAgICBidG5NaW51cyAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgYnRuTWludXMuY2xhc3NOYW1lID0gJ3NwYW4nO1xuICAgIGJ0bk1pbnVzLmNsYXNzTGlzdC5hZGQoJ2J0bk1pbnVzQ2FyZCcpO1xuICAgIGJ0bk1pbnVzLmlubmVySFRNTCA9IFwiLVwiO1xuICAgIGRpdldyYXBwZXJCdG4uYXBwZW5kQ2hpbGQoYnRuTWludXMpO1xuICAgIGRpdldyYXBwZXJCdG4uYXBwZW5kQ2hpbGQoYnRuRGVsZXRlKTtcbiAgICBcbiAgLypcbiAgQ3JlYXRpb24gZGVzIMOpdGFwZXMgcG91ciBmYWNpbGVtZW50IGNoYW5nZXIgbGEgdGFpbGxlIGRlcyBzZWdtZW50c1xuICBcbiAgICB0ZXh0U3RhcnRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0U3RhcnRTZWdtZW50LmNsYXNzTmFtZSA9ICcnO1xuICAgIHRleHRFbmRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0RW5kU2VnbWVudC5jbGFzc05hbWUgPSAnJztcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0U3RhcnRTZWdtZW50KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0RW5kU2VnbWVudCk7XG4gICovXG4gIFxuICAgIC8vRGl2IGNvbnRlbmFudCBsZXMgaW5mbyBkdSBkZXNzdXMgKHRhaWxsZSBkZSBkaXYgaW52YXJpYWJsZSlcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChpbWdTbG93KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChzZWxlY3RTcGVlZCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChpbWdSZXBldCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChzZWxlY3ROYlJlcGV0KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZCh0ZXh0U2VnbWVudCk7XG4gICAgLy9kaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChhcnJvd0Rvd24pO1xuICAgIGlEaXYuYXBwZW5kQ2hpbGQoZGl2U2VnbWVudCk7XG4gICAgaURpdi5hcHBlbmRDaGlsZChkaXZXcmFwcGVyQnRuKTtcbiAgICBpRGl2LmFwcGVuZENoaWxkKGRpdkluZm9DYXJkKTtcbiAgICBcbiAgICAvL0lmIHRoZSBjYXJkIGhhdmUgYmVlbiBkZWxldGVkLCB0aGUgY29sb3IgaXMgcmVkLCBvdGhlcndpc2UgZm91cnRoLWNvbG9yIChkZWZpbmUgaW4gc3R5bGUuY3NzKS5cbiAgICBpZiAoY2FyZEluZm8pIHtcbiAgICAgIGlmKGNhcmRJbmZvLmRlbGV0ZWQpe1xuICAgICAgICBkaXZTZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCctLXVuc3VjZXNzLWNvbG9yJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXZTZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCctLWZvdXJ0aC1jb2xvcicpO1xuICAgICAgfVxuICAgICAgdGV4dFNlZ21lbnQudmFsdWUgPSBjYXJkSW5mby5kZXNjcmlwdGlvbjtcbiAgICAgIHNlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleCA9IGNhcmRJbmZvLnJlcGV0aXRpb25OdW1iZXI7XG4gICAgICBzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4ID0gY2FyZEluZm8uc3BlZWQqMTA7XG4gICAgfVxuICB9XG4gIFxuICBcbiAgXG4gIFxuICBjYXJkT2JqZWN0ID0ge1xuICAgIHdpZHRoOiAgd2lkdGgsXG4gICAgc3RhcnRQIDogc3RhcnRQLFxuICAgIGVuZFAgOiBlbmRQLFxuICAgIHN0YXJ0RHVyYXRpb24gOiBzdGFydER1cmF0aW9uLFxuICAgIGVuZER1cmF0aW9uIDogZW5kRHVyYXRpb24sXG4gICAgZGVsZXRlZDpkZWxldGVkLFxuICAgIGRlc2NyaXB0aW9uIDogdGhpcy5kZXNjcmlwdGlvbixcbiAgICBzcGVlZCA6ICB0aGlzLnNwZWVkLFxuICAgIHJlcGV0aXRpb25OdW1iZXIgOiAgdGhpcy5yZXBldGl0aW9uTnVtYmVyLFxuICAgIGlEaXY6aURpdixcbiAgICBpZDppRGl2LmlkLFxuICAgIHVwZGF0ZUluZm8gOiB1cGRhdGVJbmZvXG4gIH07XG4gIFxuICBcblxuICBcbiAgcmV0dXJuIGNhcmRPYmplY3Q7XG59XG5cbi8qIFBlcm1ldCBkZSBkcmFnIGxhIHZpZGVvIGV0IGxlIFNIIGVuIGVudGllclxuJCggZnVuY3Rpb24oKSB7XG4gICQoIFwiLndyYXBwZXJDb21tYW5kQW5kUmFuZ2VcIiApLmRyYWdnYWJsZSh7XG4gICAgYXhpczogXCJ5XCIsXG4gICAgZHJvcDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiZHJhZ1wiKTtcbiAgICB9XG4gIH0pO1xufSApOyovXG5cbi8qXG4kKCBcIi53cmFwcGVyQ29tbWFuZEFuZFJhbmdlXCIgKS5kcm9wcGFibGUoe1xuICBkcm9wOiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuICAgICQoIHRoaXMgKVxuICAgICAgLmFkZENsYXNzKCBcInVpLXN0YXRlLWhpZ2hsaWdodFwiIClcbiAgICAgIC5maW5kKCBcInBcIiApXG4gICAgICAuaHRtbCggXCJEcm9wcGVkIVwiICk7XG4gICAgY29uc29sZS5sb2coXCJkcm9wcGVkXCIpO1xuICBcbiAgXG4gIH1cbn0pOyovXG5cblxuXG4iXX0=