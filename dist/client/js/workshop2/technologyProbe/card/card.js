'use strict';

//TODO faire une classe carte

function Card(startDurationParam, endDurationParam, startPositionParam, endPositionParam, cardInfo) {
  //Propriété de style
  var width = '6%';
  var height = '6%';
  var deleted = false;
  var iDiv = null;
  var startP = startPositionParam;
  var endP = endPositionParam;
  //Valeur pour jouer la carte
  var description = '';
  var speed = 1;
  var repetitionNumber = 1;
  //div used
  var divInfoCard = null;
  //let selectSpeed=null;
  var selectNbRepet = null;
  var selectSpeed = null;

  var imgSlow = null;

  var textSegment = null;
  var imgRepet = null;
  var divSegment = null;
  var startDuration = startDurationParam;
  var endDuration = endDurationParam;
  var left = void 0;

  var buttonDelete = null;

  //cette div est la principale, celle qui contient fragment + bardFragment
  iDiv = document.createElement('div');
  iDiv.id = 'idCard' + createUniqueId();
  iDiv.className = 'segmentWrapper';
  iDiv.style.left = startPositionParam + "px";

  //Div du segment bleu
  divSegment = document.createElement('div');
  divSegment.className = 'segment';

  //taille de la carte initiale
  width = iDiv.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "px";
  divSegment.style.width = parseInt(endPositionParam, 10) - parseInt(startPositionParam, 10) + "px";

  initGUI();
  initStyle();
  initListener();
  playCard();

  //console.log(cardInfo.deleted);
  function updateInfo() {
    var cardObject = {
      width: width,
      startP: startP,
      endP: endP,
      description: description,
      speed: speed,
      deleted: deleted,
      repetitionNumber: repetitionNumber
    };
    return cardObject;
  }

  function initListener() {

    textSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });

    divSegment.addEventListener('long-press', function (e) {
      createBtnDelete(e);
    });

    selectSpeed.addEventListener("onchange", function () {
      console.log("change speed : " + selectSpeed.options[selectSpeed.selectedIndex].value);
    });

    /*divSegment.addEventListener("touchstart", function () {
      // console.log('iDiv.id : ');
      //kill('mousedown');
     // kill('mouseup');
      let nbRepet = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      let speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;
      
      repetitionNumber = nbRepet;
      speed = speedRate;
      
      segmentFeedback.startPostion = iDiv.style.left  ;
      segmentFeedback.width = width;
      feedbackOnSliderVideo(true);
      repetPartOfVideo(startDuration, endDuration, nbRepet, speedRate);
    }, false);*/

    divSegment.addEventListener("mousedown", function () {
      // console.log('iDiv.id : ');
      var nbRepet = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      var speedRate = selectSpeed.options[selectSpeed.selectedIndex].value;

      repetitionNumber = nbRepet;
      speed = speedRate;

      segmentFeedback.startPostion = iDiv.style.left;
      segmentFeedback.width = width;
      feedbackOnSliderVideo(true);
      repetPartOfVideo(startDuration, endDuration, nbRepet, speedRate);
    }, false);
  }

  function initGUI() {
    textSegment = document.createElement('input');
    textSegment.className = 'textSegment';
    //UI button speed and slow
    imgRepet = document.createElement("img");
    imgRepet.className = 'imgRepet';
    imgSlow = document.createElement("img");
    imgSlow.className = 'imgSlow';

    selectSpeed = document.createElement("select");
    selectSpeed.className = 'selectSpeed';
    selectNbRepet = document.createElement("select");
    selectNbRepet.className = 'selectNbRepet';

    divInfoCard = document.createElement('div');
    divInfoCard.className = "infoCard";

    textSegment.addEventListener("keyup", function () {
      description = textSegment.value;
    });

    //Peupler les listes déroulantes
    for (var i = 0; i < 20; i += 1) {
      selectSpeed.add(new Option(i / 10 + ""));
    }
    selectSpeed.selectedIndex = 10;
    for (var _i = 0; _i < 20; _i++) {
      selectNbRepet.options.add(new Option(_i + ""));
    }
    selectNbRepet.selectedIndex = 1;

    /*
    selectNbRepet.addEventListener("onchange", function () {
      
      repetitionNumber = selectNbRepet.options[selectNbRepet.selectedIndex].value;
      console.log("selected : " + repetitionNumber);
    });*/

    //Div contenant les info du dessus (taille de div invariable)
    divInfoCard.appendChild(imgSlow);
    divInfoCard.appendChild(selectSpeed);
    divInfoCard.appendChild(imgRepet);
    divInfoCard.appendChild(selectNbRepet);
    iDiv.appendChild(divSegment);
    iDiv.appendChild(textSegment);
    iDiv.appendChild(divInfoCard);

    //If the card have been deleted, the color is red, otherwise blue.
    if (cardInfo) {
      if (cardInfo.deleted) {
        divSegment.style.backgroundColor = "red";
      } else {
        divSegment.style.backgroundColor = "#213F8D";
      }
      textSegment.value = cardInfo.description;
      selectNbRepet.selectedIndex = cardInfo.repetitionNumber;
      selectSpeed.selectedIndex = cardInfo.speed * 10;
    }
  }

  function initStyle() {
    textSegment.style.left = divSegment.style.width;
    imgSlow.src = "/media/workshop2/card/slow.png";
    imgRepet.src = "/media/workshop2/card/repet.png";
  }

  function playCard() {
    video.currentTime = startDurationParam;
    segmentFeedback.width = iDiv.style.width;
    segmentFeedback.startPostion = iDiv.style.left;
    feedbackOnSliderVideo(true);
  }

  var cardObject = {
    width: width,
    startP: startP,
    endP: endP,
    description: description,
    speed: speed,
    repetitionNumber: repetitionNumber,
    iDiv: iDiv,
    updateInfo: updateInfo
  };

  function createBtnDelete(e) {
    e.preventDefault();
    //delete apparait
    var buttonDelete = document.createElement('button');
    buttonDelete.id = 'idBtnDelete';
    buttonDelete.style.position = "absolute";
    buttonDelete.type = "button";
    buttonDelete.innerHTML = "Delete";
    buttonDelete.style.width = "100px";
    divInfoCard.appendChild(buttonDelete);
    buttonDelete.addEventListener('mouseup', function (e) {

      //TODO
      cardManager.execute(new DeleteCardCommand(cardObject));
      deleteCard(cardObject);
    });

    buttonDelete.addEventListener('touchend', function (e) {
      deleteCard();
    });
  }
  return cardObject;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmQuanMiXSwibmFtZXMiOlsiQ2FyZCIsInN0YXJ0RHVyYXRpb25QYXJhbSIsImVuZER1cmF0aW9uUGFyYW0iLCJzdGFydFBvc2l0aW9uUGFyYW0iLCJlbmRQb3NpdGlvblBhcmFtIiwiY2FyZEluZm8iLCJ3aWR0aCIsImhlaWdodCIsImRlbGV0ZWQiLCJpRGl2Iiwic3RhcnRQIiwiZW5kUCIsImRlc2NyaXB0aW9uIiwic3BlZWQiLCJyZXBldGl0aW9uTnVtYmVyIiwiZGl2SW5mb0NhcmQiLCJzZWxlY3ROYlJlcGV0Iiwic2VsZWN0U3BlZWQiLCJpbWdTbG93IiwidGV4dFNlZ21lbnQiLCJpbWdSZXBldCIsImRpdlNlZ21lbnQiLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJsZWZ0IiwiYnV0dG9uRGVsZXRlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJjcmVhdGVVbmlxdWVJZCIsImNsYXNzTmFtZSIsInN0eWxlIiwicGFyc2VJbnQiLCJpbml0R1VJIiwiaW5pdFN0eWxlIiwiaW5pdExpc3RlbmVyIiwicGxheUNhcmQiLCJ1cGRhdGVJbmZvIiwiY2FyZE9iamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY3JlYXRlQnRuRGVsZXRlIiwiY29uc29sZSIsImxvZyIsIm9wdGlvbnMiLCJzZWxlY3RlZEluZGV4IiwidmFsdWUiLCJuYlJlcGV0Iiwic3BlZWRSYXRlIiwic2VnbWVudEZlZWRiYWNrIiwic3RhcnRQb3N0aW9uIiwiZmVlZGJhY2tPblNsaWRlclZpZGVvIiwicmVwZXRQYXJ0T2ZWaWRlbyIsImkiLCJhZGQiLCJPcHRpb24iLCJhcHBlbmRDaGlsZCIsImJhY2tncm91bmRDb2xvciIsInNyYyIsInZpZGVvIiwiY3VycmVudFRpbWUiLCJwcmV2ZW50RGVmYXVsdCIsInBvc2l0aW9uIiwidHlwZSIsImlubmVySFRNTCIsImNhcmRNYW5hZ2VyIiwiZXhlY3V0ZSIsIkRlbGV0ZUNhcmRDb21tYW5kIiwiZGVsZXRlQ2Fy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LFVBQTlCLEVBQXlDLFVBQVNDLENBQVQsRUFBVztBQUNsRDRCO0FBQ0QsS0FGRDtBQUdEO0FBQ0QsU0FBTzlCLFVBQVA7QUFDRCIsImZpbGUiOiJjYXJkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9UT0RPIGZhaXJlIHVuZSBjbGFzc2UgY2FydGVcblxuZnVuY3Rpb24gQ2FyZCAoc3RhcnREdXJhdGlvblBhcmFtLGVuZER1cmF0aW9uUGFyYW0sc3RhcnRQb3NpdGlvblBhcmFtLGVuZFBvc2l0aW9uUGFyYW0sIGNhcmRJbmZvKSB7XG4gIC8vUHJvcHJpw6l0w6kgZGUgc3R5bGVcbiAgbGV0IHdpZHRoID0gJzYlJztcbiAgbGV0IGhlaWdodCA9ICc2JSc7XG4gIHZhciBkZWxldGVkID0gZmFsc2U7XG4gIHZhciBpRGl2ID0gbnVsbDtcbiAgdmFyIHN0YXJ0UCA9IHN0YXJ0UG9zaXRpb25QYXJhbTtcbiAgdmFyIGVuZFAgPSBlbmRQb3NpdGlvblBhcmFtO1xuLy9WYWxldXIgcG91ciBqb3VlciBsYSBjYXJ0ZVxuICBsZXQgZGVzY3JpcHRpb24gPSAnJztcbiAgbGV0IHNwZWVkID0gMTtcbiAgbGV0IHJlcGV0aXRpb25OdW1iZXIgPSAxO1xuLy9kaXYgdXNlZFxuICBsZXQgZGl2SW5mb0NhcmQgPSBudWxsO1xuICAvL2xldCBzZWxlY3RTcGVlZD1udWxsO1xuICBsZXQgc2VsZWN0TmJSZXBldCA9IG51bGw7XG4gIGxldCBzZWxlY3RTcGVlZCA9IG51bGw7XG4gIFxuICBsZXQgaW1nU2xvdyA9IG51bGw7XG4gIFxuICBsZXQgdGV4dFNlZ21lbnQgPSBudWxsO1xuICBsZXQgaW1nUmVwZXQgPSBudWxsO1xuICBsZXQgZGl2U2VnbWVudCA9IG51bGw7XG4gIGxldCBzdGFydER1cmF0aW9uID0gc3RhcnREdXJhdGlvblBhcmFtO1xuICBsZXQgZW5kRHVyYXRpb24gPSBlbmREdXJhdGlvblBhcmFtO1xuICBsZXQgbGVmdCA7XG4gIFxuICB2YXIgYnV0dG9uRGVsZXRlID0gbnVsbDtcbiAgXG4gIC8vY2V0dGUgZGl2IGVzdCBsYSBwcmluY2lwYWxlLCBjZWxsZSBxdWkgY29udGllbnQgZnJhZ21lbnQgKyBiYXJkRnJhZ21lbnRcbiAgaURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBpRGl2LmlkID0gJ2lkQ2FyZCcgKyBjcmVhdGVVbmlxdWVJZCgpO1xuICBpRGl2LmNsYXNzTmFtZSA9ICdzZWdtZW50V3JhcHBlcic7XG4gIGlEaXYuc3R5bGUubGVmdCA9IHN0YXJ0UG9zaXRpb25QYXJhbSArIFwicHhcIjtcbiAgXG4gIC8vRGl2IGR1IHNlZ21lbnQgYmxldVxuICBkaXZTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdlNlZ21lbnQuY2xhc3NOYW1lID0gJ3NlZ21lbnQnO1xuICBcbiAgLy90YWlsbGUgZGUgbGEgY2FydGUgaW5pdGlhbGVcbiAgd2lkdGggPSBpRGl2LnN0eWxlLndpZHRoID0gcGFyc2VJbnQoZW5kUG9zaXRpb25QYXJhbSwgMTApIC0gcGFyc2VJbnQoc3RhcnRQb3NpdGlvblBhcmFtLCAxMCkgKyBcInB4XCI7XG4gIGRpdlNlZ21lbnQuc3R5bGUud2lkdGggPSBwYXJzZUludChlbmRQb3NpdGlvblBhcmFtLCAxMCkgLSBwYXJzZUludChzdGFydFBvc2l0aW9uUGFyYW0sIDEwKSArIFwicHhcIjtcbiAgXG4gIGluaXRHVUkoKTtcbiAgaW5pdFN0eWxlKCk7XG4gIGluaXRMaXN0ZW5lcigpO1xuICBwbGF5Q2FyZCgpO1xuICBcbiAgLy9jb25zb2xlLmxvZyhjYXJkSW5mby5kZWxldGVkKTtcbiAgZnVuY3Rpb24gdXBkYXRlSW5mbygpe1xuICAgIHZhciBjYXJkT2JqZWN0ID0ge1xuICAgICAgd2lkdGg6ICB3aWR0aCxcbiAgICAgIHN0YXJ0UCA6IHN0YXJ0UCxcbiAgICAgIGVuZFAgOiBlbmRQLFxuICAgICAgZGVzY3JpcHRpb24gOiBkZXNjcmlwdGlvbixcbiAgICAgIHNwZWVkIDogc3BlZWQsXG4gICAgICBkZWxldGVkOmRlbGV0ZWQsXG4gICAgICByZXBldGl0aW9uTnVtYmVyIDogcmVwZXRpdGlvbk51bWJlclxuICAgIH07XG4gICAgcmV0dXJuIGNhcmRPYmplY3Q7XG4gIH1cbiAgXG4gIFxuICBmdW5jdGlvbiBpbml0TGlzdGVuZXIoKSB7XG4gICAgXG4gICAgdGV4dFNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcignbG9uZy1wcmVzcycsIGZ1bmN0aW9uKGUpe1xuICAgICAgY3JlYXRlQnRuRGVsZXRlKGUpO1xuICAgIH0pO1xuICAgIFxuICAgIGRpdlNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcignbG9uZy1wcmVzcycsIGZ1bmN0aW9uKGUpe1xuICAgICAgY3JlYXRlQnRuRGVsZXRlKGUpO1xuICAgIH0pO1xuICBcbiAgICBcbiAgICBcbiAgICBzZWxlY3RTcGVlZC5hZGRFdmVudExpc3RlbmVyKFwib25jaGFuZ2VcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGNvbnNvbGUubG9nKFwiY2hhbmdlIHNwZWVkIDogXCIgKyAgICAgc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZSk7XG4gICAgICBcbiAgICB9KTtcbiAgICBcbiAgICAvKmRpdlNlZ21lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ2lEaXYuaWQgOiAnKTtcbiAgICAgIC8va2lsbCgnbW91c2Vkb3duJyk7XG4gICAgIC8vIGtpbGwoJ21vdXNldXAnKTtcbiAgICAgIGxldCBuYlJlcGV0ID0gc2VsZWN0TmJSZXBldC5vcHRpb25zW3NlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBsZXQgc3BlZWRSYXRlID0gc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICAgIFxuICAgICAgcmVwZXRpdGlvbk51bWJlciA9IG5iUmVwZXQ7XG4gICAgICBzcGVlZCA9IHNwZWVkUmF0ZTtcbiAgICAgIFxuICAgICAgc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbiA9IGlEaXYuc3R5bGUubGVmdCAgO1xuICAgICAgc2VnbWVudEZlZWRiYWNrLndpZHRoID0gd2lkdGg7XG4gICAgICBmZWVkYmFja09uU2xpZGVyVmlkZW8odHJ1ZSk7XG4gICAgICByZXBldFBhcnRPZlZpZGVvKHN0YXJ0RHVyYXRpb24sIGVuZER1cmF0aW9uLCBuYlJlcGV0LCBzcGVlZFJhdGUpO1xuICAgIH0sIGZhbHNlKTsqL1xuICBcbiAgICBkaXZTZWdtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ2lEaXYuaWQgOiAnKTtcbiAgICAgIGxldCBuYlJlcGV0ID0gc2VsZWN0TmJSZXBldC5vcHRpb25zW3NlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBsZXQgc3BlZWRSYXRlID0gc2VsZWN0U3BlZWQub3B0aW9uc1tzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbiAgICBcbiAgICAgIHJlcGV0aXRpb25OdW1iZXIgPSBuYlJlcGV0O1xuICAgICAgc3BlZWQgPSBzcGVlZFJhdGU7XG4gICAgXG4gICAgICBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uID0gaURpdi5zdHlsZS5sZWZ0ICA7XG4gICAgICBzZWdtZW50RmVlZGJhY2sud2lkdGggPSB3aWR0aDtcbiAgICAgIGZlZWRiYWNrT25TbGlkZXJWaWRlbyh0cnVlKTtcbiAgICAgIHJlcGV0UGFydE9mVmlkZW8oc3RhcnREdXJhdGlvbiwgZW5kRHVyYXRpb24sIG5iUmVwZXQsIHNwZWVkUmF0ZSk7XG4gICAgfSwgZmFsc2UpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBpbml0R1VJKCkge1xuICAgIHRleHRTZWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0ZXh0U2VnbWVudC5jbGFzc05hbWUgPSAndGV4dFNlZ21lbnQnO1xuICAgIC8vVUkgYnV0dG9uIHNwZWVkIGFuZCBzbG93XG4gICAgaW1nUmVwZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgIGltZ1JlcGV0LmNsYXNzTmFtZT0naW1nUmVwZXQnO1xuICAgIGltZ1Nsb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgIGltZ1Nsb3cuY2xhc3NOYW1lPSdpbWdTbG93JztcbiAgICBcbiAgICBzZWxlY3RTcGVlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgc2VsZWN0U3BlZWQuY2xhc3NOYW1lID0nc2VsZWN0U3BlZWQnIDtcbiAgICBzZWxlY3ROYlJlcGV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtcbiAgICBzZWxlY3ROYlJlcGV0LmNsYXNzTmFtZSA9J3NlbGVjdE5iUmVwZXQnIDtcbiAgICBcbiAgICBkaXZJbmZvQ2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdkluZm9DYXJkLmNsYXNzTmFtZSA9IFwiaW5mb0NhcmRcIjtcbiAgICBcbiAgICB0ZXh0U2VnbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgZGVzY3JpcHRpb24gPSB0ZXh0U2VnbWVudC52YWx1ZTtcbiAgICB9KTtcbiAgIFxuICAgIC8vUGV1cGxlciBsZXMgbGlzdGVzIGTDqXJvdWxhbnRlc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkgKz0gMSkge1xuICAgICAgc2VsZWN0U3BlZWQuYWRkKG5ldyBPcHRpb24oaSAvIDEwICsgXCJcIikpO1xuICAgIH1cbiAgICBzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4ID0gMTA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XG4gICAgICBzZWxlY3ROYlJlcGV0Lm9wdGlvbnMuYWRkKG5ldyBPcHRpb24oaSArIFwiXCIpKTtcbiAgICB9XG4gICAgc2VsZWN0TmJSZXBldC5zZWxlY3RlZEluZGV4ID0gMTtcbiAgICBcbiAgICAvKlxuICAgIHNlbGVjdE5iUmVwZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm9uY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIFxuICAgICAgcmVwZXRpdGlvbk51bWJlciA9IHNlbGVjdE5iUmVwZXQub3B0aW9uc1tzZWxlY3ROYlJlcGV0LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICAgICAgY29uc29sZS5sb2coXCJzZWxlY3RlZCA6IFwiICsgcmVwZXRpdGlvbk51bWJlcik7XG4gICAgfSk7Ki9cbiAgICBcbiAgICAvL0RpdiBjb250ZW5hbnQgbGVzIGluZm8gZHUgZGVzc3VzICh0YWlsbGUgZGUgZGl2IGludmFyaWFibGUpXG4gICAgZGl2SW5mb0NhcmQuYXBwZW5kQ2hpbGQoaW1nU2xvdyk7XG4gICAgZGl2SW5mb0NhcmQuYXBwZW5kQ2hpbGQoc2VsZWN0U3BlZWQpO1xuICAgIGRpdkluZm9DYXJkLmFwcGVuZENoaWxkKGltZ1JlcGV0KTtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChzZWxlY3ROYlJlcGV0KTtcbiAgICBpRGl2LmFwcGVuZENoaWxkKGRpdlNlZ21lbnQpO1xuICAgIGlEaXYuYXBwZW5kQ2hpbGQodGV4dFNlZ21lbnQpO1xuICAgIGlEaXYuYXBwZW5kQ2hpbGQoZGl2SW5mb0NhcmQpO1xuICBcbiAgICAvL0lmIHRoZSBjYXJkIGhhdmUgYmVlbiBkZWxldGVkLCB0aGUgY29sb3IgaXMgcmVkLCBvdGhlcndpc2UgYmx1ZS5cbiAgICBpZiAoY2FyZEluZm8pIHtcbiAgICAgIGlmKGNhcmRJbmZvLmRlbGV0ZWQpe1xuICAgICAgICBkaXZTZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXZTZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiIzIxM0Y4RFwiO1xuICAgICAgfVxuICAgICAgdGV4dFNlZ21lbnQudmFsdWUgPSBjYXJkSW5mby5kZXNjcmlwdGlvbjtcbiAgICAgIHNlbGVjdE5iUmVwZXQuc2VsZWN0ZWRJbmRleCA9IGNhcmRJbmZvLnJlcGV0aXRpb25OdW1iZXI7XG4gICAgICBzZWxlY3RTcGVlZC5zZWxlY3RlZEluZGV4ID0gY2FyZEluZm8uc3BlZWQqMTA7XG4gICAgfVxuICB9XG4gIFxuICBmdW5jdGlvbiBpbml0U3R5bGUoKSB7XG4gICAgdGV4dFNlZ21lbnQuc3R5bGUubGVmdCA9IGRpdlNlZ21lbnQuc3R5bGUud2lkdGg7XG4gICAgaW1nU2xvdy5zcmMgPSBcIi9tZWRpYS93b3Jrc2hvcDIvY2FyZC9zbG93LnBuZ1wiO1xuICAgIGltZ1JlcGV0LnNyYyA9IFwiL21lZGlhL3dvcmtzaG9wMi9jYXJkL3JlcGV0LnBuZ1wiO1xuICB9XG4gIFxuICBcbiAgXG4gIFxuICBmdW5jdGlvbiBwbGF5Q2FyZCgpe1xuICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gc3RhcnREdXJhdGlvblBhcmFtO1xuICAgIHNlZ21lbnRGZWVkYmFjay53aWR0aCA9IGlEaXYuc3R5bGUud2lkdGg7XG4gICAgc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbiA9IGlEaXYuc3R5bGUubGVmdDtcbiAgICBmZWVkYmFja09uU2xpZGVyVmlkZW8odHJ1ZSk7XG4gIH1cbiAgXG4gIFxuICBcbiAgXG4gIFxuICB2YXIgY2FyZE9iamVjdCA9IHtcbiAgICB3aWR0aDogIHdpZHRoLFxuICAgIHN0YXJ0UCA6IHN0YXJ0UCxcbiAgICBlbmRQIDogZW5kUCxcbiAgICBkZXNjcmlwdGlvbiA6IGRlc2NyaXB0aW9uLFxuICAgIHNwZWVkIDogc3BlZWQsXG4gICAgcmVwZXRpdGlvbk51bWJlciA6IHJlcGV0aXRpb25OdW1iZXIsXG4gICAgaURpdjppRGl2LFxuICAgIHVwZGF0ZUluZm8gOiB1cGRhdGVJbmZvXG4gIH07XG4gIFxuICBcbiAgZnVuY3Rpb24gY3JlYXRlQnRuRGVsZXRlKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvL2RlbGV0ZSBhcHBhcmFpdFxuICAgIHZhciBidXR0b25EZWxldGUgPSAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgYnV0dG9uRGVsZXRlLmlkID0gJ2lkQnRuRGVsZXRlJztcbiAgICBidXR0b25EZWxldGUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgYnV0dG9uRGVsZXRlLnR5cGUgPSBcImJ1dHRvblwiO1xuICAgIGJ1dHRvbkRlbGV0ZS5pbm5lckhUTUwgPSBcIkRlbGV0ZVwiO1xuICAgIGJ1dHRvbkRlbGV0ZS5zdHlsZS53aWR0aCA9IFwiMTAwcHhcIjtcbiAgICBkaXZJbmZvQ2FyZC5hcHBlbmRDaGlsZChidXR0b25EZWxldGUpO1xuICAgIGJ1dHRvbkRlbGV0ZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJyxmdW5jdGlvbihlKXtcbiAgICAgIFxuICAgICAgLy9UT0RPXG4gICAgICBjYXJkTWFuYWdlci5leGVjdXRlKG5ldyBEZWxldGVDYXJkQ29tbWFuZChjYXJkT2JqZWN0KSk7XG4gICAgICBkZWxldGVDYXJkKGNhcmRPYmplY3QpO1xuICAgIH0pO1xuICBcbiAgICBidXR0b25EZWxldGUuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLGZ1bmN0aW9uKGUpe1xuICAgICAgZGVsZXRlQ2FyZCgpO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBjYXJkT2JqZWN0O1xufVxuXG5cblxuICBcbiAgIl19