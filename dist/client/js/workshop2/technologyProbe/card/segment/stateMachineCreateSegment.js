"use strict";

var knobMin = document.getElementById("range-slider_handle-min");
var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var knobMax = document.getElementById("range-slider_handle-max");

//Option for the longpress and the speed of the video_current
var speedrate = 1;
//State for the creation of segment by Drag and drop
var StateDrag = {
  IDLE: 0,
  DOWN: 1,
  DRAG: 2,
  LONGPRESS: 3,
  STARTED: 4
};

var state = StateDrag.IDLE;

var timePositionStart = 0;
var timePositionStop = 0;
var positionStart = 0;
var positionStop = 0;

//Graphical object of feedback
var segmentFeedback = {
  width: "",
  startPostion: "",
  endPosition: "",
  startDurationVideo: "",
  endDurationVideo: "",
  displayed: false,
  divGraphicalObject: document.getElementById("segmentMinMax")
};

//if (!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {
if (knobMin != null) {
  //Mouse
  knobMin.addEventListener("mousedown", function (e) {
    switch (state) {
      case StateDrag.STARTED:
        {
          stopCreateSegment();
          break;
        }
      case StateDrag.IDLE:
        {
          knobMinClick(e);
          break;
        }
    }
  }, {
    passive: true
  });

  segmentFeedback.divGraphicalObject.addEventListener("mousedown", function (e) {
    switch (state) {
      case StateDrag.STARTED:
        {
          stopCreateSegment();
          break;
        }
    }
  }, {
    passive: true
  });

  //Mouse
  knobMin.addEventListener("touchend", function (e) {
    console.log("touchstart knob");

    switch (state) {
      case StateDrag.STARTED:
        {
          stopCreateSegment();
          break;
        }
      case StateDrag.IDLE:
        {
          knobMinClick(e);
          break;
        }
    }
  }, {
    passive: true
  });

  segmentFeedback.divGraphicalObject.addEventListener("touchstart", function (e) {
    switch (state) {
      case StateDrag.STARTED:
        {
          stopCreateSegment();
          break;
        }
    }
  }, {
    passive: true
  });
}

//Create Segment
function startCreateSegment() {

  knobMax.style.position = "absolute";
  knobMax.style.left = knobMin.style.left;
  knobMax.style.visibility = "visible";
  segmentFeedback.divGraphicalObject.style.visibility = "visible";

  //state  StateDrag.LONGPRESS;
  knobMin.style.setProperty('background', '--fourth-color');
  updateSegmentFeedback(true, knobMin.style.left, knobMax.style.left);
}

function stopCreateSegment() {
  console.log("stop create segment");
  video_current.ready(function () {
    this.off('timeupdate', showSegmentFeedback);
  });

  positionStop = knobMin.style.left;
  state = StateDrag.IDLE;
  var timerLifeSegment = window.setTimeout(function () {
    knobMax.style.visibility = "hidden";
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
    knobMin.style.setProperty("background", "var(--secondary-color)");
    window.clearTimeout(timerLifeSegment);

    timePositionStop = video_current.currentTime();

    //TODO regarder aussi le fait d'enlever le listener change sur le knobmin?
    //TODO voir ici la creation de carte pour la mettre au bon endroit, checker aussi startP et endP
    player.createNewCard(timePositionStart, timePositionStop, positionStart, positionStop, segmentFeedback.divGraphicalObject.style.width);
    play();
  }, 700);
}

var knobMinMove = function knobMinMove(e) {
  console.log("knobMinMove");
  switch (state) {
    case StateDrag.DOWN:
      {
        state = StateDrag.DRAG;
        //console.log(" draging etat down");
        updateKnobAndVideoWrapper(e);
        break;
      }
    case StateDrag.DRAG:
      {
        state = StateDrag.DRAG;
        updateKnobAndVideoWrapper(e);
        //console.log(" draging etat drag");
        break;
      }
    case StateDrag.LONGPRESS:
      {
        state = StateDrag.LONGPRESS;
        //console.log("state longpress with mouse move");
        updateKnobAndVideoWrapper(e);
        updateSegmentFeedback(true, knobMin.style.left, knobMax.style.left);
        break;
      }
  }
};

var knobMinClick = function knobMinClick(e) {
  //console.log("function - knobMinClick" );
  state = StateDrag.STARTED;
  //knobMin.style.left;
  startCreateSegment();
  //updateKnobAndVideoWrapper(e);
  //console.log("function - knobMinUpCallback appel pause l165 statemachine ");
  pause();
  timePositionStart = video_current.currentTime();
  positionStart = knobMin.style.left;
  video_current.ready(function () {
    this.on('timeupdate', showSegmentFeedback);
  });
  clearAllTimer();
};

function showSegmentFeedback() {
  updateSegmentFeedback(true, knobMin.style.left, knobMax.style.left);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXRlTWFjaGluZUNyZWF0ZVNlZ21lbnQuanMiXSwibmFtZXMiOlsia25vYk1pbiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyYW5nZVNsaWRlclRyYWNrIiwia25vYk1heCIsInNwZWVkcmF0ZSIsIlN0YXRlRHJhZyIsIklETEUiLCJET1dOIiwiRFJBRyIsIkxPTkdQUkVTUyIsIlNUQVJURUQiLCJzdGF0ZSIsInRpbWVQb3NpdGlvblN0YXJ0IiwidGltZVBvc2l0aW9uU3RvcCIsInBvc2l0aW9uU3RhcnQiLCJwb3NpdGlvblN0b3AiLCJzZWdtZW50RmVlZGJhY2siLCJ3aWR0aCIsInN0YXJ0UG9zdGlvbiIsImVuZFBvc2l0aW9uIiwic3RhcnREdXJhdGlvblZpZGVvIiwiZW5kRHVyYXRpb25WaWRlbyIsImRpc3BsYXllZCIsImRpdkdyYXBoaWNhbE9iamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwic3RvcENyZWF0ZVNlZ21lbnQiLCJrbm9iTWluQ2xpY2siLCJwYXNzaXZlIiwiY29uc29sZSIsImxvZyIsInN0YXJ0Q3JlYXRlU2VnbWVudCIsInN0eWxlIiwicG9zaXRpb24iLCJsZWZ0IiwidmlzaWJpbGl0eSIsInNldFByb3BlcnR5IiwidXBkYXRlU2VnbWVudEZlZWRiYWNrIiwidmlkZW9fY3VycmVudCIsInJlYWR5Iiwib2ZmIiwic2hvd1NlZ21lbnRGZWVkYmFjayIsInRpbWVyTGlmZVNlZ21lbnQiLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwiY3VycmVudFRpbWUiLCJwbGF5ZXIiLCJjcmVhdGVOZXdDYXJkIiwicGxheSIsImtub2JNaW5Nb3ZlIiwidXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciIsInBhdXNlIiwib24iLCJjbGVhckFsbFRpbWVyIl0sIm1hcHBpbmdzIjoiOztBQUNBLElBQUlBLFVBQVVDLFNBQVNDLGNBQVQsQ0FBd0IseUJBQXhCLENBQWQ7QUFDQSxJQUFJQyxtQkFBbUJGLFNBQVNDLGNB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UU4sVUFBVUksU0FBbEI7QUFDQTtBQUNBMEMsa0NBQTBCMUIsQ0FBMUI7QUFDQVksOEJBQXNCLElBQXRCLEVBQTRCdEMsUUFBUWlDLEtBQVIsQ0FBY0UsSUFBMUMsRUFBK0MvQixRQUFRNkIsS0FBUixDQUFjRSxJQUE3RDtBQUNBO0FBQ0Q7QUF0Qkg7QUF3QkQsQ0ExQkQ7O0FBNEJBLElBQUlQLGVBQWUsU0FBZkEsWUFBZSxDQUFTRixDQUFULEVBQVk7QUFDN0I7QUFDQWQsVUFBUU4sVUFBVUssT0FBbEI7QUFDQTtBQUNBcUI7QUFDQTtBQUNBO0FBQ0FxQjtBQUNBeEMsc0JBQW9CMEIsY0FBY1EsV0FBZCxFQUFwQjtBQUNBaEMsa0JBQWdCZixRQUFRaUMsS0FBUixDQUFjRSxJQUE5QjtBQUNBSSxnQkFBY0MsS0FBZCxDQUFvQixZQUFZO0FBQzlCLFNBQUtjLEVBQUwsQ0FBUSxZQUFSLEVBQXNCWixtQkFBdEI7QUFDRCxHQUZEO0FBR0FhO0FBQ0QsQ0FkRDs7QUFnQkEsU0FBU2IsbUJBQVQsR0FBK0I7QUFDN0JKLHdCQUFzQixJQUF0QixFQUEyQnRDLFFBQVFpQyxLQUFSLENBQWNFLElBQXpDLEVBQThDL0IsUUFBUTZCLEtBQVIsQ0FBY0UsSUFBNUQ7QUFDRCIsImZpbGUiOiJzdGF0ZU1hY2hpbmVDcmVhdGVTZWdtZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG52YXIga25vYk1pbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyX2hhbmRsZS1taW5cIik7XG52YXIgcmFuZ2VTbGlkZXJUcmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2VTbGlkZXJUcmFja1wiKTtcbnZhciBrbm9iTWF4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXJfaGFuZGxlLW1heFwiKTtcblxuXG4vL09wdGlvbiBmb3IgdGhlIGxvbmdwcmVzcyBhbmQgdGhlIHNwZWVkIG9mIHRoZSB2aWRlb19jdXJyZW50XG52YXIgc3BlZWRyYXRlID0gMTtcbi8vU3RhdGUgZm9yIHRoZSBjcmVhdGlvbiBvZiBzZWdtZW50IGJ5IERyYWcgYW5kIGRyb3BcbmxldCBTdGF0ZURyYWcgPSB7XG4gIElETEU6IDAsXG4gIERPV046IDEsXG4gIERSQUc6IDIsXG4gIExPTkdQUkVTUzogMyxcbiAgU1RBUlRFRDogNCxcbn07XG5cbnZhciBzdGF0ZSA9IFN0YXRlRHJhZy5JRExFO1xuXG52YXIgdGltZVBvc2l0aW9uU3RhcnQgPSAwO1xudmFyIHRpbWVQb3NpdGlvblN0b3AgPSAwO1xudmFyIHBvc2l0aW9uU3RhcnQgPSAwO1xudmFyIHBvc2l0aW9uU3RvcCA9IDA7XG5cblxuLy9HcmFwaGljYWwgb2JqZWN0IG9mIGZlZWRiYWNrXG52YXIgc2VnbWVudEZlZWRiYWNrID0ge1xuICB3aWR0aDogXCJcIixcbiAgc3RhcnRQb3N0aW9uOiBcIlwiLFxuICBlbmRQb3NpdGlvbjogXCJcIixcbiAgc3RhcnREdXJhdGlvblZpZGVvOiBcIlwiLFxuICBlbmREdXJhdGlvblZpZGVvOiBcIlwiLFxuICBkaXNwbGF5ZWQ6IGZhbHNlLFxuICBkaXZHcmFwaGljYWxPYmplY3Q6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VnbWVudE1pbk1heFwiKVxufTtcblxuXG4vL2lmICghbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQW5kcm9pZHxCbGFja0JlcnJ5fGlQaG9uZXxpUGFkfGlQb2R8T3BlcmEgTWluaXxJRU1vYmlsZS9pKSkge1xuICBpZihrbm9iTWluICE9IG51bGwpe1xuICAgIC8vTW91c2VcbiAgICBrbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICBjYXNlIFN0YXRlRHJhZy5TVEFSVEVEOntcbiAgICAgICAgICBzdG9wQ3JlYXRlU2VnbWVudCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgU3RhdGVEcmFnLklETEUgOiB7XG4gICAgICAgICAga25vYk1pbkNsaWNrKGUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICB9LCB7XG4gICAgICBwYXNzaXZlOiB0cnVlXG4gICAgfSk7XG4gIFxuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3QuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICAgIGNhc2UgU3RhdGVEcmFnLlNUQVJURUQ6e1xuICAgICAgICAgIHN0b3BDcmVhdGVTZWdtZW50KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgXG4gICAgfSwge1xuICAgICAgcGFzc2l2ZTogdHJ1ZVxuICAgIH0pO1xuICBcbiAgICAgIC8vTW91c2VcbiAgICAgIGtub2JNaW4uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ0b3VjaHN0YXJ0IGtub2JcIilcbiAgXG4gICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgICBjYXNlIFN0YXRlRHJhZy5TVEFSVEVEOntcbiAgICAgICAgICAgIHN0b3BDcmVhdGVTZWdtZW50KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBTdGF0ZURyYWcuSURMRSA6IHtcbiAgICAgICAgICAgIGtub2JNaW5DbGljayhlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXG4gICAgICB9LCB7XG4gICAgICAgIHBhc3NpdmU6IHRydWVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBzZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICAgIGNhc2UgU3RhdGVEcmFnLlNUQVJURUQ6e1xuICAgICAgICAgICAgc3RvcENyZWF0ZVNlZ21lbnQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXG4gICAgICB9LCB7XG4gICAgICAgIHBhc3NpdmU6IHRydWVcbiAgICAgIH0pO1xuICAgIFxuICAgIFxuICAgIFxuICAgIH1cblxuXG5cbi8vQ3JlYXRlIFNlZ21lbnRcbmZ1bmN0aW9uIHN0YXJ0Q3JlYXRlU2VnbWVudCgpIHtcbiAgXG4gIGtub2JNYXguc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gIGtub2JNYXguc3R5bGUubGVmdCA9IGtub2JNaW4uc3R5bGUubGVmdDtcbiAga25vYk1heC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICBcbiAgLy9zdGF0ZSAgU3RhdGVEcmFnLkxPTkdQUkVTUztcbiAga25vYk1pbi5zdHlsZS5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZCcsJy0tZm91cnRoLWNvbG9yJyk7XG4gIHVwZGF0ZVNlZ21lbnRGZWVkYmFjayh0cnVlLGtub2JNaW4uc3R5bGUubGVmdCxrbm9iTWF4LnN0eWxlLmxlZnQpO1xufVxuXG5mdW5jdGlvbiBzdG9wQ3JlYXRlU2VnbWVudCgpIHtcbiAgY29uc29sZS5sb2coXCJzdG9wIGNyZWF0ZSBzZWdtZW50XCIpO1xuICB2aWRlb19jdXJyZW50LnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm9mZigndGltZXVwZGF0ZScgLCBzaG93U2VnbWVudEZlZWRiYWNrKTtcbiAgfSk7XG4gIFxuICBwb3NpdGlvblN0b3AgPSBrbm9iTWluLnN0eWxlLmxlZnQ7XG4gIHN0YXRlID0gU3RhdGVEcmFnLklETEU7XG4gIGxldCB0aW1lckxpZmVTZWdtZW50ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAga25vYk1heC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICBzZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgIGtub2JNaW4uc3R5bGUuc2V0UHJvcGVydHkoXCJiYWNrZ3JvdW5kXCIsXCJ2YXIoLS1zZWNvbmRhcnktY29sb3IpXCIpO1xuICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZXJMaWZlU2VnbWVudCk7XG4gICAgXG4gICAgXG4gICAgIHRpbWVQb3NpdGlvblN0b3AgPSB2aWRlb19jdXJyZW50LmN1cnJlbnRUaW1lKCk7XG4gICAgXG4gICAgLy9UT0RPIHJlZ2FyZGVyIGF1c3NpIGxlIGZhaXQgZCdlbmxldmVyIGxlIGxpc3RlbmVyIGNoYW5nZSBzdXIgbGUga25vYm1pbj9cbiAgICAvL1RPRE8gdm9pciBpY2kgbGEgY3JlYXRpb24gZGUgY2FydGUgcG91ciBsYSBtZXR0cmUgYXUgYm9uIGVuZHJvaXQsIGNoZWNrZXIgYXVzc2kgc3RhcnRQIGV0IGVuZFBcbiAgICBwbGF5ZXIuY3JlYXRlTmV3Q2FyZCh0aW1lUG9zaXRpb25TdGFydCx0aW1lUG9zaXRpb25TdG9wLCBwb3NpdGlvblN0YXJ0LHBvc2l0aW9uU3RvcCxzZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLndpZHRoICApO1xuICAgIHBsYXkoKTtcbiAgfSwgNzAwKTtcbn1cblxudmFyIGtub2JNaW5Nb3ZlID0gZnVuY3Rpb24oZSkge1xuICBjb25zb2xlLmxvZyhcImtub2JNaW5Nb3ZlXCIpO1xuICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgY2FzZSBTdGF0ZURyYWcuRE9XTjpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5EUkFHO1xuICAgICAgLy9jb25zb2xlLmxvZyhcIiBkcmFnaW5nIGV0YXQgZG93blwiKTtcbiAgICAgIHVwZGF0ZUtub2JBbmRWaWRlb1dyYXBwZXIoZSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBTdGF0ZURyYWcuRFJBRzpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5EUkFHO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIC8vY29uc29sZS5sb2coXCIgZHJhZ2luZyBldGF0IGRyYWdcIik7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBTdGF0ZURyYWcuTE9OR1BSRVNTOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLkxPTkdQUkVTUztcbiAgICAgIC8vY29uc29sZS5sb2coXCJzdGF0ZSBsb25ncHJlc3Mgd2l0aCBtb3VzZSBtb3ZlXCIpO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIHVwZGF0ZVNlZ21lbnRGZWVkYmFjayh0cnVlLCBrbm9iTWluLnN0eWxlLmxlZnQsa25vYk1heC5zdHlsZS5sZWZ0KTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufTtcblxudmFyIGtub2JNaW5DbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy9jb25zb2xlLmxvZyhcImZ1bmN0aW9uIC0ga25vYk1pbkNsaWNrXCIgKTtcbiAgc3RhdGUgPSBTdGF0ZURyYWcuU1RBUlRFRDtcbiAgLy9rbm9iTWluLnN0eWxlLmxlZnQ7XG4gIHN0YXJ0Q3JlYXRlU2VnbWVudCgpO1xuICAvL3VwZGF0ZUtub2JBbmRWaWRlb1dyYXBwZXIoZSk7XG4gIC8vY29uc29sZS5sb2coXCJmdW5jdGlvbiAtIGtub2JNaW5VcENhbGxiYWNrIGFwcGVsIHBhdXNlIGwxNjUgc3RhdGVtYWNoaW5lIFwiKTtcbiAgcGF1c2UoKTtcbiAgdGltZVBvc2l0aW9uU3RhcnQgPSB2aWRlb19jdXJyZW50LmN1cnJlbnRUaW1lKCk7XG4gIHBvc2l0aW9uU3RhcnQgPSBrbm9iTWluLnN0eWxlLmxlZnQ7XG4gIHZpZGVvX2N1cnJlbnQucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub24oJ3RpbWV1cGRhdGUnLCBzaG93U2VnbWVudEZlZWRiYWNrKTtcbiAgfSk7XG4gIGNsZWFyQWxsVGltZXIoKTtcbn07XG5cbmZ1bmN0aW9uIHNob3dTZWdtZW50RmVlZGJhY2soKSB7XG4gIHVwZGF0ZVNlZ21lbnRGZWVkYmFjayh0cnVlLGtub2JNaW4uc3R5bGUubGVmdCxrbm9iTWF4LnN0eWxlLmxlZnQpXG59XG5cblxuXG4iXX0=