'use strict';

var numberOfCard = 0;
var arrayCard = [];

/**
 * This class manag all the cards created. This is the segment history.
 * @type {HTMLElement | null}
 */
var wrapperCommandAndRange = document.getElementById("wrapperCommandAndRangeid");

//TODO Save and load button, do no delete
/*saveLogBtn.addEventListener("touchend",function (e) {
  console.log("saving log");
  arrayCard.forEach(function (arrayItem) {
   // arrayItem.updateInfo();
    //arrayItem.
  });
  exportCardsJSon();
  textSaveLog.innerText = "Log saved!" ;
});

loadLogBtn.onclick = function () {
  loadJSON(null);
};

loadLogBtn.addEventListener("mouseup",function (e) {
  //console.log("AAAAAA");
  //var mydata = JSON.parse(data);
  //console.log( loadLogBtn.value);
});



function loadJSON(callback) {
  var request = new XMLHttpRequest();
  request.open("GET", "/public/logW2Json/ipad1.json", false);
  request.send(null);
  //console.log("request : "+ request.responseText);
  var my_JSON_object = JSON.parse(request.responseText);
  
  console.log(my_JSON_object);
  
  for( let k = 0 ; k <  my_JSON_object.length ; k ++){
    addingNewCardsFromJSon(my_JSON_object[k]);
  }
}/*



//dragElement(document.getElementById("card1"));

/*
addCard.addEventListener('click', function (e) {
  addingNewCard();
});*/

//Add a card from a json file
function addingNewCardsFromJSon(cardInfo) {
  if (cardInfo.startP > cardInfo.endP) {
    var transit = cardInfo.startP;
    cardInfo.startP = cardInfo.endP;
    cardInfo.endP = transit;
  }
  if (cardInfo.startP < 0) {
    cardInfo.startP = 0;
  }
  var result = sliderToVideo(cardInfo.startP, cardInfo.endP);
  console.log(result);
  numberOfCard++;
  if (!cardInfo.deleted) {
    var card = Card(result.startDuration, result.endDuration, cardInfo.startP, cardInfo.endP, cardInfo);
    arrayCard.push(card);
    document.getElementById('divCardBoard').insertBefore(card.iDiv, document.getElementById('divCardBoard').firstChild);
  }
}

/**
 * Adding a card by drag and drop. The card is added in the list of cards
 */
function addingNewCard(startP, endP) {
  if (startP > endP) {
    var transit = startP;
    startP = endP;
    endP = transit;
  }
  var result = sliderToVideo(startP, endP);
  numberOfCard++;
  //console.log("wrapperCommandAndRange : " + window.getComputedStyle(wrapperCommandAndRange).);
  var card = new Card(result.startDuration, result.endDuration, startP, endP);
  arrayCard.push(card);
  document.getElementById('divCardBoard').insertBefore(card.iDiv, document.getElementById('divCardBoard').firstChild);

  /*
    //var card =  Card.cardConstructor(result.startDuration, result.endDuration,startP,endP);
    arrayCard.push(card);
    let result2 = sliderToVideo(10,20);
    var card =  Card.cardConstructor(result2.startDuration,result2.endDuration,10,20);
    let result3 = sliderToVideo(15,25);
    var card =  Card.cardConstructor(result3.startDuration,result3.endDuration,15,25);*/
}

/*------ Export card in a JSON file  -------*/
//TODO
var exportCard = function exportCard() {
  var arrayItemUpdated = [];
  arrayCard.forEach(function (arrayItem) {
    //arrayItem.updateInfo();
    var item = arrayItem.updateInfo();
    arrayItemUpdated.push(item);
    console.log(item);
  });
  var serializedArr = JSON.stringify([arrayItemUpdated, numberOfCard]);
  console.log("Serialisation of card complete : " + serializedArr);
  download(serializedArr, 'jsonW2log-' + createUniqueId() + '.txt', 'text/plain');

  function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], { type: contentType });
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmRNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIm51bWJlck9mQ2FyZCIsImFycmF5Q2FyZCIsIndyYXBwZXJDb21tYW5kQW5kUmFuZ2UiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiYWRkaW5nTmV3Q2FyZHNGcm9tSlNvbiIsImNhcmRJbmZvIiwic3RhcnRQIiwiZW5kUCIsInRyYW5zaXQiLCJyZXN1bHQiLCJzbGlkZXJUb1ZpZGVvIiwiY29uc29sZSIsImxvZyIsImRlbGV0ZWQiLCJjYXJkIiwiQ2FyZCIsInN0YXJ0RHVyYXRpb24iLCJlbmREdXJhdGlvbiIsInB1c2giLCJpbnNlcnRCZWZvcmUiLCJpRGl2IiwiZmlyc3RDaGlsZCIsImFkZGluZ05ld0NhcmQiLCJleHBvcnRDYXJkIiwiYXJyYXlJdGVtVXBkYXRlZCIsImZvckVhY2giLCJhcnJheUl0ZW0iLCJpdGVtIiwidXBkYXRlSW5mbyIsInNlcmlhbGl6ZWRBcnIiLCJKU09OIiwic3RyaW5naWZ5IiwiZG93bmxvYWQiLCJjcmVhdGVVbmlxdWVJZCIsImNvbnRlbnQiLCJmaWxlTmFtZSIsImNvbnRlbnRUeXBlIiwiYSIsImNyZWF0ZUVsZW1lbnQiLCJmaWxlIiwiQmxvYiIsInR5cGUiLCJocmVmIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiY2xpY2siXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsZUFBZSxDQUFuQjtBQUNBLElBQUlDLFlBQVksRUFBaEI7O0FBRUE7Ozs7QUFJQSxJQUFJQyx5QkFBeUJDLFNBQVNDLGNBQVQsQ0FBd0IsMEJBQXhCLENBQTdCOztBQUVBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZDQTtBQUNBLFNBQVNDLHNCQUFULENBQWdDQyxRQUFoQyxFQUF5QztBQUN2QyxNQUFHQSxTQUFTQyxNQUFULEdBQWtCRCxTQUFTRSxJQUE5QixFQUFtQztBQUNqQyxRQUFJQyxVQUFVSCxTQUFTQyxNQUF2QjtBQUNBRCxhQUFTQyxNQUFULEdBQWtCRCxTQUFTRSxJQUEzQjtBQUNBRixhQUFTRSxJQUFULEdBQWdCQyxPQUFoQjtBQUNEO0FBQ0QsTUFBR0gsU0FBU0MsTUFBVCxHQUFrQixDQUFyQixFQUF3QjtBQUN0QkQsYUFBU0MsTUFBVCxHQUFrQixDQUFsQjtBQUNEO0FBQ0QsTUFBSUcsU0FBU0MsY0FBY0wsU0FBU0MsTUFBdkIsRUFBOEJELFNBQVNFLElBQXZDLENBQWI7QUFDQUksVUFBUUMsR0FBUixDQUFZSCxNQUFaO0FBQ0FWO0FBQ0EsTUFBRyxDQUFDTSxTQUFTUSxPQUFiLEVBQXFCO0FBQ25CLFFBQUlDLE9BQVFDLEtBQUtOLE9BQU9PLGFBQVosRUFBMkJQLE9BQU9RLFdBQWxDLEVBQThDWixTQUFTQyxNQUF2RCxFQUE4REQsU0FBU0UsSUFBdkUsRUFBNEVGLFFBQTVFLENBQVo7QUFDQUwsY0FBVWtCLElBQVYsQ0FBZ0JKLElBQWhCO0FBQ0FaLGFBQVNDLGNBQVQsQ0FBd0IsY0FBeEIsRUFBd0NnQixZQUF4QyxDQUFxREwsS0FBS00sSUFBMUQsRUFBZ0VsQixTQUFTQyxjQUFULENBQXdCLGNBQXhCLEVBQXdDa0IsVUFBeEc7QUFDRDtBQUVGOztBQUVEOzs7QUFHQSxTQUFTQyxhQUFULENBQXVCaEIsTUFBdkIsRUFBOEJDLElBQTlCLEVBQW9DO0FBQ2xDLE1BQUdELFNBQVNDLElBQVosRUFBaUI7QUFDZixRQUFJQyxVQUFVRixNQUFkO0FBQ0FBLGFBQVNDLElBQVQ7QUFDQUEsV0FBT0MsT0FBUDtBQUNEO0FBQ0QsTUFBSUMsU0FBU0MsY0FBY0osTUFBZCxFQUFxQkMsSUFBckIsQ0FBYjtBQUNBUjtBQUNBO0FBQ0EsTUFBSWUsT0FBTyxJQUFJQyxJQUFKLENBQVNOLE9BQU9PLGFBQWhCLEVBQStCUCxPQUFPUSxXQUF0QyxFQUFrRFgsTUFBbEQsRUFBeURDLElBQXpELENBQVg7QUFDQVAsWUFBVWtCLElBQVYsQ0FBZ0JKLElBQWhCO0FBQ0FaLFdBQVNDLGNBQVQsQ0FBd0IsY0FBeEIsRUFBd0NnQixZQUF4QyxDQUFxREwsS0FBS00sSUFBMUQsRUFBZ0VsQixTQUFTQyxjQUFULENBQXdCLGNBQXhCLEVBQXdDa0IsVUFBeEc7O0FBRUY7Ozs7Ozs7QUFPQzs7QUFFRDtBQUNBO0FBQ0EsSUFBSUUsYUFBYSxTQUFiQSxVQUFhLEdBQVU7QUFDekIsTUFBSUMsbUJBQW1CLEVBQXZCO0FBQ0F4QixZQUFVeUIsT0FBVixDQUFrQixVQUFVQyxTQUFWLEVBQXFCO0FBQ3BDO0FBQ0QsUUFBSUMsT0FBT0QsVUFBVUUsVUFBVixFQUFYO0FBQ0FKLHFCQUFpQk4sSUFBakIsQ0FBc0JTLElBQXRCO0FBQ0FoQixZQUFRQyxHQUFSLENBQVllLElBQVo7QUFDRCxHQUxEO0FBTUEsTUFBSUUsZ0JBQWdCQyxLQUFLQyxTQUFMLENBQWdCLENBQUNQLGdCQUFELEVBQW1CekIsWUFBbkIsQ0FBaEIsQ0FBcEI7QUFDQVksVUFBUUMsR0FBUixDQUFZLHNDQUFzQ2lCLGFBQWxEO0FBQ0FHLFdBQVNILGFBQVQsRUFBd0IsZUFBYUksZ0JBQWIsR0FBOEIsTUFBdEQsRUFBOEQsWUFBOUQ7O0FBRUEsV0FBU0QsUUFBVCxDQUFrQkUsT0FBbEIsRUFBMkJDLFFBQTNCLEVBQXFDQyxXQUFyQyxFQUFrRDtBQUNoRCxRQUFJQyxJQUFJbkMsU0FBU29DLGFBQVQsQ0FBdUIsR0FBdkIsQ0FBUjtBQUNBLFFBQUlDLE9BQU8sSUFBSUMsSUFBSixDQUFTLENBQUNOLE9BQUQsQ0FBVCxFQUFvQixFQUFDTyxNQUFNTCxXQUFQLEVBQXBCLENBQVg7QUFDQUMsTUFBRUssSUFBRixHQUFTQyxJQUFJQyxlQUFKLENBQW9CTCxJQUFwQixDQUFUO0FBQ0FGLE1BQUVMLFFBQUYsR0FBYUcsUUFBYjtBQUNBRSxNQUFFUSxLQUFGO0FBQ0Q7QUFDRixDQW5CRCIsImZpbGUiOiJjYXJkTWFuYWdlci5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBudW1iZXJPZkNhcmQgPSAwO1xudmFyIGFycmF5Q2FyZCA9IFtdO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgbWFuYWcgYWxsIHRoZSBjYXJkcyBjcmVhdGVkLiBUaGlzIGlzIHRoZSBzZWdtZW50IGhpc3RvcnkuXG4gKiBAdHlwZSB7SFRNTEVsZW1lbnQgfCBudWxsfVxuICovXG52YXIgd3JhcHBlckNvbW1hbmRBbmRSYW5nZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkXCIpO1xuXG4vL1RPRE8gU2F2ZSBhbmQgbG9hZCBidXR0b24sIGRvIG5vIGRlbGV0ZVxuLypzYXZlTG9nQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLGZ1bmN0aW9uIChlKSB7XG4gIGNvbnNvbGUubG9nKFwic2F2aW5nIGxvZ1wiKTtcbiAgYXJyYXlDYXJkLmZvckVhY2goZnVuY3Rpb24gKGFycmF5SXRlbSkge1xuICAgLy8gYXJyYXlJdGVtLnVwZGF0ZUluZm8oKTtcbiAgICAvL2FycmF5SXRlbS5cbiAgfSk7XG4gIGV4cG9ydENhcmRzSlNvbigpO1xuICB0ZXh0U2F2ZUxvZy5pbm5lclRleHQgPSBcIkxvZyBzYXZlZCFcIiA7XG59KTtcblxubG9hZExvZ0J0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICBsb2FkSlNPTihudWxsKTtcbn07XG5cbmxvYWRMb2dCdG4uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIixmdW5jdGlvbiAoZSkge1xuICAvL2NvbnNvbGUubG9nKFwiQUFBQUFBXCIpO1xuICAvL3ZhciBteWRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAvL2NvbnNvbGUubG9nKCBsb2FkTG9nQnRuLnZhbHVlKTtcbn0pO1xuXG5cblxuZnVuY3Rpb24gbG9hZEpTT04oY2FsbGJhY2spIHtcbiAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIFwiL3B1YmxpYy9sb2dXMkpzb24vaXBhZDEuanNvblwiLCBmYWxzZSk7XG4gIHJlcXVlc3Quc2VuZChudWxsKTtcbiAgLy9jb25zb2xlLmxvZyhcInJlcXVlc3QgOiBcIisgcmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICB2YXIgbXlfSlNPTl9vYmplY3QgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTtcbiAgXG4gIGNvbnNvbGUubG9nKG15X0pTT05fb2JqZWN0KTtcbiAgXG4gIGZvciggbGV0IGsgPSAwIDsgayA8ICBteV9KU09OX29iamVjdC5sZW5ndGggOyBrICsrKXtcbiAgICBhZGRpbmdOZXdDYXJkc0Zyb21KU29uKG15X0pTT05fb2JqZWN0W2tdKTtcbiAgfVxufS8qXG5cblxuXG4vL2RyYWdFbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FyZDFcIikpO1xuXG4vKlxuYWRkQ2FyZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gIGFkZGluZ05ld0NhcmQoKTtcbn0pOyovXG5cbi8vQWRkIGEgY2FyZCBmcm9tIGEganNvbiBmaWxlXG5mdW5jdGlvbiBhZGRpbmdOZXdDYXJkc0Zyb21KU29uKGNhcmRJbmZvKXtcbiAgaWYoY2FyZEluZm8uc3RhcnRQID4gY2FyZEluZm8uZW5kUCl7XG4gICAgbGV0IHRyYW5zaXQgPSBjYXJkSW5mby5zdGFydFA7XG4gICAgY2FyZEluZm8uc3RhcnRQID0gY2FyZEluZm8uZW5kUDtcbiAgICBjYXJkSW5mby5lbmRQID0gdHJhbnNpdDtcbiAgfVxuICBpZihjYXJkSW5mby5zdGFydFAgPCAwICl7XG4gICAgY2FyZEluZm8uc3RhcnRQID0gMDtcbiAgfVxuICBsZXQgcmVzdWx0ID0gc2xpZGVyVG9WaWRlbyhjYXJkSW5mby5zdGFydFAsY2FyZEluZm8uZW5kUCk7XG4gIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gIG51bWJlck9mQ2FyZCsrO1xuICBpZighY2FyZEluZm8uZGVsZXRlZCl7XG4gICAgdmFyIGNhcmQgPSAgQ2FyZChyZXN1bHQuc3RhcnREdXJhdGlvbiwgcmVzdWx0LmVuZER1cmF0aW9uLGNhcmRJbmZvLnN0YXJ0UCxjYXJkSW5mby5lbmRQLGNhcmRJbmZvKTtcbiAgICBhcnJheUNhcmQucHVzaCggY2FyZCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpdkNhcmRCb2FyZCcpLmluc2VydEJlZm9yZShjYXJkLmlEaXYsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXZDYXJkQm9hcmQnKS5maXJzdENoaWxkKTtcbiAgfVxuIFxufVxuXG4vKipcbiAqIEFkZGluZyBhIGNhcmQgYnkgZHJhZyBhbmQgZHJvcC4gVGhlIGNhcmQgaXMgYWRkZWQgaW4gdGhlIGxpc3Qgb2YgY2FyZHNcbiAqL1xuZnVuY3Rpb24gYWRkaW5nTmV3Q2FyZChzdGFydFAsZW5kUCkge1xuICBpZihzdGFydFAgPiBlbmRQKXtcbiAgICBsZXQgdHJhbnNpdCA9IHN0YXJ0UDtcbiAgICBzdGFydFAgPSBlbmRQO1xuICAgIGVuZFAgPSB0cmFuc2l0O1xuICB9XG4gIGxldCByZXN1bHQgPSBzbGlkZXJUb1ZpZGVvKHN0YXJ0UCxlbmRQKTtcbiAgbnVtYmVyT2ZDYXJkKys7XG4gIC8vY29uc29sZS5sb2coXCJ3cmFwcGVyQ29tbWFuZEFuZFJhbmdlIDogXCIgKyB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh3cmFwcGVyQ29tbWFuZEFuZFJhbmdlKS4pO1xuICB2YXIgY2FyZCA9IG5ldyBDYXJkKHJlc3VsdC5zdGFydER1cmF0aW9uLCByZXN1bHQuZW5kRHVyYXRpb24sc3RhcnRQLGVuZFApO1xuICBhcnJheUNhcmQucHVzaCggY2FyZCk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXZDYXJkQm9hcmQnKS5pbnNlcnRCZWZvcmUoY2FyZC5pRGl2LCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGl2Q2FyZEJvYXJkJykuZmlyc3RDaGlsZCk7XG4gIFxuLypcbiAgLy92YXIgY2FyZCA9ICBDYXJkLmNhcmRDb25zdHJ1Y3RvcihyZXN1bHQuc3RhcnREdXJhdGlvbiwgcmVzdWx0LmVuZER1cmF0aW9uLHN0YXJ0UCxlbmRQKTtcbiAgYXJyYXlDYXJkLnB1c2goY2FyZCk7XG4gIGxldCByZXN1bHQyID0gc2xpZGVyVG9WaWRlbygxMCwyMCk7XG4gIHZhciBjYXJkID0gIENhcmQuY2FyZENvbnN0cnVjdG9yKHJlc3VsdDIuc3RhcnREdXJhdGlvbixyZXN1bHQyLmVuZER1cmF0aW9uLDEwLDIwKTtcbiAgbGV0IHJlc3VsdDMgPSBzbGlkZXJUb1ZpZGVvKDE1LDI1KTtcbiAgdmFyIGNhcmQgPSAgQ2FyZC5jYXJkQ29uc3RydWN0b3IocmVzdWx0My5zdGFydER1cmF0aW9uLHJlc3VsdDMuZW5kRHVyYXRpb24sMTUsMjUpOyovXG59XG5cbi8qLS0tLS0tIEV4cG9ydCBjYXJkIGluIGEgSlNPTiBmaWxlICAtLS0tLS0tKi9cbi8vVE9ET1xudmFyIGV4cG9ydENhcmQgPSBmdW5jdGlvbigpe1xuICB2YXIgYXJyYXlJdGVtVXBkYXRlZCA9IFtdO1xuICBhcnJheUNhcmQuZm9yRWFjaChmdW5jdGlvbiAoYXJyYXlJdGVtKSB7XG4gICAgIC8vYXJyYXlJdGVtLnVwZGF0ZUluZm8oKTtcbiAgICB2YXIgaXRlbSA9IGFycmF5SXRlbS51cGRhdGVJbmZvKCk7XG4gICAgYXJyYXlJdGVtVXBkYXRlZC5wdXNoKGl0ZW0pO1xuICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xuICB9KTtcbiAgdmFyIHNlcmlhbGl6ZWRBcnIgPSBKU09OLnN0cmluZ2lmeSggW2FycmF5SXRlbVVwZGF0ZWQsIG51bWJlck9mQ2FyZF0gKTtcbiAgY29uc29sZS5sb2coXCJTZXJpYWxpc2F0aW9uIG9mIGNhcmQgY29tcGxldGUgOiBcIiArIHNlcmlhbGl6ZWRBcnIpO1xuICBkb3dubG9hZChzZXJpYWxpemVkQXJyLCAnanNvblcybG9nLScrY3JlYXRlVW5pcXVlSWQoKSsnLnR4dCcsICd0ZXh0L3BsYWluJyk7XG4gIFxuICBmdW5jdGlvbiBkb3dubG9hZChjb250ZW50LCBmaWxlTmFtZSwgY29udGVudFR5cGUpIHtcbiAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIHZhciBmaWxlID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7dHlwZTogY29udGVudFR5cGV9KTtcbiAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpO1xuICAgIGEuZG93bmxvYWQgPSBmaWxlTmFtZTtcbiAgICBhLmNsaWNrKCk7XG4gIH1cbn07XG5cbiJdfQ==