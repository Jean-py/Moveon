"use strict";

//Graphical object
var video = document.getElementById("videoEAT");
var wrapperCommandAndRange = document.getElementById("wrapperCommandAndRangeid");
var knobMin = document.getElementById("range-slider_handle-min");
var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var knobMax = document.getElementById("range-slider_handle-max");
var wrapperRangerSlider = document.getElementById("range-slider-wrapper");

//Card manager to create and delete card
var cardManager = new CardManager();

//Option for the longpress and the speed of the video
var speedrate = 1;
var longPressDelay = "500";

//State for the creation of segment by Drag and drop
var StateDrag = {
  IDLE: 0,
  DOWN: 1,
  DRAG: 2,
  LONGPRESS: 3
};
var state = StateDrag.IDLE;

//Graphical object of feedback
var segmentFeedback = {
  width: "",
  startPostion: "",
  endPosition: "",
  startDurationVideo: "",
  endDurationVideo: "",
  displayed: false,
  divGraphicalObject: document.getElementById("segmentMinMax")
};

if (!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {

  //Mouse
  knobMin.addEventListener("mouseup", function (e) {
    knobMinUpCallback(e);
  }, {
    passive: true
  });
  knobMin.addEventListener("mousedown", function (e) {
    knobMinClick(e);
  }, {
    passive: true
  });
  knobMin.addEventListener("mousemove", function (e) {
    knobMinMove(e);
  }, {
    passive: true
  });
  rangeSliderTrack.addEventListener("mousedown", function (e) {
    ranglerSliderTrackClick(e);
  }, {
    passive: true
  });
  rangeSliderTrack.addEventListener("mouseUp", function (e) {
    rangeSliderTrackEndCallback(e);
  }, {
    passive: true
  });
  rangeSliderTrack.addEventListener("mousemove", function (e) {
    knobMinMove(e);
  }, {
    passive: true
  });

  wrapperRangerSlider.addEventListener("mousemove", function (e) {
    knobMinMove(e);
  }, true);

  wrapperRangerSlider.addEventListener("mouseup", function (e) {
    rangeSliderTrackEndCallback(e);
  }, true);
} else {
  //Touch
  knobMin.addEventListener("touchstart", function (e) {
    knobMinClick(e);
  }, {
    passive: true
  });
  knobMin.addEventListener("touchmove", function (e) {
    knobMinMove(e);
  }, {
    passive: true
  });
  knobMin.addEventListener("touchend", function (e) {
    knobMinUpCallback(e);
  }, {
    passive: true
  });
  rangeSliderTrack.addEventListener("touchstart", function (e) {
    ranglerSliderTrackClick(e);
  }, {
    passive: true
  });
  rangeSliderTrack.addEventListener("touchend", function (e) {
    rangeSliderTrackEndCallback(e);
  }, {
    passive: true
  });
  video.addEventListener("touchmove", function (e) {
    videoTouchMoveCallback(e);
  }, {
    passive: true
  });
}

/*window.addEventListener("mouseup", function(e){
  rangeSliderTrackEndCallback(e);
}, false);
window.addEventListener("mousemove", function(e){
  knobMinMove(e);
},true );*/

/*-----MOUSE LONG PRESS-------*/

knobMin.setAttribute("data-long-press-delay", longPressDelay);
knobMin.addEventListener('long-press', function (e) {
  // console.log('knobMin.addEventListener(longpress');
  pause();
  longpressCreateSegmentCallback(e);
});
rangeSliderTrack.addEventListener("long-press", function (e) {
  // console.log('rangeSliderTrack.addEventListener(longpress');

  pause();
  longpressCreateSegmentCallback(e);
}, false);

/*Callback function*/
var longpressCreateSegmentCallback = function longpressCreateSegmentCallback(e) {
  e.preventDefault();
  //console.log('state : ' + state +'', 'background: #222; color: #bada55');

  switch (state) {
    case StateDrag.DOWN:
      {
        state = StateDrag.LONGPRESS;
        //pause();
        startCreateSegment(e, video.currentTime);
        break;
      }

  }
  //event.preventDefault();
};

var videoTouchMoveCallback = function videoTouchMoveCallback(e) {
  switch (state) {
    case StateDrag.IDLE:
      {
        state = StateDrag.DRAG;
        break;
      }
  }
};

var ranglerSliderTrackClick = function ranglerSliderTrackClick(e) {
  //  console.log("ranglerSliderTrackClick state : " + state);
  // pause();
  switch (state) {
    case StateDrag.IDLE:
      {
        state = StateDrag.DOWN;
        console.log("ici");
        clearAllTimer();
        updateKnobAndVideoWrapper(e);
        feedbackOnSliderVideo(false);
        break;
      }
  }
  //console.log("function - ranglerSliderTrackClick appel play l147 statemachine ");
  play();
};

var knobMinUpCallback = function knobMinUpCallback(e) {
  //console.log("***knobMinUpCallback *** "+ state);
  switch (state) {
    case StateDrag.IDLE:
      {
        state = StateDrag.IDLE;
        //console.log("function - knobMinUpCallback appel play ");
        //play();
        break;
      }
    case StateDrag.LONGPRESS:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        stopCreateSegment(e, video.currentTime);
        //console.log("function - knobMinUpCallback appel pause l164 statemachine ");
        play();
        break;
      }
    case StateDrag.DRAG:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        //console.log("function - knobMinUpCallback appel pause l165 statemachine ");
        pause();
        break;
      }
    case StateDrag.DOWN:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        //console.log("function - knobMinUpCallback appel pause l172 statemachine ");
        pause();
        break;
      }
  }

  //event.preventDefault();
};

//Create Segment
function startCreateSegment(e, startSegment) {

  knobMax.style.left = knobMin.style.left;
  knobMax.style.position = "absolute";
  //state  StateDrag.LONGPRESS;
  knobMin.style.background = '#213F8D';
  knobMax.style.visibility = "visible";
  updateSegmentFeedback();
}

function stopCreateSegment(e, stopSegment) {
  var timerLifeSegment = window.setTimeout(function () {
    knobMax.style.visibility = "hidden";
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
    knobMin.style.background = '#ffffff';
    //createCard();
    window.clearTimeout(timerLifeSegment);
    //console.log("AAA : " + parseInt(knobMax.style.left,10));


    var startP = parseInt(knobMax.style.left, 10) + WIDTH_MID_KNOB_MIN / 2;
    var endP = parseInt(knobMin.style.left, 10) + WIDTH_MID_KNOB_MIN / 2;

    // cardManager.execute(new CreateNewCardCommand(startP, endP));
    createNewCard(startP, endP);
    play();
  }, 700);
}

//Update the feedback of the creation of a segment after a long press
function updateSegmentFeedback() {
  if (parseInt(knobMin.style.left, 10) > parseInt(knobMax.style.left, 10)) {
    segmentFeedback.divGraphicalObject.style.marginLeft = knobMax.style.left;
  } else {
    segmentFeedback.divGraphicalObject.style.marginLeft = knobMin.style.left;
  }
  segmentFeedback.divGraphicalObject.style.visibility = "visible";
  segmentFeedback.divGraphicalObject.style.width = Math.abs(parseInt(knobMin.style.left, 10) - parseInt(knobMax.style.left, 10)) + "px";
}

//start position on the slider and end position on the slider
function sliderToVideo(startP, endP) {
  var startDuration = Math.round(startP * video.duration / NUMBER_OF_TICK);
  var endDuration = Math.round(endP * video.duration / NUMBER_OF_TICK);
  return {
    startDuration: startDuration,
    endDuration: endDuration
  };
}

//start position on the slider and end position on the slider
function videoToSlider(startDurationVideo, endDurationVideo) {

  var startP = Math.round(startDurationVideo * NUMBER_OF_TICK / video.duration - rangeSliderTrack.offsetLeft);
  var endP = Math.round(endDurationVideo * NUMBER_OF_TICK / video.duration - rangeSliderTrack.offsetLeft);
  return {
    startPosition: startP,
    endPosition: endP
  };
}

var knobMinMove = function knobMinMove(e) {
  switch (state) {
    case StateDrag.DOWN:
      {
        state = StateDrag.DRAG;
        //console.log(" draging etat down");
        updateKnobAndVideoWrapper(e);
        break;
      }
    case StateDrag.DRAG:
      {
        state = StateDrag.DRAG;
        updateKnobAndVideoWrapper(e);
        //console.log(" draging etat drag");
        break;
      }
    case StateDrag.LONGPRESS:
      {
        state = StateDrag.LONGPRESS;
        //console.log("state longpress with mouse move");
        updateKnobAndVideoWrapper(e);
        updateSegmentFeedback();
        break;
      }
  }
};

var knobMinClick = function knobMinClick(e) {
  //console.log("function - knobMinClick" );
  pause();
  //Update video position
  switch (state) {
    case StateDrag.IDLE:
      {
        state = StateDrag.DOWN;
        clearAllTimer();
        break;
      }
  }
  //e.preventDefault();
};

var rangeSliderTrackEndCallback = function rangeSliderTrackEndCallback(e) {
  //console.log("");
  //console.log("mouse up , etat : " + state);
  // console.log("rangeSliderTrackEndCallback : " + state);
  switch (state) {
    case StateDrag.DOWN:
      {
        state = StateDrag.IDLE;
        break;
      }
    case StateDrag.DRAG:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        // console.log("function - rangeSliderTrackEndCallback l285 state machine");
        pause();
        break;
      }
    case StateDrag.LONGPRESS:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        stopCreateSegment(e, video.currentTime);
        break;
      }

  }
  //event.preventDefault();
};

var knobMinMouseLeaveCallback = function knobMinMouseLeaveCallback(e) {
  switch (state) {
    case StateDrag.DOWN:
      {
        state = StateDrag.DRAG;
        break;
      }
    case StateDrag.DRAG:
      {
        state = StateDrag.DRAG;
        updateKnobAndVideoWrapper(e);
        break;
      }
    case StateDrag.LONGPRESS:
      {
        state = StateDrag.IDLE;
        updateKnobAndVideoWrapper(e);
        stopCreateSegment(e, video.currentTime);
        break;
      }

  }
  //event.preventDefault();
};

/*
function feedbackOnSliderVideo(onOff){
  //segmentFeedback.width = iDiv.style.width;
  //segmentFeedback.startPostion = iDiv.style.left;
  //segmentFeedback.width = parseInt(width);
  //segmentFeedback.startPostion= parseInt(startP);
  segmentFeedback.endPosition = parseInt(segmentFeedback.startPostion) + parseInt(segmentFeedback.width);
  var sliderToV = sliderToVideo( segmentFeedback.startPostion, segmentFeedback.endPosition);
  segmentFeedback.startDurationVideo = sliderToV.startDuration;
  segmentFeedback.endDurationVideo = sliderToV.endDuration;
  segmentFeedback.displayed = onOff;
  if(onOff){
    //segmentFeedback.divGraphicalObject.style.marginLeft = segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.marginLeft = parseInt(segmentFeedback.startPostion) - 5 +"px";//  segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.visibility = "visible";
    segmentFeedback.divGraphicalObject.style.width =  segmentFeedback.width;
  } else {
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
  }
};
*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXRlTWFjaGluZUNyZWF0ZVNlZ21lbnQuanMiXSwibmFtZXMiOlsidmlkZW8iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZSIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwia25vYk1heCIsIndyYXBwZXJSYW5nZXJTbGlkZXIiLCJjYXJkTWFuYWdlciIsIkNhcmRNYW5hZ2VyIiwic3BlZWRyYXRlIiwibG9uZ1ByZXNzRGVsYXkiLCJTdGF0ZURyYWciLCJJRExFIiwiRE9XTiIsIkRSQUciLCJMT05HUFJFU1MiLCJzdGF0ZSIsInNlZ21lbnRGZWVkYmFjayIsIndpZHRoIiwic3RhcnRQb3N0aW9uIiwiZW5kUG9zaXRpb24iLCJzdGFydER1cmF0aW9uVmlkZW8iLCJlbmREdXJhdGlvblZpZGVvIiwiZGlzcGxheWVkIiwiZGl2R3JhcGhpY2FsT2JqZWN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwibWF0Y2giLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImtub2JNaW5VcENhbGxiYWNrIiwicGFzc2l2ZSIsImtub2JNaW5DbGljayIsImtub2JNaW5Nb3ZlIiwicmFuZ2xlclNsaWRlclRyYWNrQ2xpY2siLCJyYW5nZVNsaWRlclRyYWNrRW5kQ2FsbGJhY2siLCJ2aWRlb1RvdWNoTW92ZUNhbGxiYWNrIiwic2V0QXR0cmlidXRlIiwicGF1c2UiLCJsb25ncHJlc3NDcmVhdGVTZWdtZW50Q2FsbGJhY2siLCJwcmV2ZW50RGVmYXVsdCIsInN0YXJ0Q3JlYXRlU2VnbWVudCIsImN1cnJlbnRUaW1lIiwiY29uc29sZSIsImxvZyIsImNsZWFyQWxsVGltZXIiLCJ1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyIiwiZmVlZGJhY2tPblNsaWRlclZpZGVvIiwicGxheSIsInN0b3BDcmVhdGVTZWdtZW50Iiwic3RhcnRTZWdtZW50Iiwic3R5bGUiLCJsZWZ0IiwicG9zaXRpb24iLCJiYWNrZ3JvdW5kIiwidmlzaWJpbGl0eSIsInVwZGF0ZVNlZ21lbnRGZWVkYmFjayIsInN0b3BTZWdtZW50IiwidGltZXJMaWZlU2VnbWVudCIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJzdGFydFAiLCJwYXJzZUludCIsIldJRFRIX01JRF9LTk9CX01JTiIsImVuZFAiLCJjcmVhdGVOZXdDYXJkIiwibWFyZ2luTGVmdCIsIk1hdGgiLCJhYnMiLCJzbGlkZXJUb1ZpZGVvIiwic3RhcnREdXJhdGlvbiIsInJvdW5kIiwiZHVyYXRpb24iLCJOVU1CRVJfT0ZfVElDSyIsImVuZER1cmF0aW9uIiwidmlkZW9Ub1NsaWRlciIsIm9mZnNldExlZnQiLCJzdGFydFBvc2l0aW9uIiwia25vYk1pbk1vdXNlTGVhdmVDYWxsYmFjayJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBLElBQUlBLFFBQVFDLFNBQVNDLGNBQVQsQ0FBd0IsVUFBeEIsQ0FBWjtBQUNBLElBQUlDLHlCQUF5QkYsU0FBU0MsY0FBVCxDQUF3QiwwQkFBeEIsQ0FBN0I7QUFDQSxJQUFJRSxVQUFVSCxTQUFTQyxjQUFULENBQXdCLHlCQUF4QixDQUFkO0FBQ0EsSUFBSUcsbUJBQW1CSixTQUFTQyxjQUFULENBQXdCLGtCQUF4QixDQUF2QjtBQUNBLElBQUlJLFVBQVVMLFNBQVNDLGNBQVQsQ0FBd0IseUJBQXhCLENBQWQ7QUFDQSxJQUFJSyxzQkFBc0JOLFNBQVNDLGNBQVQsQ0FBd0Isc0JBQXhCLENBQTFCOztBQUdBO0FBQ0EsSUFBSU0sY0FBYyxJQUFJQyxXQUFKLEVBQWxCOztBQUVBO0FBQ0EsSUFBSUMsWUFBWSxDQUFoQjtBQUNBLElBQUlDLGlCQUFpQixLQUFyQjs7QUFFQTtBQUNBLElBQUlDLFlBQVk7QUFDZEMsUUFBTSxDQURRO0FBRWRDLFFBQU0sQ0FGUTtBQUdkQyxRQUFNLENBSFE7QUFJZEMsYUFBVztBQUpHLENBQWhCO0FBTUEsSUFBSUMsUUFBUUwsVUFBVUMsSUFBdEI7O0FBRUE7QUFDQSxJQUFJSyxrQkFBa0I7QUFDcEJDLFNBQU8sRUFEYTtBQUVwQkMsZ0JBQWMsRUFGTTtBQUdwQkMsZUFBYSxFQUhPO0FBSXBCQyxzQkFBb0IsRUFKQTtBQUtwQkMsb0JBQWtCLEVBTEU7QUFNcEJDLGFBQVcsS0FOUztBQU9wQkMsc0JBQW9CeEIsU0FBU0MsY0FBVCxDQUF3QixlQUF4QjtBQVBBLENBQXRCOztBQVVBLElBQUksQ0FBQ3dCLFVBQVVDLFNBQVYsQ0FBb0JDLEtBQXBCLENBQTBCLDBEQUExQixDQUFMLEVBQTRGOztBQUUxRjtBQUNBeEIsVUFBUXlCLGdCQUFSLENBQXlCLFNBQXpCLEVBQW9DLFVBQVNDLENBQVQsRUFBWTtBQUM5Q0Msc0JBQWtCRCxDQUFsQjtBQUNELEdBRkQsRUFFRztBQUNERSxhQUFTO0FBRFIsR0FGSDtBQUtBNUIsVUFBUXlCLGdCQUFSLENBQXlCLFdBQXpCLEVBQXNDLFVBQVNDLENBQVQsRUFBWTtBQUNoREcsaUJBQWFILENBQWI7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFLQTVCLFVBQVF5QixnQkFBUixDQUF5QixXQUF6QixFQUFzQyxVQUFTQyxDQUFULEVBQVk7QUFDaERJLGdCQUFZSixDQUFaO0FBQ0QsR0FGRCxFQUVHO0FBQ0RFLGFBQVM7QUFEUixHQUZIO0FBS0EzQixtQkFBaUJ3QixnQkFBakIsQ0FBa0MsV0FBbEMsRUFBK0MsVUFBU0MsQ0FBVCxFQUFZO0FBQ3pESyw0QkFBd0JMLENBQXhCO0FBQ0QsR0FGRCxFQUVHO0FBQ0RFLGFBQVM7QUFEUixHQUZIO0FBS0EzQixtQkFBaUJ3QixnQkFBakIsQ0FBa0MsU0FBbEMsRUFBNkMsVUFBU0MsQ0FBVCxFQUFZO0FBQ3ZETSxnQ0FBNEJOLENBQTVCO0FBQ0QsR0FGRCxFQUVHO0FBQ0RFLGFBQVM7QUFEUixHQUZIO0FBS0EzQixtQkFBaUJ3QixnQkFBakIsQ0FBa0MsV0FBbEMsRUFBK0MsVUFBU0MsQ0FBVCxFQUFZO0FBQ3pESSxnQkFBWUosQ0FBWjtBQUNELEdBRkQsRUFFRztBQUNERSxhQUFTO0FBRFIsR0FGSDs7QUFNQXpCLHNCQUFvQnNCLGdCQUFwQixDQUFxQyxXQUFyQyxFQUFrRCxVQUFTQyxDQUFULEVBQVk7QUFDNURJLGdCQUFZSixDQUFaO0FBQ0QsR0FGRCxFQUVHLElBRkg7O0FBSUF2QixzQkFBb0JzQixnQkFBcEIsQ0FBcUMsU0FBckMsRUFBZ0QsVUFBU0MsQ0FBVCxFQUFZO0FBQzFETSxnQ0FBNEJOLENBQTVCO0FBQ0QsR0FGRCxFQUVHLElBRkg7QUFJRCxDQTFDRCxNQTBDTztBQUNMO0FBQ0ExQixVQUFReUIsZ0JBQVIsQ0FBeUIsWUFBekIsRUFBdUMsVUFBU0MsQ0FBVCxFQUFZO0FBQ2pERyxpQkFBYUgsQ0FBYjtBQUNELEdBRkQsRUFFRztBQUNERSxhQUFTO0FBRFIsR0FGSDtBQUtBNUIsVUFBUXlCLGdCQUFSLENBQXlCLFdBQXpCLEVBQXNDLFVBQVNDLENBQVQsRUFBWTtBQUNoREksZ0JBQVlKLENBQVo7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFLQTVCLFVBQVF5QixnQkFBUixDQUF5QixVQUF6QixFQUFxQyxVQUFTQyxDQUFULEVBQVk7QUFDL0NDLHNCQUFrQkQsQ0FBbEI7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFLQTNCLG1CQUFpQndCLGdCQUFqQixDQUFrQyxZQUFsQyxFQUFnRCxVQUFTQyxDQUFULEVBQVk7QUFDMURLLDRCQUF3QkwsQ0FBeEI7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFLQTNCLG1CQUFpQndCLGdCQUFqQixDQUFrQyxVQUFsQyxFQUE4QyxVQUFTQyxDQUFULEVBQVk7QUFDeERNLGdDQUE0Qk4sQ0FBNUI7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFLQWhDLFFBQU02QixnQkFBTixDQUF1QixXQUF2QixFQUFvQyxVQUFTQyxDQUFULEVBQVk7QUFDOUNPLDJCQUF1QlAsQ0FBdkI7QUFDRCxHQUZELEVBRUc7QUFDREUsYUFBUztBQURSLEdBRkg7QUFNRDs7QUFHRDs7Ozs7OztBQVVBOztBQUVBNUIsUUFBUWtDLFlBQVIsQ0FBcUIsdUJBQXJCLEVBQThDM0IsY0FBOUM7QUFDQVAsUUFBUXlCLGdCQUFSLENBQXlCLFlBQXpCLEVBQXVDLFVBQVNDLENBQVQsRUFBWTtBQUNqRDtBQUNBUztBQUNBQyxpQ0FBK0JWLENBQS9CO0FBQ0QsQ0FKRDtBQUtBekIsaUJBQWlCd0IsZ0JBQWpCLENBQWtDLFlBQWxDLEVBQWdELFVBQVNDLENBQVQsRUFBWTtBQUMxRDs7QUFFQVM7QUFDQUMsaUNBQStCVixDQUEvQjtBQUNELENBTEQsRUFLRyxLQUxIOztBQU9BO0FBQ0EsSUFBSVUsaUNBQWlDLFNBQWpDQSw4QkFBaUMsQ0FBU1YsQ0FBVCxFQUFZO0FBQy9DQSxJQUFFVyxjQUFGO0FBQ0E7O0FBRUEsVUFBUXhCLEtBQVI7QUFDRSxTQUFLTCxVQUFVRSxJQUFmO0FBQ0E7QUFDRUcsZ0JBQVFMLFVBQVVJLFNBQWxCO0FBQ0E7QUFDQTBCLDJCQUFtQlosQ0FBbkIsRUFBc0I5QixNQUFNMkMsV0FBNUI7QUFDQTtBQUNEOztBQVBIO0FBVUE7QUFDRCxDQWZEOztBQWlCQSxJQUFJTix5QkFBeUIsU0FBekJBLHNCQUF5QixDQUFTUCxDQUFULEVBQVk7QUFDdkMsVUFBUWIsS0FBUjtBQUNFLFNBQUtMLFVBQVVDLElBQWY7QUFDQTtBQUNFSSxnQkFBUUwsVUFBVUcsSUFBbEI7QUFDQTtBQUNEO0FBTEg7QUFPRCxDQVJEOztBQVVBLElBQUlvQiwwQkFBMEIsU0FBMUJBLHVCQUEwQixDQUFTTCxDQUFULEVBQVk7QUFDeEM7QUFDQTtBQUNBLFVBQVFiLEtBQVI7QUFDRSxTQUFLTCxVQUFVQyxJQUFmO0FBQ0E7QUFDRUksZ0JBQVFMLFVBQVVFLElBQWxCO0FBQ0E4QixnQkFBUUMsR0FBUixDQUFZLEtBQVo7QUFDQUM7QUFDQUMsa0NBQTBCakIsQ0FBMUI7QUFDQWtCLDhCQUFzQixLQUF0QjtBQUNBO0FBQ0Q7QUFUSDtBQVdBO0FBQ0FDO0FBQ0QsQ0FoQkQ7O0FBa0JBLElBQUlsQixvQkFBb0IsU0FBcEJBLGlCQUFvQixDQUFTRCxDQUFULEVBQVk7QUFDbEM7QUFDQSxVQUFRYixLQUFSO0FBQ0UsU0FBS0wsVUFBVUMsSUFBZjtBQUNBO0FBQ0VJLGdCQUFRTCxVQUFVQyxJQUFsQjtBQUNBO0FBQ0E7QUFDQTtBQUNEO0FBQ0QsU0FBS0QsVUFBVUksU0FBZjtBQUNBO0FBQ0VDLGdCQUFRTCxVQUFVQyxJQUFsQjtBQUNBa0Msa0NBQTBCakIsQ0FBMUI7QUFDQW9CLDBCQUFrQnBCLENBQWxCLEVBQXFCOUIsTUFBTTJDLFdBQTNCO0FBQ0E7QUFDQU07QUFDQTtBQUNEO0FBQ0QsU0FBS3JDLFVBQVVHLElBQWY7QUFDQTtBQUNFRSxnQkFBUUwsVUFBVUMsSUFBbEI7QUFDQWtDLGtDQUEwQmpCLENBQTFCO0FBQ0E7QUFDQVM7QUFDQTtBQUNEO0FBQ0QsU0FBSzNCLFVBQVVFLElBQWY7QUFDQTtBQUNFRyxnQkFBUUwsVUFBVUMsSUFBbEI7QUFDQWtDLGtDQUEwQmpCLENBQTFCO0FBQ0E7QUFDQVM7QUFDQTtBQUNEO0FBaENIOztBQW1DQTtBQUNELENBdENEOztBQXlDQTtBQUNBLFNBQVNHLGtCQUFULENBQTRCWixDQUE1QixFQUErQnFCLFlBQS9CLEVBQTZDOztBQUUzQzdDLFVBQVE4QyxLQUFSLENBQWNDLElBQWQsR0FBcUJqRCxRQUFRZ0QsS0FBUixDQUFjQyxJQUFuQztBQUNBL0MsVUFBUThDLEtBQVIsQ0FBY0UsUUFBZCxHQUF5QixVQUF6QjtBQUNBO0FBQ0FsRCxVQUFRZ0QsS0FBUixDQUFjRyxVQUFkLEdBQTJCLFNBQTNCO0FBQ0FqRCxVQUFROEMsS0FBUixDQUFjSSxVQUFkLEdBQTJCLFNBQTNCO0FBQ0FDO0FBQ0Q7O0FBRUQsU0FBU1AsaUJBQVQsQ0FBMkJwQixDQUEzQixFQUE4QjRCLFdBQTlCLEVBQTJDO0FBQ3pDLE1BQUlDLG1CQUFtQkMsT0FBT0MsVUFBUCxDQUFrQixZQUFXO0FBQ2xEdkQsWUFBUThDLEtBQVIsQ0FBY0ksVUFBZCxHQUEyQixRQUEzQjtBQUNBdEMsb0JBQWdCTyxrQkFBaEIsQ0FBbUMyQixLQUFuQyxDQUF5Q0ksVUFBekMsR0FBc0QsUUFBdEQ7QUFDQXBELFlBQVFnRCxLQUFSLENBQWNHLFVBQWQsR0FBMkIsU0FBM0I7QUFDQTtBQUNBSyxXQUFPRSxZQUFQLENBQW9CSCxnQkFBcEI7QUFDQTs7O0FBR0EsUUFBSUksU0FBU0MsU0FBUzFELFFBQVE4QyxLQUFSLENBQWNDLElBQXZCLEVBQTZCLEVBQTdCLElBQW1DWSxxQkFBcUIsQ0FBckU7QUFDQSxRQUFJQyxPQUFPRixTQUFTNUQsUUFBUWdELEtBQVIsQ0FBY0MsSUFBdkIsRUFBNkIsRUFBN0IsSUFBbUNZLHFCQUFxQixDQUFuRTs7QUFFRDtBQUNDRSxrQkFBY0osTUFBZCxFQUFxQkcsSUFBckI7QUFDQWpCO0FBQ0QsR0Fmc0IsRUFlcEIsR0Fmb0IsQ0FBdkI7QUFnQkQ7O0FBS0Q7QUFDQSxTQUFTUSxxQkFBVCxHQUFpQztBQUMvQixNQUFJTyxTQUFTNUQsUUFBUWdELEtBQVIsQ0FBY0MsSUFBdkIsRUFBNkIsRUFBN0IsSUFBbUNXLFNBQVMxRCxRQUFROEMsS0FBUixDQUFjQyxJQUF2QixFQUE2QixFQUE3QixDQUF2QyxFQUF5RTtBQUN2RW5DLG9CQUFnQk8sa0JBQWhCLENBQW1DMkIsS0FBbkMsQ0FBeUNnQixVQUF6QyxHQUFzRDlELFFBQVE4QyxLQUFSLENBQWNDLElBQXBFO0FBQ0QsR0FGRCxNQUVPO0FBQ0xuQyxvQkFBZ0JPLGtCQUFoQixDQUFtQzJCLEtBQW5DLENBQXlDZ0IsVUFBekMsR0FBc0RoRSxRQUFRZ0QsS0FBUixDQUFjQyxJQUFwRTtBQUNEO0FBQ0RuQyxrQkFBZ0JPLGtCQUFoQixDQUFtQzJCLEtBQW5DLENBQXlDSSxVQUF6QyxHQUFzRCxTQUF0RDtBQUNBdEMsa0JBQWdCTyxrQkFBaEIsQ0FBbUMyQixLQUFuQyxDQUF5Q2pDLEtBQXpDLEdBQWlEa0QsS0FBS0MsR0FBTCxDQUFVTixTQUFTNUQsUUFBUWdELEtBQVIsQ0FBY0MsSUFBdkIsRUFBNkIsRUFBN0IsSUFBbUNXLFNBQVMxRCxRQUFROEMsS0FBUixDQUFjQyxJQUF2QixFQUE2QixFQUE3QixDQUE3QyxJQUFrRixJQUFuSTtBQUNEOztBQUVEO0FBQ0EsU0FBU2tCLGFBQVQsQ0FBdUJSLE1BQXZCLEVBQStCRyxJQUEvQixFQUFxQztBQUNuQyxNQUFJTSxnQkFBZ0JILEtBQUtJLEtBQUwsQ0FBYVYsU0FBUy9ELE1BQU0wRSxRQUFoQixHQUE0QkMsY0FBeEMsQ0FBcEI7QUFDQSxNQUFJQyxjQUFjUCxLQUFLSSxLQUFMLENBQWFQLE9BQU9sRSxNQUFNMEUsUUFBZCxHQUEwQkMsY0FBdEMsQ0FBbEI7QUFDQSxTQUFPO0FBQ0xILG1CQUFlQSxhQURWO0FBRUxJLGlCQUFhQTtBQUZSLEdBQVA7QUFJRDs7QUFFRDtBQUNBLFNBQVNDLGFBQVQsQ0FBdUJ2RCxrQkFBdkIsRUFBMkNDLGdCQUEzQyxFQUE2RDs7QUFFM0QsTUFBSXdDLFNBQVNNLEtBQUtJLEtBQUwsQ0FBYW5ELHFCQUFxQnFELGNBQXRCLEdBQXdDM0UsTUFBTTBFLFFBQS9DLEdBQTJEckUsaUJBQWlCeUUsVUFBdkYsQ0FBYjtBQUNBLE1BQUlaLE9BQU9HLEtBQUtJLEtBQUwsQ0FBYWxELG1CQUFtQm9ELGNBQXBCLEdBQXNDM0UsTUFBTTBFLFFBQTdDLEdBQXlEckUsaUJBQWlCeUUsVUFBckYsQ0FBWDtBQUNBLFNBQU87QUFDTEMsbUJBQWVoQixNQURWO0FBRUwxQyxpQkFBYTZDO0FBRlIsR0FBUDtBQUlEOztBQUVELElBQUloQyxjQUFjLFNBQWRBLFdBQWMsQ0FBU0osQ0FBVCxFQUFZO0FBQzVCLFVBQVFiLEtBQVI7QUFDRSxTQUFLTCxVQUFVRSxJQUFmO0FBQ0E7QUFDRUcsZ0JBQVFMLFVBQVVHLElBQWxCO0FBQ0E7QUFDQWdDLGtDQUEwQmpCLENBQTFCO0FBQ0E7QUFDRDtBQUNELFNBQUtsQixVQUFVRyxJQUFmO0FBQ0E7QUFDRUUsZ0JBQVFMLFVBQVVHLElBQWxCO0FBQ0FnQyxrQ0FBMEJqQixDQUExQjtBQUNBO0FBQ0E7QUFDRDtBQUNELFNBQUtsQixVQUFVSSxTQUFmO0FBQ0E7QUFDRUMsZ0JBQVFMLFVBQVVJLFNBQWxCO0FBQ0E7QUFDQStCLGtDQUEwQmpCLENBQTFCO0FBQ0EyQjtBQUNBO0FBQ0Q7QUF0Qkg7QUF3QkQsQ0F6QkQ7O0FBNEJBLElBQUl4QixlQUFlLFNBQWZBLFlBQWUsQ0FBU0gsQ0FBVCxFQUFZO0FBQzdCO0FBQ0FTO0FBQ0E7QUFDQSxVQUFRdEIsS0FBUjtBQUNFLFNBQUtMLFVBQVVDLElBQWY7QUFDQTtBQUNFSSxnQkFBUUwsVUFBVUUsSUFBbEI7QUFDQWdDO0FBQ0E7QUFDRDtBQU5IO0FBUUE7QUFDRCxDQWJEOztBQWdCQSxJQUFJViw4QkFBOEIsU0FBOUJBLDJCQUE4QixDQUFTTixDQUFULEVBQVk7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsVUFBUWIsS0FBUjtBQUNFLFNBQUtMLFVBQVVFLElBQWY7QUFDQTtBQUNFRyxnQkFBUUwsVUFBVUMsSUFBbEI7QUFDQTtBQUNEO0FBQ0QsU0FBS0QsVUFBVUcsSUFBZjtBQUNBO0FBQ0VFLGdCQUFRTCxVQUFVQyxJQUFsQjtBQUNBa0Msa0NBQTBCakIsQ0FBMUI7QUFDQTtBQUNBUztBQUNBO0FBQ0Q7QUFDRCxTQUFLM0IsVUFBVUksU0FBZjtBQUNBO0FBQ0VDLGdCQUFRTCxVQUFVQyxJQUFsQjtBQUNBa0Msa0NBQTBCakIsQ0FBMUI7QUFDQW9CLDBCQUFrQnBCLENBQWxCLEVBQXFCOUIsTUFBTTJDLFdBQTNCO0FBQ0E7QUFDRDs7QUFwQkg7QUF1QkE7QUFDRCxDQTVCRDs7QUE4QkEsSUFBSXFDLDRCQUE0QixTQUE1QkEseUJBQTRCLENBQVNsRCxDQUFULEVBQVk7QUFDMUMsVUFBUWIsS0FBUjtBQUNFLFNBQUtMLFVBQVVFLElBQWY7QUFDQTtBQUNFRyxnQkFBUUwsVUFBVUcsSUFBbEI7QUFDQTtBQUNEO0FBQ0QsU0FBS0gsVUFBVUcsSUFBZjtBQUNBO0FBQ0VFLGdCQUFRTCxVQUFVRyxJQUFsQjtBQUNBZ0Msa0NBQTBCakIsQ0FBMUI7QUFDQTtBQUNEO0FBQ0QsU0FBS2xCLFVBQVVJLFNBQWY7QUFDQTtBQUNFQyxnQkFBUUwsVUFBVUMsSUFBbEI7QUFDQWtDLGtDQUEwQmpCLENBQTFCO0FBQ0FvQiwwQkFBa0JwQixDQUFsQixFQUFxQjlCLE1BQU0yQyxXQUEzQjtBQUNBO0FBQ0Q7O0FBbEJIO0FBcUJBO0FBQ0QsQ0F2QkQ7O0FBMkJBIiwiZmlsZSI6InN0YXRlTWFjaGluZUNyZWF0ZVNlZ21lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL0dyYXBoaWNhbCBvYmplY3RcbnZhciB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9FQVRcIik7XG52YXIgd3JhcHBlckNvbW1hbmRBbmRSYW5nZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkXCIpO1xudmFyIGtub2JNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlLXNsaWRlcl9oYW5kbGUtbWluXCIpO1xudmFyIHJhbmdlU2xpZGVyVHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlU2xpZGVyVHJhY2tcIik7XG52YXIga25vYk1heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyX2hhbmRsZS1tYXhcIik7XG52YXIgd3JhcHBlclJhbmdlclNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyLXdyYXBwZXJcIik7XG5cblxuLy9DYXJkIG1hbmFnZXIgdG8gY3JlYXRlIGFuZCBkZWxldGUgY2FyZFxudmFyIGNhcmRNYW5hZ2VyID0gbmV3IENhcmRNYW5hZ2VyKCk7XG5cbi8vT3B0aW9uIGZvciB0aGUgbG9uZ3ByZXNzIGFuZCB0aGUgc3BlZWQgb2YgdGhlIHZpZGVvXG52YXIgc3BlZWRyYXRlID0gMTtcbnZhciBsb25nUHJlc3NEZWxheSA9IFwiNTAwXCI7XG5cbi8vU3RhdGUgZm9yIHRoZSBjcmVhdGlvbiBvZiBzZWdtZW50IGJ5IERyYWcgYW5kIGRyb3BcbmxldCBTdGF0ZURyYWcgPSB7XG4gIElETEU6IDAsXG4gIERPV046IDEsXG4gIERSQUc6IDIsXG4gIExPTkdQUkVTUzogM1xufTtcbnZhciBzdGF0ZSA9IFN0YXRlRHJhZy5JRExFO1xuXG4vL0dyYXBoaWNhbCBvYmplY3Qgb2YgZmVlZGJhY2tcbnZhciBzZWdtZW50RmVlZGJhY2sgPSB7XG4gIHdpZHRoOiBcIlwiLFxuICBzdGFydFBvc3Rpb246IFwiXCIsXG4gIGVuZFBvc2l0aW9uOiBcIlwiLFxuICBzdGFydER1cmF0aW9uVmlkZW86IFwiXCIsXG4gIGVuZER1cmF0aW9uVmlkZW86IFwiXCIsXG4gIGRpc3BsYXllZDogZmFsc2UsXG4gIGRpdkdyYXBoaWNhbE9iamVjdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWdtZW50TWluTWF4XCIpXG59O1xuXG5pZiAoIW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0FuZHJvaWR8QmxhY2tCZXJyeXxpUGhvbmV8aVBhZHxpUG9kfE9wZXJhIE1pbml8SUVNb2JpbGUvaSkpIHtcbiAgXG4gIC8vTW91c2VcbiAga25vYk1pbi5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbihlKSB7XG4gICAga25vYk1pblVwQ2FsbGJhY2soZSk7XG4gIH0sIHtcbiAgICBwYXNzaXZlOiB0cnVlXG4gIH0pO1xuICBrbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgIGtub2JNaW5DbGljayhlKTtcbiAgfSwge1xuICAgIHBhc3NpdmU6IHRydWVcbiAgfSk7XG4gIGtub2JNaW4uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAga25vYk1pbk1vdmUoZSk7XG4gIH0sIHtcbiAgICBwYXNzaXZlOiB0cnVlXG4gIH0pO1xuICByYW5nZVNsaWRlclRyYWNrLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgIHJhbmdsZXJTbGlkZXJUcmFja0NsaWNrKGUpO1xuICB9LCB7XG4gICAgcGFzc2l2ZTogdHJ1ZVxuICB9KTtcbiAgcmFuZ2VTbGlkZXJUcmFjay5hZGRFdmVudExpc3RlbmVyKFwibW91c2VVcFwiLCBmdW5jdGlvbihlKSB7XG4gICAgcmFuZ2VTbGlkZXJUcmFja0VuZENhbGxiYWNrKGUpO1xuICB9LCB7XG4gICAgcGFzc2l2ZTogdHJ1ZVxuICB9KTtcbiAgcmFuZ2VTbGlkZXJUcmFjay5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBrbm9iTWluTW92ZShlKTtcbiAgfSwge1xuICAgIHBhc3NpdmU6IHRydWVcbiAgfSk7XG4gIFxuICB3cmFwcGVyUmFuZ2VyU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZSkge1xuICAgIGtub2JNaW5Nb3ZlKGUpO1xuICB9LCB0cnVlKTtcbiAgXG4gIHdyYXBwZXJSYW5nZXJTbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSkge1xuICAgIHJhbmdlU2xpZGVyVHJhY2tFbmRDYWxsYmFjayhlKTtcbiAgfSwgdHJ1ZSk7XG4gIFxufSBlbHNlIHtcbiAgLy9Ub3VjaFxuICBrbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBrbm9iTWluQ2xpY2soZSk7XG4gIH0sIHtcbiAgICBwYXNzaXZlOiB0cnVlXG4gIH0pO1xuICBrbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgZnVuY3Rpb24oZSkge1xuICAgIGtub2JNaW5Nb3ZlKGUpO1xuICB9LCB7XG4gICAgcGFzc2l2ZTogdHJ1ZVxuICB9KTtcbiAga25vYk1pbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICAgIGtub2JNaW5VcENhbGxiYWNrKGUpO1xuICB9LCB7XG4gICAgcGFzc2l2ZTogdHJ1ZVxuICB9KTtcbiAgcmFuZ2VTbGlkZXJUcmFjay5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gICAgcmFuZ2xlclNsaWRlclRyYWNrQ2xpY2soZSk7XG4gIH0sIHtcbiAgICBwYXNzaXZlOiB0cnVlXG4gIH0pO1xuICByYW5nZVNsaWRlclRyYWNrLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgcmFuZ2VTbGlkZXJUcmFja0VuZENhbGxiYWNrKGUpO1xuICB9LCB7XG4gICAgcGFzc2l2ZTogdHJ1ZVxuICB9KTtcbiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgdmlkZW9Ub3VjaE1vdmVDYWxsYmFjayhlKTtcbiAgfSwge1xuICAgIHBhc3NpdmU6IHRydWVcbiAgfSk7XG4gIFxufVxuXG5cbi8qd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uKGUpe1xuICByYW5nZVNsaWRlclRyYWNrRW5kQ2FsbGJhY2soZSk7XG59LCBmYWxzZSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKXtcbiAga25vYk1pbk1vdmUoZSk7XG59LHRydWUgKTsqL1xuXG5cblxuXG4vKi0tLS0tTU9VU0UgTE9ORyBQUkVTUy0tLS0tLS0qL1xuXG5rbm9iTWluLnNldEF0dHJpYnV0ZShcImRhdGEtbG9uZy1wcmVzcy1kZWxheVwiLCBsb25nUHJlc3NEZWxheSk7XG5rbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIoJ2xvbmctcHJlc3MnLCBmdW5jdGlvbihlKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdrbm9iTWluLmFkZEV2ZW50TGlzdGVuZXIobG9uZ3ByZXNzJyk7XG4gIHBhdXNlKCk7XG4gIGxvbmdwcmVzc0NyZWF0ZVNlZ21lbnRDYWxsYmFjayhlKTtcbn0pO1xucmFuZ2VTbGlkZXJUcmFjay5hZGRFdmVudExpc3RlbmVyKFwibG9uZy1wcmVzc1wiLCBmdW5jdGlvbihlKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdyYW5nZVNsaWRlclRyYWNrLmFkZEV2ZW50TGlzdGVuZXIobG9uZ3ByZXNzJyk7XG4gIFxuICBwYXVzZSgpO1xuICBsb25ncHJlc3NDcmVhdGVTZWdtZW50Q2FsbGJhY2soZSk7XG59LCBmYWxzZSk7XG5cbi8qQ2FsbGJhY2sgZnVuY3Rpb24qL1xudmFyIGxvbmdwcmVzc0NyZWF0ZVNlZ21lbnRDYWxsYmFjayA9IGZ1bmN0aW9uKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAvL2NvbnNvbGUubG9nKCdzdGF0ZSA6ICcgKyBzdGF0ZSArJycsICdiYWNrZ3JvdW5kOiAjMjIyOyBjb2xvcjogI2JhZGE1NScpO1xuICBcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgU3RhdGVEcmFnLkRPV046XG4gICAge1xuICAgICAgc3RhdGUgPSBTdGF0ZURyYWcuTE9OR1BSRVNTO1xuICAgICAgLy9wYXVzZSgpO1xuICAgICAgc3RhcnRDcmVhdGVTZWdtZW50KGUsIHZpZGVvLmN1cnJlbnRUaW1lKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgfVxuICAvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59O1xuXG52YXIgdmlkZW9Ub3VjaE1vdmVDYWxsYmFjayA9IGZ1bmN0aW9uKGUpIHtcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgU3RhdGVEcmFnLklETEU6XG4gICAge1xuICAgICAgc3RhdGUgPSBTdGF0ZURyYWcuRFJBRztcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufTtcblxudmFyIHJhbmdsZXJTbGlkZXJUcmFja0NsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgY29uc29sZS5sb2coXCJyYW5nbGVyU2xpZGVyVHJhY2tDbGljayBzdGF0ZSA6IFwiICsgc3RhdGUpO1xuICAvLyBwYXVzZSgpO1xuICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgY2FzZSBTdGF0ZURyYWcuSURMRTpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5ET1dOO1xuICAgICAgY29uc29sZS5sb2coXCJpY2lcIik7XG4gICAgICBjbGVhckFsbFRpbWVyKCk7XG4gICAgICB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyKGUpO1xuICAgICAgZmVlZGJhY2tPblNsaWRlclZpZGVvKGZhbHNlKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICAvL2NvbnNvbGUubG9nKFwiZnVuY3Rpb24gLSByYW5nbGVyU2xpZGVyVHJhY2tDbGljayBhcHBlbCBwbGF5IGwxNDcgc3RhdGVtYWNoaW5lIFwiKTtcbiAgcGxheSgpO1xufTtcblxudmFyIGtub2JNaW5VcENhbGxiYWNrID0gZnVuY3Rpb24oZSkge1xuICAvL2NvbnNvbGUubG9nKFwiKioqa25vYk1pblVwQ2FsbGJhY2sgKioqIFwiKyBzdGF0ZSk7XG4gIHN3aXRjaCAoc3RhdGUpIHtcbiAgICBjYXNlIFN0YXRlRHJhZy5JRExFOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLklETEU7XG4gICAgICAvL2NvbnNvbGUubG9nKFwiZnVuY3Rpb24gLSBrbm9iTWluVXBDYWxsYmFjayBhcHBlbCBwbGF5IFwiKTtcbiAgICAgIC8vcGxheSgpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgU3RhdGVEcmFnLkxPTkdQUkVTUzpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5JRExFO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIHN0b3BDcmVhdGVTZWdtZW50KGUsIHZpZGVvLmN1cnJlbnRUaW1lKTtcbiAgICAgIC8vY29uc29sZS5sb2coXCJmdW5jdGlvbiAtIGtub2JNaW5VcENhbGxiYWNrIGFwcGVsIHBhdXNlIGwxNjQgc3RhdGVtYWNoaW5lIFwiKTtcbiAgICAgIHBsYXkoKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFN0YXRlRHJhZy5EUkFHOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLklETEU7XG4gICAgICB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyKGUpO1xuICAgICAgLy9jb25zb2xlLmxvZyhcImZ1bmN0aW9uIC0ga25vYk1pblVwQ2FsbGJhY2sgYXBwZWwgcGF1c2UgbDE2NSBzdGF0ZW1hY2hpbmUgXCIpO1xuICAgICAgcGF1c2UoKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFN0YXRlRHJhZy5ET1dOOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLklETEU7XG4gICAgICB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyKGUpO1xuICAgICAgLy9jb25zb2xlLmxvZyhcImZ1bmN0aW9uIC0ga25vYk1pblVwQ2FsbGJhY2sgYXBwZWwgcGF1c2UgbDE3MiBzdGF0ZW1hY2hpbmUgXCIpO1xuICAgICAgcGF1c2UoKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBcbiAgLy9ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufTtcblxuXG4vL0NyZWF0ZSBTZWdtZW50XG5mdW5jdGlvbiBzdGFydENyZWF0ZVNlZ21lbnQoZSwgc3RhcnRTZWdtZW50KSB7XG4gIFxuICBrbm9iTWF4LnN0eWxlLmxlZnQgPSBrbm9iTWluLnN0eWxlLmxlZnQ7XG4gIGtub2JNYXguc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gIC8vc3RhdGUgIFN0YXRlRHJhZy5MT05HUFJFU1M7XG4gIGtub2JNaW4uc3R5bGUuYmFja2dyb3VuZCA9ICcjMjEzRjhEJztcbiAga25vYk1heC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIHVwZGF0ZVNlZ21lbnRGZWVkYmFjaygpO1xufVxuXG5mdW5jdGlvbiBzdG9wQ3JlYXRlU2VnbWVudChlLCBzdG9wU2VnbWVudCkge1xuICBsZXQgdGltZXJMaWZlU2VnbWVudCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgIGtub2JNYXguc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICBrbm9iTWluLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmZmZmZic7XG4gICAgLy9jcmVhdGVDYXJkKCk7XG4gICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lckxpZmVTZWdtZW50KTtcbiAgICAvL2NvbnNvbGUubG9nKFwiQUFBIDogXCIgKyBwYXJzZUludChrbm9iTWF4LnN0eWxlLmxlZnQsMTApKTtcbiAgICBcbiAgICBcbiAgICB2YXIgc3RhcnRQID0gcGFyc2VJbnQoa25vYk1heC5zdHlsZS5sZWZ0LCAxMCkgKyBXSURUSF9NSURfS05PQl9NSU4gLyAyO1xuICAgIHZhciBlbmRQID0gcGFyc2VJbnQoa25vYk1pbi5zdHlsZS5sZWZ0LCAxMCkgKyBXSURUSF9NSURfS05PQl9NSU4gLyAyO1xuICAgIFxuICAgLy8gY2FyZE1hbmFnZXIuZXhlY3V0ZShuZXcgQ3JlYXRlTmV3Q2FyZENvbW1hbmQoc3RhcnRQLCBlbmRQKSk7XG4gICAgY3JlYXRlTmV3Q2FyZChzdGFydFAsZW5kUCApO1xuICAgIHBsYXkoKTtcbiAgfSwgNzAwKTtcbn1cblxuXG5cblxuLy9VcGRhdGUgdGhlIGZlZWRiYWNrIG9mIHRoZSBjcmVhdGlvbiBvZiBhIHNlZ21lbnQgYWZ0ZXIgYSBsb25nIHByZXNzXG5mdW5jdGlvbiB1cGRhdGVTZWdtZW50RmVlZGJhY2soKSB7XG4gIGlmIChwYXJzZUludChrbm9iTWluLnN0eWxlLmxlZnQsIDEwKSA+IHBhcnNlSW50KGtub2JNYXguc3R5bGUubGVmdCwgMTApKSB7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5tYXJnaW5MZWZ0ID0ga25vYk1heC5zdHlsZS5sZWZ0O1xuICB9IGVsc2Uge1xuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IGtub2JNaW4uc3R5bGUubGVmdDtcbiAgfVxuICBzZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS53aWR0aCA9IE1hdGguYWJzKChwYXJzZUludChrbm9iTWluLnN0eWxlLmxlZnQsIDEwKSAtIHBhcnNlSW50KGtub2JNYXguc3R5bGUubGVmdCwgMTApKSkgKyBcInB4XCI7XG59XG5cbi8vc3RhcnQgcG9zaXRpb24gb24gdGhlIHNsaWRlciBhbmQgZW5kIHBvc2l0aW9uIG9uIHRoZSBzbGlkZXJcbmZ1bmN0aW9uIHNsaWRlclRvVmlkZW8oc3RhcnRQLCBlbmRQKSB7XG4gIHZhciBzdGFydER1cmF0aW9uID0gTWF0aC5yb3VuZCgoKHN0YXJ0UCAqIHZpZGVvLmR1cmF0aW9uKSAvIE5VTUJFUl9PRl9USUNLKSk7XG4gIHZhciBlbmREdXJhdGlvbiA9IE1hdGgucm91bmQoKChlbmRQICogdmlkZW8uZHVyYXRpb24pIC8gTlVNQkVSX09GX1RJQ0spKTtcbiAgcmV0dXJuIHtcbiAgICBzdGFydER1cmF0aW9uOiBzdGFydER1cmF0aW9uLFxuICAgIGVuZER1cmF0aW9uOiBlbmREdXJhdGlvblxuICB9O1xufVxuXG4vL3N0YXJ0IHBvc2l0aW9uIG9uIHRoZSBzbGlkZXIgYW5kIGVuZCBwb3NpdGlvbiBvbiB0aGUgc2xpZGVyXG5mdW5jdGlvbiB2aWRlb1RvU2xpZGVyKHN0YXJ0RHVyYXRpb25WaWRlbywgZW5kRHVyYXRpb25WaWRlbykge1xuICBcbiAgdmFyIHN0YXJ0UCA9IE1hdGgucm91bmQoKChzdGFydER1cmF0aW9uVmlkZW8gKiBOVU1CRVJfT0ZfVElDSykgLyB2aWRlby5kdXJhdGlvbikgLSByYW5nZVNsaWRlclRyYWNrLm9mZnNldExlZnQpO1xuICB2YXIgZW5kUCA9IE1hdGgucm91bmQoKChlbmREdXJhdGlvblZpZGVvICogTlVNQkVSX09GX1RJQ0spIC8gdmlkZW8uZHVyYXRpb24pIC0gcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0KTtcbiAgcmV0dXJuIHtcbiAgICBzdGFydFBvc2l0aW9uOiBzdGFydFAsXG4gICAgZW5kUG9zaXRpb246IGVuZFBcbiAgfTtcbn1cblxudmFyIGtub2JNaW5Nb3ZlID0gZnVuY3Rpb24oZSkge1xuICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgY2FzZSBTdGF0ZURyYWcuRE9XTjpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5EUkFHO1xuICAgICAgLy9jb25zb2xlLmxvZyhcIiBkcmFnaW5nIGV0YXQgZG93blwiKTtcbiAgICAgIHVwZGF0ZUtub2JBbmRWaWRlb1dyYXBwZXIoZSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBTdGF0ZURyYWcuRFJBRzpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5EUkFHO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIC8vY29uc29sZS5sb2coXCIgZHJhZ2luZyBldGF0IGRyYWdcIik7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBTdGF0ZURyYWcuTE9OR1BSRVNTOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLkxPTkdQUkVTUztcbiAgICAgIC8vY29uc29sZS5sb2coXCJzdGF0ZSBsb25ncHJlc3Mgd2l0aCBtb3VzZSBtb3ZlXCIpO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIHVwZGF0ZVNlZ21lbnRGZWVkYmFjaygpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59O1xuXG5cbnZhciBrbm9iTWluQ2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vY29uc29sZS5sb2coXCJmdW5jdGlvbiAtIGtub2JNaW5DbGlja1wiICk7XG4gIHBhdXNlKCk7XG4gIC8vVXBkYXRlIHZpZGVvIHBvc2l0aW9uXG4gIHN3aXRjaCAoc3RhdGUpIHtcbiAgICBjYXNlIFN0YXRlRHJhZy5JRExFOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLkRPV047XG4gICAgICBjbGVhckFsbFRpbWVyKCk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgLy9lLnByZXZlbnREZWZhdWx0KCk7XG59O1xuXG5cbnZhciByYW5nZVNsaWRlclRyYWNrRW5kQ2FsbGJhY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vY29uc29sZS5sb2coXCJcIik7XG4gIC8vY29uc29sZS5sb2coXCJtb3VzZSB1cCAsIGV0YXQgOiBcIiArIHN0YXRlKTtcbiAgLy8gY29uc29sZS5sb2coXCJyYW5nZVNsaWRlclRyYWNrRW5kQ2FsbGJhY2sgOiBcIiArIHN0YXRlKTtcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgU3RhdGVEcmFnLkRPV046XG4gICAge1xuICAgICAgc3RhdGUgPSBTdGF0ZURyYWcuSURMRTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFN0YXRlRHJhZy5EUkFHOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLklETEU7XG4gICAgICB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyKGUpO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJmdW5jdGlvbiAtIHJhbmdlU2xpZGVyVHJhY2tFbmRDYWxsYmFjayBsMjg1IHN0YXRlIG1hY2hpbmVcIik7XG4gICAgICBwYXVzZSgpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgU3RhdGVEcmFnLkxPTkdQUkVTUzpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5JRExFO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIHN0b3BDcmVhdGVTZWdtZW50KGUsIHZpZGVvLmN1cnJlbnRUaW1lKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgfVxuICAvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59O1xuXG52YXIga25vYk1pbk1vdXNlTGVhdmVDYWxsYmFjayA9IGZ1bmN0aW9uKGUpIHtcbiAgc3dpdGNoIChzdGF0ZSkge1xuICAgIGNhc2UgU3RhdGVEcmFnLkRPV046XG4gICAge1xuICAgICAgc3RhdGUgPSBTdGF0ZURyYWcuRFJBRztcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFN0YXRlRHJhZy5EUkFHOlxuICAgIHtcbiAgICAgIHN0YXRlID0gU3RhdGVEcmFnLkRSQUc7XG4gICAgICB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyKGUpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgU3RhdGVEcmFnLkxPTkdQUkVTUzpcbiAgICB7XG4gICAgICBzdGF0ZSA9IFN0YXRlRHJhZy5JRExFO1xuICAgICAgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlcihlKTtcbiAgICAgIHN0b3BDcmVhdGVTZWdtZW50KGUsIHZpZGVvLmN1cnJlbnRUaW1lKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgfVxuICAvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59O1xuXG5cblxuLypcbmZ1bmN0aW9uIGZlZWRiYWNrT25TbGlkZXJWaWRlbyhvbk9mZil7XG4gIC8vc2VnbWVudEZlZWRiYWNrLndpZHRoID0gaURpdi5zdHlsZS53aWR0aDtcbiAgLy9zZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uID0gaURpdi5zdHlsZS5sZWZ0O1xuICAvL3NlZ21lbnRGZWVkYmFjay53aWR0aCA9IHBhcnNlSW50KHdpZHRoKTtcbiAgLy9zZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uPSBwYXJzZUludChzdGFydFApO1xuICBzZWdtZW50RmVlZGJhY2suZW5kUG9zaXRpb24gPSBwYXJzZUludChzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uKSArIHBhcnNlSW50KHNlZ21lbnRGZWVkYmFjay53aWR0aCk7XG4gIHZhciBzbGlkZXJUb1YgPSBzbGlkZXJUb1ZpZGVvKCBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uLCBzZWdtZW50RmVlZGJhY2suZW5kUG9zaXRpb24pO1xuICBzZWdtZW50RmVlZGJhY2suc3RhcnREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLnN0YXJ0RHVyYXRpb247XG4gIHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLmVuZER1cmF0aW9uO1xuICBzZWdtZW50RmVlZGJhY2suZGlzcGxheWVkID0gb25PZmY7XG4gIGlmKG9uT2ZmKXtcbiAgICAvL3NlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb247XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5tYXJnaW5MZWZ0ID0gcGFyc2VJbnQoc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbikgLSA1ICtcInB4XCI7Ly8gIHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb247XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS53aWR0aCA9ICBzZWdtZW50RmVlZGJhY2sud2lkdGg7XG4gIH0gZWxzZSB7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxufTtcbiovIl19