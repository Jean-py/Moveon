"use strict";

var video = document.getElementById("videoEAT");
var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");
var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = 1000;
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 15;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

knobMin.style.left = currentValueKnob + rangeSliderTrack.offsetLeft + "px";

/*---- Creation de ma propre bar de commande de lecture pour la vidÃ©o ----- */
// Event controller for the play/pause button
playButton.addEventListener("touchstart", function (e) {
  console.log("appel playPause function playButton.addEventListener(touchstart)  in l33 videocontroller") ;
  playPausecallback(e);
}, { passive: true });
//Click on the video trigger play and pause
video.addEventListener("touchend", function (e) {
  playPausecallback(e);
});
muteButton.addEventListener("touchend", function (e) {
  muteButtonCallback();
});
rangeSliderWrapper.addEventListener("touchend", function (e) {
  //play();
  playPausecallback();
});

//Mouse event controller
playButton.addEventListener("mousedown", function (e) {
  playPausecallback(e);
});
muteButton.addEventListener("mousedown", function (e) {
  muteButtonCallback();
});
video.addEventListener("mousedown", function (e) {
  playPausecallback(e);
});
rangeSliderWrapper.addEventListener("mouseup", function (e) {
  //play();
  //playPausecallback();
  //console.log("AA");

});

// Event controller for the seek bar
videoSlider.addEventListener("change", function (e) {
  // Update the video time
  //video.currentTime = video.duration * (videoSlider.value / NUMBER_OF_TICK);
  updateTimerVideo();
});

// Update the seek bar as the video plays
video.addEventListener("timeupdate", function () {
  // Update the slider value
  if (!video.paused) {
    currentValueKnob = NUMBER_OF_TICK / video.duration * video.currentTime + rangeSliderTrack.offsetLeft;
    // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
    knobMin.style.left = currentValueKnob - KNOB_WIDTH / 2 + "px";
  }
  //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
  updateTimerVideo();
}, false);

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown" || e.type === "mousemove" || e.type === "[object MouseEvent]") {
    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

//Update knob on a tablet
var updateKnobAndVideo = function updateKnobAndVideo(event) {
  //  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft+rangeSliderTrack.offsetLeft + dividCommandeVideo.offsetLeft;
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft; //-   ;
  //console.log("aa :  " +  body );

  video.currentTime = Math.round(((event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider) * video.duration / NUMBER_OF_TICK);
  //Update know position
  knobMin.style.left = (event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider + "px";
  if (segmentFeedback.displayed) {
    if (video.currentTime > segmentFeedback.endDurationVideo) {
      feedbackOnSliderVideo(false);
    }
  }
};

//Update knob on a laptop
var updateKnobAndVideoComputer = function updateKnobAndVideoComputer(e) {
  //take into account offset on the left of the scroll bar (body scroll and centering the wrapper)
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft - body.scrollLeft; //- window.scrollLeft  ;
  //currentValueKnob = ((e.clientX - offsetLeftSlider) * video.duration) / NUMBER_OF_TICK;
  currentValueKnob = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
  if (currentValueKnob < video.duration) {
    video.currentTime = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
    knobMin.style.left = e.pageX - (offsetLeftSlider + WIDTH_MID_KNOB_MIN / 2) + "px";
    if (segmentFeedback.displayed) {
      if (video.currentTime > segmentFeedback.endDurationVideo) {
        feedbackOnSliderVideo(false);
      }
    }
  }
};

function feedbackOnSliderVideo(onOff) {
  segmentFeedback.endPosition = parseInt(segmentFeedback.startPostion) + parseInt(segmentFeedback.width);
  var sliderToV = sliderToVideo(segmentFeedback.startPostion, segmentFeedback.endPosition);
  segmentFeedback.startDurationVideo = sliderToV.startDuration;
  segmentFeedback.endDurationVideo = sliderToV.endDuration;
  segmentFeedback.displayed = onOff;
  if (onOff) {
    //segmentFeedback.divGraphicalObject.style.marginLeft = segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.marginLeft = parseInt(segmentFeedback.startPostion) - 5 + "px"; //  segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.visibility = "visible";
    segmentFeedback.divGraphicalObject.style.width = segmentFeedback.width;
  } else {
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
  }
}

function updateTimerVideo() {
  var minutes = Math.floor(video.currentTime / 60);
  var seconds = Math.floor(video.currentTime - minutes * 60);
  if (seconds < 10) seconds = "0" + seconds;
  timerVideo.innerHTML = minutes + ":" + seconds + "/" + videoDuration;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ2aWRlbyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsInBsYXlCdXR0b24iLCJtdXRlQnV0dG9uIiwidGltZXJWaWRlbyIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkIiwicmFuZ2VTbGlkZXJXcmFwcGVyIiwiZGl2Q2FyZEJvYXJkIiwiYm9keSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiS05PQl9XSURUSCIsIk5VTUJFUl9PRl9USUNLIiwiVkFMVUVfS05PQl9NSU4iLCJXSURUSF9NSURfS05PQl9NSU4iLCJjdXJyZW50VmFsdWVLbm9iIiwidmlkZW9EdXJhdGlvbiIsInN0eWxlIiwibGVmdCIsIm9mZnNldExlZnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInBsYXlQYXVzZWNhbGxiYWNrIiwicGFzc2l2ZSIsIm11dGVCdXR0b25DYWxsYmFjayIsInVwZGF0ZVRpbWVyVmlkZW8iLCJwYXVzZWQiLCJkdXJhdGlvbiIsImN1cnJlbnRUaW1lIiwidXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciIsInR5cGUiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlciIsInVwZGF0ZUtub2JBbmRWaWRlbyIsImV2ZW50Iiwib2Zmc2V0TGVmdFNsaWRlciIsIk1hdGgiLCJyb3VuZCIsInRhcmdldFRvdWNoZXMiLCJwYWdlWCIsImNoYW5nZWRUb3VjaGVzIiwibGVuZ3RoIiwic2VnbWVudEZlZWRiYWNrIiwiZGlzcGxheWVkIiwiZW5kRHVyYXRpb25WaWRlbyIsImZlZWRiYWNrT25TbGlkZXJWaWRlbyIsInNjcm9sbExlZnQiLCJvbk9mZiIsImVuZFBvc2l0aW9uIiwicGFyc2VJbnQiLCJzdGFydFBvc3Rpb24iLCJ3aWR0aCIsInNsaWRlclRvViIsInNsaWRlclRvVmlkZW8iLCJzdGFydER1cmF0aW9uVmlkZW8iLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJkaXZHcmFwaGljYWxPYmplY3QiLCJtYXJnaW5MZWZ0IiwidmlzaWJpbGl0eSIsIm1pbnV0ZXMiLCJmbG9vciIsInNlY29uZHMiLCJpbm5lckhUTUwiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsUUFBUUMsU0FBU0MsY0FBVCxDQUF3QixVQUF4QixDQUFaO0FBQ0EsSUFBSUMsZUFBSjtBQUNBLElBQUlDLFlBQVksQ0FBaEI7QUFDQSxJQUFJQyxjQUFjSixTQUFTQyxjQUFULENBQXdCLGFBQXhCLENBQWxCO0FBQ0E7QUFDQSxJQUFJSSxhQUFhTCxTQUFTQyxjQUFULENBQXdCLFlBQXhCLENBQWpCO0FBQ0EsSUFBSUssYUFBYU4sU0FBU0MsY0FBVCxDQUF3QixNQUF4QixDQUFqQjtBQUNBLElBQUlNLGFBQWFQLFNBQVNDLGNBQVQsQ0FBd0IsWUFBeEIsQ0FBakI7QUFDQTtBQUNBLElBQUlPLFVBQVVSLFNBQVNDLGNBQVQsQ0FBd0IseUJBQXhCLENBQWQ7QUFDQSxJQUFJUSxtQkFBbUJULFNBQVNDLGNBQVQsQ0FBd0Isa0JBQXhCLENBQXZCO0FBQ0EsSUFBSVMsMkJBQTJCVixTQUFTQyxjQUFULENBQXdCLDBCQUF4QixDQUEvQjs7QUFFQSxJQUFJVSxxQkFBcUJYLFNBQVNDLGNBQVQsQ0FBd0Isc0JBQXhCLENBQXpCO0FBQ0EsSUFBSVcsZUFBZVosU0FBU0MsY0FBVCxDQUF3QixjQUF4QixDQUFuQjtBQUNBLElBQUlZLE9BQU9iLFNBQVNjLG9CQUFULENBQThCLE1BQTlCLEVBQXNDLENBQXRDLENBQVg7O0FBR0EsSUFBSUMsYUFBYSxFQUFqQjs7QUFFQSxJQUFJQyxpQkFBaUIsSUFBckI7QUFDQSxJQUFJQyxpQkFBaUIsQ0FBckI7QUFDQSxJQUFJQyxxQkFBcUIsRUFBekI7QUFDQSxJQUFJQyxtQkFBbUJGLGNBQXZCO0FBQ0EsSUFBSUcsZ0JBQWdCLE1BQXBCOztBQUdBWixRQUFRYSxLQUFSLENBQWNDLElB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ZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRUFUXCIpO1xudmFyIHRpbWVyUmVwZXRpdGlvbjtcbnZhciBzcGVlZHJhdGUgPSAxO1xudmFyIHZpZGVvU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1NsaWRlclwiKTtcbi8vIEJ1dHRvbnNcbnZhciBwbGF5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5LXBhdXNlXCIpO1xudmFyIG11dGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm11dGVcIik7XG52YXIgdGltZXJWaWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXJWaWRlb1wiKTtcbi8vIFNsaWRlcnNcbnZhciBrbm9iTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXJfaGFuZGxlLW1pblwiKTtcbnZhciByYW5nZVNsaWRlclRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZVNsaWRlclRyYWNrXCIpO1xudmFyIHdyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkXCIpO1xuXG52YXIgcmFuZ2VTbGlkZXJXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXItd3JhcHBlclwiKTtcbnZhciBkaXZDYXJkQm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpdkNhcmRCb2FyZFwiKTtcbnZhciBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJCT0RZXCIpWzBdO1xuXG5cbnZhciBLTk9CX1dJRFRIID0gMjU7XG5cbnZhciBOVU1CRVJfT0ZfVElDSyA9IDEwMDA7XG52YXIgVkFMVUVfS05PQl9NSU4gPSAwO1xudmFyIFdJRFRIX01JRF9LTk9CX01JTiA9IDE1O1xudmFyIGN1cnJlbnRWYWx1ZUtub2IgPSBWQUxVRV9LTk9CX01JTjtcbnZhciB2aWRlb0R1cmF0aW9uID0gXCIxOjQ3XCI7XG5cblxua25vYk1pbi5zdHlsZS5sZWZ0ID0gKCAgY3VycmVudFZhbHVlS25vYiArIHJhbmdlU2xpZGVyVHJhY2sub2Zmc2V0TGVmdCkgKyBcInB4XCIgO1xuXG5cblxuXG5cbi8qLS0tLSBDcmVhdGlvbiBkZSBtYSBwcm9wcmUgYmFyIGRlIGNvbW1hbmRlIGRlIGxlY3R1cmUgcG91ciBsYSB2aWTDqW8gLS0tLS0gKi9cbi8vIEV2ZW50IGNvbnRyb2xsZXIgZm9yIHRoZSBwbGF5L3BhdXNlIGJ1dHRvblxucGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSx7cGFzc2l2ZTogdHJ1ZX0pO1xuLy9DbGljayBvbiB0aGUgdmlkZW8gdHJpZ2dlciBwbGF5IGFuZCBwYXVzZVxudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgcGxheVBhdXNlY2FsbGJhY2soZSk7XG59KTtcbm11dGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgbXV0ZUJ1dHRvbkNhbGxiYWNrKCk7XG59KTtcbnJhbmdlU2xpZGVyV3JhcHBlci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICAvL3BsYXkoKTtcbiAgcGxheVBhdXNlY2FsbGJhY2soKTtcbn0pO1xuXG4vL01vdXNlIGV2ZW50IGNvbnRyb2xsZXJcbnBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSk7XG5tdXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICBtdXRlQnV0dG9uQ2FsbGJhY2soKTtcbn0pO1xudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSk7XG5yYW5nZVNsaWRlcldyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSkge1xuICAgLy9wbGF5KCk7XG4gIC8vcGxheVBhdXNlY2FsbGJhY2soKTtcbiAgLy9jb25zb2xlLmxvZyhcIkFBXCIpO1xuICBcbn0pO1xuXG4vLyBFdmVudCBjb250cm9sbGVyIGZvciB0aGUgc2VlayBiYXJcbnZpZGVvU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24oZSkge1xuICAvLyBVcGRhdGUgdGhlIHZpZGVvIHRpbWVcbiAgLy92aWRlby5jdXJyZW50VGltZSA9IHZpZGVvLmR1cmF0aW9uICogKHZpZGVvU2xpZGVyLnZhbHVlIC8gTlVNQkVSX09GX1RJQ0spO1xuICB1cGRhdGVUaW1lclZpZGVvKCk7XG59KTtcblxuXG4vLyBVcGRhdGUgdGhlIHNlZWsgYmFyIGFzIHRoZSB2aWRlbyBwbGF5c1xudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgZnVuY3Rpb24oKSB7XG4gIC8vIFVwZGF0ZSB0aGUgc2xpZGVyIHZhbHVlXG4gIGlmKCF2aWRlby5wYXVzZWQpe1xuICAgIGN1cnJlbnRWYWx1ZUtub2IgPSAoKChOVU1CRVJfT0ZfVElDSyAvIHZpZGVvLmR1cmF0aW9uKSAqIHZpZGVvLmN1cnJlbnRUaW1lKSArIHJhbmdlU2xpZGVyVHJhY2sub2Zmc2V0TGVmdCk7XG4gICAgLy8ga25vYk1pbi5zdHlsZS5sZWZ0ID0gY3VycmVudFZhbHVlS25vYi0oS05PQl9XSURUSC8yKSsgXCJweFwiIDtcbiAgICBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iLShLTk9CX1dJRFRILzIpKyBcInB4XCIgO1xuICB9XG4gIC8vdmlkZW9TbGlkZXIudmFsdWUgPSAoTlVNQkVSX09GX1RJQ0sgLyB2aWRlby5kdXJhdGlvbikgKiB2aWRlby5jdXJyZW50VGltZTtcbiAgdXBkYXRlVGltZXJWaWRlbygpO1xufSwgZmFsc2UpO1xuXG5cblxuLy9GdW5jdGlvbiB0byB1cGRhdGUgdGhlIGtub2JcbnZhciB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyID0gZnVuY3Rpb24oZSl7XG4gIGlmKGUudHlwZSA9PT0gXCJtb3VzZXVwXCIgfHwgZS50eXBlID09PSBcIm1vdXNlZG93blwiIHx8IGUudHlwZSA9PT0gXCJtb3VzZW1vdmVcIiB8fCAgZS50eXBlID09PSBcIltvYmplY3QgTW91c2VFdmVudF1cIiApe1xuICAgIHVwZGF0ZUtub2JBbmRWaWRlb0NvbXB1dGVyKGUpO1xuICB9IGVsc2Uge1xuICAgIHVwZGF0ZUtub2JBbmRWaWRlbyhlKTtcbiAgfVxuIC8vIHZpZGVvLnBsYXkoKTtcbn07XG5cblxuLy9VcGRhdGUga25vYiBvbiBhIHRhYmxldFxudmFyICB1cGRhdGVLbm9iQW5kVmlkZW8gPSBmdW5jdGlvbihldmVudCl7XG4vLyAgdmFyIG9mZnNldExlZnRTbGlkZXIgPSB3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWQub2Zmc2V0TGVmdCtyYW5nZVNsaWRlclRyYWNrLm9mZnNldExlZnQgKyBkaXZpZENvbW1hbmRlVmlkZW8ub2Zmc2V0TGVmdDtcbiAgdmFyIG9mZnNldExlZnRTbGlkZXIgPSB3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWQub2Zmc2V0TGVmdCAgOy8vLSAgIDtcbiAgLy9jb25zb2xlLmxvZyhcImFhIDogIFwiICsgIGJvZHkgKTtcbiAgXG4gIHZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5yb3VuZCgoKCggZXZlbnQudGFyZ2V0VG91Y2hlc1swXSA/IGV2ZW50LnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5jaGFuZ2VkVG91Y2hlc1tldmVudC5jaGFuZ2VkVG91Y2hlcy5sZW5ndGgtMV0ucGFnZVggKS0ob2Zmc2V0TGVmdFNsaWRlcikpKnZpZGVvLmR1cmF0aW9uKS9OVU1CRVJfT0ZfVElDSykgO1xuICAvL1VwZGF0ZSBrbm93IHBvc2l0aW9uXG4gIGtub2JNaW4uc3R5bGUubGVmdCA9ICgoKCAoZXZlbnQudGFyZ2V0VG91Y2hlc1swXSA/IGV2ZW50LnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5jaGFuZ2VkVG91Y2hlc1tldmVudC5jaGFuZ2VkVG91Y2hlcy5sZW5ndGgtMV0ucGFnZVgpKS1vZmZzZXRMZWZ0U2xpZGVyICkgKSsgXCJweFwiIDtcbiAgaWYoc2VnbWVudEZlZWRiYWNrLmRpc3BsYXllZCl7XG4gICAgaWYodmlkZW8uY3VycmVudFRpbWUgPiBzZWdtZW50RmVlZGJhY2suZW5kRHVyYXRpb25WaWRlbyl7XG4gICAgICBmZWVkYmFja09uU2xpZGVyVmlkZW8oZmFsc2UpO1xuICAgIH1cbiAgfVxufTtcblxuLy9VcGRhdGUga25vYiBvbiBhIGxhcHRvcFxudmFyIHVwZGF0ZUtub2JBbmRWaWRlb0NvbXB1dGVyID0gZnVuY3Rpb24oZSl7XG4gIC8vdGFrZSBpbnRvIGFjY291bnQgb2Zmc2V0IG9uIHRoZSBsZWZ0IG9mIHRoZSBzY3JvbGwgYmFyIChib2R5IHNjcm9sbCBhbmQgY2VudGVyaW5nIHRoZSB3cmFwcGVyKVxuICB2YXIgb2Zmc2V0TGVmdFNsaWRlciA9IHdyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZC5vZmZzZXRMZWZ0IC0gYm9keS5zY3JvbGxMZWZ0Oy8vLSB3aW5kb3cuc2Nyb2xsTGVmdCAgO1xuICAvL2N1cnJlbnRWYWx1ZUtub2IgPSAoKGUuY2xpZW50WCAtIG9mZnNldExlZnRTbGlkZXIpICogdmlkZW8uZHVyYXRpb24pIC8gTlVNQkVSX09GX1RJQ0s7XG4gIGN1cnJlbnRWYWx1ZUtub2IgPSAoKGUucGFnZVggLSBvZmZzZXRMZWZ0U2xpZGVyKSAqIHZpZGVvLmR1cmF0aW9uKSAvIE5VTUJFUl9PRl9USUNLO1xuICBpZihjdXJyZW50VmFsdWVLbm9iIDwgdmlkZW8uZHVyYXRpb24gKSB7XG4gICAgdmlkZW8uY3VycmVudFRpbWUgPSAoKGUucGFnZVggLSBvZmZzZXRMZWZ0U2xpZGVyKSAqIHZpZGVvLmR1cmF0aW9uKSAvIE5VTUJFUl9PRl9USUNLO1xuICAgIGtub2JNaW4uc3R5bGUubGVmdCA9IGUucGFnZVggLSAgKG9mZnNldExlZnRTbGlkZXIgKyAgV0lEVEhfTUlEX0tOT0JfTUlOLzIgKSArIFwicHhcIlxuICAgIGlmIChzZWdtZW50RmVlZGJhY2suZGlzcGxheWVkKSB7XG4gICAgICBpZiAodmlkZW8uY3VycmVudFRpbWUgPiBzZWdtZW50RmVlZGJhY2suZW5kRHVyYXRpb25WaWRlbykge1xuICAgICAgICBmZWVkYmFja09uU2xpZGVyVmlkZW8oZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZnVuY3Rpb24gZmVlZGJhY2tPblNsaWRlclZpZGVvKG9uT2ZmKXtcbiAgc2VnbWVudEZlZWRiYWNrLmVuZFBvc2l0aW9uID0gcGFyc2VJbnQoc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbikgKyBwYXJzZUludChzZWdtZW50RmVlZGJhY2sud2lkdGgpO1xuICB2YXIgc2xpZGVyVG9WID0gc2xpZGVyVG9WaWRlbyggc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbiwgc2VnbWVudEZlZWRiYWNrLmVuZFBvc2l0aW9uKTtcbiAgc2VnbWVudEZlZWRiYWNrLnN0YXJ0RHVyYXRpb25WaWRlbyA9IHNsaWRlclRvVi5zdGFydER1cmF0aW9uO1xuICBzZWdtZW50RmVlZGJhY2suZW5kRHVyYXRpb25WaWRlbyA9IHNsaWRlclRvVi5lbmREdXJhdGlvbjtcbiAgc2VnbWVudEZlZWRiYWNrLmRpc3BsYXllZCA9IG9uT2ZmO1xuICBpZihvbk9mZil7XG4gICAgLy9zZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLm1hcmdpbkxlZnQgPSBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uO1xuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IHBhcnNlSW50KHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb24pIC0gNSArXCJweFwiOy8vICBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uO1xuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUud2lkdGggPSAgc2VnbWVudEZlZWRiYWNrLndpZHRoO1xuICB9IGVsc2Uge1xuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gIH1cbn1cblxuXG5mdW5jdGlvbiB1cGRhdGVUaW1lclZpZGVvKCl7XG4gIGxldCBtaW51dGVzID0gTWF0aC5mbG9vcih2aWRlby5jdXJyZW50VGltZSAgLyA2MCk7XG4gIGxldCBzZWNvbmRzID0gIE1hdGguZmxvb3IodmlkZW8uY3VycmVudFRpbWUgLSBtaW51dGVzICogNjApO1xuICBpZihzZWNvbmRzPDEwKVxuICAgIHNlY29uZHMgPSBcIjBcIitzZWNvbmRzO1xuICB0aW1lclZpZGVvLmlubmVySFRNTCA9IG1pbnV0ZXMrXCI6XCIrc2Vjb25kcytcIi9cIisgdmlkZW9EdXJhdGlvbjtcbn1cblxuIl19