"use strict";

var video = document.getElementById("videoEAT");
var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");
var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = 10000;
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 15;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

knobMin.style.left = currentValueKnob + rangeSliderTrack.offsetLeft + "px";

/*---- Creation de ma propre bar de commande de lecture pour la vidÃ©o ----- */
// Event controller for the play/pause button
playButton.addEventListener("touchstart", function (e) {
  e.preventDefault();
  event.preventDefault();
  console.log("appel l36 playPausecallback videoController");
  playPausecallback(e);
}, { passive: true });
//Click on the video trigger play and pause
video.addEventListener("touchend", function (e) {
  console.log("appel l42 playPausecallback videoCOntroller");
  playPausecallback(e);
});
muteButton.addEventListener("touchend", function (e) {
  muteButtonCallback();
});
rangeSliderWrapper.addEventListener("touchend", function (e) {
  //play();
  console.log("appel l50 playPausecallback video OCntroller");
  playPausecallback();
});

//Mouse event controller
playButton.addEventListener("mousedown", function (e) {
  e.preventDefault();
  event.preventDefault();
  console.log("appel playPause function playButton.addEventListener(mousedown in l56 videocontroller");
  playPausecallback(e);
});
muteButton.addEventListener("mousedown", function (e) {
  muteButtonCallback();
});
video.addEventListener("mousedown", function (e) {
  console.log("appel playPause function video.addEventListener(mousedown in l62 videocontroller");
  playPausecallback(e);
});
rangeSliderWrapper.addEventListener("mouseup", function (e) {
  //play();
  //playPausecallback();
  //console.log("AA");

});

// Event controller for the seek bar
videoSlider.addEventListener("change", function (e) {
  // Update the video time
  //video.currentTime = video.duration * (videoSlider.value / NUMBER_OF_TICK);
  updateTimerVideo();
});

// Update the seek bar as the video plays
video.addEventListener("timeupdate", function () {
  // Update the slider value
  if (!video.paused) {
    currentValueKnob = NUMBER_OF_TICK / video.duration * video.currentTime + rangeSliderTrack.offsetLeft;
    // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
    knobMin.style.left = currentValueKnob - KNOB_WIDTH / 2 + "px";
  }
  //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
  updateTimerVideo();
}, false);

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown" || e.type === "mousemove" || e.type === "[object MouseEvent]") {
    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

//Update knob on a tablet
var updateKnobAndVideo = function updateKnobAndVideo(event) {
  //  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft+rangeSliderTrack.offsetLeft + dividCommandeVideo.offsetLeft;
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft; //-   ;
  //console.log("aa :  " +  body );

  video.currentTime = Math.round(((event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider) * video.duration / NUMBER_OF_TICK);
  //Update know position
  knobMin.style.left = (event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider + "px";
  if (segmentFeedback.displayed) {
    if (video.currentTime > segmentFeedback.endDurationVideo) {
      feedbackOnSliderVideo(false);
    }
  }
};

//Update knob on a laptop
var updateKnobAndVideoComputer = function updateKnobAndVideoComputer(e) {
  //take into account offset on the left of the scroll bar (body scroll and centering the wrapper)
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft - body.scrollLeft; //- window.scrollLeft  ;
  //currentValueKnob = ((e.clientX - offsetLeftSlider) * video.duration) / NUMBER_OF_TICK;
  currentValueKnob = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
  if (currentValueKnob < video.duration) {
    video.currentTime = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
    knobMin.style.left = e.pageX - (offsetLeftSlider + WIDTH_MID_KNOB_MIN / 2) + "px";
    if (segmentFeedback.displayed) {
      if (video.currentTime > segmentFeedback.endDurationVideo) {
        feedbackOnSliderVideo(false);
      }
    }
  }
};

function feedbackOnSliderVideo(onOff) {
  segmentFeedback.endPosition = parseInt(segmentFeedback.startPostion) + parseInt(segmentFeedback.width);
  var sliderToV = sliderToVideo(segmentFeedback.startPostion, segmentFeedback.endPosition);
  segmentFeedback.startDurationVideo = sliderToV.startDuration;
  segmentFeedback.endDurationVideo = sliderToV.endDuration;
  segmentFeedback.displayed = onOff;
  if (onOff) {
    //segmentFeedback.divGraphicalObject.style.marginLeft = segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.marginLeft = parseInt(segmentFeedback.startPostion) - 5 + "px"; //  segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.visibility = "visible";
    segmentFeedback.divGraphicalObject.style.width = segmentFeedback.width;
  } else {
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
  }
}

function updateTimerVideo() {
  var minutes = Math.floor(video.currentTime / 60);
  var seconds = Math.floor(video.currentTime - minutes * 60);
  if (seconds < 10) seconds = "0" + seconds;
  timerVideo.innerHTML = minutes + ":" + seconds + "/" + videoDuration;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ2aWRlbyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsInBsYXlCdXR0b24iLCJtdXRlQnV0dG9uIiwidGltZXJWaWRlbyIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkIiwicmFuZ2VTbGlkZXJXcmFwcGVyIiwiZGl2Q2FyZEJvYXJkIiwiYm9keSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiS05PQl9XSURUSCIsIk5VTUJFUl9PRl9USUNLIiwiVkFMVUVfS05PQl9NSU4iLCJXSURUSF9NSURfS05PQl9NSU4iLCJjdXJyZW50VmFsdWVLbm9iIiwidmlkZW9EdXJhdGlvbiIsInN0eWxlIiwibGVmdCIsIm9mZnNldExlZnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZXZlbnQiLCJjb25zb2xlIiwibG9nIiwicGxheVBhdXNlY2FsbGJhY2siLCJwYXNzaXZlIiwibXV0ZUJ1dHRvbkNhbGxiYWNrIiwidXBkYXRlVGltZXJWaWRlbyIsInBhdXNlZCIsImR1cmF0aW9uIiwiY3VycmVudFRpbWUiLCJ1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyIiwidHlwZSIsInVwZGF0ZUtub2JBbmRWaWRlb0NvbXB1dGVyIiwidXBkYXRlS25vYkFuZFZpZGVvIiwib2Zmc2V0TGVmdFNsaWRlciIsIk1hdGgiLCJyb3VuZCIsInRhcmdldFRvdWNoZXMiLCJwYWdlWCIsImNoYW5nZWRUb3VjaGVzIiwibGVuZ3RoIiwic2VnbWVudEZlZWRiYWNrIiwiZGlzcGxheWVkIiwiZW5kRHVyYXRpb25WaWRlbyIsImZlZWRiYWNrT25TbGlkZXJWaWRlbyIsInNjcm9sbExlZnQiLCJvbk9mZiIsImVuZFBvc2l0aW9uIiwicGFyc2VJbnQiLCJzdGFydFBvc3Rpb24iLCJ3aWR0aCIsInNsaWRlclRvViIsInNsaWRlclRvVmlkZW8iLCJzdGFydER1cmF0aW9uVmlkZW8iLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJkaXZHcmFwaGljYWxPYmplY3QiLCJtYXJnaW5MZWZ0IiwidmlzaWJpbGl0eSIsIm1pbnV0ZXMiLCJmbG9vciIsInNlY29uZHMiLCJpbm5lckhUTUwiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsUUFBUUMsU0FBU0MsY0FBVCxDQUF3QixVQUF4QixDQUFaO0FBQ0EsSUFBSUMsZUFBSjtBQUNBLElBQUlDLFlBQVksQ0FBaEI7QUFDQSxJQUFJQyxjQUFjSixTQUFTQyxjQUFULENBQXdCLGFBQXhCLENBQWxCO0FBQ0E7QUFDQSxJQUFJSSxhQUFhTCxTQUFTQyxjQUFULENBQXdCLFlBQXhCLENBQWpCO0FBQ0EsSUFBSUssYUFBYU4sU0FBU0MsY0FBVCxDQUF3QixNQUF4QixDQUFqQjtBQUNBLElBQUlNLGFBQWFQLFNBQVNDLGNBQVQsQ0FBd0IsWUFBeEIsQ0FBakI7QUFDQTtBQUNBLElBQUlPLFVBQVVSLFNBQVNDLGNBQVQsQ0FBd0IseUJBQXhCLENBQWQ7QUFDQSxJQUFJUSxtQkFBbUJULFNBQVNDLGNBQVQsQ0FBd0Isa0JBQXhCLENBQXZCO0FBQ0EsSUFBSVMsMkJBQTJCVixTQUFTQyxjQUFULENBQXdCLDBCQUF4QixDQUEvQjs7QUFFQSxJQUFJVSxxQkFBcUJYLFNBQVNDLGNBQVQsQ0FBd0Isc0JBQXhCLENBQXpCO0FBQ0EsSUFBSVcsZUFBZVosU0FBU0MsY0FBVCxDQUF3QixjQUF4QixDQUFuQjtBQUNBLElBQUlZLE9BQU9iLFNBQVNjLG9CQUFULENBQThCLE1BQTlCLEVBQXNDLENBQXRDLENBQVg7O0FBR0EsSUFBSUMsYUFBYSxFQUFqQjs7QUFFQSxJQUFJQyxpQkFBaUIsS0FBckI7QUFDQSxJQUFJQyxpQkFBaUIsQ0FBckI7QUFDQSxJQUFJQyxxQkFBcUIsRUFBekI7QUFDQSxJQUFJQyxtQkFBbUJGLGNBQXZCO0FBQ0EsSUFBSUcsZ0JBQWdC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RUFBaEMsQ0FBZDtBQUNBLE1BQUlnQyxVQUFXMUIsS0FBS3lCLEtBQUwsQ0FBV3BFLE1BQU1xQyxXQUFOLEdBQW9COEIsVUFBVSxFQUF6QyxDQUFmO0FBQ0EsTUFBR0UsVUFBUSxFQUFYLEVBQ0VBLFVBQVUsTUFBSUEsT0FBZDtBQUNGN0QsYUFBVzhELFNBQVgsR0FBdUJILFVBQVEsR0FBUixHQUFZRSxPQUFaLEdBQW9CLEdBQXBCLEdBQXlCaEQsYUFBaEQ7QUFDRCIsImZpbGUiOiJ2aWRlb0NvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRUFUXCIpO1xudmFyIHRpbWVyUmVwZXRpdGlvbjtcbnZhciBzcGVlZHJhdGUgPSAxO1xudmFyIHZpZGVvU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1NsaWRlclwiKTtcbi8vIEJ1dHRvbnNcbnZhciBwbGF5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5LXBhdXNlXCIpO1xudmFyIG11dGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm11dGVcIik7XG52YXIgdGltZXJWaWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXJWaWRlb1wiKTtcbi8vIFNsaWRlcnNcbnZhciBrbm9iTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXJfaGFuZGxlLW1pblwiKTtcbnZhciByYW5nZVNsaWRlclRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZVNsaWRlclRyYWNrXCIpO1xudmFyIHdyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkXCIpO1xuXG52YXIgcmFuZ2VTbGlkZXJXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXItd3JhcHBlclwiKTtcbnZhciBkaXZDYXJkQm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpdkNhcmRCb2FyZFwiKTtcbnZhciBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJCT0RZXCIpWzBdO1xuXG5cbnZhciBLTk9CX1dJRFRIID0gMjU7XG5cbnZhciBOVU1CRVJfT0ZfVElDSyA9IDEwMDAwO1xudmFyIFZBTFVFX0tOT0JfTUlOID0gMDtcbnZhciBXSURUSF9NSURfS05PQl9NSU4gPSAxNTtcbnZhciBjdXJyZW50VmFsdWVLbm9iID0gVkFMVUVfS05PQl9NSU47XG52YXIgdmlkZW9EdXJhdGlvbiA9IFwiMTo0N1wiO1xuXG5cbmtub2JNaW4uc3R5bGUubGVmdCA9ICggIGN1cnJlbnRWYWx1ZUtub2IgKyByYW5nZVNsaWRlclRyYWNrLm9mZnNldExlZnQpICsgXCJweFwiIDtcblxuXG5cblxuXG4vKi0tLS0gQ3JlYXRpb24gZGUgbWEgcHJvcHJlIGJhciBkZSBjb21tYW5kZSBkZSBsZWN0dXJlIHBvdXIgbGEgdmlkw6lvIC0tLS0tICovXG4vLyBFdmVudCBjb250cm9sbGVyIGZvciB0aGUgcGxheS9wYXVzZSBidXR0b25cbnBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnNvbGUubG9nKFwiYXBwZWwgbDM2IHBsYXlQYXVzZWNhbGxiYWNrIHZpZGVvQ29udHJvbGxlclwiICk7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSx7cGFzc2l2ZTogdHJ1ZX0pO1xuLy9DbGljayBvbiB0aGUgdmlkZW8gdHJpZ2dlciBwbGF5IGFuZCBwYXVzZVxudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJhcHBlbCBsNDIgcGxheVBhdXNlY2FsbGJhY2sgdmlkZW9DT250cm9sbGVyXCIpO1xuICBwbGF5UGF1c2VjYWxsYmFjayhlKTtcbn0pO1xubXV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICBtdXRlQnV0dG9uQ2FsbGJhY2soKTtcbn0pO1xucmFuZ2VTbGlkZXJXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gIC8vcGxheSgpO1xuICBjb25zb2xlLmxvZyhcImFwcGVsIGw1MCBwbGF5UGF1c2VjYWxsYmFjayB2aWRlbyBPQ250cm9sbGVyXCIpO1xuICBwbGF5UGF1c2VjYWxsYmFjaygpO1xufSk7XG5cbi8vTW91c2UgZXZlbnQgY29udHJvbGxlclxucGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zb2xlLmxvZyhcImFwcGVsIHBsYXlQYXVzZSBmdW5jdGlvbiBwbGF5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIobW91c2Vkb3duIGluIGw1NiB2aWRlb2NvbnRyb2xsZXJcIikgO1xuICBwbGF5UGF1c2VjYWxsYmFjayhlKTtcbn0pO1xubXV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgbXV0ZUJ1dHRvbkNhbGxiYWNrKCk7XG59KTtcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICBjb25zb2xlLmxvZyhcImFwcGVsIHBsYXlQYXVzZSBmdW5jdGlvbiB2aWRlby5hZGRFdmVudExpc3RlbmVyKG1vdXNlZG93biBpbiBsNjIgdmlkZW9jb250cm9sbGVyXCIpIDtcbiAgcGxheVBhdXNlY2FsbGJhY2soZSk7XG59KTtcbnJhbmdlU2xpZGVyV3JhcHBlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbihlKSB7XG4gICAvL3BsYXkoKTtcbiAgLy9wbGF5UGF1c2VjYWxsYmFjaygpO1xuICAvL2NvbnNvbGUubG9nKFwiQUFcIik7XG4gIFxufSk7XG5cbi8vIEV2ZW50IGNvbnRyb2xsZXIgZm9yIHRoZSBzZWVrIGJhclxudmlkZW9TbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbihlKSB7XG4gIC8vIFVwZGF0ZSB0aGUgdmlkZW8gdGltZVxuICAvL3ZpZGVvLmN1cnJlbnRUaW1lID0gdmlkZW8uZHVyYXRpb24gKiAodmlkZW9TbGlkZXIudmFsdWUgLyBOVU1CRVJfT0ZfVElDSyk7XG4gIHVwZGF0ZVRpbWVyVmlkZW8oKTtcbn0pO1xuXG5cbi8vIFVwZGF0ZSB0aGUgc2VlayBiYXIgYXMgdGhlIHZpZGVvIHBsYXlzXG52aWRlby5hZGRFdmVudExpc3RlbmVyKFwidGltZXVwZGF0ZVwiLCBmdW5jdGlvbigpIHtcbiAgLy8gVXBkYXRlIHRoZSBzbGlkZXIgdmFsdWVcbiAgaWYoIXZpZGVvLnBhdXNlZCl7XG4gICAgY3VycmVudFZhbHVlS25vYiA9ICgoKE5VTUJFUl9PRl9USUNLIC8gdmlkZW8uZHVyYXRpb24pICogdmlkZW8uY3VycmVudFRpbWUpICsgcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0KTtcbiAgICAvLyBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iLShLTk9CX1dJRFRILzIpKyBcInB4XCIgO1xuICAgIGtub2JNaW4uc3R5bGUubGVmdCA9IGN1cnJlbnRWYWx1ZUtub2ItKEtOT0JfV0lEVEgvMikrIFwicHhcIiA7XG4gIH1cbiAgLy92aWRlb1NsaWRlci52YWx1ZSA9IChOVU1CRVJfT0ZfVElDSyAvIHZpZGVvLmR1cmF0aW9uKSAqIHZpZGVvLmN1cnJlbnRUaW1lO1xuICB1cGRhdGVUaW1lclZpZGVvKCk7XG59LCBmYWxzZSk7XG5cblxuXG4vL0Z1bmN0aW9uIHRvIHVwZGF0ZSB0aGUga25vYlxudmFyIHVwZGF0ZUtub2JBbmRWaWRlb1dyYXBwZXIgPSBmdW5jdGlvbihlKXtcbiAgaWYoZS50eXBlID09PSBcIm1vdXNldXBcIiB8fCBlLnR5cGUgPT09IFwibW91c2Vkb3duXCIgfHwgZS50eXBlID09PSBcIm1vdXNlbW92ZVwiIHx8ICBlLnR5cGUgPT09IFwiW29iamVjdCBNb3VzZUV2ZW50XVwiICl7XG4gICAgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIoZSk7XG4gIH0gZWxzZSB7XG4gICAgdXBkYXRlS25vYkFuZFZpZGVvKGUpO1xuICB9XG4gLy8gdmlkZW8ucGxheSgpO1xufTtcblxuXG4vL1VwZGF0ZSBrbm9iIG9uIGEgdGFibGV0XG52YXIgIHVwZGF0ZUtub2JBbmRWaWRlbyA9IGZ1bmN0aW9uKGV2ZW50KXtcbi8vICB2YXIgb2Zmc2V0TGVmdFNsaWRlciA9IHdyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZC5vZmZzZXRMZWZ0K3JhbmdlU2xpZGVyVHJhY2sub2Zmc2V0TGVmdCArIGRpdmlkQ29tbWFuZGVWaWRlby5vZmZzZXRMZWZ0O1xuICB2YXIgb2Zmc2V0TGVmdFNsaWRlciA9IHdyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZC5vZmZzZXRMZWZ0ICA7Ly8tICAgO1xuICAvL2NvbnNvbGUubG9nKFwiYWEgOiAgXCIgKyAgYm9keSApO1xuICBcbiAgdmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLnJvdW5kKCgoKCBldmVudC50YXJnZXRUb3VjaGVzWzBdID8gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGV2ZW50LmNoYW5nZWRUb3VjaGVzW2V2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aC0xXS5wYWdlWCApLShvZmZzZXRMZWZ0U2xpZGVyKSkqdmlkZW8uZHVyYXRpb24pL05VTUJFUl9PRl9USUNLKSA7XG4gIC8vVXBkYXRlIGtub3cgcG9zaXRpb25cbiAga25vYk1pbi5zdHlsZS5sZWZ0ID0gKCgoIChldmVudC50YXJnZXRUb3VjaGVzWzBdID8gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGV2ZW50LmNoYW5nZWRUb3VjaGVzW2V2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aC0xXS5wYWdlWCkpLW9mZnNldExlZnRTbGlkZXIgKSApKyBcInB4XCIgO1xuICBpZihzZWdtZW50RmVlZGJhY2suZGlzcGxheWVkKXtcbiAgICBpZih2aWRlby5jdXJyZW50VGltZSA+IHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvKXtcbiAgICAgIGZlZWRiYWNrT25TbGlkZXJWaWRlbyhmYWxzZSk7XG4gICAgfVxuICB9XG59O1xuXG4vL1VwZGF0ZSBrbm9iIG9uIGEgbGFwdG9wXG52YXIgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIgPSBmdW5jdGlvbihlKXtcbiAgLy90YWtlIGludG8gYWNjb3VudCBvZmZzZXQgb24gdGhlIGxlZnQgb2YgdGhlIHNjcm9sbCBiYXIgKGJvZHkgc2Nyb2xsIGFuZCBjZW50ZXJpbmcgdGhlIHdyYXBwZXIpXG4gIHZhciBvZmZzZXRMZWZ0U2xpZGVyID0gd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkLm9mZnNldExlZnQgLSBib2R5LnNjcm9sbExlZnQ7Ly8tIHdpbmRvdy5zY3JvbGxMZWZ0ICA7XG4gIC8vY3VycmVudFZhbHVlS25vYiA9ICgoZS5jbGllbnRYIC0gb2Zmc2V0TGVmdFNsaWRlcikgKiB2aWRlby5kdXJhdGlvbikgLyBOVU1CRVJfT0ZfVElDSztcbiAgY3VycmVudFZhbHVlS25vYiA9ICgoZS5wYWdlWCAtIG9mZnNldExlZnRTbGlkZXIpICogdmlkZW8uZHVyYXRpb24pIC8gTlVNQkVSX09GX1RJQ0s7XG4gIGlmKGN1cnJlbnRWYWx1ZUtub2IgPCB2aWRlby5kdXJhdGlvbiApIHtcbiAgICB2aWRlby5jdXJyZW50VGltZSA9ICgoZS5wYWdlWCAtIG9mZnNldExlZnRTbGlkZXIpICogdmlkZW8uZHVyYXRpb24pIC8gTlVNQkVSX09GX1RJQ0s7XG4gICAga25vYk1pbi5zdHlsZS5sZWZ0ID0gZS5wYWdlWCAtICAob2Zmc2V0TGVmdFNsaWRlciArICBXSURUSF9NSURfS05PQl9NSU4vMiApICsgXCJweFwiXG4gICAgaWYgKHNlZ21lbnRGZWVkYmFjay5kaXNwbGF5ZWQpIHtcbiAgICAgIGlmICh2aWRlby5jdXJyZW50VGltZSA+IHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvKSB7XG4gICAgICAgIGZlZWRiYWNrT25TbGlkZXJWaWRlbyhmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mdW5jdGlvbiBmZWVkYmFja09uU2xpZGVyVmlkZW8ob25PZmYpe1xuICBzZWdtZW50RmVlZGJhY2suZW5kUG9zaXRpb24gPSBwYXJzZUludChzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uKSArIHBhcnNlSW50KHNlZ21lbnRGZWVkYmFjay53aWR0aCk7XG4gIHZhciBzbGlkZXJUb1YgPSBzbGlkZXJUb1ZpZGVvKCBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uLCBzZWdtZW50RmVlZGJhY2suZW5kUG9zaXRpb24pO1xuICBzZWdtZW50RmVlZGJhY2suc3RhcnREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLnN0YXJ0RHVyYXRpb247XG4gIHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLmVuZER1cmF0aW9uO1xuICBzZWdtZW50RmVlZGJhY2suZGlzcGxheWVkID0gb25PZmY7XG4gIGlmKG9uT2ZmKXtcbiAgICAvL3NlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb247XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5tYXJnaW5MZWZ0ID0gcGFyc2VJbnQoc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbikgLSA1ICtcInB4XCI7Ly8gIHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb247XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS53aWR0aCA9ICBzZWdtZW50RmVlZGJhY2sud2lkdGg7XG4gIH0gZWxzZSB7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIHVwZGF0ZVRpbWVyVmlkZW8oKXtcbiAgbGV0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHZpZGVvLmN1cnJlbnRUaW1lICAvIDYwKTtcbiAgbGV0IHNlY29uZHMgPSAgTWF0aC5mbG9vcih2aWRlby5jdXJyZW50VGltZSAtIG1pbnV0ZXMgKiA2MCk7XG4gIGlmKHNlY29uZHM8MTApXG4gICAgc2Vjb25kcyA9IFwiMFwiK3NlY29uZHM7XG4gIHRpbWVyVmlkZW8uaW5uZXJIVE1MID0gbWludXRlcytcIjpcIitzZWNvbmRzK1wiL1wiKyB2aWRlb0R1cmF0aW9uO1xufVxuXG4iXX0=