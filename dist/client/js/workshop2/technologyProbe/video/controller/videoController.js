"use strict";

var videovjs = document.getElementById("videovjscontrol");
var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");
//var knobMin = document.getElementsByClassName("vjs-button");

var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = parseInt(WIDTH_RANGE_SLIDER_TRACK, 10);
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 15;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

knobMin.style.left = currentValueKnob + rangeSliderTrack.offsetLeft + "px";

/*---- Creation de ma propre bar de commande de lecture pour la vidéo ----- */
// Event controller for the play/pause button
playButton.addEventListener("touchstart", function (e) {
  /*e.preventDefault();
  event.preventDefault();
  //kill('mousedown');
  //console.log("appel l36 playPausecallback videoController" );
  // videoFunctionalCoreManager.execute(new PlayPauseCommand());
  playPausecallback(e);
  //playPausecallback(e);*/
}, {
  passive: true
});

//Click  space to playpause the video
window.addEventListener("keydown", function (e) {
  if (e.keyCode == 32 && e.target == document.body) {
    Player.playPausecallback();
    event.preventDefault();
  }

  // Annuler l'action par défaut pour éviter qu'elle ne soit traitée deux fois.
  event.preventDefault();
}, true);

muteButton.addEventListener("touchend", function (e) {
  e.preventDefault();
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
});

rangeSliderWrapper.addEventListener("touchend", function (e) {
  e.preventDefault();
  Player.playPausecallback(e);
});

//Mouse event controller
playButton.addEventListener("mousedown", function (e) {
  //console.log("appel playPause function playButton.addEventListener(mousedown in l56 videocontroller") ;
  //videoFunctionalCoreManager.execute(new PlayPauseCommand());
  Player.playPausecallback();
  // event.preventDefault();
});
muteButton.addEventListener("mousedown", function (e) {
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
});

if (videovjs !== null) {

  videovjs.addEventListener("mousedown", function (e) {
    //console.log("appel playPause function video.addEventListener(mousedown in l62 videocontroller") ;
    //videoFunctionalCoreManager.execute(new PlayPauseCommand());
    Player.playPausecallback();
  });
  //Click on the video trigger play and pause
  videovjs.addEventListener("touchend", function (e) {
    e.preventDefault();
    Player.playPausecallback(e);
  });

  // Update the seek bar as the video plays
  videovjs.addEventListener("timeupdate", function () {
    // Update the slider value
    if (!videovjs.paused) {
      currentValueKnob = NUMBER_OF_TICK / videovjs.duration * videovjs.currentTime + rangeSliderTrack.offsetLeft;
      // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
      knobMin.style.left = currentValueKnob - KNOB_WIDTH / 2 + "px";
    }
    //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
    Player.updateTimerVideo();
  }, false);
}

// Event controller for the seek bar
videoSlider.addEventListener("change", function (e) {
  Player.updateTimerVideo();
});

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown") {
    videoFunctionalCoreManager.execute(new updateKnobAndVideoComputerCommand(e));

    //updateKnobAndVideoComputer(e);
  } else if (e.type === "mousemove" || e.type === "[object MouseEvent]") {

    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

/*
var video = videojs('videovjscontrol', {
  children: {
    controlBar: {
      children: {
        progressControl: true
      }
    }
  }
});*/

/*.addEventListener("",function () {
console.log("hello");
});*/
/*

var player = videojs('videovjscontrol', {
  controlBar: {
    children: {
      progressControl: true,
      playToggle: true,
      currentTimeDisplay: true,
      timeDivider: true,
      durationDisplay: true,
      //where I want to add custom component - logo brand
      //logoBrand : true,
      //where i want to add theater(not full screen, but larger) mode
      //theaterModeButton : true,
      volumeMenuButton: {
        vertical: true,
        inline: false,
        volumeBar: {
          vertical: true
        },
        volumeLevel: false
      },
      fullscreenToggle: true
    }
  }
});*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ2aWRlb3ZqcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsInBsYXlCdXR0b24iLCJtdXRlQnV0dG9uIiwidGltZXJWaWRlbyIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkIiwicmFuZ2VTbGlkZXJXcmFwcGVyIiwiZGl2Q2FyZEJvYXJkIiwiYm9keSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiS05PQl9XSURUSCIsIk5VTUJFUl9PRl9USUNLIiwicGFyc2VJbnQiLCJXSURUSF9SQU5HRV9TTElERVJfVFJBQ0siLCJWQUxVRV9LTk9CX01JTiIsIldJRFRIX01JRF9LTk9CX01JTiIsImN1cnJlbnRWYWx1ZUtub2IiLCJ2aWRlb0R1cmF0aW9uIiwic3R5bGUiLCJsZWZ0Iiwib2Zmc2V0TGVmdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicGFzc2l2ZSIsIndpbmRvdyIsImtleUNvZGUiLCJ0YXJnZXQiLCJQbGF5ZXIiLCJwbGF5UGF1c2VjYWxsYmFjayIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlciIsImV4ZWN1dGUiLCJNdXRlQnV0dG9uQ29tbWFuZCIsInBhdXNlZCIsImR1cmF0aW9uIiwiY3VycmVudFRpbWUiLCJ1cGRhdGVUaW1lclZpZGVvIiwidXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciIsInR5cGUiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlckNvbW1hbmQiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlciIsInVwZGF0ZUtub2JBbmRWaWRlbyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxXQUFXQyxTQUFTQyxjQUFULENBQXdCLGlCQUF4QixDQUFmO0FBQ0EsSUFBSUMsZUFBSjtBQUNBLElB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UzJCLGdCQUFULENBQTBCLFlBQTFCLEVBQXdDLFlBQVc7QUFDakQ7QUFDQSxRQUFJLENBQUMzQixTQUFTd0MsTUFBZCxFQUFzQjtBQUNwQmxCLHlCQUFzQkwsaUJBQWlCakIsU0FBU3lDLFFBQTNCLEdBQXVDekMsU0FBUzBDLFdBQWpELEdBQWdFaEMsaUJBQWlCZ0IsVUFBckc7QUFDQTtBQUNBakIsY0FBUWUsS0FBUixDQUFjQyxJQUFkLEdBQXFCSCxtQkFBb0JOLGFBQWEsQ0FBakMsR0FBc0MsSUFBM0Q7QUFDRDtBQUNEO0FBQ0FpQixXQUFPVSxnQkFBUDtBQUNELEdBVEQsRUFTRyxLQVRIO0FBWUQ7O0FBSUQ7QUFDQXRDLFlBQVlzQixnQkFBWixDQUE2QixRQUE3QixFQUF1QyxVQUFTQyxDQUFULEVBQVk7QUFDakRLLFNBQU9VLGdCQUFQO0FBQ0QsQ0FGRDs7QUFNQTtBQUNBLElBQUlDLDRCQUE0QixTQUE1QkEseUJBQTRCLENBQVNoQixDQUFULEVBQVk7QUFDMUMsTUFBSUEsRUFBRWlCLElBQUYsS0FBVyxTQUFYLElBQXdCakIsRUFBRWlCLElBQUYsS0FBVyxXQUF2QyxFQUFvRDtBQUNsRFIsK0JBQTJCQyxPQUEzQixDQUFtQyxJQUFJUSxpQ0FBSixDQUFzQ2xCLENBQXRDLENBQW5DOztBQUVBO0FBQ0QsR0FKRCxNQUlPLElBQUdBLEVBQUVpQixJQUFGLEtBQVcsV0FBWCxJQUEwQmpCLEVBQUVpQixJQUFGLEtBQVcscUJBQXhDLEVBQStEOztBQUVwRUUsK0JBQTJCbkIsQ0FBM0I7QUFDRCxHQUhNLE1BR0E7QUFDTG9CLHVCQUFtQnBCLENBQW5CO0FBQ0Q7QUFDRDtBQUNELENBWkQ7O0FBY0E7Ozs7Ozs7Ozs7O0FBV0U7OztBQUdGIiwiZmlsZSI6InZpZGVvQ29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB2aWRlb3ZqcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW92anNjb250cm9sXCIpO1xudmFyIHRpbWVyUmVwZXRpdGlvbjtcbnZhciBzcGVlZHJhdGUgPSAxO1xudmFyIHZpZGVvU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1NsaWRlclwiKTtcbi8vIEJ1dHRvbnNcbnZhciBwbGF5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5LXBhdXNlXCIpO1xudmFyIG11dGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm11dGVcIik7XG52YXIgdGltZXJWaWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXJWaWRlb1wiKTtcbi8vIFNsaWRlcnNcbnZhciBrbm9iTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXJfaGFuZGxlLW1pblwiKTtcbi8vdmFyIGtub2JNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLWJ1dHRvblwiKTtcblxudmFyIHJhbmdlU2xpZGVyVHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlU2xpZGVyVHJhY2tcIik7XG52YXIgd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWRcIik7XG5cbnZhciByYW5nZVNsaWRlcldyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlLXNsaWRlci13cmFwcGVyXCIpO1xudmFyIGRpdkNhcmRCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGl2Q2FyZEJvYXJkXCIpO1xudmFyIGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIkJPRFlcIilbMF07XG5cblxudmFyIEtOT0JfV0lEVEggPSAyNTtcblxudmFyIE5VTUJFUl9PRl9USUNLID0gcGFyc2VJbnQoV0lEVEhfUkFOR0VfU0xJREVSX1RSQUNLLCAxMCk7XG52YXIgVkFMVUVfS05PQl9NSU4gPSAwO1xudmFyIFdJRFRIX01JRF9LTk9CX01JTiA9IDE1O1xudmFyIGN1cnJlbnRWYWx1ZUtub2IgPSBWQUxVRV9LTk9CX01JTjtcbnZhciB2aWRlb0R1cmF0aW9uID0gXCIxOjQ3XCI7XG5cblxua25vYk1pbi5zdHlsZS5sZWZ0ID0gKGN1cnJlbnRWYWx1ZUtub2IgKyByYW5nZVNsaWRlclRyYWNrLm9mZnNldExlZnQpICsgXCJweFwiO1xuXG4vKi0tLS0gQ3JlYXRpb24gZGUgbWEgcHJvcHJlIGJhciBkZSBjb21tYW5kZSBkZSBsZWN0dXJlIHBvdXIgbGEgdmlkw6lvIC0tLS0tICovXG4vLyBFdmVudCBjb250cm9sbGVyIGZvciB0aGUgcGxheS9wYXVzZSBidXR0b25cbnBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24oZSkge1xuICAvKmUucHJldmVudERlZmF1bHQoKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgLy9raWxsKCdtb3VzZWRvd24nKTtcbiAgLy9jb25zb2xlLmxvZyhcImFwcGVsIGwzNiBwbGF5UGF1c2VjYWxsYmFjayB2aWRlb0NvbnRyb2xsZXJcIiApO1xuIC8vIHZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IFBsYXlQYXVzZUNvbW1hbmQoKSk7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xuICAvL3BsYXlQYXVzZWNhbGxiYWNrKGUpOyovXG59LCB7XG4gIHBhc3NpdmU6IHRydWVcbn0pO1xuXG4vL0NsaWNrICBzcGFjZSB0byBwbGF5cGF1c2UgdGhlIHZpZGVvXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgaWYoZS5rZXlDb2RlID09IDMyICYmIGUudGFyZ2V0ID09IGRvY3VtZW50LmJvZHkpIHtcbiAgICBQbGF5ZXIucGxheVBhdXNlY2FsbGJhY2soKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG4gIFxuICBcbiAgLy8gQW5udWxlciBsJ2FjdGlvbiBwYXIgZMOpZmF1dCBwb3VyIMOpdml0ZXIgcXUnZWxsZSBuZSBzb2l0IHRyYWl0w6llIGRldXggZm9pcy5cbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0sIHRydWUpO1xuXG5cblxubXV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIHZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IE11dGVCdXR0b25Db21tYW5kKCkpO1xufSk7XG5cbnJhbmdlU2xpZGVyV3JhcHBlci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIFBsYXllci5wbGF5UGF1c2VjYWxsYmFjayhlKTtcbn0pO1xuXG4vL01vdXNlIGV2ZW50IGNvbnRyb2xsZXJcbnBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gIC8vY29uc29sZS5sb2coXCJhcHBlbCBwbGF5UGF1c2UgZnVuY3Rpb24gcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKG1vdXNlZG93biBpbiBsNTYgdmlkZW9jb250cm9sbGVyXCIpIDtcbiAgLy92aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBQbGF5UGF1c2VDb21tYW5kKCkpO1xuICBQbGF5ZXIucGxheVBhdXNlY2FsbGJhY2soKTtcbiAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0pO1xubXV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgTXV0ZUJ1dHRvbkNvbW1hbmQoKSk7XG4gIFxufSk7XG5cbmlmKHZpZGVvdmpzICE9PSBudWxsKXtcbiAgXG4gIHZpZGVvdmpzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgIC8vY29uc29sZS5sb2coXCJhcHBlbCBwbGF5UGF1c2UgZnVuY3Rpb24gdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihtb3VzZWRvd24gaW4gbDYyIHZpZGVvY29udHJvbGxlclwiKSA7XG4gICAgLy92aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBQbGF5UGF1c2VDb21tYW5kKCkpO1xuICAgIFBsYXllci5wbGF5UGF1c2VjYWxsYmFjaygpO1xuICB9KTtcbi8vQ2xpY2sgb24gdGhlIHZpZGVvIHRyaWdnZXIgcGxheSBhbmQgcGF1c2VcbiAgdmlkZW92anMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgUGxheWVyLnBsYXlQYXVzZWNhbGxiYWNrKGUpO1xuICB9KTtcblxuLy8gVXBkYXRlIHRoZSBzZWVrIGJhciBhcyB0aGUgdmlkZW8gcGxheXNcbiAgdmlkZW92anMuYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgLy8gVXBkYXRlIHRoZSBzbGlkZXIgdmFsdWVcbiAgICBpZiAoIXZpZGVvdmpzLnBhdXNlZCkge1xuICAgICAgY3VycmVudFZhbHVlS25vYiA9ICgoKE5VTUJFUl9PRl9USUNLIC8gdmlkZW92anMuZHVyYXRpb24pICogdmlkZW92anMuY3VycmVudFRpbWUpICsgcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0KTtcbiAgICAgIC8vIGtub2JNaW4uc3R5bGUubGVmdCA9IGN1cnJlbnRWYWx1ZUtub2ItKEtOT0JfV0lEVEgvMikrIFwicHhcIiA7XG4gICAgICBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iIC0gKEtOT0JfV0lEVEggLyAyKSArIFwicHhcIjtcbiAgICB9XG4gICAgLy92aWRlb1NsaWRlci52YWx1ZSA9IChOVU1CRVJfT0ZfVElDSyAvIHZpZGVvLmR1cmF0aW9uKSAqIHZpZGVvLmN1cnJlbnRUaW1lO1xuICAgIFBsYXllci51cGRhdGVUaW1lclZpZGVvKCk7XG4gIH0sIGZhbHNlKTtcbiAgXG4gIFxufVxuXG5cblxuLy8gRXZlbnQgY29udHJvbGxlciBmb3IgdGhlIHNlZWsgYmFyXG52aWRlb1NsaWRlci5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgUGxheWVyLnVwZGF0ZVRpbWVyVmlkZW8oKTtcbn0pO1xuXG5cblxuLy9GdW5jdGlvbiB0byB1cGRhdGUgdGhlIGtub2JcbnZhciB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyID0gZnVuY3Rpb24oZSkge1xuICBpZiAoZS50eXBlID09PSBcIm1vdXNldXBcIiB8fCBlLnR5cGUgPT09IFwibW91c2Vkb3duXCIgKXtcbiAgICB2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyB1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlckNvbW1hbmQoZSkpO1xuICAgIFxuICAgIC8vdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIoZSk7XG4gIH0gZWxzZSBpZihlLnR5cGUgPT09IFwibW91c2Vtb3ZlXCIgfHwgZS50eXBlID09PSBcIltvYmplY3QgTW91c2VFdmVudF1cIikge1xuICBcbiAgICB1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlcihlKTtcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGVLbm9iQW5kVmlkZW8oZSk7XG4gIH1cbiAgLy8gdmlkZW8ucGxheSgpO1xufTtcblxuLypcbnZhciB2aWRlbyA9IHZpZGVvanMoJ3ZpZGVvdmpzY29udHJvbCcsIHtcbiAgY2hpbGRyZW46IHtcbiAgICBjb250cm9sQmFyOiB7XG4gICAgICBjaGlsZHJlbjoge1xuICAgICAgICBwcm9ncmVzc0NvbnRyb2w6IHRydWVcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pOyovXG5cbiAgLyouYWRkRXZlbnRMaXN0ZW5lcihcIlwiLGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXCJoZWxsb1wiKTtcbn0pOyovXG4vKlxuXG52YXIgcGxheWVyID0gdmlkZW9qcygndmlkZW92anNjb250cm9sJywge1xuICBjb250cm9sQmFyOiB7XG4gICAgY2hpbGRyZW46IHtcbiAgICAgIHByb2dyZXNzQ29udHJvbDogdHJ1ZSxcbiAgICAgIHBsYXlUb2dnbGU6IHRydWUsXG4gICAgICBjdXJyZW50VGltZURpc3BsYXk6IHRydWUsXG4gICAgICB0aW1lRGl2aWRlcjogdHJ1ZSxcbiAgICAgIGR1cmF0aW9uRGlzcGxheTogdHJ1ZSxcbiAgICAgIC8vd2hlcmUgSSB3YW50IHRvIGFkZCBjdXN0b20gY29tcG9uZW50IC0gbG9nbyBicmFuZFxuICAgICAgLy9sb2dvQnJhbmQgOiB0cnVlLFxuICAgICAgLy93aGVyZSBpIHdhbnQgdG8gYWRkIHRoZWF0ZXIobm90IGZ1bGwgc2NyZWVuLCBidXQgbGFyZ2VyKSBtb2RlXG4gICAgICAvL3RoZWF0ZXJNb2RlQnV0dG9uIDogdHJ1ZSxcbiAgICAgIHZvbHVtZU1lbnVCdXR0b246IHtcbiAgICAgICAgdmVydGljYWw6IHRydWUsXG4gICAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICAgIHZvbHVtZUJhcjoge1xuICAgICAgICAgIHZlcnRpY2FsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHZvbHVtZUxldmVsOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGZ1bGxzY3JlZW5Ub2dnbGU6IHRydWVcbiAgICB9XG4gIH1cbn0pOyovXG4iXX0=