"use strict";

var video = document.getElementById("videoEAT");
var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");
var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = parseInt(WIDTH_RANGE_SLIDER_TRACK, 10);
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 15;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

knobMin.style.left = currentValueKnob + rangeSliderTrack.offsetLeft + "px";

/*---- Creation de ma propre bar de commande de lecture pour la vidÃ©o ----- */
// Event controller for the play/pause button
playButton.addEventListener("touchstart", function (e) {
  e.preventDefault();
  event.preventDefault();
  kill('mousedown');
  //console.log("appel l36 playPausecallback videoController" );
  playPausecallback(e);
}, {
  passive: true
});
//Click on the video trigger play and pause
video.addEventListener("touchend", function (e) {
  //console.log("appel l42 playPausecallback videoCOntroller");
  playPausecallback(e);
});
muteButton.addEventListener("touchend", function (e) {
  muteButtonCallback();
});
rangeSliderWrapper.addEventListener("touchend", function (e) {
  //play();
  //console.log("appel l50 playPausecallback video Controller");
  playPausecallback();
});

//Mouse event controller
playButton.addEventListener("mousedown", function (e) {

  //console.log("appel playPause function playButton.addEventListener(mousedown in l56 videocontroller") ;
  playPausecallback(e);
  e.preventDefault();
  // event.preventDefault();
});
muteButton.addEventListener("mousedown", function (e) {
  muteButtonCallback();
});
video.addEventListener("mousedown", function (e) {
  //console.log("appel playPause function video.addEventListener(mousedown in l62 videocontroller") ;
  playPausecallback(e);
});

// Event controller for the seek bar
videoSlider.addEventListener("change", function (e) {
  updateTimerVideo();
});

// Update the seek bar as the video plays
video.addEventListener("timeupdate", function () {
  // Update the slider value
  if (!video.paused) {
    currentValueKnob = NUMBER_OF_TICK / video.duration * video.currentTime + rangeSliderTrack.offsetLeft;
    // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
    knobMin.style.left = currentValueKnob - KNOB_WIDTH / 2 + "px";
  }
  //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
  updateTimerVideo();
}, false);

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown" || e.type === "mousemove" || e.type === "[object MouseEvent]") {
    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

//Update knob on a tablet
var updateKnobAndVideo = function updateKnobAndVideo(event) {
  //  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft+rangeSliderTrack.offsetLeft + dividCommandeVideo.offsetLeft;
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft; //-   ;
  //console.log("aa :  " +  body );

  video.currentTime = Math.round(((event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider) * video.duration / NUMBER_OF_TICK);
  //Update know position
  knobMin.style.left = (event.targetTouches[0] ? event.targetTouches[0].pageX : event.changedTouches[event.changedTouches.length - 1].pageX) - offsetLeftSlider + "px";
  if (segmentFeedback.displayed) {
    if (video.currentTime > segmentFeedback.endDurationVideo) {
      feedbackOnSliderVideo(false);
    }
  }
};

//Update knob on a laptop
var updateKnobAndVideoComputer = function updateKnobAndVideoComputer(e) {
  //take into account offset on the left of the scroll bar (body scroll and centering the wrapper)
  var offsetLeftSlider = wrapperCommandAndRangeid.offsetLeft - body.scrollLeft; //- window.scrollLeft  ;
  currentValueKnob = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
  if (currentValueKnob < video.duration && currentValueKnob >= 0) {
    video.currentTime = (e.pageX - offsetLeftSlider) * video.duration / NUMBER_OF_TICK;
    knobMin.style.left = e.pageX - (offsetLeftSlider + WIDTH_MID_KNOB_MIN / 2) + "px";
    if (segmentFeedback.displayed) {
      if (video.currentTime > segmentFeedback.endDurationVideo) {
        feedbackOnSliderVideo(false);
      }
    }
  }
};

function feedbackOnSliderVideo(onOff) {
  segmentFeedback.endPosition = parseInt(segmentFeedback.startPostion) + parseInt(segmentFeedback.width);
  var sliderToV = sliderToVideo(segmentFeedback.startPostion, segmentFeedback.endPosition);
  segmentFeedback.startDurationVideo = sliderToV.startDuration;
  segmentFeedback.endDurationVideo = sliderToV.endDuration;
  segmentFeedback.displayed = onOff;
  if (onOff) {
    //segmentFeedback.divGraphicalObject.style.marginLeft = segmentFeedback.startPostion;
    //minus 2 because we need to get 2 frame before the segment
    segmentFeedback.divGraphicalObject.style.marginLeft = parseInt(segmentFeedback.startPostion) - 7 + "px"; //  segmentFeedback.startPostion;
    segmentFeedback.divGraphicalObject.style.visibility = "visible";
    segmentFeedback.divGraphicalObject.style.width = segmentFeedback.width;
  } else {
    segmentFeedback.divGraphicalObject.style.visibility = "hidden";
  }
}

function updateTimerVideo() {
  var minutes = Math.floor(video.currentTime / 60);
  var seconds = Math.floor(video.currentTime - minutes * 60);
  if (seconds < 10) seconds = "0" + seconds;
  timerVideo.innerHTML = minutes + ":" + seconds + "/" + videoDuration;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ2aWRlbyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsInBsYXlCdXR0b24iLCJtdXRlQnV0dG9uIiwidGltZXJWaWRlbyIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkIiwicmFuZ2VTbGlkZXJXcmFwcGVyIiwiZGl2Q2FyZEJvYXJkIiwiYm9keSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiS05PQl9XSURUSCIsIk5VTUJFUl9PRl9USUNLIiwicGFyc2VJbnQiLCJXSURUSF9SQU5HRV9TTElERVJfVFJBQ0siLCJWQUxVRV9LTk9CX01JTiIsIldJRFRIX01JRF9LTk9CX01JTiIsImN1cnJlbnRWYWx1ZUtub2IiLCJ2aWRlb0R1cmF0aW9uIiwic3R5bGUiLCJsZWZ0Iiwib2Zmc2V0TGVmdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJldmVudCIsImtpbGwiLCJwbGF5UGF1c2VjYWxsYmFjayIsInBhc3NpdmUiLCJtdXRlQnV0dG9uQ2FsbGJhY2siLCJ1cGRhdGVUaW1lclZpZGVvIiwicGF1c2VkIiwiZHVyYXRpb24iLCJjdXJyZW50VGltZSIsInVwZGF0ZUtub2JBbmRWaWRlb1dyYXBwZXIiLCJ0eXBlIiwidXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIiLCJ1cGRhdGVLbm9iQW5kVmlkZW8iLCJvZmZzZXRMZWZ0U2xpZGVyIiwiTWF0aCIsInJvdW5kIiwidGFyZ2V0VG91Y2hlcyIsInBhZ2VYIiwiY2hhbmdlZFRvdWNoZXMiLCJsZW5ndGgiLCJzZWdtZW50RmVlZGJhY2siLCJkaXNwbGF5ZWQiLCJlbmREdXJhdGlvblZpZGVvIiwiZmVlZGJhY2tPblNsaWRlclZpZGVvIiwic2Nyb2xsTGVmdCIsIm9uT2ZmIiwiZW5kUG9zaXRpb24iLCJzdGFydFBvc3Rpb24iLCJ3aWR0aCIsInNsaWRlclRvViIsInNsaWRlclRvVmlkZW8iLCJzdGFydER1cmF0aW9uVmlkZW8iLCJzdGFydER1cmF0aW9uIiwiZW5kRHVyYXRpb24iLCJkaXZHcmFwaGljYWxPYmplY3QiLCJtYXJnaW5MZWZ0IiwidmlzaWJpbGl0eSIsIm1pbnV0ZXMiLCJmbG9vciIsInNlY29uZHMiLCJpbm5lckhUTUwiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsUUFBUUMsU0FBU0MsY0FBVCxDQUF3QixVQUF4QixDQUFaO0FBQ0EsSUFBSUMsZUFBSjtBQUNBLElBQUlDLFlBQVksQ0FBaEI7QUFDQSxJQUFJQyxjQUFjSixTQUFTQyxjQUFULENBQXdCLGFBQXhCLENBQWxCO0FBQ0E7QUFDQSxJQUFJSSxhQUFhTCxTQUFTQyxjQUFULENBQXdCLFlBQXhCLENBQWpCO0FBQ0EsSUFBSUssYUFBYU4sU0FBU0MsY0FBVCxDQUF3QixNQUF4QixDQUFqQjtBQUNBLElBQUlNLGFBQWFQLFNBQVNDLGNBQVQsQ0FBd0IsWUFBeEIsQ0FBakI7QUFDQTtBQUNBLElBQUlPLFVBQVVSLFNBQVNDLGNBQVQsQ0FBd0IseUJBQXhCLENBQWQ7QUFDQSxJQUFJUSxtQkFBbUJULFNBQVNDLGNBQVQsQ0FBd0Isa0JBQXhCLENBQXZCO0FBQ0EsSUFBSVMsMkJBQTJCVixTQUFTQyxjQUFULENBQXdCLDBCQUF4QixDQUEvQjs7QUFFQSxJQUFJVSxxQkFBcUJYLFNBQVNDLGNBQVQsQ0FBd0Isc0JBQXhCLENBQXpCO0FBQ0EsSUFBSVcsZUFBZVosU0FBU0MsY0FBVCxDQUF3QixjQUF4QixDQUFuQjtBQUNBLElBQUlZLE9BQU9iLFNBQVNjLG9CQUFULENBQThCLE1BQTlCLEVBQXNDLENBQXRDLENBQVg7O0FBR0EsSUFBSUMsYUFBYSxFQUFqQjs7QUFFQSxJQUFJQyxpQkFBaUJDLFNBQVNDLHdCQUFULEVBQW1DLEVBQW5DLENBQXJCO0FBQ0EsSUFBSUMsaUJBQWlCLENBQXJCO0FBQ0EsSUFBSUMscUJBQXFCLEVBQXpC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Q0Y3RCxhQUFXOEQsU0FBWCxHQUF1QkgsVUFBVSxHQUFWLEdBQWdCRSxPQUFoQixHQUEwQixHQUExQixHQUFnQzlDLGFBQXZEO0FBQ0QiLCJmaWxlIjoidmlkZW9Db250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0VBVFwiKTtcbnZhciB0aW1lclJlcGV0aXRpb247XG52YXIgc3BlZWRyYXRlID0gMTtcbnZhciB2aWRlb1NsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TbGlkZXJcIik7XG4vLyBCdXR0b25zXG52YXIgcGxheUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheS1wYXVzZVwiKTtcbnZhciBtdXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtdXRlXCIpO1xudmFyIHRpbWVyVmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRpbWVyVmlkZW9cIik7XG4vLyBTbGlkZXJzXG52YXIga25vYk1pbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyX2hhbmRsZS1taW5cIik7XG52YXIgcmFuZ2VTbGlkZXJUcmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2VTbGlkZXJUcmFja1wiKTtcbnZhciB3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZFwiKTtcblxudmFyIHJhbmdlU2xpZGVyV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyLXdyYXBwZXJcIik7XG52YXIgZGl2Q2FyZEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXZDYXJkQm9hcmRcIik7XG52YXIgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiQk9EWVwiKVswXTtcblxuXG52YXIgS05PQl9XSURUSCA9IDI1O1xuXG52YXIgTlVNQkVSX09GX1RJQ0sgPSBwYXJzZUludChXSURUSF9SQU5HRV9TTElERVJfVFJBQ0ssIDEwKTtcbnZhciBWQUxVRV9LTk9CX01JTiA9IDA7XG52YXIgV0lEVEhfTUlEX0tOT0JfTUlOID0gMTU7XG52YXIgY3VycmVudFZhbHVlS25vYiA9IFZBTFVFX0tOT0JfTUlOO1xudmFyIHZpZGVvRHVyYXRpb24gPSBcIjE6NDdcIjtcblxuXG5rbm9iTWluLnN0eWxlLmxlZnQgPSAoY3VycmVudFZhbHVlS25vYiArIHJhbmdlU2xpZGVyVHJhY2sub2Zmc2V0TGVmdCkgKyBcInB4XCI7XG5cblxuXG5cbi8qLS0tLSBDcmVhdGlvbiBkZSBtYSBwcm9wcmUgYmFyIGRlIGNvbW1hbmRlIGRlIGxlY3R1cmUgcG91ciBsYSB2aWTDqW8gLS0tLS0gKi9cbi8vIEV2ZW50IGNvbnRyb2xsZXIgZm9yIHRoZSBwbGF5L3BhdXNlIGJ1dHRvblxucGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAga2lsbCgnbW91c2Vkb3duJyk7XG4gIC8vY29uc29sZS5sb2coXCJhcHBlbCBsMzYgcGxheVBhdXNlY2FsbGJhY2sgdmlkZW9Db250cm9sbGVyXCIgKTtcbiAgcGxheVBhdXNlY2FsbGJhY2soZSk7XG59LCB7XG4gIHBhc3NpdmU6IHRydWVcbn0pO1xuLy9DbGljayBvbiB0aGUgdmlkZW8gdHJpZ2dlciBwbGF5IGFuZCBwYXVzZVxudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgLy9jb25zb2xlLmxvZyhcImFwcGVsIGw0MiBwbGF5UGF1c2VjYWxsYmFjayB2aWRlb0NPbnRyb2xsZXJcIik7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSk7XG5tdXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gIG11dGVCdXR0b25DYWxsYmFjaygpO1xufSk7XG5yYW5nZVNsaWRlcldyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgLy9wbGF5KCk7XG4gIC8vY29uc29sZS5sb2coXCJhcHBlbCBsNTAgcGxheVBhdXNlY2FsbGJhY2sgdmlkZW8gQ29udHJvbGxlclwiKTtcbiAgcGxheVBhdXNlY2FsbGJhY2soKTtcbn0pO1xuXG4vL01vdXNlIGV2ZW50IGNvbnRyb2xsZXJcbnBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gIFxuICAvL2NvbnNvbGUubG9nKFwiYXBwZWwgcGxheVBhdXNlIGZ1bmN0aW9uIHBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihtb3VzZWRvd24gaW4gbDU2IHZpZGVvY29udHJvbGxlclwiKSA7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTtcbm11dGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gIG11dGVCdXR0b25DYWxsYmFjaygpO1xufSk7XG52aWRlby5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgLy9jb25zb2xlLmxvZyhcImFwcGVsIHBsYXlQYXVzZSBmdW5jdGlvbiB2aWRlby5hZGRFdmVudExpc3RlbmVyKG1vdXNlZG93biBpbiBsNjIgdmlkZW9jb250cm9sbGVyXCIpIDtcbiAgcGxheVBhdXNlY2FsbGJhY2soZSk7XG59KTtcblxuXG4vLyBFdmVudCBjb250cm9sbGVyIGZvciB0aGUgc2VlayBiYXJcbnZpZGVvU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24oZSkge1xuICB1cGRhdGVUaW1lclZpZGVvKCk7XG59KTtcblxuXG4vLyBVcGRhdGUgdGhlIHNlZWsgYmFyIGFzIHRoZSB2aWRlbyBwbGF5c1xudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgZnVuY3Rpb24oKSB7XG4gIC8vIFVwZGF0ZSB0aGUgc2xpZGVyIHZhbHVlXG4gIGlmICghdmlkZW8ucGF1c2VkKSB7XG4gICAgY3VycmVudFZhbHVlS25vYiA9ICgoKE5VTUJFUl9PRl9USUNLIC8gdmlkZW8uZHVyYXRpb24pICogdmlkZW8uY3VycmVudFRpbWUpICsgcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0KTtcbiAgICAvLyBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iLShLTk9CX1dJRFRILzIpKyBcInB4XCIgO1xuICAgIGtub2JNaW4uc3R5bGUubGVmdCA9IGN1cnJlbnRWYWx1ZUtub2IgLSAoS05PQl9XSURUSCAvIDIpICsgXCJweFwiO1xuICB9XG4gIC8vdmlkZW9TbGlkZXIudmFsdWUgPSAoTlVNQkVSX09GX1RJQ0sgLyB2aWRlby5kdXJhdGlvbikgKiB2aWRlby5jdXJyZW50VGltZTtcbiAgdXBkYXRlVGltZXJWaWRlbygpO1xufSwgZmFsc2UpO1xuXG5cblxuLy9GdW5jdGlvbiB0byB1cGRhdGUgdGhlIGtub2JcbnZhciB1cGRhdGVLbm9iQW5kVmlkZW9XcmFwcGVyID0gZnVuY3Rpb24oZSkge1xuICBpZiAoZS50eXBlID09PSBcIm1vdXNldXBcIiB8fCBlLnR5cGUgPT09IFwibW91c2Vkb3duXCIgfHwgZS50eXBlID09PSBcIm1vdXNlbW92ZVwiIHx8IGUudHlwZSA9PT0gXCJbb2JqZWN0IE1vdXNlRXZlbnRdXCIpIHtcbiAgICB1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlcihlKTtcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGVLbm9iQW5kVmlkZW8oZSk7XG4gIH1cbiAgLy8gdmlkZW8ucGxheSgpO1xufTtcblxuXG4vL1VwZGF0ZSBrbm9iIG9uIGEgdGFibGV0XG52YXIgdXBkYXRlS25vYkFuZFZpZGVvID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gIHZhciBvZmZzZXRMZWZ0U2xpZGVyID0gd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkLm9mZnNldExlZnQrcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0ICsgZGl2aWRDb21tYW5kZVZpZGVvLm9mZnNldExlZnQ7XG4gIHZhciBvZmZzZXRMZWZ0U2xpZGVyID0gd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkLm9mZnNldExlZnQ7IC8vLSAgIDtcbiAgLy9jb25zb2xlLmxvZyhcImFhIDogIFwiICsgIGJvZHkgKTtcbiAgXG4gIHZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5yb3VuZCgoKChldmVudC50YXJnZXRUb3VjaGVzWzBdID8gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGV2ZW50LmNoYW5nZWRUb3VjaGVzW2V2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aCAtIDFdLnBhZ2VYKSAtIChvZmZzZXRMZWZ0U2xpZGVyKSkgKiB2aWRlby5kdXJhdGlvbikgLyBOVU1CRVJfT0ZfVElDSyk7XG4gIC8vVXBkYXRlIGtub3cgcG9zaXRpb25cbiAga25vYk1pbi5zdHlsZS5sZWZ0ID0gKCgoKGV2ZW50LnRhcmdldFRvdWNoZXNbMF0gPyBldmVudC50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZXZlbnQuY2hhbmdlZFRvdWNoZXNbZXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoIC0gMV0ucGFnZVgpKSAtIG9mZnNldExlZnRTbGlkZXIpKSArIFwicHhcIjtcbiAgaWYgKHNlZ21lbnRGZWVkYmFjay5kaXNwbGF5ZWQpIHtcbiAgICBpZiAodmlkZW8uY3VycmVudFRpbWUgPiBzZWdtZW50RmVlZGJhY2suZW5kRHVyYXRpb25WaWRlbykge1xuICAgICAgZmVlZGJhY2tPblNsaWRlclZpZGVvKGZhbHNlKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vVXBkYXRlIGtub2Igb24gYSBsYXB0b3BcbnZhciB1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlciA9IGZ1bmN0aW9uKGUpIHtcbiAgLy90YWtlIGludG8gYWNjb3VudCBvZmZzZXQgb24gdGhlIGxlZnQgb2YgdGhlIHNjcm9sbCBiYXIgKGJvZHkgc2Nyb2xsIGFuZCBjZW50ZXJpbmcgdGhlIHdyYXBwZXIpXG4gIHZhciBvZmZzZXRMZWZ0U2xpZGVyID0gd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkLm9mZnNldExlZnQgLSBib2R5LnNjcm9sbExlZnQ7IC8vLSB3aW5kb3cuc2Nyb2xsTGVmdCAgO1xuICBjdXJyZW50VmFsdWVLbm9iID0gKChlLnBhZ2VYIC0gb2Zmc2V0TGVmdFNsaWRlcikgKiB2aWRlby5kdXJhdGlvbikgLyBOVU1CRVJfT0ZfVElDSztcbiAgaWYgKGN1cnJlbnRWYWx1ZUtub2IgPCB2aWRlby5kdXJhdGlvbiAmJiBjdXJyZW50VmFsdWVLbm9iID49IDApIHtcbiAgICB2aWRlby5jdXJyZW50VGltZSA9ICgoZS5wYWdlWCAtIG9mZnNldExlZnRTbGlkZXIpICogdmlkZW8uZHVyYXRpb24pIC8gTlVNQkVSX09GX1RJQ0s7XG4gICAga25vYk1pbi5zdHlsZS5sZWZ0ID0gZS5wYWdlWCAtIChvZmZzZXRMZWZ0U2xpZGVyICsgV0lEVEhfTUlEX0tOT0JfTUlOIC8gMikgKyBcInB4XCI7XG4gICAgaWYgKHNlZ21lbnRGZWVkYmFjay5kaXNwbGF5ZWQpIHtcbiAgICAgIGlmICh2aWRlby5jdXJyZW50VGltZSA+IHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvKSB7XG4gICAgICAgIGZlZWRiYWNrT25TbGlkZXJWaWRlbyhmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mdW5jdGlvbiBmZWVkYmFja09uU2xpZGVyVmlkZW8ob25PZmYpIHtcbiAgc2VnbWVudEZlZWRiYWNrLmVuZFBvc2l0aW9uID0gcGFyc2VJbnQoc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbikgKyBwYXJzZUludChzZWdtZW50RmVlZGJhY2sud2lkdGgpO1xuICB2YXIgc2xpZGVyVG9WID0gc2xpZGVyVG9WaWRlbyhzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uLCBzZWdtZW50RmVlZGJhY2suZW5kUG9zaXRpb24pO1xuICBzZWdtZW50RmVlZGJhY2suc3RhcnREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLnN0YXJ0RHVyYXRpb247XG4gIHNlZ21lbnRGZWVkYmFjay5lbmREdXJhdGlvblZpZGVvID0gc2xpZGVyVG9WLmVuZER1cmF0aW9uO1xuICBzZWdtZW50RmVlZGJhY2suZGlzcGxheWVkID0gb25PZmY7XG4gIGlmIChvbk9mZikge1xuICAgIC8vc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5tYXJnaW5MZWZ0ID0gc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbjtcbiAgICAvL21pbnVzIDIgYmVjYXVzZSB3ZSBuZWVkIHRvIGdldCAyIGZyYW1lIGJlZm9yZSB0aGUgc2VnbWVudFxuICAgIHNlZ21lbnRGZWVkYmFjay5kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IHBhcnNlSW50KHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb24pIC0gNyArIFwicHhcIjsgLy8gIHNlZ21lbnRGZWVkYmFjay5zdGFydFBvc3Rpb247XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gICAgc2VnbWVudEZlZWRiYWNrLmRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS53aWR0aCA9IHNlZ21lbnRGZWVkYmFjay53aWR0aDtcbiAgfSBlbHNlIHtcbiAgICBzZWdtZW50RmVlZGJhY2suZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG59XG5cblxuZnVuY3Rpb24gdXBkYXRlVGltZXJWaWRlbygpIHtcbiAgbGV0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHZpZGVvLmN1cnJlbnRUaW1lIC8gNjApO1xuICBsZXQgc2Vjb25kcyA9IE1hdGguZmxvb3IodmlkZW8uY3VycmVudFRpbWUgLSBtaW51dGVzICogNjApO1xuICBpZiAoc2Vjb25kcyA8IDEwKVxuICAgIHNlY29uZHMgPSBcIjBcIiArIHNlY29uZHM7XG4gIHRpbWVyVmlkZW8uaW5uZXJIVE1MID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcyArIFwiL1wiICsgdmlkZW9EdXJhdGlvbjtcbn0iXX0=