"use strict";

var videovjs = document.getElementById("videovjscontrol");
var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");
//var knobMin = document.getElementsByClassName("vjs-button");

var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = parseInt(WIDTH_RANGE_SLIDER_TRACK, 10);
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 15;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

knobMin.style.left = currentValueKnob + rangeSliderTrack.offsetLeft + "px";

/*---- Creation de ma propre bar de commande de lecture pour la vidéo ----- */
// Event controller for the play/pause button
/*playButton.addEventListener("touchstart", function(e) {
  /!*e.preventDefault();
  event.preventDefault();
  //kill('mousedown');
  //console.log("appel l36 playPausecallback videoController" );
 // videoFunctionalCoreManager.execute(new PlayPauseCommand());
  playPausecallback(e);
  //playPausecallback(e);*!/
}, {
  passive: true
});*/

//Click  space to playpause the video
window.addEventListener("keydown", function (e) {
  if (e.keyCode == 32 && e.target == document.body) {
    Player.playPausecallback();
    event.preventDefault();
  }
  // Annuler l'action par défaut pour éviter qu'elle ne soit traitée deux fois.
  event.preventDefault();
}, true);

/*muteButton.addEventListener("touchend", function(e) {
  e.preventDefault();
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
});*/

rangeSliderWrapper.addEventListener("touchend", function (e) {
  e.preventDefault();
  Player.playPausecallback(e);
});

//Mouse event controller
/*playButton.addEventListener("mousedown", function(e) {
  //console.log("appel playPause function playButton.addEventListener(mousedown in l56 videocontroller") ;
  //videoFunctionalCoreManager.execute(new PlayPauseCommand());
  Player.playPausecallback();
  // event.preventDefault();
});*/
/*muteButton.addEventListener("mousedown", function(e) {
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
  
});*/

if (videovjs !== null) {

  videovjs.addEventListener("mousedown", function (e) {
    //console.log("appel playPause function video.addEventListener(mousedown in l62 videocontroller") ;
    //videoFunctionalCoreManager.execute(new PlayPauseCommand());
    Player.playPausecallback();
  });
  //Click on the video trigger play and pause
  videovjs.addEventListener("touchend", function (e) {
    e.preventDefault();
    Player.playPausecallback(e);
  });

  // Update the seek bar as the video plays
  videovjs.addEventListener("timeupdate", function () {
    // Update the slider value
    if (!videovjs.paused) {
      currentValueKnob = NUMBER_OF_TICK / videovjs.duration * videovjs.currentTime + rangeSliderTrack.offsetLeft;
      // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
      knobMin.style.left = currentValueKnob - KNOB_WIDTH / 2 + "px";
    }
    //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
    Player.updateTimerVideo();
  }, false);
}

// Event controller for the seek bar
videoSlider.addEventListener("change", function (e) {
  Player.updateTimerVideo();
});

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown") {
    videoFunctionalCoreManager.execute(new updateKnobAndVideoComputerCommand(e));

    //updateKnobAndVideoComputer(e);
  } else if (e.type === "mousemove" || e.type === "[object MouseEvent]") {

    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

var mytest = videojs('videojjjs', {
  controls: true,
  autoplay: false,
  preload: 'auto'
});

mytest.userActive(false);

var eventT = new EventTarget();
console.log(eventT);
var handleBar = function handleBar() {
  console.log('bar was triggered');
};

eventT.addEventListener('bar', handleBar);

// This causes any `event listeners` for the `bar` event to get called
// see EventTarget#trigger for more information
//eventT.trigger('bar');
// logs 'bar was triggered'
/*

var vjs_progress_control = document.getElementsByClassName("vjs-progress-control")[0];

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
});

vjs_progress_control.addEventListener("long-press", function(e) {
  console.log("Hallo");
});
*/

//seekbar.handleMouseDown();
/*
var seekBarVideojs = document.getElementsByClassName("vjs-remaining-time-display")[0];




//test sur videojs
console.log(vjs_progress_control);

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
}, {
  passive: true
});*/
/*

seekBarVideojs.addEventListener(['mousedown', 'touchstart'], function (e) {
  console.log("helloooo");
} );*/
/*





var vjs_progress_control = document.getElementsByClassName("vjs-progress-control")[0];
//test sur videojs
console.log(vjs_progress_control);

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
}, {
  passive: true
});


var seekBarVideojs = document.getElementsByClassName("vjs-slider-horizontal")[1];

seekBarVideojs.addEventListener("mousedown", function(e){
  console.log("jajaja");
});

var p = document.getElementsByClassName("vjs-control")[6];
p.addEventListener("mousedown", function(e){
  pause();
  longpressCreateSegmentCallback(e);
  console.log("jojo");

});
*/

/*

seekBarVideojs.addEventListener("long-press", function(e){
  pause();
  longpressCreateSegmentCallback(e);
});
*/

/*
var player = videojs('videovjscontrol');

var myComponent = new Component(player);
var button = new Component(player);

var myButton = myComponent.addChild(button, {
  text: 'Press Me',
  buttonChildExample: {
    buttonChildOption: true
  }
});*/

//var video = videojs('videovjscontrol');
/*.addEventListener("",function () {
console.log("hello");
});*/

/*

var player = videojs('videovjscontrol', {
  controlBar: {
    children: {
      progressControl: true,
      playToggle: true,
      currentTimeDisplay: true,
      timeDivider: true,
      durationDisplay: true,
      //where I want to add custom component - logo brand
      //logoBrand : true,
      //where i want to add theater(not full screen, but larger) mode
      //theaterModeButton : true,
      volumeMenuButton: {
        vertical: true,
        inline: false,
        volumeBar: {
          vertical: true
        },
        volumeLevel: false
      },
      fullscreenToggle: true
    }
  }
});*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ2aWRlb3ZqcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsInBsYXlCdXR0b24iLCJtdXRlQnV0dG9uIiwidGltZXJWaWRlbyIsImtub2JNaW4iLCJyYW5nZVNsaWRlclRyYWNrIiwid3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkIiwicmFuZ2VTbGlkZXJXcmFwcGVyIiwiZGl2Q2FyZEJvYXJkIiwiYm9keSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiS05PQl9XSURUSCIsIk5VTUJFUl9PRl9USUNLIiwicGFyc2VJbnQiLCJXSURUSF9SQU5HRV9TTElERVJfVFJBQ0siLCJWQUxVRV9LTk9CX01JTiIsIldJRFRIX01JRF9LTk9CX01JTiIsImN1cnJlbnRWYWx1ZUtub2IiLCJ2aWRlb0R1cmF0aW9uIiwic3R5bGUiLCJsZWZ0Iiwib2Zmc2V0TGVmdCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwia2V5Q29kZSIsInRhcmdldCIsIlBsYXllciIsInBsYXlQYXVzZWNhbGxiYWNrIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInBhdXNlZCIsImR1cmF0aW9uIiwiY3VycmVudFRpbWUiLCJ1cGRhdGVUaW1lclZpZGVvIiwidXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciIsInR5cGUiLCJ2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlciIsImV4ZWN1dGUiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlckNvbW1hbmQiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlciIsInVwZGF0ZUtub2JBbmRWaWRlbyIsIm15dGVzdCIsInZpZGVvanMiLCJjb250cm9scyIsImF1dG9wbGF5IiwicHJlbG9hZCIsInVzZXJBY3RpdmUiLCJldmVudFQiLCJFdmVudFRhcmdldCIsImNvbnNvbGUiLCJsb2ciLCJoYW5kbGVCYXIi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dXJjZXNDb250ZW50IjpbInZhciB2aWRlb3ZqcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW92anNjb250cm9sXCIpO1xudmFyIHRpbWVyUmVwZXRpdGlvbjtcbnZhciBzcGVlZHJhdGUgPSAxO1xudmFyIHZpZGVvU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1NsaWRlclwiKTtcbi8vIEJ1dHRvbnNcbnZhciBwbGF5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5LXBhdXNlXCIpO1xudmFyIG11dGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm11dGVcIik7XG52YXIgdGltZXJWaWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXJWaWRlb1wiKTtcbi8vIFNsaWRlcnNcbnZhciBrbm9iTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyYW5nZS1zbGlkZXJfaGFuZGxlLW1pblwiKTtcbi8vdmFyIGtub2JNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLWJ1dHRvblwiKTtcblxudmFyIHJhbmdlU2xpZGVyVHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlU2xpZGVyVHJhY2tcIik7XG52YXIgd3JhcHBlckNvbW1hbmRBbmRSYW5nZWlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWRcIik7XG5cbnZhciByYW5nZVNsaWRlcldyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlLXNsaWRlci13cmFwcGVyXCIpO1xudmFyIGRpdkNhcmRCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGl2Q2FyZEJvYXJkXCIpO1xudmFyIGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIkJPRFlcIilbMF07XG5cblxudmFyIEtOT0JfV0lEVEggPSAyNTtcblxudmFyIE5VTUJFUl9PRl9USUNLID0gcGFyc2VJbnQoV0lEVEhfUkFOR0VfU0xJREVSX1RSQUNLLCAxMCk7XG52YXIgVkFMVUVfS05PQl9NSU4gPSAwO1xudmFyIFdJRFRIX01JRF9LTk9CX01JTiA9IDE1O1xudmFyIGN1cnJlbnRWYWx1ZUtub2IgPSBWQUxVRV9LTk9CX01JTjtcbnZhciB2aWRlb0R1cmF0aW9uID0gXCIxOjQ3XCI7XG5cblxua25vYk1pbi5zdHlsZS5sZWZ0ID0gKGN1cnJlbnRWYWx1ZUtub2IgKyByYW5nZVNsaWRlclRyYWNrLm9mZnNldExlZnQpICsgXCJweFwiO1xuXG4vKi0tLS0gQ3JlYXRpb24gZGUgbWEgcHJvcHJlIGJhciBkZSBjb21tYW5kZSBkZSBsZWN0dXJlIHBvdXIgbGEgdmlkw6lvIC0tLS0tICovXG4vLyBFdmVudCBjb250cm9sbGVyIGZvciB0aGUgcGxheS9wYXVzZSBidXR0b25cbi8qcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gIC8hKmUucHJldmVudERlZmF1bHQoKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgLy9raWxsKCdtb3VzZWRvd24nKTtcbiAgLy9jb25zb2xlLmxvZyhcImFwcGVsIGwzNiBwbGF5UGF1c2VjYWxsYmFjayB2aWRlb0NvbnRyb2xsZXJcIiApO1xuIC8vIHZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IFBsYXlQYXVzZUNvbW1hbmQoKSk7XG4gIHBsYXlQYXVzZWNhbGxiYWNrKGUpO1xuICAvL3BsYXlQYXVzZWNhbGxiYWNrKGUpOyohL1xufSwge1xuICBwYXNzaXZlOiB0cnVlXG59KTsqL1xuXG4vL0NsaWNrICBzcGFjZSB0byBwbGF5cGF1c2UgdGhlIHZpZGVvXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgaWYoZS5rZXlDb2RlID09IDMyICYmIGUudGFyZ2V0ID09IGRvY3VtZW50LmJvZHkpIHtcbiAgICBQbGF5ZXIucGxheVBhdXNlY2FsbGJhY2soKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG4gIC8vIEFubnVsZXIgbCdhY3Rpb24gcGFyIGTDqWZhdXQgcG91ciDDqXZpdGVyIHF1J2VsbGUgbmUgc29pdCB0cmFpdMOpZSBkZXV4IGZvaXMuXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59LCB0cnVlKTtcblxuXG5cbi8qbXV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIHZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IE11dGVCdXR0b25Db21tYW5kKCkpO1xufSk7Ki9cblxucmFuZ2VTbGlkZXJXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgUGxheWVyLnBsYXlQYXVzZWNhbGxiYWNrKGUpO1xufSk7XG5cbi8vTW91c2UgZXZlbnQgY29udHJvbGxlclxuLypwbGF5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAvL2NvbnNvbGUubG9nKFwiYXBwZWwgcGxheVBhdXNlIGZ1bmN0aW9uIHBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihtb3VzZWRvd24gaW4gbDU2IHZpZGVvY29udHJvbGxlclwiKSA7XG4gIC8vdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgUGxheVBhdXNlQ29tbWFuZCgpKTtcbiAgUGxheWVyLnBsYXlQYXVzZWNhbGxiYWNrKCk7XG4gIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTsqL1xuLyptdXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICB2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBNdXRlQnV0dG9uQ29tbWFuZCgpKTtcbiAgXG59KTsqL1xuXG5pZih2aWRlb3ZqcyAhPT0gbnVsbCl7XG4gIFxuICB2aWRlb3Zqcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAvL2NvbnNvbGUubG9nKFwiYXBwZWwgcGxheVBhdXNlIGZ1bmN0aW9uIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIobW91c2Vkb3duIGluIGw2MiB2aWRlb2NvbnRyb2xsZXJcIikgO1xuICAgIC8vdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgUGxheVBhdXNlQ29tbWFuZCgpKTtcbiAgICBQbGF5ZXIucGxheVBhdXNlY2FsbGJhY2soKTtcbiAgfSk7XG4vL0NsaWNrIG9uIHRoZSB2aWRlbyB0cmlnZ2VyIHBsYXkgYW5kIHBhdXNlXG4gIHZpZGVvdmpzLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFBsYXllci5wbGF5UGF1c2VjYWxsYmFjayhlKTtcbiAgfSk7XG5cbi8vIFVwZGF0ZSB0aGUgc2VlayBiYXIgYXMgdGhlIHZpZGVvIHBsYXlzXG4gIHZpZGVvdmpzLmFkZEV2ZW50TGlzdGVuZXIoXCJ0aW1ldXBkYXRlXCIsIGZ1bmN0aW9uKCkge1xuICAgIC8vIFVwZGF0ZSB0aGUgc2xpZGVyIHZhbHVlXG4gICAgaWYgKCF2aWRlb3Zqcy5wYXVzZWQpIHtcbiAgICAgIGN1cnJlbnRWYWx1ZUtub2IgPSAoKChOVU1CRVJfT0ZfVElDSyAvIHZpZGVvdmpzLmR1cmF0aW9uKSAqIHZpZGVvdmpzLmN1cnJlbnRUaW1lKSArIHJhbmdlU2xpZGVyVHJhY2sub2Zmc2V0TGVmdCk7XG4gICAgICAvLyBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iLShLTk9CX1dJRFRILzIpKyBcInB4XCIgO1xuICAgICAga25vYk1pbi5zdHlsZS5sZWZ0ID0gY3VycmVudFZhbHVlS25vYiAtIChLTk9CX1dJRFRIIC8gMikgKyBcInB4XCI7XG4gICAgfVxuICAgIC8vdmlkZW9TbGlkZXIudmFsdWUgPSAoTlVNQkVSX09GX1RJQ0sgLyB2aWRlby5kdXJhdGlvbikgKiB2aWRlby5jdXJyZW50VGltZTtcbiAgICBQbGF5ZXIudXBkYXRlVGltZXJWaWRlbygpO1xuICB9LCBmYWxzZSk7XG4gIFxuICBcbn1cblxuXG5cbi8vIEV2ZW50IGNvbnRyb2xsZXIgZm9yIHRoZSBzZWVrIGJhclxudmlkZW9TbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbihlKSB7XG4gIFBsYXllci51cGRhdGVUaW1lclZpZGVvKCk7XG59KTtcblxuXG5cbi8vRnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBrbm9iXG52YXIgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciA9IGZ1bmN0aW9uKGUpIHtcbiAgaWYgKGUudHlwZSA9PT0gXCJtb3VzZXVwXCIgfHwgZS50eXBlID09PSBcIm1vdXNlZG93blwiICl7XG4gICAgdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXJDb21tYW5kKGUpKTtcbiAgICBcbiAgICAvL3VwZGF0ZUtub2JBbmRWaWRlb0NvbXB1dGVyKGUpO1xuICB9IGVsc2UgaWYoZS50eXBlID09PSBcIm1vdXNlbW92ZVwiIHx8IGUudHlwZSA9PT0gXCJbb2JqZWN0IE1vdXNlRXZlbnRdXCIpIHtcbiAgXG4gICAgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIoZSk7XG4gIH0gZWxzZSB7XG4gICAgdXBkYXRlS25vYkFuZFZpZGVvKGUpO1xuICB9XG4gIC8vIHZpZGVvLnBsYXkoKTtcbn07XG5cblxuXG5cbnZhciBteXRlc3QgPSB2aWRlb2pzKCd2aWRlb2pqanMnLHtcbiAgY29udHJvbHM6IHRydWUsXG4gIGF1dG9wbGF5OiBmYWxzZSxcbiAgcHJlbG9hZDogJ2F1dG8nXG59KTtcblxubXl0ZXN0LnVzZXJBY3RpdmUoZmFsc2UpO1xuXG52YXIgZXZlbnRUID0gbmV3IEV2ZW50VGFyZ2V0KCk7XG5jb25zb2xlLmxvZyhldmVudFQpO1xudmFyIGhhbmRsZUJhciA9IGZ1bmN0aW9uKCkge1xuICBjb25zb2xlLmxvZygnYmFyIHdhcyB0cmlnZ2VyZWQnKTtcbn07XG5cbmV2ZW50VC5hZGRFdmVudExpc3RlbmVyKCdiYXInLCBoYW5kbGVCYXIpO1xuXG5cbi8vIFRoaXMgY2F1c2VzIGFueSBgZXZlbnQgbGlzdGVuZXJzYCBmb3IgdGhlIGBiYXJgIGV2ZW50IHRvIGdldCBjYWxsZWRcbi8vIHNlZSBFdmVudFRhcmdldCN0cmlnZ2VyIGZvciBtb3JlIGluZm9ybWF0aW9uXG4vL2V2ZW50VC50cmlnZ2VyKCdiYXInKTtcbi8vIGxvZ3MgJ2JhciB3YXMgdHJpZ2dlcmVkJ1xuLypcblxudmFyIHZqc19wcm9ncmVzc19jb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInZqcy1wcm9ncmVzcy1jb250cm9sXCIpWzBdO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0pO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibG9uZy1wcmVzc1wiLCBmdW5jdGlvbihlKSB7XG4gIGNvbnNvbGUubG9nKFwiSGFsbG9cIik7XG59KTtcbiovXG5cbi8vc2Vla2Jhci5oYW5kbGVNb3VzZURvd24oKTtcbi8qXG52YXIgc2Vla0JhclZpZGVvanMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLXJlbWFpbmluZy10aW1lLWRpc3BsYXlcIilbMF07XG5cblxuXG5cbi8vdGVzdCBzdXIgdmlkZW9qc1xuY29uc29sZS5sb2codmpzX3Byb2dyZXNzX2NvbnRyb2wpO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0sIHtcbiAgcGFzc2l2ZTogdHJ1ZVxufSk7Ki9cbi8qXG5cbnNlZWtCYXJWaWRlb2pzLmFkZEV2ZW50TGlzdGVuZXIoWydtb3VzZWRvd24nLCAndG91Y2hzdGFydCddLCBmdW5jdGlvbiAoZSkge1xuICBjb25zb2xlLmxvZyhcImhlbGxvb29vXCIpO1xufSApOyovXG4vKlxuXG5cblxuXG5cbnZhciB2anNfcHJvZ3Jlc3NfY29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ2anMtcHJvZ3Jlc3MtY29udHJvbFwiKVswXTtcbi8vdGVzdCBzdXIgdmlkZW9qc1xuY29uc29sZS5sb2codmpzX3Byb2dyZXNzX2NvbnRyb2wpO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0sIHtcbiAgcGFzc2l2ZTogdHJ1ZVxufSk7XG5cblxudmFyIHNlZWtCYXJWaWRlb2pzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInZqcy1zbGlkZXItaG9yaXpvbnRhbFwiKVsxXTtcblxuc2Vla0JhclZpZGVvanMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKXtcbiAgY29uc29sZS5sb2coXCJqYWphamFcIik7XG59KTtcblxudmFyIHAgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLWNvbnRyb2xcIilbNl07XG5wLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSl7XG4gIHBhdXNlKCk7XG4gIGxvbmdwcmVzc0NyZWF0ZVNlZ21lbnRDYWxsYmFjayhlKTtcbiAgY29uc29sZS5sb2coXCJqb2pvXCIpO1xuXG59KTtcbiovXG5cbi8qXG5cbnNlZWtCYXJWaWRlb2pzLmFkZEV2ZW50TGlzdGVuZXIoXCJsb25nLXByZXNzXCIsIGZ1bmN0aW9uKGUpe1xuICBwYXVzZSgpO1xuICBsb25ncHJlc3NDcmVhdGVTZWdtZW50Q2FsbGJhY2soZSk7XG59KTtcbiovXG5cbi8qXG52YXIgcGxheWVyID0gdmlkZW9qcygndmlkZW92anNjb250cm9sJyk7XG5cbnZhciBteUNvbXBvbmVudCA9IG5ldyBDb21wb25lbnQocGxheWVyKTtcbnZhciBidXR0b24gPSBuZXcgQ29tcG9uZW50KHBsYXllcik7XG5cbnZhciBteUJ1dHRvbiA9IG15Q29tcG9uZW50LmFkZENoaWxkKGJ1dHRvbiwge1xuICB0ZXh0OiAnUHJlc3MgTWUnLFxuICBidXR0b25DaGlsZEV4YW1wbGU6IHtcbiAgICBidXR0b25DaGlsZE9wdGlvbjogdHJ1ZVxuICB9XG59KTsqL1xuXG5cblxuLy92YXIgdmlkZW8gPSB2aWRlb2pzKCd2aWRlb3Zqc2NvbnRyb2wnKTtcbiAgLyouYWRkRXZlbnRMaXN0ZW5lcihcIlwiLGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXCJoZWxsb1wiKTtcbn0pOyovXG5cblxuLypcblxudmFyIHBsYXllciA9IHZpZGVvanMoJ3ZpZGVvdmpzY29udHJvbCcsIHtcbiAgY29udHJvbEJhcjoge1xuICAgIGNoaWxkcmVuOiB7XG4gICAgICBwcm9ncmVzc0NvbnRyb2w6IHRydWUsXG4gICAgICBwbGF5VG9nZ2xlOiB0cnVlLFxuICAgICAgY3VycmVudFRpbWVEaXNwbGF5OiB0cnVlLFxuICAgICAgdGltZURpdmlkZXI6IHRydWUsXG4gICAgICBkdXJhdGlvbkRpc3BsYXk6IHRydWUsXG4gICAgICAvL3doZXJlIEkgd2FudCB0byBhZGQgY3VzdG9tIGNvbXBvbmVudCAtIGxvZ28gYnJhbmRcbiAgICAgIC8vbG9nb0JyYW5kIDogdHJ1ZSxcbiAgICAgIC8vd2hlcmUgaSB3YW50IHRvIGFkZCB0aGVhdGVyKG5vdCBmdWxsIHNjcmVlbiwgYnV0IGxhcmdlcikgbW9kZVxuICAgICAgLy90aGVhdGVyTW9kZUJ1dHRvbiA6IHRydWUsXG4gICAgICB2b2x1bWVNZW51QnV0dG9uOiB7XG4gICAgICAgIHZlcnRpY2FsOiB0cnVlLFxuICAgICAgICBpbmxpbmU6IGZhbHNlLFxuICAgICAgICB2b2x1bWVCYXI6IHtcbiAgICAgICAgICB2ZXJ0aWNhbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB2b2x1bWVMZXZlbDogZmFsc2VcbiAgICAgIH0sXG4gICAgICBmdWxsc2NyZWVuVG9nZ2xlOiB0cnVlXG4gICAgfVxuICB9XG59KTsqL1xuIl19