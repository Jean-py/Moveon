"use strict";

var timerRepetition;
var speedrate = 1;
var videoSlider = document.getElementById("videoSlider");
// Buttons
var playButton = document.getElementById("play-pause");
var muteButton = document.getElementById("mute");
var timerVideo = document.getElementById("timerVideo");
// Sliders
var knobMin = document.getElementById("range-slider_handle-min");

var rangeSliderTrack = document.getElementById("rangeSliderTrack");
var wrapperCommandAndRangeid = document.getElementById("wrapperCommandAndRangeid");

var rangeSliderWrapper = document.getElementById("range-slider-wrapper");
var divCardBoard = document.getElementById("divCardBoard");
var body = document.getElementsByTagName("BODY")[0];

var KNOB_WIDTH = 25;

var NUMBER_OF_TICK = parseInt(WIDTH_RANGE_SLIDER_TRACK, 10);
var VALUE_KNOB_MIN = 0;
var WIDTH_MID_KNOB_MIN = 0.5;
var currentValueKnob = VALUE_KNOB_MIN;
var videoDuration = "1:47";

//Click  space to playpause the video
document.addEventListener("keydown", function (e) {
  if (document.activeElement.className === 'textSegment') {} else if (e.keyCode == 32) {
    console.log("in the if keydown");
    player.playPausecallback();
    event.preventDefault();
  }
  // Annuler l'action par défaut pour éviter qu'elle ne soit traitée deux fois.
  //event.preventDefault();
}, true);

/*muteButton.addEventListener("touchend", function(e) {
  e.preventDefault();
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
});*/
if (rangeSliderWrapper != null) {

  rangeSliderWrapper.addEventListener("touchend", function (e) {
    e.preventDefault();
    Player.playPausecallback(e);
  });
}

//Mouse event controller
/*playButton.addEventListener("mousedown", function(e) {
  //console.log("appel playPause function playButton.addEventListener(mousedown in l56 videocontroller") ;
  //videoFunctionalCoreManager.execute(new PlayPauseCommand());
  Player.playPausecallback();
  // event.preventDefault();
});*/
/*muteButton.addEventListener("mousedown", function(e) {
  videoFunctionalCoreManager.execute(new MuteButtonCommand());
  
});*/
if (video_current !== null) {

  video_current.ready(function () {
    this.on('timeupdate', function () {
      knobMin.style.left = parseFloat(document.getElementsByClassName("vjs-play-progress")[0].style.width, 10) - WIDTH_MID_KNOB_MIN + "%"; // Returns (string) "70px"
    });
  });

  /*
  video_current.addEventListener("mousedown", function(e) {
    //console.log("appel playPause function video.addEventListener(mousedown in l62 videocontroller") ;
    //videoFunctionalCoreManager.execute(new PlayPauseCommand());
    player.playPausecallback();
  });
  //Click on the video trigger play and pause
  video_current.addEventListener("touchend", function(e) {
    e.preventDefault();
    player.playPausecallback(e);
  });
  // Update the seek bar as the video plays
  video_current.addEventListener("timeupdate", function() {
    // Update the slider value
    if (!video_current.paused) {
      currentValueKnob = (((NUMBER_OF_TICK / video_current.duration) * video_current.currentTime) + rangeSliderTrack.offsetLeft);
      // knobMin.style.left = currentValueKnob-(KNOB_WIDTH/2)+ "px" ;
      knobMin.style.left = currentValueKnob - (KNOB_WIDTH / 2) + "px";
    }
    //videoSlider.value = (NUMBER_OF_TICK / video.duration) * video.currentTime;
    player.updateTimerVideo();
  }, false);*/
}

//Function to update the knob
var updateKnobAndVideoWrapper = function updateKnobAndVideoWrapper(e) {
  if (e.type === "mouseup" || e.type === "mousedown") {
    videoFunctionalCoreManager.execute(new updateKnobAndVideoComputerCommand(e));

    //updateKnobAndVideoComputer(e);
  } else if (e.type === "mousemove" || e.type === "[object MouseEvent]") {

    updateKnobAndVideoComputer(e);
  } else {
    updateKnobAndVideo(e);
  }
  // video.play();
};

/*

var eventT = new EventTarget();
console.log(eventT);
var handleBar = function() {
  console.log('bar was triggered');
};

eventT.addEventListener('bar', handleBar);
eventT.trigger('bar');
*/

/*

var mytest = videojs('videojs',{
  controls: false,
  autoplay: false,
  preload: 'auto'
});*/
//myPlayer.addChild('BigPlayButton');
/*

mytest.userActive(false);


*/

// This causes any `event listeners` for the `bar` event to get called
// see EventTarget#trigger for more information
// logs 'bar was triggered'
/*

var vjs_progress_control = document.getElementsByClassName("vjs-progress-control")[0];

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
});

vjs_progress_control.addEventListener("long-press", function(e) {
  console.log("Hallo");
});
*/

//seekbar.handleMouseDown();
/*
var seekBarVideojs = document.getElementsByClassName("vjs-remaining-time-display")[0];




//test sur videojs
console.log(vjs_progress_control);

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
}, {
  passive: true
});*/
/*

seekBarVideojs.addEventListener(['mousedown', 'touchstart'], function (e) {
  console.log("helloooo");
} );*/
/*





var vjs_progress_control = document.getElementsByClassName("vjs-progress-control")[0];
//test sur videojs
console.log(vjs_progress_control);

vjs_progress_control.addEventListener("mousedown", function(e) {
  console.log("holla");
}, {
  passive: true
});


var seekBarVideojs = document.getElementsByClassName("vjs-slider-horizontal")[1];

seekBarVideojs.addEventListener("mousedown", function(e){
  console.log("jajaja");
});

var p = document.getElementsByClassName("vjs-control")[6];
p.addEventListener("mousedown", function(e){
  pause();
  longpressCreateSegmentCallback(e);
  console.log("jojo");

});
*/

/*

seekBarVideojs.addEventListener("long-press", function(e){
  pause();
  longpressCreateSegmentCallback(e);
});
*/

/*
var player = videojs('videovjscontrol');

var myComponent = new Component(player);
var button = new Component(player);

var myButton = myComponent.addChild(button, {
  text: 'Press Me',
  buttonChildExample: {
    buttonChildOption: true
  }
});*/

//var video = videojs('videovjscontrol');
/*.addEventListener("",function () {
console.log("hello");
});*/

/*

var player = videojs('videovjscontrol', {
  controlBar: {
    children: {
      progressControl: true,
      playToggle: true,
      currentTimeDisplay: true,
      timeDivider: true,
      durationDisplay: true,
      //where I want to add custom component - logo brand
      //logoBrand : true,
      //where i want to add theater(not full screen, but larger) mode
      //theaterModeButton : true,
      volumeMenuButton: {
        vertical: true,
        inline: false,
        volumeBar: {
          vertical: true
        },
        volumeLevel: false
      },
      fullscreenToggle: true
    }
  }
});*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJ0aW1lclJlcGV0aXRpb24iLCJzcGVlZHJhdGUiLCJ2aWRlb1NsaWRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwbGF5QnV0dG9uIiwibXV0ZUJ1dHRvbiIsInRpbWVyVmlkZW8iLCJrbm9iTWluIiwicmFuZ2VTbGlkZXJUcmFjayIsIndyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZCIsInJhbmdlU2xpZGVyV3JhcHBlciIsImRpdkNhcmRCb2FyZCIsImJvZHkiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsIktOT0JfV0lEVEgiLCJOVU1CRVJfT0ZfVElDSyIsInBhcnNlSW50IiwiV0lEVEhfUkFOR0VfU0xJREVSX1RSQUNLIiwiVkFMVUVfS05PQl9NSU4iLCJXSURUSF9NSURfS05PQl9NSU4iLCJjdXJyZW50VmFsdWVLbm9iIiwidmlkZW9EdXJhdGlvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiYWN0aXZlRWxlbWVudCIsImNsYXNzTmFtZSIsImtleUNvZGUiLCJjb25zb2xlIiwibG9nIiwicGxheWVyIiwicGxheVBhdXNlY2FsbGJhY2siLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiUGxheWVyIiwidmlkZW9fY3VycmVudCIsInJlYWR5Iiwib24iLCJzdHlsZSIsImxlZnQiLCJwYXJzZUZsb2F0IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsIndpZHRoIiwidXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciIsInR5cGUiLCJ2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlciIsImV4ZWN1dGUiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlckNvbW1hbmQiLCJ1cGRhdGVLbm9iQW5kVmlkZW9Db21wdXRlciIsInVwZGF0ZUtub2JBbmRWaWRlbyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxlQUFKO0FBQ0EsSUFBSUMsWUFBWSxDQUFoQjtBQUNBLElBQUlDLGNBQWNDLFNBQVNDLGNBQVQs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QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUFhQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQWNBOzs7OztBQUtBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWdDQTs7Ozs7Ozs7QUFRQTs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0U7Ozs7QUFLRiIsImZpbGUiOiJ2aWRlb0NvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdGltZXJSZXBldGl0aW9uO1xudmFyIHNwZWVkcmF0ZSA9IDE7XG52YXIgdmlkZW9TbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvU2xpZGVyXCIpO1xuLy8gQnV0dG9uc1xudmFyIHBsYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXktcGF1c2VcIik7XG52YXIgbXV0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibXV0ZVwiKTtcbnZhciB0aW1lclZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0aW1lclZpZGVvXCIpO1xuLy8gU2xpZGVyc1xudmFyIGtub2JNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhbmdlLXNsaWRlcl9oYW5kbGUtbWluXCIpO1xuXG52YXIgcmFuZ2VTbGlkZXJUcmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2VTbGlkZXJUcmFja1wiKTtcbnZhciB3cmFwcGVyQ29tbWFuZEFuZFJhbmdlaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndyYXBwZXJDb21tYW5kQW5kUmFuZ2VpZFwiKTtcblxudmFyIHJhbmdlU2xpZGVyV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFuZ2Utc2xpZGVyLXdyYXBwZXJcIik7XG52YXIgZGl2Q2FyZEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXZDYXJkQm9hcmRcIik7XG52YXIgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiQk9EWVwiKVswXTtcblxuXG52YXIgS05PQl9XSURUSCA9IDI1O1xuXG52YXIgTlVNQkVSX09GX1RJQ0sgPSBwYXJzZUludChXSURUSF9SQU5HRV9TTElERVJfVFJBQ0ssIDEwKTtcbnZhciBWQUxVRV9LTk9CX01JTiA9IDA7XG52YXIgV0lEVEhfTUlEX0tOT0JfTUlOID0gMC41O1xudmFyIGN1cnJlbnRWYWx1ZUtub2IgPSBWQUxVRV9LTk9CX01JTjtcbnZhciB2aWRlb0R1cmF0aW9uID0gXCIxOjQ3XCI7XG5cblxuLy9DbGljayAgc3BhY2UgdG8gcGxheXBhdXNlIHRoZSB2aWRlb1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgaWYoICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmNsYXNzTmFtZSA9PT0gJ3RleHRTZWdtZW50Jykge1xuICBcbiAgfSBlbHNlIGlmKGUua2V5Q29kZSA9PSAzMil7XG4gICAgY29uc29sZS5sb2coXCJpbiB0aGUgaWYga2V5ZG93blwiKTtcbiAgICBwbGF5ZXIucGxheVBhdXNlY2FsbGJhY2soKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG4gIC8vIEFubnVsZXIgbCdhY3Rpb24gcGFyIGTDqWZhdXQgcG91ciDDqXZpdGVyIHF1J2VsbGUgbmUgc29pdCB0cmFpdMOpZSBkZXV4IGZvaXMuXG4gIC8vZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0sIHRydWUpO1xuXG5cblxuLyptdXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgTXV0ZUJ1dHRvbkNvbW1hbmQoKSk7XG59KTsqL1xuaWYocmFuZ2VTbGlkZXJXcmFwcGVyICE9IG51bGwpe1xuICBcbiAgcmFuZ2VTbGlkZXJXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFBsYXllci5wbGF5UGF1c2VjYWxsYmFjayhlKTtcbiAgfSk7XG59XG5cbi8vTW91c2UgZXZlbnQgY29udHJvbGxlclxuLypwbGF5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAvL2NvbnNvbGUubG9nKFwiYXBwZWwgcGxheVBhdXNlIGZ1bmN0aW9uIHBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihtb3VzZWRvd24gaW4gbDU2IHZpZGVvY29udHJvbGxlclwiKSA7XG4gIC8vdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgUGxheVBhdXNlQ29tbWFuZCgpKTtcbiAgUGxheWVyLnBsYXlQYXVzZWNhbGxiYWNrKCk7XG4gIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTsqL1xuLyptdXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICB2aWRlb0Z1bmN0aW9uYWxDb3JlTWFuYWdlci5leGVjdXRlKG5ldyBNdXRlQnV0dG9uQ29tbWFuZCgpKTtcbiAgXG59KTsqL1xuaWYodmlkZW9fY3VycmVudCAhPT0gbnVsbCl7XG4gXG4gdmlkZW9fY3VycmVudC5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vbigndGltZXVwZGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAga25vYk1pbi5zdHlsZS5sZWZ0ID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLXBsYXktcHJvZ3Jlc3NcIilbMF0uc3R5bGUud2lkdGgsMTApIC0gV0lEVEhfTUlEX0tOT0JfTUlOICtcIiVcIiA7IC8vIFJldHVybnMgKHN0cmluZykgXCI3MHB4XCJcbiAgICB9KVxuICB9KTtcbiAgXG4gIC8qXG4gIHZpZGVvX2N1cnJlbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgLy9jb25zb2xlLmxvZyhcImFwcGVsIHBsYXlQYXVzZSBmdW5jdGlvbiB2aWRlby5hZGRFdmVudExpc3RlbmVyKG1vdXNlZG93biBpbiBsNjIgdmlkZW9jb250cm9sbGVyXCIpIDtcbiAgICAvL3ZpZGVvRnVuY3Rpb25hbENvcmVNYW5hZ2VyLmV4ZWN1dGUobmV3IFBsYXlQYXVzZUNvbW1hbmQoKSk7XG4gICAgcGxheWVyLnBsYXlQYXVzZWNhbGxiYWNrKCk7XG4gIH0pO1xuLy9DbGljayBvbiB0aGUgdmlkZW8gdHJpZ2dlciBwbGF5IGFuZCBwYXVzZVxuICB2aWRlb19jdXJyZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHBsYXllci5wbGF5UGF1c2VjYWxsYmFjayhlKTtcbiAgfSk7XG5cbi8vIFVwZGF0ZSB0aGUgc2VlayBiYXIgYXMgdGhlIHZpZGVvIHBsYXlzXG4gIHZpZGVvX2N1cnJlbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgLy8gVXBkYXRlIHRoZSBzbGlkZXIgdmFsdWVcbiAgICBpZiAoIXZpZGVvX2N1cnJlbnQucGF1c2VkKSB7XG4gICAgICBjdXJyZW50VmFsdWVLbm9iID0gKCgoTlVNQkVSX09GX1RJQ0sgLyB2aWRlb19jdXJyZW50LmR1cmF0aW9uKSAqIHZpZGVvX2N1cnJlbnQuY3VycmVudFRpbWUpICsgcmFuZ2VTbGlkZXJUcmFjay5vZmZzZXRMZWZ0KTtcbiAgICAgIC8vIGtub2JNaW4uc3R5bGUubGVmdCA9IGN1cnJlbnRWYWx1ZUtub2ItKEtOT0JfV0lEVEgvMikrIFwicHhcIiA7XG4gICAgICBrbm9iTWluLnN0eWxlLmxlZnQgPSBjdXJyZW50VmFsdWVLbm9iIC0gKEtOT0JfV0lEVEggLyAyKSArIFwicHhcIjtcbiAgICB9XG4gICAgLy92aWRlb1NsaWRlci52YWx1ZSA9IChOVU1CRVJfT0ZfVElDSyAvIHZpZGVvLmR1cmF0aW9uKSAqIHZpZGVvLmN1cnJlbnRUaW1lO1xuICAgIHBsYXllci51cGRhdGVUaW1lclZpZGVvKCk7XG4gIH0sIGZhbHNlKTsqL1xuICBcbiAgXG59XG5cblxuXG5cbi8vRnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBrbm9iXG52YXIgdXBkYXRlS25vYkFuZFZpZGVvV3JhcHBlciA9IGZ1bmN0aW9uKGUpIHtcbiAgaWYgKGUudHlwZSA9PT0gXCJtb3VzZXVwXCIgfHwgZS50eXBlID09PSBcIm1vdXNlZG93blwiICl7XG4gICAgdmlkZW9GdW5jdGlvbmFsQ29yZU1hbmFnZXIuZXhlY3V0ZShuZXcgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXJDb21tYW5kKGUpKTtcbiAgICBcbiAgICAvL3VwZGF0ZUtub2JBbmRWaWRlb0NvbXB1dGVyKGUpO1xuICB9IGVsc2UgaWYoZS50eXBlID09PSBcIm1vdXNlbW92ZVwiIHx8IGUudHlwZSA9PT0gXCJbb2JqZWN0IE1vdXNlRXZlbnRdXCIpIHtcbiAgXG4gICAgdXBkYXRlS25vYkFuZFZpZGVvQ29tcHV0ZXIoZSk7XG4gIH0gZWxzZSB7XG4gICAgdXBkYXRlS25vYkFuZFZpZGVvKGUpO1xuICB9XG4gIC8vIHZpZGVvLnBsYXkoKTtcbn07XG5cbi8qXG5cbnZhciBldmVudFQgPSBuZXcgRXZlbnRUYXJnZXQoKTtcbmNvbnNvbGUubG9nKGV2ZW50VCk7XG52YXIgaGFuZGxlQmFyID0gZnVuY3Rpb24oKSB7XG4gIGNvbnNvbGUubG9nKCdiYXIgd2FzIHRyaWdnZXJlZCcpO1xufTtcblxuZXZlbnRULmFkZEV2ZW50TGlzdGVuZXIoJ2JhcicsIGhhbmRsZUJhcik7XG5ldmVudFQudHJpZ2dlcignYmFyJyk7XG4qL1xuXG4vKlxuXG52YXIgbXl0ZXN0ID0gdmlkZW9qcygndmlkZW9qcycse1xuICBjb250cm9sczogZmFsc2UsXG4gIGF1dG9wbGF5OiBmYWxzZSxcbiAgcHJlbG9hZDogJ2F1dG8nXG59KTsqL1xuLy9teVBsYXllci5hZGRDaGlsZCgnQmlnUGxheUJ1dHRvbicpO1xuLypcblxubXl0ZXN0LnVzZXJBY3RpdmUoZmFsc2UpO1xuXG5cbiovXG5cblxuLy8gVGhpcyBjYXVzZXMgYW55IGBldmVudCBsaXN0ZW5lcnNgIGZvciB0aGUgYGJhcmAgZXZlbnQgdG8gZ2V0IGNhbGxlZFxuLy8gc2VlIEV2ZW50VGFyZ2V0I3RyaWdnZXIgZm9yIG1vcmUgaW5mb3JtYXRpb25cbi8vIGxvZ3MgJ2JhciB3YXMgdHJpZ2dlcmVkJ1xuLypcblxudmFyIHZqc19wcm9ncmVzc19jb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInZqcy1wcm9ncmVzcy1jb250cm9sXCIpWzBdO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0pO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibG9uZy1wcmVzc1wiLCBmdW5jdGlvbihlKSB7XG4gIGNvbnNvbGUubG9nKFwiSGFsbG9cIik7XG59KTtcbiovXG5cbi8vc2Vla2Jhci5oYW5kbGVNb3VzZURvd24oKTtcbi8qXG52YXIgc2Vla0JhclZpZGVvanMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLXJlbWFpbmluZy10aW1lLWRpc3BsYXlcIilbMF07XG5cblxuXG5cbi8vdGVzdCBzdXIgdmlkZW9qc1xuY29uc29sZS5sb2codmpzX3Byb2dyZXNzX2NvbnRyb2wpO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0sIHtcbiAgcGFzc2l2ZTogdHJ1ZVxufSk7Ki9cbi8qXG5cbnNlZWtCYXJWaWRlb2pzLmFkZEV2ZW50TGlzdGVuZXIoWydtb3VzZWRvd24nLCAndG91Y2hzdGFydCddLCBmdW5jdGlvbiAoZSkge1xuICBjb25zb2xlLmxvZyhcImhlbGxvb29vXCIpO1xufSApOyovXG4vKlxuXG5cblxuXG5cbnZhciB2anNfcHJvZ3Jlc3NfY29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ2anMtcHJvZ3Jlc3MtY29udHJvbFwiKVswXTtcbi8vdGVzdCBzdXIgdmlkZW9qc1xuY29uc29sZS5sb2codmpzX3Byb2dyZXNzX2NvbnRyb2wpO1xuXG52anNfcHJvZ3Jlc3NfY29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgY29uc29sZS5sb2coXCJob2xsYVwiKTtcbn0sIHtcbiAgcGFzc2l2ZTogdHJ1ZVxufSk7XG5cblxudmFyIHNlZWtCYXJWaWRlb2pzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInZqcy1zbGlkZXItaG9yaXpvbnRhbFwiKVsxXTtcblxuc2Vla0JhclZpZGVvanMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKXtcbiAgY29uc29sZS5sb2coXCJqYWphamFcIik7XG59KTtcblxudmFyIHAgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmpzLWNvbnRyb2xcIilbNl07XG5wLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSl7XG4gIHBhdXNlKCk7XG4gIGxvbmdwcmVzc0NyZWF0ZVNlZ21lbnRDYWxsYmFjayhlKTtcbiAgY29uc29sZS5sb2coXCJqb2pvXCIpO1xuXG59KTtcbiovXG5cbi8qXG5cbnNlZWtCYXJWaWRlb2pzLmFkZEV2ZW50TGlzdGVuZXIoXCJsb25nLXByZXNzXCIsIGZ1bmN0aW9uKGUpe1xuICBwYXVzZSgpO1xuICBsb25ncHJlc3NDcmVhdGVTZWdtZW50Q2FsbGJhY2soZSk7XG59KTtcbiovXG5cbi8qXG52YXIgcGxheWVyID0gdmlkZW9qcygndmlkZW92anNjb250cm9sJyk7XG5cbnZhciBteUNvbXBvbmVudCA9IG5ldyBDb21wb25lbnQocGxheWVyKTtcbnZhciBidXR0b24gPSBuZXcgQ29tcG9uZW50KHBsYXllcik7XG5cbnZhciBteUJ1dHRvbiA9IG15Q29tcG9uZW50LmFkZENoaWxkKGJ1dHRvbiwge1xuICB0ZXh0OiAnUHJlc3MgTWUnLFxuICBidXR0b25DaGlsZEV4YW1wbGU6IHtcbiAgICBidXR0b25DaGlsZE9wdGlvbjogdHJ1ZVxuICB9XG59KTsqL1xuXG5cblxuLy92YXIgdmlkZW8gPSB2aWRlb2pzKCd2aWRlb3Zqc2NvbnRyb2wnKTtcbiAgLyouYWRkRXZlbnRMaXN0ZW5lcihcIlwiLGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXCJoZWxsb1wiKTtcbn0pOyovXG5cblxuLypcblxudmFyIHBsYXllciA9IHZpZGVvanMoJ3ZpZGVvdmpzY29udHJvbCcsIHtcbiAgY29udHJvbEJhcjoge1xuICAgIGNoaWxkcmVuOiB7XG4gICAgICBwcm9ncmVzc0NvbnRyb2w6IHRydWUsXG4gICAgICBwbGF5VG9nZ2xlOiB0cnVlLFxuICAgICAgY3VycmVudFRpbWVEaXNwbGF5OiB0cnVlLFxuICAgICAgdGltZURpdmlkZXI6IHRydWUsXG4gICAgICBkdXJhdGlvbkRpc3BsYXk6IHRydWUsXG4gICAgICAvL3doZXJlIEkgd2FudCB0byBhZGQgY3VzdG9tIGNvbXBvbmVudCAtIGxvZ28gYnJhbmRcbiAgICAgIC8vbG9nb0JyYW5kIDogdHJ1ZSxcbiAgICAgIC8vd2hlcmUgaSB3YW50IHRvIGFkZCB0aGVhdGVyKG5vdCBmdWxsIHNjcmVlbiwgYnV0IGxhcmdlcikgbW9kZVxuICAgICAgLy90aGVhdGVyTW9kZUJ1dHRvbiA6IHRydWUsXG4gICAgICB2b2x1bWVNZW51QnV0dG9uOiB7XG4gICAgICAgIHZlcnRpY2FsOiB0cnVlLFxuICAgICAgICBpbmxpbmU6IGZhbHNlLFxuICAgICAgICB2b2x1bWVCYXI6IHtcbiAgICAgICAgICB2ZXJ0aWNhbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB2b2x1bWVMZXZlbDogZmFsc2VcbiAgICAgIH0sXG4gICAgICBmdWxsc2NyZWVuVG9nZ2xlOiB0cnVlXG4gICAgfVxuICB9XG59KTsqL1xuIl19