"use strict";

var transparencyRange = document.getElementById("transparencyRange");
var speedcheckboxes00 = document.getElementById("speedcheckboxes-0-0");
var speedcheckboxes01 = document.getElementById("speedcheckboxes-0-1");

var repetitioncheckboxes00 = document.getElementById("Repetitioncheckboxes-0-0");
var repetitioncheckboxes01 = document.getElementById("Repetitioncheckboxes-0-1");

var positionanalysis0 = document.getElementById("position-analysis-0");
var positionanalysis1 = document.getElementById("position-analysis-1");

var HEIGHT = "20px";

var DataAnalyst = function DataAnalyst() {
  //I implemented a command pattern, see : https://www.dofactory.com/javascript/command-design-pattern
  return {
    //execute a command
    analyseData1: function analyseData1() {
      console.log("visualiseAllSegmentsInOne");
      _analyseData();
    }
  };
};

positionanalysis0.addEventListener('click', updatePosition);
positionanalysis1.addEventListener('click', updatePosition);
transparencyRange.addEventListener('input', updateTransparency);
repetitioncheckboxes00.addEventListener('change', updateHeight);
repetitioncheckboxes01.addEventListener('change', updateHeight);
speedcheckboxes00.addEventListener('change', updateHeight);
speedcheckboxes01.addEventListener('change', updateHeight);

function updateTransparency() {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];

    // initial background-color looks like 'rgba(255, 123, 0, 0.5)'
    var initialBackgroundColor = elemSegment.style.backgroundColor;
    var bgColorSeparated = initialBackgroundColor.split(',');
    // last element contains opacity and closing bracket
    // so I have to replace it with new opacity value:

    bgColorSeparated[3] = transparencyRange.value + ')';
    var newColor = bgColorSeparated.join(',');
    newColor = newColor.split(')');
    newColor = newColor.join(' ');

    newColor = newColor + ')';
    elemSegment.style.backgroundColor = newColor;
  }
}

function updatePosition() {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;
  var positionAbsolute = positionanalysis1.checked;

  console.log("positionAbsolute :", positionanalysis1.checked);
  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    if (positionAbsolute) {
      elemSegment.style.position = "absolute";
    } else {
      elemSegment.style.position = "relative";
    }
  }
}

function updateHeight(speed, repet) {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    var height = 20; //(1 + speed * repet);


    if (repetitioncheckboxes00.checked) {
      height = 10 * elemSegment.getAttribute("repetition");
      //divGraphicalObject.style.height = (10  * valueSelectRepet * valueSelectSpeed  ) + "px";
    }
    if (speedcheckboxes00.checked) {
      height *= 2 - elemSegment.getAttribute("speed");
    }
    elemSegment.style.height = height + "px";
  }
}

//Fonction permettant de visualiser tous les segments sur la barre de progression
var _analyseData = function _analyseData() {

  var listSegment = document.getElementsByClassName('segmentWrapper');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    //Get speed and repet
    var selectSpeed = elemSegment.childNodes[1].childNodes[1];
    var selectRepet = elemSegment.childNodes[1].childNodes[3];
    var valueSelectSpeed = selectSpeed.options[selectSpeed.selectedIndex].value;
    var valueSelectRepet = selectRepet.options[selectRepet.selectedIndex].value;
    //    for(var j = 0; j < valueSelectRepet; j++) {


    var divGraphicalObject = document.createElement('div');
    divGraphicalObject.setAttribute("repetition", valueSelectRepet);
    divGraphicalObject.setAttribute("speed", valueSelectSpeed);
    divGraphicalObject.className = 'range-slider_track';
    divGraphicalObject.className = 'data_visualisation';
    divGraphicalObject.style.height = HEIGHT;
    var height = 1 + selectSpeed * selectRepet;
    //divGraphicalObject.style.height = (10  * valueSelectRepet ) + "px";

    //divGraphicalObject.style.backgroundColor = getRandomColor(valueSelectSpeed, valueSelectRepet);
    divGraphicalObject.style.backgroundColor = getColor(valueSelectSpeed, valueSelectRepet, 1);

    //minus 2 because we need to get 2 frame before the segment
    divGraphicalObject.style.marginLeft = elemSegment.style.left; //  segmentFeedback.startPostion;
    divGraphicalObject.style.visibility = "visible";
    divGraphicalObject.style.width = elemSegment.style.width;
    document.getElementById('range-slider-wrapper').appendChild(divGraphicalObject);

    //  }
  }
};

function getColor(speed, repet, trans) {
  var trans = trans; // 50% transparency
  //'241,238,246' , '116,169,207'
  var colorArray = ['#E3F2FD', '#90CAF9', '#42A5F5', '#1E88E5', '#1565C0', '#0D47A1'];

  var hexColor = hexToRgb(colorArray[Math.round(5 - speed * 10 / 2)]);
  var color = 'rgba(' + hexColor.r + ',' + hexColor.g + ',' + hexColor.b + ',';
  color += trans + ')'; // add the transparency
  //console.log(1- Math.round(((speed*10)-1) / 2) );
  console.log(color);

  return color;
}

function getColor3(speed, repet, trans) {
  var trans = trans; // 50% transparency
  //'241,238,246' , '116,169,207'
  var colorArray = ['45, 182, 255', '32, 131, 184', '19, 76, 107', '12,51,76'];
  var color = 'rgba(' + colorArray[Math.round(5 - speed * 10 / 2)] + ',';
  color += trans + ')'; // add the transparency
  //console.log(1- Math.round(((speed*10)-1) / 2) );
  console.log(color);

  return color;
}

function getColor2(speed, repet) {
  var trans = '0.3'; // 50% transparency
  var trans = '1'; // 50% transparency
  //trans += repet * speed;


  var color = 'rgba(' + (255 - speed * 100) + ',' + speed * 100 + ',255' + ',';
  var color = 'rgba( 35 , 64,255,';
  var rainbow = new Rainbow();
  var rgb = hexToRgb(rainbow.colorAt(255 - speed * 255));
  color = 'rgba( ' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',';
  color += trans + ')'; // add the transparency
  console.log(color);
  return color;
}

function getRandomColor() {
  var trans = '0.2'; // 50% transparency
  var color = 'rgba(';
  for (var i = 0; i < 3; i++) {
    color += Math.floor(Math.random() * 255) + ',';
  }
  color += trans + ')'; // add the transparency
  return color;
}

function hexToRgb(hex) {
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

/* Draggable element */
// Make the DIV element draggable:
dragElement(document.getElementById("AnalysisMenuDraggable"));

function dragElement(elmnt) {
  var pos1 = 0,
      pos2 = 0,
      pos3 = 0,
      pos4 = 0;
  if (document.getElementById("AnalysisMenuHeader")) {
    // if present, the header is where you move the DIV from:
    document.getElementById("AnalysisMenuHeader").onmousedown = dragMouseDown;
  } else {
    // otherwise, move the DIV from anywhere inside the DIV:
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = elmnt.offsetTop - pos2 + "px";
    elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
  }

  function closeDragElement() {
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

console.log("*** DataAnalysis Script loaded ***");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFBbmFseXNpc1V0aWxpdGllcy5qcyJdLCJuYW1lcyI6WyJ0cmFuc3BhcmVuY3lSYW5nZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzcGVlZGNoZWNrYm94ZXMwMCIsInNwZWVkY2hlY2tib3hlczAxIiwicmVwZXRpdGlvbmNoZWNrYm94ZXMwMCIsInJlcGV0aXRpb25jaGVja2JveGVzMDEiLCJwb3NpdGlvbmFuYWx5c2lzMCIsInBvc2l0aW9uYW5hbHlzaXMxIiwiSEVJR0hUIiwiRGF0YUFuYWx5c3QiLCJhbmFseXNlRGF0YTEiLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVwZGF0ZVBvc2l0aW9uIiwidXBkYXRlVHJhbnNwYXJlbmN5IiwidXBkYXRlSGVpZ2h0IiwibGlzdFNlZ21lbnQiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiZWxlbVNlZ21lbnQiLCJpIiwibGVuZ3RoIiwiaW5pdGlhbEJhY2tncm91bmRDb2xvciIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiYmdDb2xvclNlcGFyYXRlZCIsInNwbGl0IiwidmFsdWUiLCJuZXdDb2xvciIsImpvaW4iLCJwb3NpdGlvbkFic29sdXRlIiwiY2hlY2tlZCIsInBvc2l0aW9uIiwic3BlZWQiLCJyZXBldCIsImhlaWdodCIsImdldEF0dHJpYnV0ZSIsInNlbGVjdFNwZWVkIiwiY2hpbGROb2RlcyIsInNlbGVjdFJlcGV0IiwidmFsdWVTZWxlY3RTcGVlZCIsIm9wdGlvbnMiLCJzZWxlY3RlZEluZGV4IiwidmFsdWVTZWxlY3RSZXBldCIsImRpdkdyYXBoaWNhbE9iamVjdCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJnZXRDb2xvciIsIm1hcmdpbkxlZnQiLCJsZWZ0IiwidmlzaWJpbGl0eSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJ0cmFucyIsImNvbG9yQXJyYXkiLCJoZXhDb2xvciIsImhleFRvUmdiIiwiTWF0aCIsInJvdW5kIiwiY29sb3IiLCJyIiwiZyIsImIiLCJnZXRDb2xvcjMiLCJnZXRDb2xvcjIiLCJyYWluYm93IiwiUmFpbmJvdyIsInJnYiIsImNvbG9yQXQiLCJnZXRSYW5kb21Db2xvciIsImZsb29yIiwicmFuZG9tIiwiaGV4IiwicmVzdWx0IiwiZXhlYyIsInBhcnNlSW50IiwiZHJhZ0VsZW1lbnQiLCJlbG1udCIsInBvczEiLCJwb3MyIiwicG9zMyIsInBvczQiLCJvbm1vdXNlZG93biIsImRyYWdNb3VzZURvd24iLCJlIiwid2luZG93IiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImNsaWVudFgiLCJjbGllbnRZIiwib25tb3VzZXVwIiwiY2xvc2VEcmFnRWxlbWVudCIsIm9ubW91c2Vtb3ZlIiwiZWxlbWVudERyYWciLCJ0b3AiLCJvZmZzZXRUb3AiLCJvZmZzZXRMZWZ0Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLG9CQUFvQkMsU0FBU0MsY0FBVCxDQUF3QixtQkFBeEIsQ0FBeEI7QUFDQSxJQUFJQyxvQkFBb0JGLFNBQVNDLGNBQVQsQ0FBd0IscUJBQXhCLENBQXhCO0FBQ0EsSUFBSUUsb0JBQW9CSCxTQUFTQyxjQUFULENBQXdCLHFCQUF4QixDQUF4Qjs7QUFFQSxJQUFJRyx5QkFBeUJKLFNBQVNDLGNBQVQsQ0FBd0IsMEJBQXhCLENBQTdCO0FBQ0EsSUFBSUkseUJBQXlCTCxTQUFTQyxjQUFULENBQXdCLDBCQUF4QixDQUE3Qjs7QUFFQSxJQUFJSyxvQkFBb0JOLFNBQVNDLGNBQVQsQ0FBd0IscUJBQXhCLENBQXhCO0FBQ0EsSUFBSU0sb0JBQW9CUCxTQUFTQyxjQUFULENBQXdCLHFCQUF4QixDQUF4Qjs7QUFHQSxJQUFJTyxTQUFTLE1BQWI7O0FBRUEsSUFBSUMsY0FBYyxTQUFkQSxXQUFjLEdBQVc7QUFDM0I7QUFDQSxTQUFPO0FBQ0w7QUFDQUMsa0JBQWMsd0JBQVk7QUFDeEJDLGNBQVFDLEdBQVIsQ0FBWSwyQkFBWjtBQUNBRjtBQUNEO0FBTEksR0FBUDtBQU9ELENBVEQ7O0FB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QUFFSyxPQUFUO0FBQ0ExRixhQUFTMkYsU0FBVCxHQUFxQkMsZ0JBQXJCO0FBQ0E7QUFDQTVGLGFBQVM2RixXQUFULEdBQXVCQyxXQUF2QjtBQUNEOztBQUVELFdBQVNBLFdBQVQsQ0FBcUJULENBQXJCLEVBQXdCO0FBQ3RCQSxRQUFJQSxLQUFLQyxPQUFPQyxLQUFoQjtBQUNBRixNQUFFRyxjQUFGO0FBQ0E7QUFDQVQsV0FBT0UsT0FBT0ksRUFBRUksT0FBaEI7QUFDQVQsV0FBT0UsT0FBT0csRUFBRUssT0FBaEI7QUFDQVQsV0FBT0ksRUFBRUksT0FBVDtBQUNBUCxXQUFPRyxFQUFFSyxPQUFUO0FBQ0E7QUFDQVosVUFBTXZELEtBQU4sQ0FBWXdFLEdBQVosR0FBbUJqQixNQUFNa0IsU0FBTixHQUFrQmhCLElBQW5CLEdBQTJCLElBQTdDO0FBQ0FGLFVBQU12RCxLQUFOLENBQVkyQixJQUFaLEdBQW9CNEIsTUFBTW1CLFVBQU4sR0FBbUJsQixJQUFwQixHQUE0QixJQUEvQztBQUNEOztBQUVELFdBQVNhLGdCQUFULEdBQTRCO0FBQzFCO0FBQ0E1RixhQUFTMkYsU0FBVCxHQUFxQixJQUFyQjtBQUNBM0YsYUFBUzZGLFdBQVQsR0FBdUIsSUFBdkI7QUFDRDtBQUNGOztBQUVEbEYsUUFBUUMsR0FBUixDQUFZLG9DQUFaIiwiZmlsZSI6ImRhdGFBbmFseXNpc1V0aWxpdGllcy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB0cmFuc3BhcmVuY3lSYW5nZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHJhbnNwYXJlbmN5UmFuZ2VcIik7XG52YXIgc3BlZWRjaGVja2JveGVzMDAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwZWVkY2hlY2tib3hlcy0wLTBcIik7XG52YXIgc3BlZWRjaGVja2JveGVzMDEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwZWVkY2hlY2tib3hlcy0wLTFcIik7XG5cbnZhciByZXBldGl0aW9uY2hlY2tib3hlczAwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJSZXBldGl0aW9uY2hlY2tib3hlcy0wLTBcIik7XG52YXIgcmVwZXRpdGlvbmNoZWNrYm94ZXMwMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiUmVwZXRpdGlvbmNoZWNrYm94ZXMtMC0xXCIpO1xuXG52YXIgcG9zaXRpb25hbmFseXNpczAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBvc2l0aW9uLWFuYWx5c2lzLTBcIik7XG52YXIgcG9zaXRpb25hbmFseXNpczEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBvc2l0aW9uLWFuYWx5c2lzLTFcIik7XG5cblxudmFyIEhFSUdIVCA9IFwiMjBweFwiO1xuXG52YXIgRGF0YUFuYWx5c3QgPSBmdW5jdGlvbigpIHtcbiAgLy9JIGltcGxlbWVudGVkIGEgY29tbWFuZCBwYXR0ZXJuLCBzZWUgOiBodHRwczovL3d3dy5kb2ZhY3RvcnkuY29tL2phdmFzY3JpcHQvY29tbWFuZC1kZXNpZ24tcGF0dGVyblxuICByZXR1cm4ge1xuICAgIC8vZXhlY3V0ZSBhIGNvbW1hbmRcbiAgICBhbmFseXNlRGF0YTE6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwidmlzdWFsaXNlQWxsU2VnbWVudHNJbk9uZVwiKTtcbiAgICAgIGFuYWx5c2VEYXRhMSgpO1xuICAgIH0sXG4gIH1cbn07XG5cblxucG9zaXRpb25hbmFseXNpczAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1cGRhdGVQb3NpdGlvbik7XG5wb3NpdGlvbmFuYWx5c2lzMS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHVwZGF0ZVBvc2l0aW9uKTtcbnRyYW5zcGFyZW5jeVJhbmdlLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdXBkYXRlVHJhbnNwYXJlbmN5KTtcbnJlcGV0aXRpb25jaGVja2JveGVzMDAuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlSGVpZ2h0KTtcbnJlcGV0aXRpb25jaGVja2JveGVzMDEuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlSGVpZ2h0KTtcbnNwZWVkY2hlY2tib3hlczAwLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUhlaWdodCk7XG5zcGVlZGNoZWNrYm94ZXMwMS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVIZWlnaHQpO1xuXG5cblxuZnVuY3Rpb24gdXBkYXRlVHJhbnNwYXJlbmN5KCkge1xuICB2YXIgbGlzdFNlZ21lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkYXRhX3Zpc3VhbGlzYXRpb24nKTtcbiAgLy9wbGF5Q2FyZChhcnJheUl0ZW0uaURpdiwgYXJyYXlJdGVtLnN0YXJ0UCk7XG4gIHZhciBlbGVtU2VnbWVudCA9IG51bGw7XG4gIFxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RTZWdtZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgZWxlbVNlZ21lbnQgPSBsaXN0U2VnbWVudFtpXTtcbiAgXG4vLyBpbml0aWFsIGJhY2tncm91bmQtY29sb3IgbG9va3MgbGlrZSAncmdiYSgyNTUsIDEyMywgMCwgMC41KSdcbiAgICB2YXIgaW5pdGlhbEJhY2tncm91bmRDb2xvciA9IGVsZW1TZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvcjtcbiAgICB2YXIgYmdDb2xvclNlcGFyYXRlZCA9IGluaXRpYWxCYWNrZ3JvdW5kQ29sb3Iuc3BsaXQoJywnKTtcbi8vIGxhc3QgZWxlbWVudCBjb250YWlucyBvcGFjaXR5IGFuZCBjbG9zaW5nIGJyYWNrZXRcbi8vIHNvIEkgaGF2ZSB0byByZXBsYWNlIGl0IHdpdGggbmV3IG9wYWNpdHkgdmFsdWU6XG4gICAgXG4gICAgYmdDb2xvclNlcGFyYXRlZFszXSA9IHRyYW5zcGFyZW5jeVJhbmdlLnZhbHVlICsgJyknO1xuICAgIHZhciBuZXdDb2xvciA9IGJnQ29sb3JTZXBhcmF0ZWQuam9pbignLCcpO1xuICAgIG5ld0NvbG9yID0gbmV3Q29sb3Iuc3BsaXQoJyknKTtcbiAgICBuZXdDb2xvciA9IG5ld0NvbG9yLmpvaW4oJyAnKTtcbiAgICBcbiAgICBuZXdDb2xvciA9IG5ld0NvbG9yKyAnKSc7XG4gICAgZWxlbVNlZ21lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIG5ld0NvbG9yIDtcbiAgfVxufVxuXG5cblxuZnVuY3Rpb24gdXBkYXRlUG9zaXRpb24oKSB7XG4gIHZhciBsaXN0U2VnbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2RhdGFfdmlzdWFsaXNhdGlvbicpO1xuICAvL3BsYXlDYXJkKGFycmF5SXRlbS5pRGl2LCBhcnJheUl0ZW0uc3RhcnRQKTtcbiAgdmFyIGVsZW1TZWdtZW50ID0gbnVsbDtcbiAgdmFyIHBvc2l0aW9uQWJzb2x1dGUgPSBwb3NpdGlvbmFuYWx5c2lzMS5jaGVja2VkO1xuICBcbiAgXG4gIGNvbnNvbGUubG9nKFwicG9zaXRpb25BYnNvbHV0ZSA6XCIsIHBvc2l0aW9uYW5hbHlzaXMxLmNoZWNrZWQpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RTZWdtZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgZWxlbVNlZ21lbnQgPSBsaXN0U2VnbWVudFtpXTtcbiAgICBpZihwb3NpdGlvbkFic29sdXRlKXtcbiAgICAgIGVsZW1TZWdtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIH1lbHNlIHtcbiAgICAgIGVsZW1TZWdtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICAgIH1cbiAgfVxufVxuXG5cbmZ1bmN0aW9uIHVwZGF0ZUhlaWdodChzcGVlZCwgcmVwZXQgKXtcbiAgdmFyIGxpc3RTZWdtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGF0YV92aXN1YWxpc2F0aW9uJyk7XG4gIC8vcGxheUNhcmQoYXJyYXlJdGVtLmlEaXYsIGFycmF5SXRlbS5zdGFydFApO1xuICB2YXIgZWxlbVNlZ21lbnQgPSBudWxsO1xuICBcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0U2VnbWVudC5sZW5ndGg7IGkrKykge1xuICAgIGVsZW1TZWdtZW50ID0gbGlzdFNlZ21lbnRbaV07XG4gICAgdmFyIGhlaWdodCA9IDIwOy8vKDEgKyBzcGVlZCAqIHJlcGV0KTtcbiAgICBcbiAgICBcbiAgICBpZihyZXBldGl0aW9uY2hlY2tib3hlczAwLmNoZWNrZWQpe1xuICAgICAgaGVpZ2h0ID0gMTAgICogZWxlbVNlZ21lbnQuZ2V0QXR0cmlidXRlKFwicmVwZXRpdGlvblwiKSA7XG4gICAgICAvL2RpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5oZWlnaHQgPSAoMTAgICogdmFsdWVTZWxlY3RSZXBldCAqIHZhbHVlU2VsZWN0U3BlZWQgICkgKyBcInB4XCI7XG4gICAgICBcbiAgICB9XG4gICAgaWYoc3BlZWRjaGVja2JveGVzMDAuY2hlY2tlZCl7XG4gICAgICBoZWlnaHQgKj0gICAgKDIgLSBlbGVtU2VnbWVudC5nZXRBdHRyaWJ1dGUoXCJzcGVlZFwiKSk7XG4gICAgfVxuICAgIGVsZW1TZWdtZW50LnN0eWxlLmhlaWdodCA9IChoZWlnaHQgKSArIFwicHhcIjtcbiAgICBcbiAgfVxuICBcbiBcblxuXG59XG5cblxuXG5cbi8vRm9uY3Rpb24gcGVybWV0dGFudCBkZSB2aXN1YWxpc2VyIHRvdXMgbGVzIHNlZ21lbnRzIHN1ciBsYSBiYXJyZSBkZSBwcm9ncmVzc2lvblxudmFyIGFuYWx5c2VEYXRhMSA9IGZ1bmN0aW9uICgpIHtcbiAgXG4gIHZhciBsaXN0U2VnbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NlZ21lbnRXcmFwcGVyJyk7XG4gIC8vcGxheUNhcmQoYXJyYXlJdGVtLmlEaXYsIGFycmF5SXRlbS5zdGFydFApO1xuICB2YXIgZWxlbVNlZ21lbnQgPSBudWxsO1xuICBcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0U2VnbWVudC5sZW5ndGg7IGkrKykge1xuICAgIGVsZW1TZWdtZW50ID0gbGlzdFNlZ21lbnRbaV07XG4gICAgLy9HZXQgc3BlZWQgYW5kIHJlcGV0XG4gICAgdmFyIHNlbGVjdFNwZWVkID0gZWxlbVNlZ21lbnQuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzFdO1xuICAgIHZhciBzZWxlY3RSZXBldCA9IGVsZW1TZWdtZW50LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1szXTtcbiAgICB2YXIgdmFsdWVTZWxlY3RTcGVlZCA9IHNlbGVjdFNwZWVkLm9wdGlvbnNbc2VsZWN0U3BlZWQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgdmFyIHZhbHVlU2VsZWN0UmVwZXQgPSBzZWxlY3RSZXBldC5vcHRpb25zW3NlbGVjdFJlcGV0LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuLy8gICAgZm9yKHZhciBqID0gMDsgaiA8IHZhbHVlU2VsZWN0UmVwZXQ7IGorKykge1xuICAgIFxuICAgIFxuICAgICAgdmFyIGRpdkdyYXBoaWNhbE9iamVjdCA9ICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zZXRBdHRyaWJ1dGUoXCJyZXBldGl0aW9uXCIsIHZhbHVlU2VsZWN0UmVwZXQpO1xuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LnNldEF0dHJpYnV0ZShcInNwZWVkXCIsIHZhbHVlU2VsZWN0U3BlZWQpO1xuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LmNsYXNzTmFtZSA9ICdyYW5nZS1zbGlkZXJfdHJhY2snO1xuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LmNsYXNzTmFtZSA9ICdkYXRhX3Zpc3VhbGlzYXRpb24nO1xuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLmhlaWdodCA9IEhFSUdIVDtcbiAgICAgIHZhciBoZWlnaHQgPSAoMSArIHNlbGVjdFNwZWVkICpzZWxlY3RSZXBldCk7XG4gICAgICAvL2RpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5oZWlnaHQgPSAoMTAgICogdmFsdWVTZWxlY3RSZXBldCApICsgXCJweFwiO1xuICAgICAgXG4gICAgLy9kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZ2V0UmFuZG9tQ29sb3IodmFsdWVTZWxlY3RTcGVlZCwgdmFsdWVTZWxlY3RSZXBldCk7XG4gICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRDb2xvcih2YWx1ZVNlbGVjdFNwZWVkLCB2YWx1ZVNlbGVjdFJlcGV0LCAxKTtcbiAgICBcbiAgICAgIC8vbWludXMgMiBiZWNhdXNlIHdlIG5lZWQgdG8gZ2V0IDIgZnJhbWUgYmVmb3JlIHRoZSBzZWdtZW50XG4gICAgICBkaXZHcmFwaGljYWxPYmplY3Quc3R5bGUubWFyZ2luTGVmdCA9IGVsZW1TZWdtZW50LnN0eWxlLmxlZnQ7IC8vICBzZWdtZW50RmVlZGJhY2suc3RhcnRQb3N0aW9uO1xuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS53aWR0aCA9IGVsZW1TZWdtZW50LnN0eWxlLndpZHRoO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhbmdlLXNsaWRlci13cmFwcGVyJykuYXBwZW5kQ2hpbGQoZGl2R3JhcGhpY2FsT2JqZWN0KTtcbiAgXG4gIC8vICB9XG4gIH1cbn07XG5cblxuZnVuY3Rpb24gIGdldENvbG9yKHNwZWVkLCByZXBldCwgdHJhbnMpIHtcbiAgICAgIHZhciB0cmFucyA9IHRyYW5zOyAvLyA1MCUgdHJhbnNwYXJlbmN5XG4gIC8vJzI0MSwyMzgsMjQ2JyAsICcxMTYsMTY5LDIwNydcbiAgICAgIHZhciBjb2xvckFycmF5ID0gWycjRTNGMkZEJywnIzkwQ0FGOScsJyM0MkE1RjUnLCcjMUU4OEU1JywnIzE1NjVDMCcsICcjMEQ0N0ExJ107XG4gIFxuICAgICAgbGV0IGhleENvbG9yICA9IGhleFRvUmdiKGNvbG9yQXJyYXlbTWF0aC5yb3VuZCg1LSgoKHNwZWVkKjEwKSkgLyAyKSApXSk7XG4gIHZhciBjb2xvciA9ICdyZ2JhKCcgKyBoZXhDb2xvci5yKycsJytoZXhDb2xvci5nKycsJytoZXhDb2xvci5iKycsJztcbiAgICAgIGNvbG9yICs9IHRyYW5zICsgJyknOyAvLyBhZGQgdGhlIHRyYW5zcGFyZW5jeVxuICAgICAgLy9jb25zb2xlLmxvZygxLSBNYXRoLnJvdW5kKCgoc3BlZWQqMTApLTEpIC8gMikgKTtcbiAgICAgIGNvbnNvbGUubG9nKGNvbG9yKTtcbiAgXG4gIHJldHVybiBjb2xvcjtcbn1cblxuXG5mdW5jdGlvbiAgZ2V0Q29sb3IzKHNwZWVkLCByZXBldCwgdHJhbnMpIHtcbiAgdmFyIHRyYW5zID0gdHJhbnM7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgLy8nMjQxLDIzOCwyNDYnICwgJzExNiwxNjksMjA3J1xuICB2YXIgY29sb3JBcnJheSA9IFsnNDUsIDE4MiwgMjU1JywnMzIsIDEzMSwgMTg0JywnMTksIDc2LCAxMDcnLCcxMiw1MSw3NiddO1xuICB2YXIgY29sb3IgPSAncmdiYSgnICsgY29sb3JBcnJheVtNYXRoLnJvdW5kKDUtKCgoc3BlZWQqMTApKSAvIDIpICldICsnLCc7XG4gIGNvbG9yICs9IHRyYW5zICsgJyknOyAvLyBhZGQgdGhlIHRyYW5zcGFyZW5jeVxuICAvL2NvbnNvbGUubG9nKDEtIE1hdGgucm91bmQoKChzcGVlZCoxMCktMSkgLyAyKSApO1xuICBjb25zb2xlLmxvZyhjb2xvcik7XG4gIFxuICByZXR1cm4gY29sb3I7XG59XG5cblxuXG5mdW5jdGlvbiAgZ2V0Q29sb3IyKHNwZWVkLCByZXBldCkge1xuICB2YXIgdHJhbnMgPSAnMC4zJzsgLy8gNTAlIHRyYW5zcGFyZW5jeVxuICB2YXIgdHJhbnMgPSAnMSc7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgLy90cmFucyArPSByZXBldCAqIHNwZWVkO1xuICBcbiAgXG4gIHZhciBjb2xvciA9ICdyZ2JhKCcrICgyNTUgLXNwZWVkICogMTAwKSsnLCcgKyhzcGVlZCAqIDEwMCkgKycsMjU1JysnLCcgO1xuICB2YXIgY29sb3IgPSAncmdiYSggMzUgLCA2NCwyNTUsJyA7XG4gIHZhciByYWluYm93ID0gbmV3IFJhaW5ib3coKTtcbiAgdmFyIHJnYiA9ICBoZXhUb1JnYihyYWluYm93LmNvbG9yQXQoMjU1IC0gKHNwZWVkKSoyNTUpKTtcbiAgY29sb3IgPSAncmdiYSggJysgcmdiLnIgKycsJyArIHJnYi5nICsnLCcgKyByZ2IuYiArJywnO1xuICBjb2xvciArPSB0cmFucyArICcpJzsgLy8gYWRkIHRoZSB0cmFuc3BhcmVuY3lcbiAgY29uc29sZS5sb2coY29sb3IgKTtcbiAgcmV0dXJuIGNvbG9yO1xufVxuXG5mdW5jdGlvbiBnZXRSYW5kb21Db2xvcigpIHtcbiAgdmFyIHRyYW5zID0gJzAuMic7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgdmFyIGNvbG9yID0gJ3JnYmEoJztcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICBjb2xvciArPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpICsgJywnO1xuICB9XG4gIGNvbG9yICs9IHRyYW5zICsgJyknOyAvLyBhZGQgdGhlIHRyYW5zcGFyZW5jeVxuICByZXR1cm4gY29sb3I7XG59XG5cblxuZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7XG4gIHZhciByZXN1bHQgPSAvXiM/KFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pJC9pLmV4ZWMoaGV4KTtcbiAgcmV0dXJuIHJlc3VsdCA/IHtcbiAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxuICB9IDogbnVsbDtcbn1cblxuXG5cblxuXG5cbi8qIERyYWdnYWJsZSBlbGVtZW50ICovXG4vLyBNYWtlIHRoZSBESVYgZWxlbWVudCBkcmFnZ2FibGU6XG5kcmFnRWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkFuYWx5c2lzTWVudURyYWdnYWJsZVwiKSk7XG5cbmZ1bmN0aW9uIGRyYWdFbGVtZW50KGVsbW50KSB7XG4gIHZhciBwb3MxID0gMCwgcG9zMiA9IDAsIHBvczMgPSAwLCBwb3M0ID0gMDtcbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiQW5hbHlzaXNNZW51SGVhZGVyXCIpKSB7XG4gICAgLy8gaWYgcHJlc2VudCwgdGhlIGhlYWRlciBpcyB3aGVyZSB5b3UgbW92ZSB0aGUgRElWIGZyb206XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJBbmFseXNpc01lbnVIZWFkZXJcIikub25tb3VzZWRvd24gPSBkcmFnTW91c2VEb3duO1xuICB9IGVsc2Uge1xuICAgIC8vIG90aGVyd2lzZSwgbW92ZSB0aGUgRElWIGZyb20gYW55d2hlcmUgaW5zaWRlIHRoZSBESVY6XG4gICAgZWxtbnQub25tb3VzZWRvd24gPSBkcmFnTW91c2VEb3duO1xuICB9XG4gIFxuICBmdW5jdGlvbiBkcmFnTW91c2VEb3duKGUpIHtcbiAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIGdldCB0aGUgbW91c2UgY3Vyc29yIHBvc2l0aW9uIGF0IHN0YXJ0dXA6XG4gICAgcG9zMyA9IGUuY2xpZW50WDtcbiAgICBwb3M0ID0gZS5jbGllbnRZO1xuICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGNsb3NlRHJhZ0VsZW1lbnQ7XG4gICAgLy8gY2FsbCBhIGZ1bmN0aW9uIHdoZW5ldmVyIHRoZSBjdXJzb3IgbW92ZXM6XG4gICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBlbGVtZW50RHJhZztcbiAgfVxuICBcbiAgZnVuY3Rpb24gZWxlbWVudERyYWcoZSkge1xuICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgY3Vyc29yIHBvc2l0aW9uOlxuICAgIHBvczEgPSBwb3MzIC0gZS5jbGllbnRYO1xuICAgIHBvczIgPSBwb3M0IC0gZS5jbGllbnRZO1xuICAgIHBvczMgPSBlLmNsaWVudFg7XG4gICAgcG9zNCA9IGUuY2xpZW50WTtcbiAgICAvLyBzZXQgdGhlIGVsZW1lbnQncyBuZXcgcG9zaXRpb246XG4gICAgZWxtbnQuc3R5bGUudG9wID0gKGVsbW50Lm9mZnNldFRvcCAtIHBvczIpICsgXCJweFwiO1xuICAgIGVsbW50LnN0eWxlLmxlZnQgPSAoZWxtbnQub2Zmc2V0TGVmdCAtIHBvczEpICsgXCJweFwiO1xuICB9XG4gIFxuICBmdW5jdGlvbiBjbG9zZURyYWdFbGVtZW50KCkge1xuICAgIC8vIHN0b3AgbW92aW5nIHdoZW4gbW91c2UgYnV0dG9uIGlzIHJlbGVhc2VkOlxuICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IG51bGw7XG4gICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBudWxsO1xuICB9XG59XG5cbmNvbnNvbGUubG9nKFwiKioqIERhdGFBbmFseXNpcyBTY3JpcHQgbG9hZGVkICoqKlwiKTtcbiJdfQ==