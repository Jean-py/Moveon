"use strict";

var transparencyRange = document.getElementById("transparencyRange");
var speedcheckboxes00 = document.getElementById("speedcheckboxes-0-0");
var speedcheckboxes01 = document.getElementById("speedcheckboxes-0-1");

var repetitioncheckboxes00 = document.getElementById("Repetitioncheckboxes-0-0");
var repetitioncheckboxes01 = document.getElementById("Repetitioncheckboxes-0-1");

var positionanalysis0 = document.getElementById("position-analysis-0");
var positionanalysis1 = document.getElementById("position-analysis-1");

var HEIGHT = "20px";

var DataAnalyst = function DataAnalyst() {
  //I implemented a command pattern, see : https://www.dofactory.com/javascript/command-design-pattern
  return {
    //execute a command
    analyseData1: function analyseData1() {
      console.log("visualiseAllSegmentsInOne");
      _analyseData();
    }
  };
};

positionanalysis0.addEventListener('click', updatePosition);
positionanalysis1.addEventListener('click', updatePosition);
transparencyRange.addEventListener('input', updateTransparency);
repetitioncheckboxes00.addEventListener('change', updateHeight);
repetitioncheckboxes01.addEventListener('change', updateHeight);
speedcheckboxes00.addEventListener('change', updateHeight);
speedcheckboxes01.addEventListener('change', updateHeight);

function updateTransparency() {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];

    // initial background-color looks like 'rgba(255, 123, 0, 0.5)'
    var initialBackgroundColor = elemSegment.style.backgroundColor;
    var bgColorSeparated = initialBackgroundColor.split(',');
    // last element contains opacity and closing bracket
    // so I have to replace it with new opacity value:

    bgColorSeparated[3] = transparencyRange.value + ')';
    var newColor = bgColorSeparated.join(',');
    newColor = newColor.split(')');
    newColor = newColor.join(' ');

    newColor = newColor + ')';
    elemSegment.style.backgroundColor = newColor;
  }
}

function updatePosition() {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;
  var positionAbsolute = positionanalysis1.checked;

  console.log("positionAbsolute :", positionanalysis1.checked);
  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    if (positionAbsolute) {
      elemSegment.style.position = "absolute";
    } else {
      elemSegment.style.position = "relative";
    }
  }
}

function updateHeight(speed, repet) {
  var listSegment = document.getElementsByClassName('data_visualisation');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    var height = 20; //(1 + speed * repet);


    if (repetitioncheckboxes00.checked) {
      height = 10 * elemSegment.getAttribute("repetition");
      //divGraphicalObject.style.height = (10  * valueSelectRepet * valueSelectSpeed  ) + "px";
    }
    if (speedcheckboxes00.checked) {
      height *= 2 - elemSegment.getAttribute("speed");
    }
    elemSegment.style.height = height + "px";
  }
}

//Fonction permettant de visualiser tous les segments sur la barre de progression
var _analyseData = function _analyseData() {

  var listSegment = document.getElementsByClassName('segmentWrapper');
  //playCard(arrayItem.iDiv, arrayItem.startP);
  var elemSegment = null;

  for (var i = 0; i < listSegment.length; i++) {
    elemSegment = listSegment[i];
    //Get speed and repet
    var selectSpeed = elemSegment.childNodes[1].childNodes[1];
    var selectRepet = elemSegment.childNodes[1].childNodes[3];
    var valueSelectSpeed = selectSpeed.options[selectSpeed.selectedIndex].value;
    var valueSelectRepet = selectRepet.options[selectRepet.selectedIndex].value;
    //    for(var j = 0; j < valueSelectRepet; j++) {


    var divGraphicalObject = document.createElement('div');
    divGraphicalObject.setAttribute("repetition", valueSelectRepet);
    divGraphicalObject.setAttribute("speed", valueSelectSpeed);
    divGraphicalObject.className = 'range-slider_track';
    divGraphicalObject.className = 'data_visualisation';
    divGraphicalObject.style.height = HEIGHT;
    var height = 1 + selectSpeed * selectRepet;
    //divGraphicalObject.style.height = (10  * valueSelectRepet ) + "px";

    //divGraphicalObject.style.backgroundColor = getRandomColor(valueSelectSpeed, valueSelectRepet);
    divGraphicalObject.style.backgroundColor = getColor(valueSelectSpeed, valueSelectRepet, 1);

    //minus 2 because we need to get 2 frame before the segment
    divGraphicalObject.style.marginLeft = elemSegment.style.left; //  segmentFeedback.startPostion;
    divGraphicalObject.style.visibility = "visible";
    divGraphicalObject.style.width = elemSegment.style.width;
    document.getElementById('range-slider-wrapper').appendChild(divGraphicalObject);

    //  }
  }
};

function getColor(speed, repet, trans) {
  var trans = trans; // 50% transparency
  //'241,238,246' , '116,169,207'
  var colorArray = ['193, 211, 244', '189,201,225', '116,169,207', '43,140,190', '4,90,141', '4,90,141'];
  var color = 'rgba(' + colorArray[Math.round(5 - speed * 10 / 2)] + ',';
  color += trans + ')'; // add the transparency
  //console.log(1- Math.round(((speed*10)-1) / 2) );
  console.log(color);

  return color;
}

function getColor2(speed, repet) {
  var trans = '0.3'; // 50% transparency
  var trans = '1'; // 50% transparency
  //trans += repet * speed;


  var color = 'rgba(' + (255 - speed * 100) + ',' + speed * 100 + ',255' + ',';
  var color = 'rgba( 35 , 64,255,';
  var rainbow = new Rainbow();
  var rgb = hexToRgb(rainbow.colorAt(255 - speed * 255));
  color = 'rgba( ' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',';
  color += trans + ')'; // add the transparency
  console.log(color);
  return color;
}

function getRandomColor() {
  var trans = '0.2'; // 50% transparency
  var color = 'rgba(';
  for (var i = 0; i < 3; i++) {
    color += Math.floor(Math.random() * 255) + ',';
  }
  color += trans + ')'; // add the transparency
  return color;
}

function hexToRgb(hex) {
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

/* Draggable element */
// Make the DIV element draggable:
dragElement(document.getElementById("AnalysisMenuDraggable"));

function dragElement(elmnt) {
  var pos1 = 0,
      pos2 = 0,
      pos3 = 0,
      pos4 = 0;
  if (document.getElementById("AnalysisMenuHeader")) {
    // if present, the header is where you move the DIV from:
    document.getElementById("AnalysisMenuHeader").onmousedown = dragMouseDown;
  } else {
    // otherwise, move the DIV from anywhere inside the DIV:
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = elmnt.offsetTop - pos2 + "px";
    elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
  }

  function closeDragElement() {
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

console.log("*** DataAnalysis Script loaded ***");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFBbmFseXNpc1V0aWxpdGllcy5qcyJdLCJuYW1lcyI6WyJ0cmFuc3BhcmVuY3lSYW5nZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzcGVlZGNoZWNrYm94ZXMwMCIsInNwZWVkY2hlY2tib3hlczAxIiwicmVwZXRpdGlvbmNoZWNrYm94ZXMwMCIsInJlcGV0aXRpb25jaGVja2JveGVzMDEiLCJwb3NpdGlvbmFuYWx5c2lzMCIsInBvc2l0aW9uYW5hbHlzaXMxIiwiSEVJR0hUIiwiRGF0YUFuYWx5c3QiLCJhbmFseXNlRGF0YTEiLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVwZGF0ZVBvc2l0aW9uIiwidXBkYXRlVHJhbnNwYXJlbmN5IiwidXBkYXRlSGVpZ2h0IiwibGlzdFNlZ21lbnQiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiZWxlbVNlZ21lbnQiLCJpIiwibGVuZ3RoIiwiaW5pdGlhbEJhY2tncm91bmRDb2xvciIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiYmdDb2xvclNlcGFyYXRlZCIsInNwbGl0IiwidmFsdWUiLCJuZXdDb2xvciIsImpvaW4iLCJwb3NpdGlvbkFic29sdXRlIiwiY2hlY2tlZCIsInBvc2l0aW9uIiwic3BlZWQiLCJyZXBldCIsImhlaWdodCIsImdldEF0dHJpYnV0ZSIsInNlbGVjdFNwZWVkIiwiY2hpbGROb2RlcyIsInNlbGVjdFJlcGV0IiwidmFsdWVTZWxlY3RTcGVlZCIsIm9wdGlvbnMiLCJzZWxlY3RlZEluZGV4IiwidmFsdWVTZWxlY3RSZXBldCIsImRpdkdyYXBoaWNhbE9iamVjdCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJnZXRDb2xvciIsIm1hcmdpbkxlZnQiLCJsZWZ0IiwidmlzaWJpbGl0eSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJ0cmFucyIsImNvbG9yQXJyYXkiLCJjb2xvciIsIk1hdGgiLCJyb3VuZCIsImdldENvbG9yMiIsInJhaW5ib3ciLCJSYWluYm93IiwicmdiIiwiaGV4VG9SZ2IiLCJjb2xvckF0IiwiciIsImciLCJiIiwiZ2V0UmFuZG9tQ29sb3IiLCJmbG9vciIsInJhbmRvbSIsImhleCIsInJlc3VsdCIsImV4ZWMiLCJwYXJzZUludCIsImRyYWdFbGVtZW50IiwiZWxtbnQiLCJwb3MxIiwicG9zMiIsInBvczMiLCJwb3M0Iiwib25tb3VzZWRvd24iLCJkcmFnTW91c2VEb3duIiwiZSIsIndpbmRvdyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJjbGllbnRYIiwiY2xpZW50WSIsIm9ubW91c2V1cCIsImNsb3NlRHJhZ0VsZW1lbnQiLCJvbm1vdXNlbW92ZSIsImVsZW1lbnREcmFnIiwidG9wIiwib2Zmc2V0VG9wIiwib2Zmc2V0TGVmdCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxvQkFBb0JDLFNBQVNDLGNBQVQsQ0FBd0IsbUJBQXhCLENBQXhCO0FBQ0EsSUFBSUMsb0JBQW9CRixTQUFTQyxjQUFULENBQXdCLHFCQUF4QixDQUF4QjtBQUNBLElBQUlFLG9CQUFvQkgsU0FBU0MsY0FBVCxDQUF3QixxQkFBeEIsQ0FBeEI7O0FBRUEsSUFBSUcseUJBQXlCSixTQUFTQyxjQUFULENBQXdCLDBCQUF4QixDQUE3QjtBQUNBLElBQUlJLHlCQUF5QkwsU0FBU0MsY0FBVCxDQUF3QiwwQkFBeEIsQ0FBN0I7O0FBRUEsSUFBSUssb0JBQW9CTixTQUFTQyxjQUFULENBQXdCLHFCQUF4QixDQUF4QjtBQUNBLElBQUlNLG9CQUFvQlAsU0FBU0MsY0FBVCxDQUF3QixxQkFBeEIsQ0FBeEI7O0FBR0EsSUFBSU8sU0FBUyxNQUFiOztBQUVBLElBQUlDLGNBQWMsU0FBZEEsV0FBYyxHQUFXO0FBQzNCO0FBQ0EsU0FBTztBQUNMO0FBQ0FDLGtCQUFjLHdCQUFZO0FBQ3hCQyxjQUFRQyxHQUFSLENBQVksMkJBQVo7QUFDQUY7QUFDRDtBQUxJLEdBQVA7QUFPRCxDQVREOztBQVlBSixrQkFBa0JPLGdCQUFsQixDQUFt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QVQsR0FBcUIsSUFBckI7QUFDQXpGLGFBQVMyRixXQUFULEdBQXVCLElBQXZCO0FBQ0Q7QUFDRjs7QUFFRGhGLFFBQVFDLEdBQVIsQ0FBWSxvQ0FBWiIsImZpbGUiOiJkYXRhQW5hbHlzaXNVdGlsaXRpZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdHJhbnNwYXJlbmN5UmFuZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRyYW5zcGFyZW5jeVJhbmdlXCIpO1xudmFyIHNwZWVkY2hlY2tib3hlczAwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGVlZGNoZWNrYm94ZXMtMC0wXCIpO1xudmFyIHNwZWVkY2hlY2tib3hlczAxID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGVlZGNoZWNrYm94ZXMtMC0xXCIpO1xuXG52YXIgcmVwZXRpdGlvbmNoZWNrYm94ZXMwMCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiUmVwZXRpdGlvbmNoZWNrYm94ZXMtMC0wXCIpO1xudmFyIHJlcGV0aXRpb25jaGVja2JveGVzMDEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIlJlcGV0aXRpb25jaGVja2JveGVzLTAtMVwiKTtcblxudmFyIHBvc2l0aW9uYW5hbHlzaXMwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwb3NpdGlvbi1hbmFseXNpcy0wXCIpO1xudmFyIHBvc2l0aW9uYW5hbHlzaXMxID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwb3NpdGlvbi1hbmFseXNpcy0xXCIpO1xuXG5cbnZhciBIRUlHSFQgPSBcIjIwcHhcIjtcblxudmFyIERhdGFBbmFseXN0ID0gZnVuY3Rpb24oKSB7XG4gIC8vSSBpbXBsZW1lbnRlZCBhIGNvbW1hbmQgcGF0dGVybiwgc2VlIDogaHR0cHM6Ly93d3cuZG9mYWN0b3J5LmNvbS9qYXZhc2NyaXB0L2NvbW1hbmQtZGVzaWduLXBhdHRlcm5cbiAgcmV0dXJuIHtcbiAgICAvL2V4ZWN1dGUgYSBjb21tYW5kXG4gICAgYW5hbHlzZURhdGExOiBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcInZpc3VhbGlzZUFsbFNlZ21lbnRzSW5PbmVcIik7XG4gICAgICBhbmFseXNlRGF0YTEoKTtcbiAgICB9LFxuICB9XG59O1xuXG5cbnBvc2l0aW9uYW5hbHlzaXMwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdXBkYXRlUG9zaXRpb24pO1xucG9zaXRpb25hbmFseXNpczEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1cGRhdGVQb3NpdGlvbik7XG50cmFuc3BhcmVuY3lSYW5nZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZVRyYW5zcGFyZW5jeSk7XG5yZXBldGl0aW9uY2hlY2tib3hlczAwLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUhlaWdodCk7XG5yZXBldGl0aW9uY2hlY2tib3hlczAxLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUhlaWdodCk7XG5zcGVlZGNoZWNrYm94ZXMwMC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVIZWlnaHQpO1xuc3BlZWRjaGVja2JveGVzMDEuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlSGVpZ2h0KTtcblxuXG5cbmZ1bmN0aW9uIHVwZGF0ZVRyYW5zcGFyZW5jeSgpIHtcbiAgdmFyIGxpc3RTZWdtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGF0YV92aXN1YWxpc2F0aW9uJyk7XG4gIC8vcGxheUNhcmQoYXJyYXlJdGVtLmlEaXYsIGFycmF5SXRlbS5zdGFydFApO1xuICB2YXIgZWxlbVNlZ21lbnQgPSBudWxsO1xuICBcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0U2VnbWVudC5sZW5ndGg7IGkrKykge1xuICAgIGVsZW1TZWdtZW50ID0gbGlzdFNlZ21lbnRbaV07XG4gIFxuLy8gaW5pdGlhbCBiYWNrZ3JvdW5kLWNvbG9yIGxvb2tzIGxpa2UgJ3JnYmEoMjU1LCAxMjMsIDAsIDAuNSknXG4gICAgdmFyIGluaXRpYWxCYWNrZ3JvdW5kQ29sb3IgPSBlbGVtU2VnbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgdmFyIGJnQ29sb3JTZXBhcmF0ZWQgPSBpbml0aWFsQmFja2dyb3VuZENvbG9yLnNwbGl0KCcsJyk7XG4vLyBsYXN0IGVsZW1lbnQgY29udGFpbnMgb3BhY2l0eSBhbmQgY2xvc2luZyBicmFja2V0XG4vLyBzbyBJIGhhdmUgdG8gcmVwbGFjZSBpdCB3aXRoIG5ldyBvcGFjaXR5IHZhbHVlOlxuICAgIFxuICAgIGJnQ29sb3JTZXBhcmF0ZWRbM10gPSB0cmFuc3BhcmVuY3lSYW5nZS52YWx1ZSArICcpJztcbiAgICB2YXIgbmV3Q29sb3IgPSBiZ0NvbG9yU2VwYXJhdGVkLmpvaW4oJywnKTtcbiAgICBuZXdDb2xvciA9IG5ld0NvbG9yLnNwbGl0KCcpJyk7XG4gICAgbmV3Q29sb3IgPSBuZXdDb2xvci5qb2luKCcgJyk7XG4gICAgXG4gICAgbmV3Q29sb3IgPSBuZXdDb2xvcisgJyknO1xuICAgIGVsZW1TZWdtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICBuZXdDb2xvciA7XG4gIH1cbn1cblxuXG5cbmZ1bmN0aW9uIHVwZGF0ZVBvc2l0aW9uKCkge1xuICB2YXIgbGlzdFNlZ21lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkYXRhX3Zpc3VhbGlzYXRpb24nKTtcbiAgLy9wbGF5Q2FyZChhcnJheUl0ZW0uaURpdiwgYXJyYXlJdGVtLnN0YXJ0UCk7XG4gIHZhciBlbGVtU2VnbWVudCA9IG51bGw7XG4gIHZhciBwb3NpdGlvbkFic29sdXRlID0gcG9zaXRpb25hbmFseXNpczEuY2hlY2tlZDtcbiAgXG4gIFxuICBjb25zb2xlLmxvZyhcInBvc2l0aW9uQWJzb2x1dGUgOlwiLCBwb3NpdGlvbmFuYWx5c2lzMS5jaGVja2VkKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0U2VnbWVudC5sZW5ndGg7IGkrKykge1xuICAgIGVsZW1TZWdtZW50ID0gbGlzdFNlZ21lbnRbaV07XG4gICAgaWYocG9zaXRpb25BYnNvbHV0ZSl7XG4gICAgICBlbGVtU2VnbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB9ZWxzZSB7XG4gICAgICBlbGVtU2VnbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgICB9XG4gIH1cbn1cblxuXG5mdW5jdGlvbiB1cGRhdGVIZWlnaHQoc3BlZWQsIHJlcGV0ICl7XG4gIHZhciBsaXN0U2VnbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2RhdGFfdmlzdWFsaXNhdGlvbicpO1xuICAvL3BsYXlDYXJkKGFycmF5SXRlbS5pRGl2LCBhcnJheUl0ZW0uc3RhcnRQKTtcbiAgdmFyIGVsZW1TZWdtZW50ID0gbnVsbDtcbiAgXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdFNlZ21lbnQubGVuZ3RoOyBpKyspIHtcbiAgICBlbGVtU2VnbWVudCA9IGxpc3RTZWdtZW50W2ldO1xuICAgIHZhciBoZWlnaHQgPSAyMDsvLygxICsgc3BlZWQgKiByZXBldCk7XG4gICAgXG4gICAgXG4gICAgaWYocmVwZXRpdGlvbmNoZWNrYm94ZXMwMC5jaGVja2VkKXtcbiAgICAgIGhlaWdodCA9IDEwICAqIGVsZW1TZWdtZW50LmdldEF0dHJpYnV0ZShcInJlcGV0aXRpb25cIikgO1xuICAgICAgLy9kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUuaGVpZ2h0ID0gKDEwICAqIHZhbHVlU2VsZWN0UmVwZXQgKiB2YWx1ZVNlbGVjdFNwZWVkICApICsgXCJweFwiO1xuICAgICAgXG4gICAgfVxuICAgIGlmKHNwZWVkY2hlY2tib3hlczAwLmNoZWNrZWQpe1xuICAgICAgaGVpZ2h0ICo9ICAgICgyIC0gZWxlbVNlZ21lbnQuZ2V0QXR0cmlidXRlKFwic3BlZWRcIikpO1xuICAgIH1cbiAgICBlbGVtU2VnbWVudC5zdHlsZS5oZWlnaHQgPSAoaGVpZ2h0ICkgKyBcInB4XCI7XG4gICAgXG4gIH1cbiAgXG4gXG5cblxufVxuXG5cblxuXG4vL0ZvbmN0aW9uIHBlcm1ldHRhbnQgZGUgdmlzdWFsaXNlciB0b3VzIGxlcyBzZWdtZW50cyBzdXIgbGEgYmFycmUgZGUgcHJvZ3Jlc3Npb25cbnZhciBhbmFseXNlRGF0YTEgPSBmdW5jdGlvbiAoKSB7XG4gIFxuICB2YXIgbGlzdFNlZ21lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzZWdtZW50V3JhcHBlcicpO1xuICAvL3BsYXlDYXJkKGFycmF5SXRlbS5pRGl2LCBhcnJheUl0ZW0uc3RhcnRQKTtcbiAgdmFyIGVsZW1TZWdtZW50ID0gbnVsbDtcbiAgXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdFNlZ21lbnQubGVuZ3RoOyBpKyspIHtcbiAgICBlbGVtU2VnbWVudCA9IGxpc3RTZWdtZW50W2ldO1xuICAgIC8vR2V0IHNwZWVkIGFuZCByZXBldFxuICAgIHZhciBzZWxlY3RTcGVlZCA9IGVsZW1TZWdtZW50LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1sxXTtcbiAgICB2YXIgc2VsZWN0UmVwZXQgPSBlbGVtU2VnbWVudC5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbM107XG4gICAgdmFyIHZhbHVlU2VsZWN0U3BlZWQgPSBzZWxlY3RTcGVlZC5vcHRpb25zW3NlbGVjdFNwZWVkLnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICAgIHZhciB2YWx1ZVNlbGVjdFJlcGV0ID0gc2VsZWN0UmVwZXQub3B0aW9uc1tzZWxlY3RSZXBldC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcbi8vICAgIGZvcih2YXIgaiA9IDA7IGogPCB2YWx1ZVNlbGVjdFJlcGV0OyBqKyspIHtcbiAgICBcbiAgICBcbiAgICAgIHZhciBkaXZHcmFwaGljYWxPYmplY3QgPSAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkaXZHcmFwaGljYWxPYmplY3Quc2V0QXR0cmlidXRlKFwicmVwZXRpdGlvblwiLCB2YWx1ZVNlbGVjdFJlcGV0KTtcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zZXRBdHRyaWJ1dGUoXCJzcGVlZFwiLCB2YWx1ZVNlbGVjdFNwZWVkKTtcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5jbGFzc05hbWUgPSAncmFuZ2Utc2xpZGVyX3RyYWNrJztcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5jbGFzc05hbWUgPSAnZGF0YV92aXN1YWxpc2F0aW9uJztcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS5oZWlnaHQgPSBIRUlHSFQ7XG4gICAgICB2YXIgaGVpZ2h0ID0gKDEgKyBzZWxlY3RTcGVlZCAqc2VsZWN0UmVwZXQpO1xuICAgICAgLy9kaXZHcmFwaGljYWxPYmplY3Quc3R5bGUuaGVpZ2h0ID0gKDEwICAqIHZhbHVlU2VsZWN0UmVwZXQgKSArIFwicHhcIjtcbiAgICAgIFxuICAgIC8vZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGdldFJhbmRvbUNvbG9yKHZhbHVlU2VsZWN0U3BlZWQsIHZhbHVlU2VsZWN0UmVwZXQpO1xuICAgICBkaXZHcmFwaGljYWxPYmplY3Quc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZ2V0Q29sb3IodmFsdWVTZWxlY3RTcGVlZCwgdmFsdWVTZWxlY3RSZXBldCwgMSk7XG4gICAgXG4gICAgICAvL21pbnVzIDIgYmVjYXVzZSB3ZSBuZWVkIHRvIGdldCAyIGZyYW1lIGJlZm9yZSB0aGUgc2VnbWVudFxuICAgICAgZGl2R3JhcGhpY2FsT2JqZWN0LnN0eWxlLm1hcmdpbkxlZnQgPSBlbGVtU2VnbWVudC5zdHlsZS5sZWZ0OyAvLyAgc2VnbWVudEZlZWRiYWNrLnN0YXJ0UG9zdGlvbjtcbiAgICAgIGRpdkdyYXBoaWNhbE9iamVjdC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gICAgICBkaXZHcmFwaGljYWxPYmplY3Quc3R5bGUud2lkdGggPSBlbGVtU2VnbWVudC5zdHlsZS53aWR0aDtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYW5nZS1zbGlkZXItd3JhcHBlcicpLmFwcGVuZENoaWxkKGRpdkdyYXBoaWNhbE9iamVjdCk7XG4gIFxuICAvLyAgfVxuICB9XG59O1xuXG5mdW5jdGlvbiAgZ2V0Q29sb3Ioc3BlZWQsIHJlcGV0LCB0cmFucykge1xuICAgICAgdmFyIHRyYW5zID0gdHJhbnM7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgLy8nMjQxLDIzOCwyNDYnICwgJzExNiwxNjksMjA3J1xuICAgICAgdmFyIGNvbG9yQXJyYXkgPSBbJzE5MywgMjExLCAyNDQnLCcxODksMjAxLDIyNScsJzExNiwxNjksMjA3JywnNDMsMTQwLDE5MCcsJzQsOTAsMTQxJywnNCw5MCwxNDEnXTtcbiAgICAgIHZhciBjb2xvciA9ICdyZ2JhKCcgKyBjb2xvckFycmF5W01hdGgucm91bmQoNS0oKChzcGVlZCoxMCkpIC8gMikgKV0gKycsJztcbiAgICAgIGNvbG9yICs9IHRyYW5zICsgJyknOyAvLyBhZGQgdGhlIHRyYW5zcGFyZW5jeVxuICAgICAgLy9jb25zb2xlLmxvZygxLSBNYXRoLnJvdW5kKCgoc3BlZWQqMTApLTEpIC8gMikgKTtcbiAgICAgIGNvbnNvbGUubG9nKGNvbG9yKTtcbiAgXG4gIHJldHVybiBjb2xvcjtcbn1cblxuXG5mdW5jdGlvbiAgZ2V0Q29sb3IyKHNwZWVkLCByZXBldCkge1xuICB2YXIgdHJhbnMgPSAnMC4zJzsgLy8gNTAlIHRyYW5zcGFyZW5jeVxuICB2YXIgdHJhbnMgPSAnMSc7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgLy90cmFucyArPSByZXBldCAqIHNwZWVkO1xuICBcbiAgXG4gIHZhciBjb2xvciA9ICdyZ2JhKCcrICgyNTUgLXNwZWVkICogMTAwKSsnLCcgKyhzcGVlZCAqIDEwMCkgKycsMjU1JysnLCcgO1xuICB2YXIgY29sb3IgPSAncmdiYSggMzUgLCA2NCwyNTUsJyA7XG4gIHZhciByYWluYm93ID0gbmV3IFJhaW5ib3coKTtcbiAgdmFyIHJnYiA9ICBoZXhUb1JnYihyYWluYm93LmNvbG9yQXQoMjU1IC0gKHNwZWVkKSoyNTUpKTtcbiAgY29sb3IgPSAncmdiYSggJysgcmdiLnIgKycsJyArIHJnYi5nICsnLCcgKyByZ2IuYiArJywnO1xuICBjb2xvciArPSB0cmFucyArICcpJzsgLy8gYWRkIHRoZSB0cmFuc3BhcmVuY3lcbiAgY29uc29sZS5sb2coY29sb3IgKTtcbiAgcmV0dXJuIGNvbG9yO1xufVxuXG5mdW5jdGlvbiBnZXRSYW5kb21Db2xvcigpIHtcbiAgdmFyIHRyYW5zID0gJzAuMic7IC8vIDUwJSB0cmFuc3BhcmVuY3lcbiAgdmFyIGNvbG9yID0gJ3JnYmEoJztcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICBjb2xvciArPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpICsgJywnO1xuICB9XG4gIGNvbG9yICs9IHRyYW5zICsgJyknOyAvLyBhZGQgdGhlIHRyYW5zcGFyZW5jeVxuICByZXR1cm4gY29sb3I7XG59XG5cblxuZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7XG4gIHZhciByZXN1bHQgPSAvXiM/KFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pJC9pLmV4ZWMoaGV4KTtcbiAgcmV0dXJuIHJlc3VsdCA/IHtcbiAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxuICB9IDogbnVsbDtcbn1cblxuXG5cblxuXG5cbi8qIERyYWdnYWJsZSBlbGVtZW50ICovXG4vLyBNYWtlIHRoZSBESVYgZWxlbWVudCBkcmFnZ2FibGU6XG5kcmFnRWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkFuYWx5c2lzTWVudURyYWdnYWJsZVwiKSk7XG5cbmZ1bmN0aW9uIGRyYWdFbGVtZW50KGVsbW50KSB7XG4gIHZhciBwb3MxID0gMCwgcG9zMiA9IDAsIHBvczMgPSAwLCBwb3M0ID0gMDtcbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiQW5hbHlzaXNNZW51SGVhZGVyXCIpKSB7XG4gICAgLy8gaWYgcHJlc2VudCwgdGhlIGhlYWRlciBpcyB3aGVyZSB5b3UgbW92ZSB0aGUgRElWIGZyb206XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJBbmFseXNpc01lbnVIZWFkZXJcIikub25tb3VzZWRvd24gPSBkcmFnTW91c2VEb3duO1xuICB9IGVsc2Uge1xuICAgIC8vIG90aGVyd2lzZSwgbW92ZSB0aGUgRElWIGZyb20gYW55d2hlcmUgaW5zaWRlIHRoZSBESVY6XG4gICAgZWxtbnQub25tb3VzZWRvd24gPSBkcmFnTW91c2VEb3duO1xuICB9XG4gIFxuICBmdW5jdGlvbiBkcmFnTW91c2VEb3duKGUpIHtcbiAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIGdldCB0aGUgbW91c2UgY3Vyc29yIHBvc2l0aW9uIGF0IHN0YXJ0dXA6XG4gICAgcG9zMyA9IGUuY2xpZW50WDtcbiAgICBwb3M0ID0gZS5jbGllbnRZO1xuICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGNsb3NlRHJhZ0VsZW1lbnQ7XG4gICAgLy8gY2FsbCBhIGZ1bmN0aW9uIHdoZW5ldmVyIHRoZSBjdXJzb3IgbW92ZXM6XG4gICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBlbGVtZW50RHJhZztcbiAgfVxuICBcbiAgZnVuY3Rpb24gZWxlbWVudERyYWcoZSkge1xuICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgY3Vyc29yIHBvc2l0aW9uOlxuICAgIHBvczEgPSBwb3MzIC0gZS5jbGllbnRYO1xuICAgIHBvczIgPSBwb3M0IC0gZS5jbGllbnRZO1xuICAgIHBvczMgPSBlLmNsaWVudFg7XG4gICAgcG9zNCA9IGUuY2xpZW50WTtcbiAgICAvLyBzZXQgdGhlIGVsZW1lbnQncyBuZXcgcG9zaXRpb246XG4gICAgZWxtbnQuc3R5bGUudG9wID0gKGVsbW50Lm9mZnNldFRvcCAtIHBvczIpICsgXCJweFwiO1xuICAgIGVsbW50LnN0eWxlLmxlZnQgPSAoZWxtbnQub2Zmc2V0TGVmdCAtIHBvczEpICsgXCJweFwiO1xuICB9XG4gIFxuICBmdW5jdGlvbiBjbG9zZURyYWdFbGVtZW50KCkge1xuICAgIC8vIHN0b3AgbW92aW5nIHdoZW4gbW91c2UgYnV0dG9uIGlzIHJlbGVhc2VkOlxuICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IG51bGw7XG4gICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBudWxsO1xuICB9XG59XG5cbmNvbnNvbGUubG9nKFwiKioqIERhdGFBbmFseXNpcyBTY3JpcHQgbG9hZGVkICoqKlwiKTtcbiJdfQ==